{
  "type": "issue",
  "issue": {
    "id": 2966945793,
    "node_id": "I_kwDOABII586w2AAB",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32201",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32201/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32201/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32201/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32201",
    "number": 32201,
    "state": "open",
    "state_reason": null,
    "title": "BIP32: Maximal length of derivation paths and depth of extended keys",
    "body": "Hi folks,\nI have started to notice and report an overflow of the depth of extended keys (as described in BIP32) and some confusion regarding the depth came up. On one hand, the depth is, I'd say indirectly, limited to the range [0 , 255] due to the serialization into a [single byte](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#serialization-format). On the other hand, I don't see an inherent technical reason(s) that would prevent deriving even _lower_ keys (with depth 255+).\n\nThe list of libraries, where I see the depth overflowing is increasing:  https://github.com/libbitcoin/libbitcoin-system/pull/1624, https://github.com/bitcoinj/bitcoinj/pull/3693, https://github.com/tyler-smith/go-bip32/issues/27, https://github.com/MetacoSA/NBitcoin/issues/1260, https://github.com/piotrnar/gocoin/issues/71,...\n\nIn bitcoin repository, the overflow is caught [here](https://github.com/bitcoin/bitcoin/blob/639279e86a6edd6cb68e8cf077d14337bcd13959/src/key.cpp#L360) (and also [here](https://github.com/bitcoin/bitcoin/blob/639279e86a6edd6cb68e8cf077d14337bcd13959/src/pubkey.cpp#L407)) and there is also a [test case](https://github.com/bitcoin/bitcoin/blob/449e2eb7e40f7e14300af92bce8e70a9fde91e1b/src/test/bip32_tests.cpp#L187-L203) for it. But the [derivation paths](https://github.com/bitcoin/bitcoin/blob/449e2eb7e40f7e14300af92bce8e70a9fde91e1b/src/util/bip32.cpp#L18) themselves aren't restricted in the size. Due to the variety of implementations and libraries APIs' for the derivation paths and key derivation (priv -> priv, priv -> pub, pub -> pub), there are also a few different ways how to possibly hit the overflow.\n\nKeys that overflow could be _hiding_ coins (as they would appear to live at different levels), but the valid parents are likely still identifiable via the fingerprints. (Possibly, in some edge-cases, overflown keys could be invalid in such a way that the coins would get locked.) I am not familiar with how the depth is used later on, e.g., after key deserialization, and if it could cause other issues.\n\nAre there any legitimate reasons to allow longer paths and keys with depth > 255? Or shall any such overflow be considered a bug? Not sure, if I can tag Pieter Wuille, to get his thoughts regarding the depth validity and if there is more to it.",
    "user": {
      "login": "quapka",
      "id": 4338671,
      "node_id": "MDQ6VXNlcjQzMzg2NzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4338671?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quapka",
      "html_url": "https://github.com/quapka",
      "followers_url": "https://api.github.com/users/quapka/followers",
      "following_url": "https://api.github.com/users/quapka/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/quapka/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/quapka/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/quapka/subscriptions",
      "organizations_url": "https://api.github.com/users/quapka/orgs",
      "repos_url": "https://api.github.com/users/quapka/repos",
      "events_url": "https://api.github.com/users/quapka/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/quapka/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "created_at": "2025-04-02T16:20:19Z",
    "updated_at": "2025-04-02T16:29:50Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2773125259,
      "node_id": "IC_kwDOABII586lSoiL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2773125259",
      "actor": {
        "login": "quapka",
        "id": 4338671,
        "node_id": "MDQ6VXNlcjQzMzg2NzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4338671?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/quapka",
        "html_url": "https://github.com/quapka",
        "followers_url": "https://api.github.com/users/quapka/followers",
        "following_url": "https://api.github.com/users/quapka/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/quapka/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/quapka/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/quapka/subscriptions",
        "organizations_url": "https://api.github.com/users/quapka/orgs",
        "repos_url": "https://api.github.com/users/quapka/repos",
        "events_url": "https://api.github.com/users/quapka/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/quapka/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-02T16:29:49Z",
      "updated_at": "2025-04-02T16:29:49Z",
      "author_association": "NONE",
      "body": "I would ask about this in the [bips](https://www.github.com/bitcoin/bips) repository, but I don't see the option to raise issues there. And since I don't have a definitive answer, I wasn't sure how to maybe clarify or highlight this in BIP32 itself via a PR.",
      "user": {
        "login": "quapka",
        "id": 4338671,
        "node_id": "MDQ6VXNlcjQzMzg2NzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4338671?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/quapka",
        "html_url": "https://github.com/quapka",
        "followers_url": "https://api.github.com/users/quapka/followers",
        "following_url": "https://api.github.com/users/quapka/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/quapka/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/quapka/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/quapka/subscriptions",
        "organizations_url": "https://api.github.com/users/quapka/orgs",
        "repos_url": "https://api.github.com/users/quapka/repos",
        "events_url": "https://api.github.com/users/quapka/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/quapka/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32201#issuecomment-2773125259",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32201"
    }
  ]
}