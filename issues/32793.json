{
  "type": "issue",
  "issue": {
    "id": 3165217340,
    "node_id": "I_kwDOABII5868qWI8",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32793",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32793/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32793/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32793/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32793",
    "number": 32793,
    "state": "open",
    "state_reason": null,
    "title": "wallet_keypool sleep(1.1) might be flakey",
    "body": "I got a test failure on  PR #32061  that does affect `walletpassphrase` because of `RPCRunLater()` because of replacing libevent's timing loop with `CScheduler`:\n\nhttps://github.com/bitcoin/bitcoin/actions/runs/15790841634/job/44516161778?pr=32061#step:7:3079\n\nHowever, I'm having a very hard time reproducing the test failure.\n\nWe expect wallet to lock in 1 second, sleep for 1.1 seconds and then assert that wallet is locked.\n\nAccording to the log, the time between unlock and the check was 1.22 seconds:\n```\n node0 2025-06-21T02:07:38.682985Z [httpworker.11] [rpc/request.cpp:243] [parse] [rpc] ThreadRPCServer method=walletpassphrase user=__cookie__ \n...\n node0 2025-06-21T02:07:39.902062Z [httpworker.13] [rpc/request.cpp:243] [parse] [rpc] ThreadRPCServer method=getwalletinfo user=__cookie__ \n```\n\nHowever in the failed assertion, `unlocked_until == 1750471659` (instead of expected 0) which translates to `2025-06-21 2:07:39`.\n\nI'm about to push to this branch again so we'll get to see if it fails again. I just thought I'd document the behavior in an issue for now, maybe bumping the test's sleep to 2 full seconds is prudent, or implementing some other kind of `wait_until` logic",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 0,
    "created_at": "2025-06-21T16:41:00Z",
    "updated_at": "2025-06-21T16:41:00Z"
  },
  "events": []
}