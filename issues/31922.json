{
  "type": "issue",
  "issue": {
    "id": 2867817120,
    "node_id": "I_kwDOABII586q72qg",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31922",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31922/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31922/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31922/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31922",
    "number": 31922,
    "state": "open",
    "state_reason": null,
    "title": "Fuzzing Bitcoin Core with clang-16",
    "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nbuilding fails during linking CXX executable bitcoin-wallet\n```\n[ 27%] Building CXX object src/util/CMakeFiles/bitcoin_util.dir/__/sync.cpp.o                                                                                            \n[ 27%] Linking CXX static library libbitcoin_util.a                                                                                                                      \n[ 27%] Built target bitcoin_util                                                                                                                                         \n[ 27%] Building C object src/secp256k1/src/CMakeFiles/secp256k1_precomputed.dir/precomputed_ecmult.c.o                                                                   \n[ 27%] Building C object src/secp256k1/src/CMakeFiles/secp256k1_precomputed.dir/precomputed_ecmult_gen.c.o                                                               \n[ 27%] Built target secp256k1_precomputed                                                                                                                                \n[ 28%] Building C object src/secp256k1/src/CMakeFiles/secp256k1.dir/secp256k1.c.o                                                                                        \n[ 28%] Linking C static library ../lib/libsecp256k1.a                                                                                                                    \n[ 28%] Built target secp256k1                                                                                                                                            \n[ 28%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/bitcoin-wallet.cpp.o                                                                                        \n[ 28%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/init/bitcoin-wallet.cpp.o                                                                                   \n[ 28%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/wallet/wallettool.cpp.o                                                                                     \n[ 28%] Linking CXX executable bitcoin-wallet                                                                                                                             \n/usr/bin/ld: libbitcoin_common.a(bloom.cpp.o): undefined reference to symbol 'exp@@GLIBC_2.29'                                                                           \n/usr/bin/ld: /lib/x86_64-linux-gnu/libm.so.6: error adding symbols: DSO missing from command line                                                                        \nclang: error: linker command failed with exit code 1 (use -v to see invocation)                                                                                          \ngmake[2]: *** [src/CMakeFiles/bitcoin-wallet.dir/build.make:138: src/bitcoin-wallet] Error 1                                                                             \ngmake[1]: *** [CMakeFiles/Makefile2:650: src/CMakeFiles/bitcoin-wallet.dir/all] Error 2                                                                                  \ngmake: *** [Makefile:146: all] Error 2\n```\n\n### Expected behaviour\n\nsuccessful fuzz build.\n\n### Steps to reproduce\n\nUsing master branch:\n\n`cmake -DCMAKE_C_COMPILER=/usr/bin/clang-16 -DCMAKE_CXX_COMPILER=/usr/bin/clang-16 --preset=libfuzzer`\n\nNote here I am using clang-16 because the project fails to even begin the build process due to an error: `uint256.h:133:19: error: call to consteval function 'util::ConstevalHexDigit' is not a constant expression`.  After finding the issue: https://github.com/bitcoin/bitcoin/issues/30947 I set the compiler to clang-16 which begins the build process but fails 28% through.\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster@5b8fd7c3a6b8c9c6a9481d340c3bcc67e74993c3\n\n### Operating system and version\n\nDebian GNU/Linux 12 (bookworm)\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "yancyribbens",
      "id": 817736,
      "node_id": "MDQ6VXNlcjgxNzczNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/817736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yancyribbens",
      "html_url": "https://github.com/yancyribbens",
      "followers_url": "https://api.github.com/users/yancyribbens/followers",
      "following_url": "https://api.github.com/users/yancyribbens/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/yancyribbens/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/yancyribbens/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/yancyribbens/subscriptions",
      "organizations_url": "https://api.github.com/users/yancyribbens/orgs",
      "repos_url": "https://api.github.com/users/yancyribbens/repos",
      "events_url": "https://api.github.com/users/yancyribbens/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/yancyribbens/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 1,
    "created_at": "2025-02-21T03:15:17Z",
    "updated_at": "2025-02-21T08:25:22Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2673888781,
      "node_id": "IC_kwDOABII586fYE4N",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2673888781",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-21T08:25:19Z",
      "updated_at": "2025-02-21T08:25:19Z",
      "author_association": "MEMBER",
      "body": "> [ 28%] Linking CXX executable bitcoin-wallet\n\nThere is no such executable in the fuzz build target. When using cmake, you will have to delete the build folder before configuring. Otherwise the build could be stale.\n\nAlso, your system has clang-19 available to use, see https://packages.debian.org/bookworm/clang-19\n\n\nWhat are the exact steps to reproduce?\n\nI can't reproduce this locally with:\n\n```\nrm -rf ./bld-fzz && cmake -DCMAKE_C_COMPILER=/usr/bin/clang-16 -DCMAKE_CXX_COMPILER=/usr/bin/clang-16 -DSANITIZERS=fuzzer -DBUILD_FOR_FUZZING=ON -B ./bld-fzz && cmake --build ./bld-fzz -j $(nproc)\n```\n\nUnrelated to your issue, it seems there are link issues with ubsan, so you'll probably want to exclude that for now:\n\n```\nrm -rf ./bld-fzz && cmake -DCMAKE_C_COMPILER=/usr/bin/clang-19 -DCMAKE_CXX_COMPILER=/usr/bin/clang-19 --preset=libfuzzer -DSANITIZERS=fuzzer,address  -B ./bld-fzz && cmake --build ./bld-fzz -j $(nproc)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31922#issuecomment-2673888781",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31922"
    }
  ]
}