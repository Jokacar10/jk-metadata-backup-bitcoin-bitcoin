{
  "type": "issue",
  "issue": {
    "id": 3313221631,
    "node_id": "I_kwDOABII587Fe7__",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33176",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33176/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33176/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33176/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33176",
    "number": 33176,
    "state": "open",
    "state_reason": null,
    "title": "build: indefinite mpgen hang on Ubuntu 22.04",
    "body": "Noticed this while looking at #31802, but the same happens on master (273e600e65c2e31a6e9a0bd72b40672aaa503b08).\n\n```bash\n# podman run -it ubuntu:22.04 /bin/bash\n\napt update && apt upgrade -y && apt install build-essential cmake pkgconf python3 git libevent-dev libboost-dev libsqlite3-dev libcapnp-dev capnproto -y\n\ngit clone https://github.com/bitcoin/bitcoin\n\ncd bitcoin\ncmake -B build -DENABLE_IPC=ON\ncmake --build build \n```\nThe build never completes. It hangs indefinitely doing capnp generation:\n```bash\ncmake --build build -j10\n[  1%] Built target crc32c\n[  1%] Generating bitcoin-build-info.h\n[  1%] Built target secp256k1_precomputed\n[  1%] Built target mputil\n[  2%] Built target univalue\n[  4%] Built target bitcoin_consensus\n[  7%] Built target bitcoin_crypto\n[ 10%] Built target minisketch\n[ 10%] Built target bitcoin_cli\n[ 10%] Built target exhaustive_tests\n[ 16%] Built target leveldb\n[ 26%] Built target unitester\n[ 26%] Built target mpgen\n[ 26%] Built target object\n[ 27%] Built target multiprocess\n[ 28%] Built target secp256k1\n[ 28%] Built target noverify_tests\n[ 28%] Generating capnp/mining.capnp.c++, capnp/mining.capnp.h, capnp/mining.capnp.proxy-client.c++, capnp/mining.capnp.proxy-types.h, capnp/mining.capnp.proxy-server.c++, capnp/mining.capnp.proxy-types.c++, capnp/mining.capnp.proxy.h\n[ 28%] Generating capnp/init.capnp.c++, capnp/init.capnp.h, capnp/init.capnp.proxy-client.c++, capnp/init.capnp.proxy-types.h, capnp/init.capnp.proxy-server.c++, capnp/init.capnp.proxy-types.c++, capnp/init.capnp.proxy.h\n[ 28%] Generating capnp/echo.capnp.c++, capnp/echo.capnp.h, capnp/echo.capnp.proxy-client.c++, capnp/echo.capnp.proxy-types.h, capnp/echo.capnp.proxy-server.c++, capnp/echo.capnp.proxy-types.c++, capnp/echo.capnp.proxy.h\n[ 28%] Generating capnp/common.capnp.c++, capnp/common.capnp.h, capnp/common.capnp.proxy-client.c++, capnp/common.capnp.proxy-types.h, capnp/common.capnp.proxy-server.c++, capnp/common.capnp.proxy-types.c++, capnp/common.capnp.proxy.h\n[ 28%] Generating mp/test/foo.capnp.c++, mp/test/foo.capnp.h, mp/test/foo.capnp.proxy-client.c++, mp/test/foo.capnp.proxy-types.h, mp/test/foo.capnp.proxy-server.c++, mp/test/foo.capnp.proxy-types.c++, mp/test/foo.capnp.proxy.h\n[ 28%] Built target tests\n[ 28%] Generating capnp/echo.capnp.c++, capnp/echo.capnp.h, capnp/echo.capnp.proxy-client.c++, capnp/echo.capnp.proxy-types.h, capnp/echo.capnp.proxy-server.c++, capnp/echo.capnp.proxy-types.c++, capnp/echo.capnp.proxy.h\n[ 28%] Generating capnp/common.capnp.c++, capnp/common.capnp.h, capnp/common.capnp.proxy-client.c++, capnp/common.capnp.proxy-types.h, capnp/common.capnp.proxy-server.c++, capnp/common.capnp.proxy-types.c++, capnp/common.capnp.proxy.h\n[ 32%] Built target test_util\n[ 32%] Generating capnp/init.capnp.c++, capnp/init.capnp.h, capnp/init.capnp.proxy-client.c++, capnp/init.capnp.proxy-types.h, capnp/init.capnp.proxy-server.c++, capnp/init.capnp.proxy-types.c++, capnp/init.capnp.proxy.h\n[ 32%] Generating capnp/mining.capnp.c++, capnp/mining.capnp.h, capnp/mining.capnp.proxy-client.c++, capnp/mining.capnp.proxy-types.h, capnp/mining.capnp.proxy-server.c++, capnp/mining.capnp.proxy-types.c++, capnp/mining.capnp.proxy.h\n[ 32%] Built target generate_build_info\n[ 37%] Built target bitcoin_wallet\n[ 37%] Built target bitcoin_clientversion\n[ 46%] Built target bitcoin_common\n[ 52%] Built target bitcoin_util\n[ 67%] Built target bitcoin_node\n[ 67%] Built target bitcoin-cli\n[ 67%] Built target bitcoin-tx\n[ 67%] Built target bitcoin-util\n[ 68%] Built target bitcoin-wallet\n[ 68%] Built target bitcoin\n[ 68%] Built target bitcoind\n```",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 61889416,
        "node_id": "MDU6TGFiZWw2MTg4OTQxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system",
        "name": "Build system",
        "color": "5319e7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 1,
    "created_at": "2025-08-12T08:52:12Z",
    "updated_at": "2025-08-12T10:11:50Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 19106928071,
      "node_id": "LE_lADOABII587Fe7__zwAAAARy3JXH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19106928071",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-12T08:52:13Z",
      "label": {
        "name": "Build system",
        "color": "5319e7"
      }
    },
    {
      "event": "commented",
      "id": 3178692456,
      "node_id": "IC_kwDOABII5869dv9o",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3178692456",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-12T10:11:50Z",
      "updated_at": "2025-08-12T10:11:50Z",
      "author_association": "MEMBER",
      "body": "I also see the sameinfinite hang:\n\n```log\n[ 33%] Generating mp/test/foo.capnp.c++, mp/test/foo.capnp.h, mp/test/foo.capnp.proxy-client.c++, mp/test/foo.capnp.proxy-types.h, mp/test/foo.capnp.proxy-server.c++, mp/test/foo.capnp.proxy-types.c++, mp/test/foo.capnp.proxy.h\n[ 33%] Generating capnp/mining.capnp.c++, capnp/mining.capnp.h, capnp/mining.capnp.proxy-client.c++, capnp/mining.capnp.proxy-types.h, capnp/mining.capnp.proxy-server.c++, capnp/mining.capnp.proxy-types.c++, capnp/mining.capnp.proxy.h\n[ 33%] Generating capnp/echo.capnp.c++, capnp/echo.capnp.h, capnp/echo.capnp.proxy-client.c++, capnp/echo.capnp.proxy-types.h, capnp/echo.capnp.proxy-server.c++, capnp/echo.capnp.proxy-types.c++, capnp/echo.capnp.proxy.h\n[ 33%] Generating capnp/common.capnp.c++, capnp/common.capnp.h, capnp/common.capnp.proxy-client.c++, capnp/common.capnp.proxy-types.h, capnp/common.capnp.proxy-server.c++, capnp/common.capnp.proxy-types.c++, capnp/common.capnp.proxy.h\n[ 33%] Generating capnp/init.capnp.c++, capnp/init.capnp.h, capnp/init.capnp.proxy-client.c++, capnp/init.capnp.proxy-types.h, capnp/init.capnp.proxy-server.c++, capnp/init.capnp.proxy-types.c++, capnp/init.capnp.proxy.h\n[ 33%] Generating capnp/mining.capnp.c++, capnp/mining.capnp.h, capnp/mining.capnp.proxy-client.c++, capnp/mining.capnp.proxy-types.h, capnp/mining.capnp.proxy-server.c++, capnp/mining.capnp.proxy-types.c++, capnp/mining.capnp.proxy.h\n[ 33%] Built target generate_build_info\nConsolidate compiler generated dependencies of target bitcoin_clientversion\nConsolidate compiler generated dependencies of target bitcoin_util\n[ 33%] Built target bitcoin_clientversion\nConsolidate compiler generated dependencies of target bitcoin_common\nConsolidate compiler generated dependencies of target bitcoin_wallet\n[ 38%] Built target bitcoin_util\nConsolidate compiler generated dependencies of target bitcoin_node\nConsolidate compiler generated dependencies of target bitcoin\n[ 38%] Built target bitcoin\n[ 47%] Built target bitcoin_common\n[ 47%] Building CXX object src/CMakeFiles/bitcoin-cli.dir/bitcoin-cli.cpp.o\n[ 47%] Building CXX object src/CMakeFiles/bitcoin-util.dir/bitcoin-util.cpp.o\n[ 47%] Building CXX object src/CMakeFiles/bitcoin-tx.dir/bitcoin-tx.cpp.o\n[ 52%] Built target bitcoin_wallet\n[ 52%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/bitcoin-wallet.cpp.o\n[ 67%] Built target bitcoin_node\n[ 67%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/init/bitcoin-wallet.cpp.o\n[ 67%] Linking CXX executable ../bin/bitcoin-util\n[ 67%] Building CXX object src/CMakeFiles/bitcoind.dir/bitcoind.cpp.o\n[ 67%] Built target bitcoin-util\n[ 68%] Building CXX object src/CMakeFiles/bitcoin-wallet.dir/wallet/wallettool.cpp.o\n[ 70%] Building CXX object src/CMakeFiles/bitcoind.dir/init/bitcoind.cpp.o\n[ 70%] Linking CXX executable ../bin/bitcoin-cli\n[ 70%] Linking CXX executable ../bin/bitcoin-tx\n[ 70%] Built target bitcoin-cli\n[ 70%] Linking CXX executable ../bin/bitcoind\n[ 70%] Built target bitcoin-tx\n[ 70%] Linking CXX executable ../bin/bitcoin-wallet\n[ 70%] Built target bitcoind\n[ 70%] Built target bitcoin-wallet\n^Cgmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc.dir/build.make:96: src/ipc/capnp/echo.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc_headers.dir/build.make:98: src/ipc/capnp/echo.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc_headers.dir/build.make:120: src/ipc/capnp/init.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc.dir/build.make:74: src/ipc/capnp/common.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc_headers.dir/build.make:76: src/ipc/capnp/common.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc.dir/build.make:140: src/ipc/capnp/mining.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc_headers.dir/build.make:142: src/ipc/capnp/mining.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/libmultiprocess/test/CMakeFiles/mptest.dir/build.make:74: src/ipc/libmultiprocess/test/mp/test/foo.capnp.c++] Interrupt\ngmake[2]: *** [src/ipc/CMakeFiles/bitcoin_ipc.dir/build.make:118: src/ipc/capnp/init.capnp.c++] Interrupt\ngmake[1]: *** [CMakeFiles/Makefile2:1502: src/ipc/libmultiprocess/test/CMakeFiles/mptest.dir/all] Interrupt\ngmake[1]: *** [CMakeFiles/Makefile2:1737: src/ipc/CMakeFiles/bitcoin_ipc.dir/all] Interrupt\ngmake[1]: *** [CMakeFiles/Makefile2:1764: src/ipc/CMakeFiles/bitcoin_ipc_headers.dir/all] Interrupt\ngmake: *** [Makefile:146: all] Interrupt\n```",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33176#issuecomment-3178692456",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33176"
    }
  ]
}