{
  "type": "issue",
  "issue": {
    "id": 2887617929,
    "node_id": "I_kwDOABII586sHY2J",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31965",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31965/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31965/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31965/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31965",
    "number": 31965,
    "state": "open",
    "state_reason": null,
    "title": "Revisiting us self-hosting parts of our CI",
    "body": "The project currently self-hosts the runners for ~half of our CI jobs. The other half of the CI jobs run on GitHub Actions hosted by GitHub. In an offline discussion, the question came up if we should move the self-hosted runners to some other non-self-hosted infrastructure or if there are other ways to improve on the following areas:\n\n- reduce infrastructure maintenance burden: someone has to take care of the servers, but that's (normally) not too much work. Shouldn't be a single person maintaining it to reduce the bus-factor and single point of failures. \n- increase performance: generally faster CI is welcome, maybe solvable with more CPU, but also related to https://github.com/bitcoin/bitcoin/issues/30852 - not clear yet what exactly is targeted - and performance could be improved with self-hosted CI too - no need to go non-self-hosted for this alone.\n- increase security/robustness: generally, running public jobs CI on self-hosted hardware is a security risk and [not recommended](https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners#self-hosted-runner-security) - making it (more) secure is possible, but probably a lot of work that we might want to outsource to e.g. a company that specializes on it\n\nCurrently, the self-hosted CI has implicit caches for docker images, ccache, depends (sources and built). Caching would need to be implemented on non-selfhosted runners too. Some more discussion about the implicit caches is [here](https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2558198430).\n\nSome mentioned ideas, but there are probably more approaches worth exploring:\n- Github Actions: move all jobs to GitHub actions. GitHub cache is limited to 10GB, which is too small. PR authors can't rerun PRs. Even more dependency on GitHub/Microsoft, but we already have half of the jobs there.  \nSee also [#30304 ci: Move more tasks to GHA?](https://github.com/bitcoin/bitcoin/issues/30304).\n- runson.com: would need to move the cirrus jobs to GitHub Actions format. Allows to use a way bigger cache, potentially cheaper than GitHub actions?\n- [actions-runner-controller](https://github.com/actions/actions-runner-controller): bring our own machines for a kubernetes cluster, or rent pods on demand and let the controller spin up things for new jobs. In theory, helps with performance and probably with security. Would need to move from Cirrus to GitHub Actions.\n- [Cirrus-CI on Cloud machines](https://cirrus-ci.org/guide/supported-computing-services/): use cloud machines and keep Cirrus. Needs us to figure out caching.\n- [bitcoin-core-cirrus-runner](https://github.com/0xB10C/bitcoin-core-cirrus-runner): is a experimental NixOS module that runs jobs in a isolated, ephemeral, and minimal QEMU VM. Would still be self-hosted CI, does address some of the security concerns about the current CI, not production ready yet, and probably a more complex solutions that wound't reduce maintenance burden in the long run.\n- Keep status status quo: use self-hosted, persistent, but potentially insecure Cirrus runners - \"if it ain't broken, don't fix it\"",
    "user": {
      "login": "0xB10C",
      "id": 19157360,
      "node_id": "MDQ6VXNlcjE5MTU3MzYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB10C",
      "html_url": "https://github.com/0xB10C",
      "followers_url": "https://api.github.com/users/0xB10C/followers",
      "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB10C/orgs",
      "repos_url": "https://api.github.com/users/0xB10C/repos",
      "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/0xB10C/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 2,
    "created_at": "2025-02-28T16:42:02Z",
    "updated_at": "2025-03-09T12:13:27Z"
  },
  "events": [
    {
      "event": "subscribed",
      "id": 16515258976,
      "node_id": "SE_lADOABII586sHY2JzwAAAAPYYtpg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16515258976",
      "actor": {
        "login": "m3dwards",
        "id": 1204616,
        "node_id": "MDQ6VXNlcjEyMDQ2MTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1204616?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/m3dwards",
        "html_url": "https://github.com/m3dwards",
        "followers_url": "https://api.github.com/users/m3dwards/followers",
        "following_url": "https://api.github.com/users/m3dwards/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/m3dwards/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/m3dwards/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/m3dwards/subscriptions",
        "organizations_url": "https://api.github.com/users/m3dwards/orgs",
        "repos_url": "https://api.github.com/users/m3dwards/repos",
        "events_url": "https://api.github.com/users/m3dwards/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/m3dwards/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-28T16:44:26Z"
    },
    {
      "event": "commented",
      "id": 2692548770,
      "node_id": "IC_kwDOABII586gfQii",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2692548770",
      "actor": {
        "login": "rishavtarway",
        "id": 110075716,
        "node_id": "U_kgDOBo-fRA",
        "avatar_url": "https://avatars.githubusercontent.com/u/110075716?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rishavtarway",
        "html_url": "https://github.com/rishavtarway",
        "followers_url": "https://api.github.com/users/rishavtarway/followers",
        "following_url": "https://api.github.com/users/rishavtarway/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rishavtarway/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rishavtarway/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rishavtarway/subscriptions",
        "organizations_url": "https://api.github.com/users/rishavtarway/orgs",
        "repos_url": "https://api.github.com/users/rishavtarway/repos",
        "events_url": "https://api.github.com/users/rishavtarway/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rishavtarway/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-02T04:16:04Z",
      "updated_at": "2025-03-02T06:23:03Z",
      "author_association": "NONE",
      "body": "@0xB10C  Will there be possibility we can think of more on  this idea : \n\n1. Hybrid Approach with Optimized Caching:\n\n=>  Key Factors to this approach \n\ni) Instead of a complete switch, maintain a smaller, more secure self-hosted infrastructure specifically for caching.\n\nii ) Use GitHub Actions or another cloud-based CI for the majority of the job execution.\n\niii) Develop a robust, distributed caching system (e.g., using a dedicated cloud storage service or a distributed cache like Redis) that integrates with both self-hosted and cloud CI.\n\nin this way this allows for the speed of cloud CI, while utilizing the control of self hosted for critical caching.",
      "user": {
        "login": "rishavtarway",
        "id": 110075716,
        "node_id": "U_kgDOBo-fRA",
        "avatar_url": "https://avatars.githubusercontent.com/u/110075716?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rishavtarway",
        "html_url": "https://github.com/rishavtarway",
        "followers_url": "https://api.github.com/users/rishavtarway/followers",
        "following_url": "https://api.github.com/users/rishavtarway/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rishavtarway/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rishavtarway/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rishavtarway/subscriptions",
        "organizations_url": "https://api.github.com/users/rishavtarway/orgs",
        "repos_url": "https://api.github.com/users/rishavtarway/repos",
        "events_url": "https://api.github.com/users/rishavtarway/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rishavtarway/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31965#issuecomment-2692548770",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31965"
    },
    {
      "event": "mentioned",
      "id": 16524236976,
      "node_id": "MEE_lADOABII586sHY2JzwAAAAPY69iw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16524236976",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-02T06:23:24Z"
    },
    {
      "event": "subscribed",
      "id": 16524236981,
      "node_id": "SE_lADOABII586sHY2JzwAAAAPY69i1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16524236981",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-02T06:23:24Z"
    },
    {
      "event": "commented",
      "id": 2694584064,
      "node_id": "IC_kwDOABII586gnBcA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2694584064",
      "actor": {
        "login": "m3dwards",
        "id": 1204616,
        "node_id": "MDQ6VXNlcjEyMDQ2MTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1204616?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/m3dwards",
        "html_url": "https://github.com/m3dwards",
        "followers_url": "https://api.github.com/users/m3dwards/followers",
        "following_url": "https://api.github.com/users/m3dwards/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/m3dwards/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/m3dwards/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/m3dwards/subscriptions",
        "organizations_url": "https://api.github.com/users/m3dwards/orgs",
        "repos_url": "https://api.github.com/users/m3dwards/repos",
        "events_url": "https://api.github.com/users/m3dwards/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/m3dwards/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-03T14:29:40Z",
      "updated_at": "2025-03-03T14:49:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "CC @willcl-ark\n\nThere are also some companies that offer drop in replacements to Github runners such as [BuildJet](https://buildjet.com/for-github-actions). They will also often provide their own caching options.\n\nI quite like the idea of all of CI being defined as Github Actions which means all jobs should be runnable on forks (if a little slower as they wouldn't be on bigger runners).\n\nAssuming we were happy to migrate the jobs to Github Actions, the next consideration is which runners to use: \n\nTo put this on a spectrum of easy -> hard to administer and maintain it would be:\n\n[Github's runners ](https://docs.github.com/en/actions/using-github-hosted-runners/using-github-hosted-runners/about-github-hosted-runners#standard-github-hosted-runners-for-public-repositories)-> [BuildJet](https://buildjet.com/for-github-actions) -> [runs-on.com](https://runs-on.com/) -> [actions-runner-controller](https://github.com/actions/actions-runner-controller)\n\nThen to consider the cost per minute from expensive -> inexpensive on an 8 core runner:\n\n[Github's runners $0.032](https://docs.github.com/en/billing/managing-billing-for-your-products/managing-billing-for-github-actions/about-billing-for-github-actions) -> [actions-runner-controller $??](https://github.com/actions/actions-runner-controller) -> [BuildJet $0.016](https://buildjet.com/for-github-actions/docs/about/pricing) -> [runs-on.com $0.0034](https://runs-on.com/pricing/)\n\nActions runner controller is hard to estimate cost as it would depend on the autoscaling of the k8s cluster.\n\nIt's my opinion that the sweet spot between cost and administration burden is between `BuildJet` and `Runs-On`. `BuildJet` requires almost no administration and `Runs-On` advertises as only needing a few hours a year but I think we should imagine that there would need to be a few people comfortable enough with AWS to fix things once a year or so if something goes wrong. Runs-On is provisioned using a Cloud Formation template.\n\nAssuming we have enough people happy to administer a runs-on.com AWS stack (I would be) then I think this is perhaps worth exploring moving jobs there. If people want as little administration as possible, perhaps we should look at BuildJet (or equivalents)",
      "user": {
        "login": "m3dwards",
        "id": 1204616,
        "node_id": "MDQ6VXNlcjEyMDQ2MTY=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1204616?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/m3dwards",
        "html_url": "https://github.com/m3dwards",
        "followers_url": "https://api.github.com/users/m3dwards/followers",
        "following_url": "https://api.github.com/users/m3dwards/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/m3dwards/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/m3dwards/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/m3dwards/subscriptions",
        "organizations_url": "https://api.github.com/users/m3dwards/orgs",
        "repos_url": "https://api.github.com/users/m3dwards/repos",
        "events_url": "https://api.github.com/users/m3dwards/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/m3dwards/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31965#issuecomment-2694584064",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31965"
    },
    {
      "event": "mentioned",
      "id": 16535420982,
      "node_id": "MEE_lADOABII586sHY2JzwAAAAPZloA2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16535420982",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-03T14:29:41Z"
    },
    {
      "event": "subscribed",
      "id": 16535421012,
      "node_id": "SE_lADOABII586sHY2JzwAAAAPZloBU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16535421012",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-03T14:29:41Z"
    },
    {
      "event": "subscribed",
      "id": 16538177206,
      "node_id": "SE_lADOABII586sHY2JzwAAAAPZwI62",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16538177206",
      "actor": {
        "login": "s373nZ",
        "id": 118189041,
        "node_id": "U_kgDOBwtr8Q",
        "avatar_url": "https://avatars.githubusercontent.com/u/118189041?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/s373nZ",
        "html_url": "https://github.com/s373nZ",
        "followers_url": "https://api.github.com/users/s373nZ/followers",
        "following_url": "https://api.github.com/users/s373nZ/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/s373nZ/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/s373nZ/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/s373nZ/subscriptions",
        "organizations_url": "https://api.github.com/users/s373nZ/orgs",
        "repos_url": "https://api.github.com/users/s373nZ/repos",
        "events_url": "https://api.github.com/users/s373nZ/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/s373nZ/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-03T17:28:44Z"
    },
    {
      "event": "labeled",
      "id": 16644771694,
      "node_id": "LE_lADOABII586sHY2JzwAAAAPgGw9u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16644771694",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-09T12:13:27Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    }
  ]
}