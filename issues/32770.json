{
  "type": "issue",
  "issue": {
    "id": 3156815360,
    "node_id": "I_kwDOABII5868KS4A",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32770",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32770/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32770/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32770/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32770",
    "number": 32770,
    "state": "open",
    "state_reason": null,
    "title": "Slow unit tests delay functional tests and leave CPU unused",
    "body": "When running the unit and functional tests under a sanitizer (as done in some CI tasks), the CPU usage could be better. Currently, one or two slow running unit tests idle along on a single CPU thread. \n\nCan be seen in this graph, which shows an initial spike during compilation, then the slow unit tests, and finally the functional test CPU usage:\n![Image](https://github.com/user-attachments/assets/66e21580-24d4-474f-9a95-b704f964f4cf)\n\nIt would be nice to somehow fix this. Options are:\n\n* Speed up the unit tests (not sure how easy this is, or if this is possible at all)\n* Run the functional tests along with the ctest-tests in parallel somehow\n* Something else?",
    "user": {
      "login": "maflcko",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maflcko",
      "html_url": "https://github.com/maflcko",
      "followers_url": "https://api.github.com/users/maflcko/followers",
      "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
      "organizations_url": "https://api.github.com/users/maflcko/orgs",
      "repos_url": "https://api.github.com/users/maflcko/repos",
      "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/maflcko/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 2,
    "created_at": "2025-06-18T13:07:41Z",
    "updated_at": "2025-06-18T13:42:04Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 18210265499,
      "node_id": "LE_lADOABII5868KS4AzwAAAAQ9apmb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18210265499",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-18T13:07:59Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "commented",
      "id": 2984171765,
      "node_id": "IC_kwDOABII586x3tj1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2984171765",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-18T13:14:58Z",
      "updated_at": "2025-06-18T13:14:58Z",
      "author_association": "MEMBER",
      "body": "I have noticed similar when investigating tangential Ci changes. It is possible to run more unit tests in parallel, but we still always wait for the slowest test.\n\nIf I recall itâ€™s a secp256 test, and there was perhaps a suggestion to disable it (mostly), or have it run weekly or something?",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32770#issuecomment-2984171765",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32770"
    },
    {
      "event": "commented",
      "id": 2984264066,
      "node_id": "IC_kwDOABII586x4EGC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2984264066",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-18T13:38:37Z",
      "updated_at": "2025-06-18T13:42:04Z",
      "author_association": "MEMBER",
      "body": "Looking at https://github.com/bitcoin/bitcoin/actions/runs/15714959524/job/44282297642#step:6:4481, it seems there are several affected tests:\n\n```\n...\n135/142 Test  #66: net_tests ............................   Passed  243.14 sec\n136/142 Test #139: wallet_tests .........................   Passed  108.31 sec\n137/142 Test #138: wallet_crypto_tests ..................   Passed  116.03 sec\n138/142 Test   #5: secp256k1_noverify_tests .............   Passed  426.46 sec\n139/142 Test #129: coinselector_tests ...................   Passed  268.56 sec\n140/142 Test   #9: bench_sanity_check ...................   Passed  487.70 sec\n141/142 Test  #32: coins_tests ..........................   Passed  559.64 sec\n142/142 Test   #6: secp256k1_tests ......................   Passed  590.82 sec\n```\n\nedit:\n\nTsan:\n\n```\n[20:37:36.776] 136/142 Test  #32: coins_tests ..........................   Passed  122.51 sec\n[20:37:38.388] 137/142 Test  #30: checkqueue_tests .....................   Passed  124.34 sec\n[20:37:46.297] 138/142 Test #139: wallet_tests .........................   Passed   29.87 sec\n[20:38:40.235] 139/142 Test   #9: bench_sanity_check ...................   Passed  193.33 sec\n[20:38:42.459] 140/142 Test #129: coinselector_tests ...................   Passed   98.51 sec\n[20:42:20.591] 141/142 Test   #5: secp256k1_noverify_tests .............   Passed  413.70 sec\n[20:48:11.703] 142/142 Test   #6: secp256k1_tests ......................   Passed  764.81 sec\n```\n\nmsan:\n\n```\n[13:02:32.115] 134/141 Test  #31: coins_tests ..........................   Passed   98.23 sec\n[13:02:40.482] 135/141 Test #138: wallet_tests .........................   Passed   22.38 sec\n[13:02:53.347] 136/141 Test #114: txvalidationcache_tests ..............   Passed   67.72 sec\n[13:03:29.497] 137/141 Test #128: coinselector_tests ...................   Passed   78.19 sec\n[13:03:32.923] 138/141 Test  #29: checkqueue_tests .....................   Passed  163.40 sec\n[13:04:12.828] 139/141 Test   #8: bench_sanity_check ...................   Passed  207.55 sec\n[13:05:08.881] 140/141 Test   #5: secp256k1_noverify_tests .............   Passed  263.61 sec\n[13:08:27.015] 141/141 Test   #6: secp256k1_tests ......................   Passed  461.74 sec\n```",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32770#issuecomment-2984264066",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32770"
    }
  ]
}