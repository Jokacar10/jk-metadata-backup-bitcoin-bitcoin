{
  "type": "issue",
  "issue": {
    "id": 3322502078,
    "node_id": "I_kwDOABII587GCVu-",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33188",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33188/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33188/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33188/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33188",
    "number": 33188,
    "state": "open",
    "state_reason": null,
    "title": "asan: GCC warning about use-after-free",
    "body": "GCC is warning about use-after-free in the recently added ASAN unpoisoning:\n```bash\n# gcc (GCC) 15.2.1 20250808 (Red Hat 15.2.1-1)\n# cmake -B build -DSANITIZERS=address\nIn file included from /root/bitcoin/src/util/check.h:131,\n                 from /root/bitcoin/src/random.h:13,\n                 from /root/bitcoin/src/test/util/random.h:9,\n                 from /root/bitcoin/src/test/util/setup_common.h:19,\n                 from /root/bitcoin/src/test/util/setup_common.cpp:5:\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7,\n    inlined from ‘std::pair<CMutableTransaction, long int> TestChain100Setup::CreateValidTransaction(const std::vector<std::shared_ptr<const CTransaction> >&, const std::vector<COutPoint>&, int, const std::vector<CKey>&, const std::vector<CTxOut>&, const std::optional<CFeeRate>&, const std::optional<unsigned int>&)’ at /root/bitcoin/src/test/util/setup_common.cpp:486:1:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn file included from /root/bitcoin/src/memusage.h:10,\n                 from /root/bitcoin/src/core_memusage.h:10,\n                 from /root/bitcoin/src/kernel/mempool_entry.h:10,\n                 from /root/bitcoin/src/test/util/setup_common.cpp:18:\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7,\n    inlined from ‘std::pair<CMutableTransaction, long int> TestChain100Setup::CreateValidTransaction(const std::vector<std::shared_ptr<const CTransaction> >&, const std::vector<COutPoint>&, int, const std::vector<CKey>&, const std::vector<CTxOut>&, const std::optional<CFeeRate>&, const std::optional<unsigned int>&)’ at /root/bitcoin/src/test/util/setup_common.cpp:486:1:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n<snip>\nIn file included from /root/bitcoin/src/util/check.h:131,\n                 from /root/bitcoin/src/random.h:13,\n                 from /root/bitcoin/src/test/util/random.h:9,\n                 from /root/bitcoin/src/test/util/setup_common.h:19,\n                 from /root/bitcoin/src/test/transaction_tests.cpp:7:\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn file included from /root/bitcoin/src/memusage.h:10,\n                 from /root/bitcoin/src/core_memusage.h:10,\n                 from /root/bitcoin/src/coins.h:10,\n                 from /root/bitcoin/src/script/sign.h:10,\n                 from /root/bitcoin/src/test/transaction_tests.cpp:23:\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7,\n    inlined from ‘void transaction_tests::max_standard_legacy_sigops::test_method()’ at /root/bitcoin/src/test/transaction_tests.cpp:1150:1:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7,\n    inlined from ‘void transaction_tests::spends_witness_prog::test_method()’ at /root/bitcoin/src/test/transaction_tests.cpp:1305:1:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7,\n    inlined from ‘void transaction_tests::test_Get::test_method()’ at /root/bitcoin/src/test/transaction_tests.cpp:450:1:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn destructor ‘PoolResource<MAX_BLOCK_SIZE_BYTES, ALIGN_BYTES>::~PoolResource() [with long unsigned int MAX_BLOCK_SIZE_BYTES = 152; long unsigned int ALIGN_BYTES = 8]’,\n    inlined from ‘virtual CCoinsViewCache::~CCoinsViewCache()’ at /root/bitcoin/src/coins.h:362:7,\n    inlined from ‘void transaction_tests::test_IsStandard::test_method()’ at /root/bitcoin/src/test/transaction_tests.cpp:1055:1:\n/root/bitcoin/src/support/allocators/pool.h:210:13: warning: pointer ‘chunk’ used after ‘void operator delete(void*, std::align_val_t)’ [-Wuse-after-free]\n  210 |             ASAN_UNPOISON_MEMORY_REGION(chunk, m_chunk_size_bytes);\n      |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~\n/root/bitcoin/src/support/allocators/pool.h:209:31: note: call to ‘void operator delete(void*, std::align_val_t)’ here\n  209 |             ::operator delete ((void*)chunk, std::align_val_t{ELEM_ALIGN_BYTES});\n      |             ~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n```\n\ncc @dergoegge ",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 0,
    "created_at": "2025-08-14T14:45:19Z",
    "updated_at": "2025-08-14T14:45:19Z"
  },
  "events": []
}