{
  "type": "issue",
  "issue": {
    "id": 3362784667,
    "node_id": "I_kwDOABII587IcAWb",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33265",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33265/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33265/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33265/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33265",
    "number": 33265,
    "state": "open",
    "state_reason": null,
    "title": "Zero output not cleared",
    "body": "I think this relates to https://github.com/bitcoin/bitcoin/issues/27463, fyi @instagibbs \n\nWorking on a clear reproduction script for regtest, but here are some preliminary notes and signet examples:\n\nThe script (network-less) is `51024e73`. It `decode`s to different addresses for mainnet, testnets (including signets) and regtest:\n\n * `bc1pfeessrawgf` - mainnet\n * `tb1pfees9rn5nz` - testnets (incl. signets)\n * `bcrt1pfeesnyr2tx` - regtest\n\nThis LN Anchor address is important because such transactions were noticed on signet. See examples of leftover outputs which were spent:\n\n * [67da00b7e55c249ed338618bf7caea128365c2a35c77da5abb379e8574e537a5](https://mempool.space/signet/tx/67da00b7e55c249ed338618bf7caea128365c2a35c77da5abb379e8574e537a5)\n * [571be0fd823de6bd1c3bc9a7349297aacc7ce73bd99638b53e381aa1651f570c](https://mempool.space/signet/tx/571be0fd823de6bd1c3bc9a7349297aacc7ce73bd99638b53e381aa1651f570c)\n\nThese outputs can be seen as still available on current master (6ca6f3b37b99) on signet network.\nJust import following read-only descriptor wallet:\n\n```sh\n#!/bin/sh\n### start a fresh signet daemon, moving old signet datadir\n# bitcoin-cli -signet stop\n# test -d ~/.bitcoin/signet-old || mv ~/.bitcoin/signet ~/.bitcoin/signet-old\n# mkdir -p ~/bitcoin/signet/wallets\nbitcoind -signet -daemon\n\n### adjust or enhance lines above and see also your bitcoin.conf\n\nuntil bitcoin-cli -signet echo hello 2>/dev/null | grep -q .\ndo\n  sleep 1\ndone\n\ncd ~/.bitcoin/signet/wallets\ntest -d lnanchor && cd lnanchor || {\n  bitcoin-cli -signet createwallet lnanchor true true\n  bitcoin-cli -signet -rpcwallet=lnanchor \\\n   importdescriptors '[{\"desc\":\"addr(tb1pfees9rn5nz)#8njps4hg\",\"timestamp\":\"now\"}]'\n}\nph=$(bitcoin-cli -signet getblockchaininfo | grep pruneheight | tr -cd '[0-9]')\nbitcoin-cli -signet loadwallet lnanchor\nbitcoin-cli -signet -rpcwallet=lnanchor rescanblockchain $ph\n\nlist() {\n  bitcoin-cli -signet -rpcwallet=lnanchor \\\n    listunspent ${1:-0} \\\n    | grep -w -e txid -e vout -e amount -e confirmations -e safe \\\n    | tr -d ' ,\"' \\\n    | cut -d: -f2 \\\n    | paste -d \" \" - - - - -\n}\n\nwhile true; do LC_ALL=C date -u; list; sleep 1; done\n```\n\nThe script works both on an already-synced signet and a newly-syncing (uncomment lines in the top) one. Soon something like the following output may be seen and feel free to press `^C` then:\n\n```\n...\nThu Aug 28 09:59:45 UTC 2025\na7b388a8f48350f92f8987d45409723bf329519816eba808de59ad6ebe974628 2 0.00000000 127 true\n0378f0bc23d0cdbc7afe01dbfe77e4b925fa2c426a75509590ccd9f970ca288f 2 0.00000000 817 true\n19b091d8653165fda6ac25f231b6afdaba3a35a4199fa39952ae63de16c08f04 2 0.00000000 818 true\ne67aebeb09f64b1fec0177bc1b1edf336f8a31df7f264a3d83db2c2b1ebd7bb7 2 0.00000000 602 true\n82779ab667f82ec42f4a7c561da5fab7952e32bf7215ba6d19a2e4fe22ab44a6 1 0.00000000 579 true\n13e541ef82d52ca1010b09990f28230cfd57ab54cccd7e7fbf427a05d66d515f 1 0.00000000 833 true\n24e532f648b951376f2cef53b8c07d1e0b1fd0652a257a62968988f31c4aca26 2 0.00000000 269 true\n30f1fcc25b066c63f01b3b0588448bc285713d12c320d0505ac38a2aa96aaa8f 1 0.00000000 834 true\nd24a3e60de8ccf95fc4dfa1d6efc9c5f77100d058d1fceccba40d6a54d1a02f2 1 0.00000000 738 true\n6acce19b0418360f9e0c1650d2267fad6761dd0e98a2da23739b62ebfaa5cb00 2 0.00000000 675 true\n67da00b7e55c249ed338618bf7caea128365c2a35c77da5abb379e8574e537a5 2 0.00000000 673 true\nbcb0311b7d3e78f636319ebb483e36cde5162545b7fc94df7cd4185112d7d712 2 0.00000000 832 true\nea0522ba8f4ada4d3770f0d81c212bb0f7da25235e2b8b57c04e90c96b5b598c 2 0.00000000 691 true\na69bdd445aa6f82798c745792268cad4cbb2c2dd2e7a32809ee94bce51c26de5 2 0.00000000 273 true\n851248a635cb25d00dd39665636a3208c7252f059cfa418d43bf55535c283a5b 1 0.00000000 272 true\n85518747043d2bf36418f6262b6a8d35593bf8d2419250448f8cb5cbeab0d5d0 2 0.00000000 251 true\n6faa9ecf8b2c0afd657a32f50d5d93d91d33a578bd8fdd2ef4d960dea2a1bfb7 2 0.00000000 221 true\ne5cf85120935082b14889674d5c4ed66d8bfce3b8e9c0eebc9d4dea079de01d9 1 0.00000000 131 true\n06df913b8fb0fc39dac875d1b5c4cc948499ed6e3dca6d2867afc59435e66a6f 2 0.00000000 129 true\n571be0fd823de6bd1c3bc9a7349297aacc7ce73bd99638b53e381aa1651f570c 2 0.00000000 128 true\n```\n\nLet's take the [first transaction (...4628)](https://mempool.space/signet/tx/a7b388a8f48350f92f8987d45409723bf329519816eba808de59ad6ebe974628) and its [follow-up which spends the zero output](https://mempool.space/signet/tx/92246e21897116e7e7b9afc62034caaadb75ae61c441c52df4a66dbdd9e234f5). The latter can not be traced from the former on mempool.space other than checking [the LN Anchor address](https://mempool.space/signet/address/tb1pfees9rn5nz).\n\nI would expect the zero output to be cleared in the descriptor wallet no matter if the spending transaction has anything to do with the first transaction in a package other than the zero output itself.",
    "user": {
      "login": "jsarenik",
      "id": 244565,
      "node_id": "MDQ6VXNlcjI0NDU2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jsarenik",
      "html_url": "https://github.com/jsarenik",
      "followers_url": "https://api.github.com/users/jsarenik/followers",
      "following_url": "https://api.github.com/users/jsarenik/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jsarenik/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jsarenik/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jsarenik/subscriptions",
      "organizations_url": "https://api.github.com/users/jsarenik/orgs",
      "repos_url": "https://api.github.com/users/jsarenik/repos",
      "events_url": "https://api.github.com/users/jsarenik/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jsarenik/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 0,
    "created_at": "2025-08-28T10:35:27Z",
    "updated_at": "2025-08-28T10:47:54Z"
  },
  "events": [
    {
      "event": "mentioned",
      "id": 19388668253,
      "node_id": "MEE_lADOABII587IcAWbzwAAAASDp5ld",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19388668253",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T10:35:29Z"
    },
    {
      "event": "subscribed",
      "id": 19388668286,
      "node_id": "SE_lADOABII587IcAWbzwAAAASDp5l-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19388668286",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T10:35:29Z"
    },
    {
      "event": "labeled",
      "id": 19388795036,
      "node_id": "LE_lADOABII587IcAWbzwAAAASDqYic",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19388795036",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T10:43:11Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    }
  ]
}