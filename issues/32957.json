{
  "type": "issue",
  "issue": {
    "id": 3226510960,
    "node_id": "I_kwDOABII587AUKZw",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32957",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32957/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32957/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32957/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32957",
    "number": 32957,
    "state": "open",
    "state_reason": null,
    "title": "SegFault in QSortFilterProxyModelPrivate::build_source_to_proxy_mapping",
    "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nI was loading a bunch of old wallets sequentially using \"bitcoin-cli loadwallet\" in a loop. bitcoin-qt crashed shortly after finishing loading one wallet and starting to load the next.\n\nThe debug log shows this at the end:\n\n    2025-07-13T13:06:26Z init message: Rescanning…\n    2025-07-13T13:06:26Z [wallet23] Rescanning last 3130 blocks (from block 902235)...\n    2025-07-13T13:06:26Z [wallet23] Rescan started from block 00000000000000000001009ee18d68a681723b922e5b756aa89c513f28e15876... (fast variant using block filters)\n    2025-07-13T13:07:02Z [wallet23] Scanning current mempool transactions.\n    2025-07-13T13:07:02Z [wallet23] Rescan completed in           36695ms\n    2025-07-13T13:07:02Z [wallet23] setKeyPool.size() = 60000\n    2025-07-13T13:07:02Z [wallet23] mapWallet.size() = 303\n    2025-07-13T13:07:02Z [wallet23] m_address_book.size() = 16\n    2025-07-13T13:07:02Z Using SQLite Version 3.40.1\n    2025-07-13T13:07:02Z Using wallet /home/user/.bitcoin/wallets/wallet24\n    2025-07-13T13:07:02Z init message: Loading wallet…\n    2025-07-13T13:07:02Z [wallet24] Wallet file version = 10500, last client version = 280000\n\ngdb shows this stack trace:\n\n    Thread 1 \"bitcoin-qt-v29.\" received signal SIGSEGV, Segmentation fault.\n    QSortFilterProxyModelPrivate::build_source_to_proxy_mapping (proxy_to_source=..., source_to_proxy=..., this=this@entry=0x55555b826470)\n        at ../../include/QtCore/../../src/corelib/tools/qarraydata.h:61\n    61      ../../include/QtCore/../../src/corelib/tools/qarraydata.h: No such file or directory.\n\n    (gdb) where\n    #0  QSortFilterProxyModelPrivate::build_source_to_proxy_mapping (proxy_to_source=..., source_to_proxy=..., this=this@entry=0x55555b826470)\n        at ../../include/QtCore/../../src/corelib/tools/qarraydata.h:61\n    #1  0x00007ffff6682b97 in QSortFilterProxyModelPrivate::sort (this=0x55555b82b3e0) at itemmodels/qsortfilterproxymodel.cpp:634\n    #2  0x00005555557b4c54 in OverviewPage::setWalletModel (this=this@entry=0x7fff28023430, model=0x7ffb66326a30) at ./qt/overviewpage.cpp:269\n    #3  0x000055555577c395 in WalletView::WalletView (this=this@entry=0x55555b6ecec0, wallet_model=<optimized out>, _platformStyle=0x555556be0cf0, parent=<optimized out>)\n        at ./qt/walletview.cpp:41\n    #4  0x00005555556ef343 in BitcoinGUI::addWallet (this=0x555556eafdc0, walletModel=<optimized out>) at ./qt/bitcoingui.cpp:739\n    #5  0x00005555556f478d in _ZZN7GUIUtil20ExceptionSafeConnectIP16WalletControllerMS1_FvP11WalletModelEP10BitcoinGUIMS7_FvS4_EEEDaT_T0_T1_T2_N2Qt14ConnectionTypeEENKUlDpOT_E_clIJRS4_EEEDaSJ_ (__closure=0x555556d431a0) at ./qt/guiutil.h:400\n    #6  _ZN9QtPrivate11FunctorCallINS_11IndexesListIJLi0EEEENS_4ListIJP11WalletModelEEEvZN7GUIUtil20ExceptionSafeConnectIP16WalletControllerMS9_FvS5_EP10BitcoinGUIMSD_FvS5_EEEDaT_T0_T1_T2_N2Qt14ConnectionTypeEEUlDpOT_E_E4callERSQ_PPv (arg=<optimized out>, f=...) at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:146\n    #7  _ZN9QtPrivate7FunctorIZN7GUIUtil20ExceptionSafeConnectIP16WalletControllerMS3_FvP11WalletModelEP10BitcoinGUIMS9_FvS6_EEEDaT_T0_T1_T2_N2Qt14ConnectionTypeEEUlDpOT_E_Li1EE4callINS_4ListIJS6_EEEvEEvRSM_PvPSS_ (arg=<optimized out>, f=...) at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:256\n    #8  _ZN9QtPrivate18QFunctorSlotObjectIZN7GUIUtil20ExceptionSafeConnectIP16WalletControllerMS3_FvP11WalletModelEP10BitcoinGUIMS9_FvS6_EEEDaT_T0_T1_T2_N2Qt14ConnectionTypeEEUlDpOT_E_Li1ENS_4ListIJS6_EEEvE4implEiPNS_15QSlotObjectBaseEP7QObjectPPvPb (which=<optimized out>, this_=0x555556d43190, r=<optimized out>, a=<optimized out>,\n        ret=<optimized out>) at /usr/include/x86_64-linux-gnu/qt5/QtCore/qobjectdefs_impl.h:443\n    #9  0x00007ffff66dd730 in QObject::event (this=0x555556eafdc0, e=0x7ffb65750450) at kernel/qobject.cpp:1347\n    #10 0x00007ffff7962fae in QApplicationPrivate::notify_helper (this=<optimized out>, receiver=0x555556eafdc0, e=0x7ffb65750450) at kernel/qapplication.cpp:3640\n    #11 0x00007ffff66b1738 in QCoreApplication::notifyInternal2 (receiver=0x555556eafdc0, event=0x7ffb65750450) at kernel/qcoreapplication.cpp:1064\n    #12 0x00007ffff66b18fe in QCoreApplication::sendEvent (receiver=<optimized out>, event=<optimized out>) at kernel/qcoreapplication.cpp:1462\n    #13 0x00007ffff66b46c1 in QCoreApplicationPrivate::sendPostedEvents (receiver=0x0, event_type=0, data=0x555556955090) at kernel/qcoreapplication.cpp:1821\n    #14 0x00007ffff66b4b48 in QCoreApplication::sendPostedEvents (receiver=<optimized out>, event_type=<optimized out>) at kernel/qcoreapplication.cpp:1680\n    #15 0x00007ffff670a193 in postEventSourceDispatch (s=0x555556a5ac20) at kernel/qeventdispatcher_glib.cpp:277\n    #16 0x00007ffff571e749 in g_main_context_dispatch () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\n    #17 0x00007ffff571e9d8 in ?? () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\n    #18 0x00007ffff571ea6c in g_main_context_iteration () from /lib/x86_64-linux-gnu/libglib-2.0.so.0\n    #19 0x00007ffff6709876 in QEventDispatcherGlib::processEvents (this=0x555556a0b3a0, flags=...) at kernel/qeventdispatcher_glib.cpp:423\n    #20 0x00007ffff66b01bb in QEventLoop::exec (this=this@entry=0x7fffffffd3b0, flags=..., flags@entry=...) at ../../include/QtCore/../../src/corelib/global/qflags.h:69\n    #21 0x00007ffff66b8316 in QCoreApplication::exec () at ../../include/QtCore/../../src/corelib/global/qflags.h:121\n    #22 0x00007ffff7130ecc in QGuiApplication::exec () at kernel/qguiapplication.cpp:1863\n    #23 0x00007ffff7962f25 in QApplication::exec () at kernel/qapplication.cpp:2832\n    #24 0x00005555556db812 in GuiMain (argc=2, argv=0x7fffffffdb88) at ./qt/bitcoin.cpp:691\n\n\n### Expected behaviour\n\nI expect to be able to load wallets without a seg fault.\n\n### Steps to reproduce\n\nThis is the only time I've seen this crash.\n\n### Relevant log output\n\nSee above.\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\n29.0.0\n\n### Operating system and version\n\nDebian GNU/Linux 12 (bookworm)\n\n### Machine specifications\n\nDebian/Intel SSD, hotel wifi\n\nPlenty of RAM and swap",
    "user": {
      "login": "dooglus",
      "id": 573356,
      "node_id": "MDQ6VXNlcjU3MzM1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573356?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dooglus",
      "html_url": "https://github.com/dooglus",
      "followers_url": "https://api.github.com/users/dooglus/followers",
      "following_url": "https://api.github.com/users/dooglus/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/dooglus/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/dooglus/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/dooglus/subscriptions",
      "organizations_url": "https://api.github.com/users/dooglus/orgs",
      "repos_url": "https://api.github.com/users/dooglus/repos",
      "events_url": "https://api.github.com/users/dooglus/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/dooglus/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 135946,
        "node_id": "MDU6TGFiZWwxMzU5NDY=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/GUI",
        "name": "GUI",
        "color": "02d7e1",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 0,
    "created_at": "2025-07-13T13:34:25Z",
    "updated_at": "2025-07-13T13:38:49Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 18605383857,
      "node_id": "LE_lADOABII587AUKZwzwAAAARU96Cx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18605383857",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-13T13:38:49Z",
      "label": {
        "name": "GUI",
        "color": "02d7e1"
      }
    }
  ]
}