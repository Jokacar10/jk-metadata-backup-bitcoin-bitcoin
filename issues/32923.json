{
  "type": "issue",
  "issue": {
    "id": 3212629495,
    "node_id": "I_kwDOABII586_fNX3",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32923",
    "number": 32923,
    "state": "open",
    "state_reason": null,
    "title": "guix: Windows build is non-deterministic across build architectures",
    "body": "This has been the case since https://github.com/bitcoin/bitcoin/commit/8578fabb95face25d9fa7dfaad38d0a2857c2481.\n\nGuix build on `x86_64` & `aarch64` @ 01f908195589 (prior merge):\n```bash\n0324606fdfc525e2acf6ffc5b5327021df6b47de107dbeb51f54162a3dead570  guix-build-01f908195589/output/dist-archive/bitcoin-01f908195589.tar.gz\ne9be0c0c6ab0d856c2176ff0da9c4fb3599f8bd0d578138262fde7307691c28b  guix-build-01f908195589/output/x86_64-w64-mingw32/SHA256SUMS.part\nb27afe43704fa3045f1acebd967f282781f5d1907b48fbc1455c69a7f148ab1a  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-codesigning.tar.gz\nb445befd6dbe5668d9e6f1f2722fba0ed9b01c33c12271b790befb4856b988a9  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-debug.zip\naddb8b7c4ebefeeef5ece568cdc021bc98f5c5e8a57bfac7dd12fc41df487bda  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-setup-unsigned.exe\n472d798ca94c12331b4a0c5f3d7160b11d7b7a7f18776a2edb8220fffe9f9fa9  guix-build-01f908195589/output/x86_64-w64-mingw32/bitcoin-01f908195589-win64-unsigned.zip\n```\n\nGuix Build @ 8578fabb95face25d9fa7dfaad38d0a2857c2481:\n```bash\n# x86_64\na993b92027df5cc5ff6ee2355fb4214fe566769917abcedd91b2c4c01814891f  guix-build-8578fabb95fa/output/dist-archive/bitcoin-8578fabb95fa.tar.gz\n26912d42f5228c146ee27a533daf4d111f164a34e77b6ab68a15b25c3f89d37d  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/SHA256SUMS.part\n756656f917c0025b5b921f3fbd20f0f0815867b85c692c0bdaf6ec139adb88a3  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-codesigning.tar.gz\n9c0b6af68e716767a3ab83c3c22aae4074c26afa0ca01ad9d16ccbe90d219148  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-debug.zip\na103dba4ba354ed2f3ca73dfa19e86a525ba40d9d6c7baf67f663623e02449a1  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-setup-unsigned.exe\nf77d0ef89287a5233c2904e266d3e93f779665cfa3d10586339df053bebdab84  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-unsigned.zip\n\n# aarch64\na993b92027df5cc5ff6ee2355fb4214fe566769917abcedd91b2c4c01814891f  guix-build-8578fabb95fa/output/dist-archive/bitcoin-8578fabb95fa.tar.gz\nf3bb452cb21520cd31c962a2c54866f0a0176ac2f6e6848ac6926b5c0a7b4131  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/SHA256SUMS.part\n19c98f753129ef55c920ab5dbb93b23de5164d43bd2654533c0cce8783b1406d  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-codesigning.tar.gz\n9c0b6af68e716767a3ab83c3c22aae4074c26afa0ca01ad9d16ccbe90d219148  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-debug.zip\n78ace262a902030421b0748252701d4c948f72458ec7f1dddd84492ef620b53d  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-setup-unsigned.exe\n8262620ed8029972b991e79e65c446cc0bae7d15f6db8c4f78dc7e0aff173900  guix-build-8578fabb95fa/output/x86_64-w64-mingw32/bitcoin-8578fabb95fa-win64-unsigned.zip\n```\n\nI originally thought this was somehow introduced in #32837. However this was the difference in the binaries:\n```diff\n--- a.txt\n+++ b.txt\n@@ -1,9 +1,9 @@\n \n-bitcoin-qt.exe_built_on_x86_64_unstripped:\tfile format coff-x86-64\n+bitcoin-qt.exe_built_on_aarch64_unstripped:\tfile format coff-x86-64\n \n Disassembly of section .text:\n \n 0000000140b1b070 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE>:\n 140b1b070: f3 0f 1e fa                 \tendbr64\n 140b1b074: 41 57                       \tpushq\t%r15\n 140b1b076: 41 56                       \tpushq\t%r14\n@@ -607,15 +607,15 @@\n 140b1bb7d: b8 ff ff ff ff              \tmovl\t$0xffffffff, %eax       # imm = 0xFFFFFFFF\n 140b1bb82: e9 1f fb ff ff              \tjmp\t0x140b1b6a6 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE+0x636>\n 140b1bb87: 89 56 1c                    \tmovl\t%edx, 0x1c(%rsi)\n 140b1bb8a: 4c 01 fa                    \taddq\t%r15, %rdx\n 140b1bb8d: 49 89 d0                    \tmovq\t%rdx, %r8\n 140b1bb90: 31 c0                       \txorl\t%eax, %eax\n 140b1bb92: 4d 29 f8                    \tsubq\t%r15, %r8\n-140b1bb95: 4c 39 fa                    \tcmpq\t%r15, %rdx\n+140b1bb95: 49 39 d7                    \tcmpq\t%rdx, %r15\n 140b1bb98: 0f 84 68 fc ff ff           \tje\t0x140b1b806 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE+0x796>\n 140b1bb9e: 66 90                       \tnop\n 140b1bba0: 41 0f b6 14 07              \tmovzbl\t(%r15,%rax), %edx\n 140b1bba5: 88 14 01                    \tmovb\t%dl, (%rcx,%rax)\n 140b1bba8: 48 83 c0 01                 \taddq\t$0x1, %rax\n 140b1bbac: 49 39 c0                    \tcmpq\t%rax, %r8\n 140b1bbaf: 75 ef                       \tjne\t0x140b1bba0 <_ZN11WalletModel18prepareTransactionER22WalletModelTransactionRKN6wallet12CCoinControlE+0xb30>\n```",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 234877,
        "node_id": "MDU6TGFiZWwyMzQ4Nzc=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Windows",
        "name": "Windows",
        "color": "884400",
        "default": false
      },
      {
        "id": 61889416,
        "node_id": "MDU6TGFiZWw2MTg4OTQxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Build%20system",
        "name": "Build system",
        "color": "5319e7",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 5,
    "created_at": "2025-07-08T13:45:28Z",
    "updated_at": "2025-07-10T07:00:30Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 18526993758,
      "node_id": "LE_lADOABII586_fNX3zwAAAARQS31e",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18526993758",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-08T13:45:30Z",
      "label": {
        "name": "Build system",
        "color": "5319e7"
      }
    },
    {
      "event": "subscribed",
      "id": 18527139209,
      "node_id": "SE_lADOABII586_fNX3zwAAAARQTbWJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18527139209",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-08T13:53:00Z"
    },
    {
      "event": "labeled",
      "id": 18545333731,
      "node_id": "LE_lADOABII586_fNX3zwAAAARRY1Xj",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18545333731",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-09T12:23:40Z",
      "label": {
        "name": "Windows",
        "color": "884400"
      }
    },
    {
      "event": "commented",
      "id": 3055693691,
      "node_id": "IC_kwDOABII5862Ii97",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3055693691",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-10T05:55:37Z",
      "updated_at": "2025-07-10T05:56:32Z",
      "author_association": "MEMBER",
      "body": "#32597 being the cause of this non-determinism doesn't make any sense to me.\n\nThe function with the non-determinsm is `WalletModel::prepareTransaction` which is a GUI only function that was not modified by #32597. That PR didn't change anything remotely near that, so it being the root cause makes no sense.\n\naddr2line indicates that the problematic line corresponds to https://github.com/bitcoin/bitcoin/blob/a40e9536588c366886de4f4b9d67b8665a509929/src/prevector.h#L174 After unwrapping all of the inlines, the offending caller is https://github.com/bitcoin/bitcoin/blob/a40e9536588c366886de4f4b9d67b8665a509929/src/qt/walletmodel.cpp#L183\n\nThis issue being in prevector is also very weird. This code is called all over place throughout the project, and it's only in this one particular instance where it is compiled differently?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32923#issuecomment-3055693691",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923"
    },
    {
      "event": "commented",
      "id": 3055873569,
      "node_id": "IC_kwDOABII5862JO4h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3055873569",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-10T06:47:56Z",
      "updated_at": "2025-07-10T06:47:56Z",
      "author_association": "MEMBER",
      "body": "> The function with the non-determinsm is `WalletModel::prepareTransaction` which is a GUI only function that was not modified by [#32597](https://github.com/bitcoin/bitcoin/pull/32597). That PR didn't change anything remotely near that, so it being the root cause makes no sense.\n\nMy guess would be that one of the O2 passes (or the linker) is confused by the `std::map` changes in the header. (`wallet.h` is included in that gui module)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32923#issuecomment-3055873569",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923"
    },
    {
      "event": "commented",
      "id": 3055875782,
      "node_id": "IC_kwDOABII5862JPbG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3055875782",
      "actor": {
        "login": "dstadulis",
        "id": 15150758,
        "node_id": "MDQ6VXNlcjE1MTUwNzU4",
        "avatar_url": "https://avatars.githubusercontent.com/u/15150758?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dstadulis",
        "html_url": "https://github.com/dstadulis",
        "followers_url": "https://api.github.com/users/dstadulis/followers",
        "following_url": "https://api.github.com/users/dstadulis/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dstadulis/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dstadulis/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dstadulis/subscriptions",
        "organizations_url": "https://api.github.com/users/dstadulis/orgs",
        "repos_url": "https://api.github.com/users/dstadulis/repos",
        "events_url": "https://api.github.com/users/dstadulis/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dstadulis/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-10T06:48:46Z",
      "updated_at": "2025-07-10T06:49:23Z",
      "author_association": "NONE",
      "body": "Nice catch!\n\ntldr: seems there should be no *logical* difference between the two -- but CMIIW:\n\n## Assessing the differences\n\nTwo changes exist between the two segments of machine code:\n\n1. Registry Extension prefix of the `cmpq` instruction\n2. The encoding of the operands are switched, in x86 assembly syntax convention.\n\nLet's try to decode the logical effect of the changes!\n\nA consequential, control-flow op code `cmpq` which sets \"[condition codes](https://www.cs.cmu.edu/afs/cs/academic/class/15213-s20/www/recitations/x86-cheat-sheet.pdf)\" value(s) in `EFLAGS` registers.  Added after IA32, for the ability to compare quad words on x86-64, a prefix is used to maintain compatability with prior x86 versions.\n\nLet's try to decode the logical effect of these two changes!\n\n## Conditional Jumps\n\n> 140b1bb98: 0f 84 68 fc ff ff           \tje\t0x140b1b806\n\n`0F 84` hex indicates a Jcc \"Jump if conditions met\" predicate, followed by the bytes `68 fc ff ff` i.e. the code doubleword (a signed, relative 32 byte offset -- indicated the jump destinaton address).  [`0F 84`, Specifically indicates the `je` predicate which checks if the zero-flag ZF has been set by the CC values](https://www.felixcloutier.com/x86/jcc#:~:text=0F%2084%20cd,equal%20(ZF%3D1).) in [EFLAGs](https://en.wikipedia.org/wiki/FLAGS_register).\n\nWhat sets the zero-flag CC EFLAG value?\n\n## `cmpq`!\n\naddress:\t opcode           \t\t\t\tmnemonic\n>-140b1bb95: 4c 39 fa                    \tcmpq\t%r15, %rdx\n>+140b1bb95: 49 39 d7                    \tcmpq\t%rdx, %r15\n\nLet's decode the machine code:\n`0x39` corresponds to the [`cmp` instruction](https://www.felixcloutier.com/x86/cmp), while `0x4C` and `0x49` are the Registry Extension (REX) prefixes.  The software that translated machine code to mnemonic attested that the operands on {source, destination} have been flipped (Maybe the source of the build's discrepancy is a [NASM / GAS AT&T syntax difference](https://en.wikibooks.org/wiki/X86_Assembly/GNU_assembly_syntax#) between the two build environments?)\n\n## Establishing equivalent between machine code and mnemonic: Decoding operand encoding\nNow, dear bit lovers, the time has come to decode the ModR/M byte to determine the operand order and registers involved.\n\n[Documentation specifies](https://wiki.osdev.org/X86-64_Instruction_Encoding#ModR/M_and_SIB_bytes) that the registers -- used as operands to `cmp` -- are specified with two, 3 bit segements of the machine code.  Hence if the two 3 bit sequences match, the logical result of of `0x39 FA` and `0x39 D7` should be equivalent.  Let's check:\n\n```python\ndef compare_binary_bits(hex_value1, hex_value2):\n    # Convert hexadecimal to binary and remove '0b' prefix\n    bin_value1 = bin(int(hex_value1, 16))[2:].zfill(8)\n    print(f\"bin_value1: {bin_value1}\")\n    bin_value2 = bin(int(hex_value2, 16))[2:].zfill(8)\n    print(f\"bin_value2: {bin_value2}\")\n\n    # Extract last 3 bits and 4th from the last - 7th from the last bits (0-indexed)\n    last_3_bits1 = bin_value1[-3:]\n    print(f\"last_3_bits1: {last_3_bits1}\")\n    middle_bits1 = bin_value1[-6:-3]\n    print(f\"middle_bits1: {middle_bits1}\")\n\n    last_3_bits2 = bin_value2[-3:]\n    print(f\"last_3_bits2: {last_3_bits2}\")\n    middle_bits2 = bin_value2[-6:-3]\n    print(f\"middle_bits2: {middle_bits2}\")\n\n    # Assert transposition of operands / registers\n    assert (last_3_bits2 == middle_bits1) and (last_3_bits1 == middle_bits2), \"Bits do not match\"\n\n# Test with given hex values\ncompare_binary_bits('FA', 'D7')\n```\n\nIndeed, the operands match -- as attested to in the mnemonic. 😮‍💨\n\n## Decoding the Operands' Prefix: \nSpecification:\n>In 64-bit mode, the same opcodes represent the instruction prefix REX and are not treated as individual instructions.\nFrom: [325383-088-sdm-vol-2abcd.pdf](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html)\n\nGiven the operands' prefixes of\n\n0x4C => 0b01001100\n0x49 => 0b01001001\n\nAnd the [prefix decoding map](https://wiki.osdev.org/X86-64_Instruction_Encoding#Encoding:~:text=Fixed%20bit%20pattern-,W,field%20or%20the%20SIB.base%20field.%20See%2064%2Dbit%20addressing.,-Because%20the%20first)...\n\n**The x86-64 specification differences between to the two binaries is found:**\n- the binary, compiled on x86-64, has set the R extention which affects the MODRM.reg field.\n- while the binary, compiled on aarch64, has set the B extention which affects either the MODRM.rm field or the SIB.base field.\n\nIIUC, these REX settings only affect the size of the registers of the source operrands and not the logical result of the specification -- which is likely why the difference is elided during machine-code-to-mnemonic translation.\n\n## Reasoning about potential consequences\n\nGiven both prefixes set the REX.W extension, the `cmp` instruction should run the [comparison on the two operands](https://namazso.github.io/x86/html/CMP.html#:~:text=REX.W%20%2B%2039,r/m64.) equivalently as `cmp` function is symetrical / equivalent, with transposed operands.  `cmp` sets the zero-flag in EFLAGS which then `je` continues on as normal.  Thus: **there is no logical difference in the result of how the machine code should functioning, according to x86-64 specification** ✅\n\n## Intel x86-64 Documentation:\n- PDF: https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html#three-volume\n- HTML: https://github.com/xem/minix86/blob/9a192e6b456008ddd328ef0e9eeecfa4e6988ef0/README.md?plain=1#L15-L17\n[E]FLAGS register (and what the arithmetic flags denote) are described in [section 3.4.3 of Intel® 64 and IA-32 Architectures Software Developer’s Manual, Volume 1](https://www.intel.com/content/dam/www/public/us/en/documents/manuals/64-ia-32-architectures-software-developer-vol-1-manual.pdf)\n\n## jcc\nhttps://c9x.me/x86/html/file_module_x86_id_146.html\nhttps://www.felixcloutier.com/x86/jcc\n\n## cmp links\nhttps://asm-docs.microagi.org/x86/cmp.html\nhttps://tizee.github.io/x86_ref_book_web/instruction/cmp.html#compare-two-operands\nhttps://c9x.me/x86/html/file_module_x86_id_35.html\n\n## Decoding\nIntel® X86 Encoder Decoder (Intel® XED) is a software library: https://intelxed.github.io decoding [4C39FA](https://toolsbits.com/instruction?bytes=4c39fa) and [4939D7](https://toolsbits.com/instruction?bytes=4939D7)\n\n```sh\n$ echo \"obase=2; ibase=16; 4C\" | bc\n1001100\n$ echo \"obase=2; ibase=16; 49\" | bc\n1001001\n```\n\n## radare2 \nColor coding mnemonics from associated machine code\n```sh\nr2 -a x86 =(echo -en \"\\x49\\x39\\xd7\")\n```",
      "user": {
        "login": "dstadulis",
        "id": 15150758,
        "node_id": "MDQ6VXNlcjE1MTUwNzU4",
        "avatar_url": "https://avatars.githubusercontent.com/u/15150758?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/dstadulis",
        "html_url": "https://github.com/dstadulis",
        "followers_url": "https://api.github.com/users/dstadulis/followers",
        "following_url": "https://api.github.com/users/dstadulis/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/dstadulis/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/dstadulis/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/dstadulis/subscriptions",
        "organizations_url": "https://api.github.com/users/dstadulis/orgs",
        "repos_url": "https://api.github.com/users/dstadulis/repos",
        "events_url": "https://api.github.com/users/dstadulis/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/dstadulis/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32923#issuecomment-3055875782",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923"
    },
    {
      "event": "commented",
      "id": 3055925920,
      "node_id": "IC_kwDOABII5862Jbqg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3055925920",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-10T06:57:58Z",
      "updated_at": "2025-07-10T06:59:33Z",
      "author_association": "MEMBER",
      "body": "The most recent change in `prevector.h`, and the only one that hasn't been shipped in a release yet, was a40e9536588c366886de4f4b9d67b8665a509929. But that just removed the reverse iterator, which this doesn't use afaik.\n\nYou could try initiazing `std::vector<CRecipient> vecSend;` with the size of `recipients`, which might result in different code paths. Though even if that restored determinism it wouldn't fix the underlying issue.\n\nMy own aarch64 builder is broken #32759, so I can't test it. Though I might just nuke it and try again.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32923#issuecomment-3055925920",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923"
    },
    {
      "event": "commented",
      "id": 3055948842,
      "node_id": "IC_kwDOABII5862JhQq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3055948842",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-10T07:00:30Z",
      "updated_at": "2025-07-10T07:00:30Z",
      "author_association": "MEMBER",
      "body": "#32930 seems like it results in a different enough code path to workaround this issue.\n\nUltimately, this seems like an upstream compiler bug.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32923#issuecomment-3055948842",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32923"
    }
  ]
}