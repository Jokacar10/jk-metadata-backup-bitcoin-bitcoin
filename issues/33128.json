{
  "type": "issue",
  "issue": {
    "id": 3286010421,
    "node_id": "I_kwDOABII587D3Io1",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33128",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33128/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33128/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33128/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33128",
    "number": 33128,
    "state": "open",
    "state_reason": null,
    "title": "OpenBSD, NetBSD: `-reindex` is broken",
    "body": "The `-reindex` option is broken on both the master branch and the 29.x branch (I have not tested older release branches).\n\nConsider the following workflow on OpenBSD 7.7:\n```\n$ rm -rf /home/hebasto/.bitcoin/regtest\n$ ./build/bin/bitcoind -regtest -daemon\nBitcoin Core starting\n$ ./build/bin/bitcoin-cli -regtest createwallet $(date +%Y-%m-%d)\n$ ./build/bin/bitcoin-cli -regtest -generate 200\n$ ./build/bin/bitcoin-cli -regtest getblockcount\n200\n$ ./build/bin/bitcoin-cli -regtest stop\nBitcoin Core stopping\n$ rm -rf /home/hebasto/.bitcoin/regtest/blocks/index\n$ ./build/bin/bitcoind -regtest -daemon\nBitcoin Core starting\n$ tail -6 /home/hebasto/.bitcoin/regtest/debug.log\n2025-08-02T15:02:00Z : Error initializing block database.\nPlease restart with -reindex or -reindex-chainstate to recover.\n2025-08-02T15:02:00Z Shutdown: In progress...\n2025-08-02T15:02:00Z scheduler thread exit\n2025-08-02T15:02:00Z Flushed fee estimates to fee_estimates.dat.\n2025-08-02T15:02:00Z Shutdown: done\n$ rm /home/hebasto/.bitcoin/regtest/debug.log\n$ ./build/bin/bitcoind -regtest -daemon -reindex\nBitcoin Core starting\n$ ./build/bin/bitcoin-cli -regtest getblockcount\n0\n$ cat /home/hebasto/.bitcoin/regtest/debug.log                    \n\n\n\n\n\n2025-08-02T15:13:08Z Bitcoin Core version v29.99.0-75ed673193c5 (release build)\n2025-08-02T15:13:08Z Using the 'sse4(1way),sse41(4way),avx2(8way)' SHA256 implementation\n2025-08-02T15:13:08Z Using RdSeed as an additional entropy source\n2025-08-02T15:13:08Z Using RdRand as an additional entropy source\n2025-08-02T15:13:08Z Default data directory /home/hebasto/.bitcoin\n2025-08-02T15:13:08Z Using data directory /home/hebasto/.bitcoin/regtest\n2025-08-02T15:13:08Z Config file: /home/hebasto/.bitcoin/bitcoin.conf (not found, skipping)\n2025-08-02T15:13:08Z Command-line arg: daemon=\"\"\n2025-08-02T15:13:08Z Command-line arg: regtest=\"\"\n2025-08-02T15:13:08Z Command-line arg: reindex=\"\"\n2025-08-02T15:13:08Z Using at most 125 automatic connections (512 file descriptors available)\n2025-08-02T15:13:08Z scheduler thread start\n2025-08-02T15:13:08Z Binding RPC on address ::1 port 18443\n2025-08-02T15:13:08Z Binding RPC on address 127.0.0.1 port 18443\n2025-08-02T15:13:08Z Generated RPC authentication cookie /home/hebasto/.bitcoin/regtest/.cookie\n2025-08-02T15:13:08Z Permissions used for cookie: rw-------\n2025-08-02T15:13:08Z Using random cookie authentication.\n2025-08-02T15:13:08Z Starting HTTP server with 16 worker threads\n2025-08-02T15:13:08Z Using wallet directory /home/hebasto/.bitcoin/regtest/wallets\n2025-08-02T15:13:08Z init message: Verifying wallet(s)…\n2025-08-02T15:13:08Z Using /16 prefix for IP bucketing\n2025-08-02T15:13:08Z init message: Loading P2P addresses…\n2025-08-02T15:13:08Z Loaded 0 addresses from peers.dat  0ms\n2025-08-02T15:13:08Z init message: Loading banlist…\n2025-08-02T15:13:08Z SetNetworkActive: true\n2025-08-02T15:13:08Z Cache configuration:\n2025-08-02T15:13:08Z * Using 2.0 MiB for block index database\n2025-08-02T15:13:08Z * Using 8.0 MiB for chain state database\n2025-08-02T15:13:08Z * Using 440.0 MiB for in-memory UTXO set (plus up to 286.1 MiB of unused mempool space)\n2025-08-02T15:13:08Z Script verification uses 7 additional threads\n2025-08-02T15:13:08Z Using obfuscation key for blocksdir *.dat files (/home/hebasto/.bitcoin/regtest/blocks): '997651b2ed068218'\n2025-08-02T15:13:08Z Wiping LevelDB in /home/hebasto/.bitcoin/regtest/blocks/index\n2025-08-02T15:13:08Z Opening LevelDB in /home/hebasto/.bitcoin/regtest/blocks/index\n2025-08-02T15:13:08Z Opened LevelDB successfully\n2025-08-02T15:13:08Z Using obfuscation key for /home/hebasto/.bitcoin/regtest/blocks/index: 0000000000000000\n2025-08-02T15:13:08Z Using 16 MiB out of 16 MiB requested for signature cache, able to store 524288 elements\n2025-08-02T15:13:08Z Using 16 MiB out of 16 MiB requested for script execution cache, able to store 524288 elements\n2025-08-02T15:13:08Z init message: Loading block index…\n2025-08-02T15:13:08Z Validating signatures for all blocks.\n2025-08-02T15:13:08Z Setting nMinimumChainWork=0000000000000000000000000000000000000000000000000000000000000000\n2025-08-02T15:13:08Z Initializing chainstate Chainstate [ibd] @ height -1 (null)\n2025-08-02T15:13:08Z Wiping LevelDB in /home/hebasto/.bitcoin/regtest/chainstate\n2025-08-02T15:13:08Z Opening LevelDB in /home/hebasto/.bitcoin/regtest/chainstate\n2025-08-02T15:13:08Z Opened LevelDB successfully\n2025-08-02T15:13:08Z Wrote new obfuscation key for /home/hebasto/.bitcoin/regtest/chainstate: cc8a83834d10b91a\n2025-08-02T15:13:08Z Using obfuscation key for /home/hebasto/.bitcoin/regtest/chainstate: cc8a83834d10b91a\n2025-08-02T15:13:08Z init message: Verifying blocks…\n2025-08-02T15:13:08Z Block index and chainstate loaded\n2025-08-02T15:13:08Z Setting NODE_NETWORK on non-prune mode\n2025-08-02T15:13:08Z initload thread start\n2025-08-02T15:13:08Z Reindexing block file blk00000.dat...\n2025-08-02T15:13:08Z UpdateTip: new best=0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206 height=0 version=0x00000001 log2_work=1.000000 tx=1 date='2011-02-02T23:16:42Z' progress=0.000002 cache=0.3MiB(0txo)\n2025-08-02T15:13:08Z block tree size = 1\n2025-08-02T15:13:08Z nBestHeight = 0\n2025-08-02T15:13:08Z mapport thread start\n2025-08-02T15:13:08Z torcontrol thread start\n2025-08-02T15:13:08Z Bound to 127.0.0.1:18445\n2025-08-02T15:13:08Z Bound to [::]:18444\n2025-08-02T15:13:08Z Bound to 0.0.0.0:18444\n2025-08-02T15:13:08Z Loaded 0 addresses from \"anchors.dat\"\n2025-08-02T15:13:08Z 0 block-relay-only anchors will be tried for connections.\n2025-08-02T15:13:08Z init message: Starting network threads…\n2025-08-02T15:13:08Z net thread start\n2025-08-02T15:13:08Z dnsseed thread start\n2025-08-02T15:13:08Z Loading addresses from DNS seed dummySeed.invalid.\n2025-08-02T15:13:08Z addcon thread start\n2025-08-02T15:13:08Z opencon thread start\n2025-08-02T15:13:08Z init message: Done loading\n2025-08-02T15:13:08Z msghand thread start\n2025-08-02T15:13:08Z 0 addresses found from DNS seeds\n2025-08-02T15:13:08Z dnsseed thread exit\n2025-08-02T15:13:08Z Loaded 1 blocks from external file in 38ms\n2025-08-02T15:13:08Z Reindexing finished\n2025-08-02T15:13:08Z Loading 0 mempool transactions from file...\n2025-08-02T15:13:08Z Imported mempool transactions from file: 0 succeeded, 0 failed, 0 expired, 0 already there, 0 waiting for initial broadcast\n2025-08-02T15:13:08Z initload thread exit\n$ ./build/bin/bitcoin-cli -regtest stop\nBitcoin Core stopping\n```\n\nDespite the log containing the messages \"Reindexing block file blk00000.dat...\" and \"Reindexing finished\", the `getblockcount` RPC returns 0.\n\nIt appears this issue affects other operating systems as well, as noted in https://github.com/bitcoin/bitcoin/pull/32987#discussion_r2248288321.",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 0,
    "created_at": "2025-08-02T15:22:03Z",
    "updated_at": "2025-08-02T15:22:12Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 18951207984,
      "node_id": "LE_lADOABII587D3Io1zwAAAARplHww",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18951207984",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-02T15:22:12Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    }
  ]
}