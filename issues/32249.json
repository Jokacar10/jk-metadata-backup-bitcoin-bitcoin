{
  "type": "issue",
  "issue": {
    "id": 2988472531,
    "node_id": "I_kwDOABII586yIHjT",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32249",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32249/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32249/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32249/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32249",
    "number": 32249,
    "state": "open",
    "state_reason": null,
    "title": "Mistake in `feature_pruning.py` functional test?",
    "body": "Reported on IRC yesterday:\n\n```\n17:24:04 < PiRK_> Good evening. I was looking through a functional test and i'm wondering if this isn't a typo:Â \n                  https://github.com/bitcoin/bitcoin/blob/master/test/functional/feature_pruning.py#L44\n17:24:04 < PiRK_> \"nTimes\" vs `nTime`\n17:27:08 < sipa> PiRK_: looks like it\n```\n\nThe code is definitely not doing what the comment says, as it's *always* resetting `mine_large_blocks.nTime` to 0, rather than only on the first run. However, if I fix it, the test does not pass anymore.\n\nFiling this as an issue so someone who is more familiar with the test or feels like digging in can have a look.",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 3,
    "created_at": "2025-04-11T12:03:44Z",
    "updated_at": "2025-04-17T18:28:13Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 17222726100,
      "node_id": "LE_lADOABII586yIHjTzwAAAAQCjfHU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17222726100",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-11T12:04:44Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "subscribed",
      "id": 17237137814,
      "node_id": "SE_lADOABII586yIHjTzwAAAAQDadmW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17237137814",
      "actor": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-13T04:25:00Z"
    },
    {
      "event": "commented",
      "id": 2806590332,
      "node_id": "IC_kwDOABII586nSSt8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2806590332",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-15T15:58:49Z",
      "updated_at": "2025-04-15T15:58:49Z",
      "author_association": "MEMBER",
      "body": "For anyone wanting to fix this, note that `feature_pruning.py` is not run by default. Please verify locally that your changes don't break the test.",
      "user": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32249#issuecomment-2806590332",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32249"
    },
    {
      "event": "commented",
      "id": 2810024702,
      "node_id": "IC_kwDOABII586nfZL-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2810024702",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-16T15:56:01Z",
      "updated_at": "2025-04-16T15:56:01Z",
      "author_association": "MEMBER",
      "body": "For reference, the \"failing\" test that relies on the typo was added in commit 4a1975008b602aeacdad9a74d1837a7455148074. That is, the following diff passes for me:\n\n<details><summary>test diff</summary>\n\n```diff\ndiff --git a/test/functional/feature_pruning.py b/test/functional/feature_pruning.py\nindex 8d924282cf..5e8a388ec6 100755\n--- a/test/functional/feature_pruning.py\n+++ b/test/functional/feature_pruning.py\n@@ -25,7 +25,6 @@ from test_framework.util import (\n     assert_equal,\n     assert_greater_than,\n     assert_raises_rpc_error,\n-    try_rpc,\n )\n \n # Rescans start at the earliest block up to 2 hours before a key timestamp, so\n@@ -41,7 +40,7 @@ def mine_large_blocks(node, n):\n     # Set the nTime if this is the first time this function has been called.\n     # A static variable ensures that time is monotonicly increasing and is therefore\n     # different for each block created => blockhash is unique.\n-    if \"nTimes\" not in mine_large_blocks.__dict__:\n+    if \"nTime\" not in mine_large_blocks.__dict__:\n         mine_large_blocks.nTime = 0\n \n     # Get the block parameters for the first block\n@@ -480,12 +479,8 @@ class PruneTest(BitcoinTestFramework):\n         self.log.info(\"Test invalid pruning command line options\")\n         self.test_invalid_command_line_options()\n \n-        self.log.info(\"Test scanblocks can not return pruned data\")\n         self.test_scanblocks_pruned()\n \n-        self.log.info(\"Test pruneheight reflects the presence of block and undo data\")\n-        self.test_pruneheight_undo_presence()\n-\n         self.log.info(\"Done\")\n \n     def test_scanblocks_pruned(self):\n@@ -499,18 +494,5 @@ class PruneTest(BitcoinTestFramework):\n         assert_raises_rpc_error(-1, \"Block not available (pruned data)\", node.scanblocks,\n             \"start\", [{\"desc\": f\"raw({false_positive_spk.hex()})\"}], 0, 0, \"basic\", {\"filter_false_positives\": True})\n \n-    def test_pruneheight_undo_presence(self):\n-        node = self.nodes[2]\n-        pruneheight = node.getblockchaininfo()[\"pruneheight\"]\n-        fetch_block = node.getblockhash(pruneheight - 1)\n-\n-        self.connect_nodes(1, 2)\n-        peers = node.getpeerinfo()\n-        node.getblockfrompeer(fetch_block, peers[0][\"id\"])\n-        self.wait_until(lambda: not try_rpc(-1, \"Block not available (pruned data)\", node.getblock, fetch_block), timeout=5)\n-\n-        new_pruneheight = node.getblockchaininfo()[\"pruneheight\"]\n-        assert_equal(pruneheight, new_pruneheight)\n-\n if __name__ == '__main__':\n     PruneTest(__file__).main()\n```\n</details>",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32249#issuecomment-2810024702",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32249"
    },
    {
      "event": "commented",
      "id": 2813731772,
      "node_id": "IC_kwDOABII586ntiO8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2813731772",
      "actor": {
        "login": "EniRox001",
        "id": 66912335,
        "node_id": "MDQ6VXNlcjY2OTEyMzM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/66912335?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/EniRox001",
        "html_url": "https://github.com/EniRox001",
        "followers_url": "https://api.github.com/users/EniRox001/followers",
        "following_url": "https://api.github.com/users/EniRox001/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/EniRox001/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/EniRox001/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/EniRox001/subscriptions",
        "organizations_url": "https://api.github.com/users/EniRox001/orgs",
        "repos_url": "https://api.github.com/users/EniRox001/repos",
        "events_url": "https://api.github.com/users/EniRox001/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/EniRox001/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-17T18:28:11Z",
      "updated_at": "2025-04-17T18:28:11Z",
      "author_association": "NONE",
      "body": "Iâll investigate this further and determine the best way to implement a fix.",
      "user": {
        "login": "EniRox001",
        "id": 66912335,
        "node_id": "MDQ6VXNlcjY2OTEyMzM1",
        "avatar_url": "https://avatars.githubusercontent.com/u/66912335?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/EniRox001",
        "html_url": "https://github.com/EniRox001",
        "followers_url": "https://api.github.com/users/EniRox001/followers",
        "following_url": "https://api.github.com/users/EniRox001/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/EniRox001/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/EniRox001/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/EniRox001/subscriptions",
        "organizations_url": "https://api.github.com/users/EniRox001/orgs",
        "repos_url": "https://api.github.com/users/EniRox001/repos",
        "events_url": "https://api.github.com/users/EniRox001/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/EniRox001/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32249#issuecomment-2813731772",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32249"
    }
  ]
}