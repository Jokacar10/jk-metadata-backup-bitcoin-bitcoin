{
  "type": "issue",
  "issue": {
    "id": 2978404475,
    "node_id": "I_kwDOABII586xhth7",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32235",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32235/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32235/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32235/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32235",
    "number": 32235,
    "state": "open",
    "state_reason": null,
    "title": "Tor: TX circuit isolation",
    "body": "Create an option that would forcefully terminate any connection that just sent a locally originating transaction.\n\n-proxyrandomize ensures that each connection corresponds to a tor circuit, therefore terminating connection = terminating circuit\n\nthe same circuit will not send more than 1 transaction. achieving desirable privacy properties.\n\nthis is a preferable solution to the proposed overengineered mess of https://github.com/bitcoin/bitcoin/pull/29415\n",
    "user": {
      "login": "learnwayback",
      "id": 185106791,
      "node_id": "U_kgDOCwiBZw",
      "avatar_url": "https://avatars.githubusercontent.com/u/185106791?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/learnwayback",
      "html_url": "https://github.com/learnwayback",
      "followers_url": "https://api.github.com/users/learnwayback/followers",
      "following_url": "https://api.github.com/users/learnwayback/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/learnwayback/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/learnwayback/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/learnwayback/subscriptions",
      "organizations_url": "https://api.github.com/users/learnwayback/orgs",
      "repos_url": "https://api.github.com/users/learnwayback/repos",
      "events_url": "https://api.github.com/users/learnwayback/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/learnwayback/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64583,
        "node_id": "MDU6TGFiZWw2NDU4Mw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Feature",
        "name": "Feature",
        "color": "7cf575",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 3,
    "created_at": "2025-04-08T02:08:42Z",
    "updated_at": "2025-04-08T08:32:10Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 17162821686,
      "node_id": "LE_lADOABII586xhth7zwAAAAP---A2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17162821686",
      "actor": {
        "login": "learnwayback",
        "id": 185106791,
        "node_id": "U_kgDOCwiBZw",
        "avatar_url": "https://avatars.githubusercontent.com/u/185106791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/learnwayback",
        "html_url": "https://github.com/learnwayback",
        "followers_url": "https://api.github.com/users/learnwayback/followers",
        "following_url": "https://api.github.com/users/learnwayback/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/learnwayback/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/learnwayback/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/learnwayback/subscriptions",
        "organizations_url": "https://api.github.com/users/learnwayback/orgs",
        "repos_url": "https://api.github.com/users/learnwayback/repos",
        "events_url": "https://api.github.com/users/learnwayback/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/learnwayback/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T02:08:42Z",
      "label": {
        "name": "Feature",
        "color": "7cf575"
      }
    },
    {
      "event": "subscribed",
      "id": 17163366335,
      "node_id": "SE_lADOABII586xhth7zwAAAAP_BC-_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17163366335",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T03:34:54Z"
    },
    {
      "event": "commented",
      "id": 2785159104,
      "node_id": "IC_kwDOABII586mAifA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2785159104",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T03:57:53Z",
      "updated_at": "2025-04-08T04:01:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "That doesn't seem private at all to me: Disconnecting right after sending your own tx  means telling your peer that this is likely a local tx, which is only acceptable if there is no other information they can connect it with:\n\nHere, they can probe for various kinds of information about your node in advance, and when you finally disconnect them after sending an own tx they can use that.\n\nAlso, the status quo is to send outgoing txns to all peers, in the tor-only case you'd drop all your peers at the same time without any adjustments such as in #29415 - this is very undesirable.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32235#issuecomment-2785159104",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32235"
    },
    {
      "event": "commented",
      "id": 2785287412,
      "node_id": "IC_kwDOABII586mBBz0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2785287412",
      "actor": {
        "login": "learnwayback",
        "id": 185106791,
        "node_id": "U_kgDOCwiBZw",
        "avatar_url": "https://avatars.githubusercontent.com/u/185106791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/learnwayback",
        "html_url": "https://github.com/learnwayback",
        "followers_url": "https://api.github.com/users/learnwayback/followers",
        "following_url": "https://api.github.com/users/learnwayback/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/learnwayback/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/learnwayback/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/learnwayback/subscriptions",
        "organizations_url": "https://api.github.com/users/learnwayback/orgs",
        "repos_url": "https://api.github.com/users/learnwayback/repos",
        "events_url": "https://api.github.com/users/learnwayback/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/learnwayback/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T05:44:32Z",
      "updated_at": "2025-04-08T05:57:28Z",
      "author_association": "NONE",
      "body": "> That doesn't seem private at all to me: Disconnecting right after sending your own tx means telling your peer that this is likely a local tx, which is only acceptable if there is no other information they can connect it with:\n> Here, they can probe for various kinds of information about your node in advance, and when you finally disconnect them after sending an own tx they can use that.\n\nIf your node is public (probed) then it seems to be too late to hide. TX circuit isolation only makes sense if you are running a probably small & pruned node behind tor for a private wallet and it's unreachable (-listen=0).\nI suppose public nodes may moonlight as private wallets but that strikes me as a bad idea (and maybe not addressable, as any deviation in behavior will leak information).\n\n> Also, the status quo is to send outgoing txns to all peers, in the tor-only case you'd drop all your peers at the same time without any adjustments such as in [#29415](https://github.com/bitcoin/bitcoin/pull/29415) - this is very undesirable.\n\nThis may indeed be a problem, sending behavior may need to be adjusted, send to one peer a time observing the status of the mempool in response (this may already be the default, wouldn't it resend if it doesn't go through?). In most cases a single send will be sufficient.\n",
      "user": {
        "login": "learnwayback",
        "id": 185106791,
        "node_id": "U_kgDOCwiBZw",
        "avatar_url": "https://avatars.githubusercontent.com/u/185106791?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/learnwayback",
        "html_url": "https://github.com/learnwayback",
        "followers_url": "https://api.github.com/users/learnwayback/followers",
        "following_url": "https://api.github.com/users/learnwayback/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/learnwayback/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/learnwayback/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/learnwayback/subscriptions",
        "organizations_url": "https://api.github.com/users/learnwayback/orgs",
        "repos_url": "https://api.github.com/users/learnwayback/repos",
        "events_url": "https://api.github.com/users/learnwayback/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/learnwayback/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32235#issuecomment-2785287412",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32235"
    },
    {
      "event": "commented",
      "id": 2785659926,
      "node_id": "IC_kwDOABII586mCcwW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2785659926",
      "actor": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-04-08T08:32:09Z",
      "updated_at": "2025-04-08T08:32:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "> If your node is public (probed) then it seems to be too late to hide.\n\nWait. It is not that simple. I guess here you assume that if a node is \"public\" you mean \"is accepting inbound connections\". So, if a node is accepting inbound connections on a clearnet IPv4 address and on a an `.onion` address, then it could have been that a spy has correlated and linked the IPv4 address and the `.onion` address as belonging to the same node. That is true, it is too late to \"hide\" as in un-correlate those.\n\nBut. Tor connections do not have a source address, so the connections made by a node are not linked to its listening `.onion` address. Those outbound connections made by the node, even if without a source address could still be linked to the node (i.e. its IPv4 and `.onion` listening addresses) if the node leaks some information at the application level. Most blatant example is if the node is using a custom user agent string, e.g. \"Jonny's node\" and sends that as the greeting over the IPv4, inbound and outbound Tor connections.\n\nSo, outbound Tor connections are pretty anonymous at the network level (no source address) and if we are careful not to leak information at the application level then it is good for sending our own transactions. Best way to avoid application level leakage is to exchange the bare minimum of messages for sending the transaction - don't send anything extra and ignore incoming messages not related to the transaction send.\n\nIn addition it may happen that the transaction is sent to an adversary. They can hold it and start probing nodes' mempools to see which one has the transaction. So the current behavior of putting the transaction in the mempool upfront has to be changed.\n\nSo, have dedicated broadcast connections that do not leak info at the application level and don't put the transaction in the mempool upfront. This is exactly what https://github.com/bitcoin/bitcoin/pull/29415 does.\n\n> overengineered mess\n\nThank you for looking into https://github.com/bitcoin/bitcoin/pull/29415! Concrete ideas into how to simplify things are very much welcome!",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32235#issuecomment-2785659926",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32235"
    }
  ]
}