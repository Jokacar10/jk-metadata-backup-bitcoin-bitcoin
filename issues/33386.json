{
  "type": "issue",
  "issue": {
    "id": 3414291236,
    "node_id": "I_kwDOABII587LgfMk",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33386",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33386/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33386/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33386/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33386",
    "number": 33386,
    "state": "open",
    "state_reason": null,
    "title": "Default ASmap file path is not used unless -asmap is set",
    "body": "The `-asmap` option supposedly has a default value `ip_asn.map` (as defined by `DEFAULT_ASMAP_FILENAME`). However, when I tried to put a file with this name into my datadir, nothing happened. It turns out that this default is not actually used unless the `-asmap` option is set, which seems weird since setting the option normally overrides the default. There is a way to set it without overriding the default on the command line (`bitcoind -asmap`), but in bitcoin.conf there doesn't seem to be a way to do that (e.g. `asmap=1` sets the file path to `1`).\n\nSome ways this could be resolved:\n\n- Simply better document this behavior. The help text doesn't say that the default value is not actually used when the option is not set, and the option itself is introduced as `-asmap=<file>` which in no way indicates that it can be used without a value.\n- If the option is not set (but not explicitly disabled with `-noasmap`) try to load the ASmap file using the default path but don't abort if the file doesn't exist.\n- Remove the default value to prevent any confusion.",
    "user": {
      "login": "vostrnad",
      "id": 43024885,
      "node_id": "MDQ6VXNlcjQzMDI0ODg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/43024885?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vostrnad",
      "html_url": "https://github.com/vostrnad",
      "followers_url": "https://api.github.com/users/vostrnad/followers",
      "following_url": "https://api.github.com/users/vostrnad/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/vostrnad/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/vostrnad/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/vostrnad/subscriptions",
      "organizations_url": "https://api.github.com/users/vostrnad/orgs",
      "repos_url": "https://api.github.com/users/vostrnad/repos",
      "events_url": "https://api.github.com/users/vostrnad/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/vostrnad/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 2,
    "created_at": "2025-09-13T23:37:29Z",
    "updated_at": "2025-09-16T13:22:59Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 3298250998,
      "node_id": "IC_kwDOABII587El1D2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3298250998",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-16T12:00:42Z",
      "updated_at": "2025-09-16T12:00:42Z",
      "author_association": "MEMBER",
      "body": "@fjahr ",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33386#issuecomment-3298250998",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33386"
    },
    {
      "event": "mentioned",
      "id": 19724954755,
      "node_id": "MEE_lADOABII587LgfMkzwAAAASXsuyD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19724954755",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-16T12:00:44Z"
    },
    {
      "event": "subscribed",
      "id": 19724954792,
      "node_id": "SE_lADOABII587LgfMkzwAAAASXsuyo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19724954792",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-16T12:00:44Z"
    },
    {
      "event": "commented",
      "id": 3298756998,
      "node_id": "IC_kwDOABII587EnwmG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3298756998",
      "actor": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-16T13:22:59Z",
      "updated_at": "2025-09-16T13:22:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "I agree that this whole default location thing is a bit odd and it's not something I think we necessarily need but it was already there when I started to get more involved in ASmap and I didn't find it so harmful that it needed to be removed. It can be easily ignored by just not putting a file there after all, so if you don't like it just don't use it, I guess.\n\n> The -asmap option supposedly has a default value ip_asn.map (as defined by DEFAULT_ASMAP_FILENAME). However, when I tried to put a file with this name into my datadir, nothing happened. It turns out that this default is not actually used unless the -asmap option is set, which seems weird since setting the option normally overrides the default. \n\nI think the behavior is correct that placing a file in the default location doesn't activate ASmap automatically. ASmap is off by default and I don't think we have another feature that gets activated with just a file being in a certain place. I prefer that the feature still needs to be explicitly activated for now.\n\nFWIW, I am reading `-asmap` documentation as \"activate the feature, then it will look for the file in the default location or the location provided\" while you read it as \"if the file is in the default location, activate the feature, otherwise also activate the feature if the default location was overridden\". Can you pinpoint which part of the docs gave you this impression? Was it the RPC help or maybe files.md (https://github.com/bitcoin/bitcoin/blob/master/doc/files.md)? Is there a different place where you think this behavior could be better documented?\n\n> Some ways this could be resolved:\n\nI would suggest to go with option one and add some more documentation. Note that this doesn't get easier to reason about when there is an additional path available with embedded data, should #28792 be merged. I am giving an explanation of the behavior here: https://github.com/bitcoin/bitcoin/pull/28792#issuecomment-2322358005 and I am expanding the documentation in the PR accordingly, also adding something explicitly on the default file location: https://github.com/bitcoin/bitcoin/pull/28792/files#diff-b1e19192258d83199d8adaa5ac31f067af98f63554bfdd679bd8e8073815e69dR526 There is also some more on the asmap data here: https://github.com/bitcoin/bitcoin/pull/28792/files#diff-7128095523f4b61eba067a48474bdc10b72fe13cf8843408c1154a488fcf6f60\n\n> There is a way to set it without overriding the default on the command line (bitcoind -asmap), but in bitcoin.conf there doesn't seem to be a way to do that (e.g. asmap=1 sets the file path to 1).\n\nThis is actually a bug (IMO) that is unrelated to ASmap itself, I am fixing it in the embedding PR and it's also included in this smaller prework PR that I have extracted and there was a little bit of discussion on it there as well: https://github.com/bitcoin/bitcoin/pull/33026#discussion_r2228533987 I am actually happy that you ran into this and see it as an issue too ;)",
      "user": {
        "login": "fjahr",
        "id": 1322187,
        "node_id": "MDQ6VXNlcjEzMjIxODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fjahr",
        "html_url": "https://github.com/fjahr",
        "followers_url": "https://api.github.com/users/fjahr/followers",
        "following_url": "https://api.github.com/users/fjahr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fjahr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fjahr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
        "organizations_url": "https://api.github.com/users/fjahr/orgs",
        "repos_url": "https://api.github.com/users/fjahr/repos",
        "events_url": "https://api.github.com/users/fjahr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fjahr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33386#issuecomment-3298756998",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33386"
    }
  ]
}