{
  "type": "issue",
  "issue": {
    "id": 2401300578,
    "node_id": "I_kwDOABII586PIPBi",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30424",
    "number": 30424,
    "state": "closed",
    "state_reason": "completed",
    "title": "intermittent issue in feature_reindex.py: Reindex fails to continue after restart; `initload` thread hangs forever",
    "body": "The goal of `continue_reindex_after_shutdown` is to start with `-reindex`, then stop as soon as possible and restart the node to pick up the reindex again, then stop the node as soon as possible again.\r\n\r\nHowever, sometimes the second shutdown stalls forever (without progress). So it seems like there are several bugs:\r\n\r\n* The shutdown stalls forever (it should interrupt and shut down in a reasonable time)\r\n* There is no reindex progess (it should pick up the previous work and try to make progess)\r\n\r\nApparently this is reproducible for an unknown reason in https://github.com/hebasto/bitcoin/pull/261 (The CI log can be downloaded: https://github.com/user-attachments/files/16166689/ci-log.txt)\r\n\r\nThe tail would be:\r\n\r\n```\r\n2024-07-05T10:43:00.2453258Z \u001b[0;34m node0 2024-07-05T10:32:53.991979Z [initload] [/home/runner/work/_temp/src/validationinterface.cpp:183] [UpdatedBlockTip] [validation] Enqueuing UpdatedBlockTip: new block hash=0a6d527afe45175193bcc158cfad2aa3af7b27f5b1706cb52cd4a9c66e6c2ec5 fork block hash=456fd2eb726ba547a4ca41d2e8f88f8e5bfc30c60ce598c6d8bdf77d17aa01f7 (in IBD=true) \u001b[0m\r\n2024-07-05T10:43:00.2453933Z \u001b[0;34m node0 2024-07-05T10:32:53.992109Z [initload] [/home/runner/work/_temp/src/validation.cpp:3175] [ConnectTip] [bench]   - Load block from disk: 0.05ms \u001b[0m\r\n2024-07-05T10:43:00.2454680Z \u001b[0;34m node0 2024-07-05T10:32:53.992182Z [initload] [/home/runner/work/_temp/src/validation.cpp:2499] [ConnectBlock] [bench]     - Sanity checks: 0.00ms [0.00s (0.00ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2455405Z \u001b[0;34m node0 2024-07-05T10:32:53.992230Z [initload] [/home/runner/work/_temp/src/validation.cpp:2601] [ConnectBlock] [bench]     - Fork checks: 0.05ms [0.00s (0.04ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2456292Z \u001b[0;34m node0 2024-07-05T10:32:53.992241Z [initload] [/home/runner/work/_temp/src/validation.cpp:2693] [ConnectBlock] [bench]       - Connect 1 transactions: 0.01ms (0.011ms/tx, 0.000ms/txin) [0.00s (0.03ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2457101Z \u001b[0;34m node0 2024-07-05T10:32:53.992251Z [initload] [/home/runner/work/_temp/src/validation.cpp:2711] [ConnectBlock] [bench]     - Verify 0 txins: 0.02ms (0.000ms/txin) [0.00s (0.04ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2457995Z \u001b[0;34m node0 2024-07-05T10:32:53.992302Z [initload] [/home/runner/work/_temp/src/validation.cpp:2725] [ConnectBlock] [bench]     - Write undo data: 0.05ms [0.00s (0.10ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2458736Z \u001b[0;34m node0 2024-07-05T10:32:53.992308Z [initload] [/home/runner/work/_temp/src/validation.cpp:2740] [ConnectBlock] [bench]     - Index writing: 0.01ms [0.00s (0.01ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2459820Z \u001b[0;34m node0 2024-07-05T10:32:53.992314Z [initload] [/home/runner/work/_temp/src/validationinterface.cpp:245] [BlockChecked] [validation] BlockChecked: block hash=15f1512d52773c7f26db99f313fed562748b67bf4ab034e92edd8a856f91de0c state=Valid \u001b[0m\r\n2024-07-05T10:43:00.2460665Z \u001b[0;34m node0 2024-07-05T10:32:53.992320Z [initload] [/home/runner/work/_temp/src/validation.cpp:3194] [ConnectTip] [bench]   - Connect total: 0.21ms [0.00s (0.28ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2461358Z \u001b[0;34m node0 2024-07-05T10:32:53.992401Z [initload] [/home/runner/work/_temp/src/validation.cpp:3203] [ConnectTip] [bench]   - Flush: 0.08ms [0.00s (0.10ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2462099Z \u001b[0;34m node0 2024-07-05T10:32:53.992408Z [initload] [/home/runner/work/_temp/src/validation.cpp:3213] [ConnectTip] [bench]   - Writing chainstate: 0.01ms [0.00s (0.02ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2463178Z \u001b[0;34m node0 2024-07-05T10:32:53.992426Z [initload] [/home/runner/work/_temp/src/validationinterface.cpp:222] [MempoolTransactionsRemovedForBlock] [validation] Enqueuing MempoolTransactionsRemovedForBlock: block height=5 txs removed=0 \u001b[0m\r\n2024-07-05T10:43:00.2464650Z \u001b[0;34m node0 2024-07-05T10:32:53.992435Z [initload] [/home/runner/work/_temp/src/validation.cpp:2971] [UpdateTipLog] UpdateTip: new best=15f1512d52773c7f26db99f313fed562748b67bf4ab034e92edd8a856f91de0c height=5 version=0x20000000 log2_work=3.584963 tx=6 date='2024-07-05T10:32:50Z' progress=1.000000 cache=0.3MiB(5txo) \u001b[0m\r\n2024-07-05T10:43:00.2465405Z \u001b[0;34m node0 2024-07-05T10:32:53.992440Z [initload] [/home/runner/work/_temp/src/validation.cpp:3229] [ConnectTip] [bench]   - Connect postprocess: 0.03ms [0.00s (0.06ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2466115Z \u001b[0;34m node0 2024-07-05T10:32:53.992445Z [initload] [/home/runner/work/_temp/src/validation.cpp:3233] [ConnectTip] [bench] - Connect block: 0.38ms [0.00s (0.51ms/blk)] \u001b[0m\r\n2024-07-05T10:43:00.2466848Z \u001b[0;34m node0 2024-07-05T10:32:53.992463Z [initload] [/home/runner/work/_temp/src/txmempool.cpp:664] [check] [mempool] Checking mempool with 0 transactions and 0 inputs \u001b[0m\r\n2024-07-05T10:43:00.2468103Z \u001b[0;34m node0 2024-07-05T10:32:53.992531Z [initload] [/home/runner/work/_temp/src/validationinterface.cpp:212] [BlockConnected] [validation] Enqueuing BlockConnected: block hash=15f1512d52773c7f26db99f313fed562748b67bf4ab034e92edd8a856f91de0c block height=5 \u001b[0m\r\n2024-07-05T10:43:00.2469712Z \u001b[0;34m node0 2024-07-05T10:32:53.992539Z [initload] [/home/runner/work/_temp/src/validationinterface.cpp:183] [UpdatedBlockTip] [validation] Enqueuing UpdatedBlockTip: new block hash=15f1512d52773c7f26db99f313fed562748b67bf4ab034e92edd8a856f91de0c fork block hash=0a6d527afe45175193bcc158cfad2aa3af7b27f5b1706cb52cd4a9c66e6c2ec5 (in IBD=true) \u001b[0m\r\n2024-07-05T10:43:00.2470134Z \u001b[0;36m test  2024-07-05T10:32:54.087000Z TestFramework.node0 (DEBUG): RPC successfully started \u001b[0m\r\n2024-07-05T10:43:00.2470891Z \u001b[0;34m node0 2024-07-05T10:32:54.087480Z [http] [/home/runner/work/_temp/src/httpserver.cpp:303] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:35146 \u001b[0m\r\n2024-07-05T10:43:00.2471658Z \u001b[0;34m node0 2024-07-05T10:32:54.087604Z [httpworker.0] [/home/runner/work/_temp/src/rpc/request.cpp:232] [parse] [rpc] ThreadRPCServer method=getblockcount user=__cookie__ \u001b[0m\r\n2024-07-05T10:43:00.2472018Z \u001b[0;36m test  2024-07-05T10:32:54.088000Z TestFramework.node0 (DEBUG): Stopping node \u001b[0m\r\n2024-07-05T10:43:00.2472756Z \u001b[0;34m node0 2024-07-05T10:32:54.088812Z [http] [/home/runner/work/_temp/src/httpserver.cpp:303] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:35146 \u001b[0m\r\n2024-07-05T10:43:00.2473575Z \u001b[0;34m node0 2024-07-05T10:32:54.088902Z [httpworker.2] [/home/runner/work/_temp/src/rpc/request.cpp:232] [parse] [rpc] ThreadRPCServer method=stop user=__cookie__ \u001b[0m\r\n2024-07-05T10:43:00.2474250Z \u001b[0;34m node0 2024-07-05T10:32:54.089014Z [init] [/home/runner/work/_temp/src/httpserver.cpp:496] [InterruptHTTPServer] [http] Interrupting HTTP server \u001b[0m\r\n2024-07-05T10:43:00.2474902Z \u001b[0;34m node0 2024-07-05T10:32:54.089097Z [init] [/home/runner/work/_temp/src/httprpc.cpp:378] [InterruptHTTPRPC] [rpc] Interrupting HTTP RPC server \u001b[0m\r\n2024-07-05T10:43:00.2475475Z \u001b[0;34m node0 2024-07-05T10:32:54.089111Z [init] [/home/runner/work/_temp/src/rpc/server.cpp:308] [operator()] [rpc] Interrupting RPC \u001b[0m\r\n2024-07-05T10:43:00.2476143Z \u001b[0;34m node0 2024-07-05T10:32:54.089141Z [init] [/home/runner/work/_temp/src/init.cpp:276] [Shutdown] Shutdown: In progress... \u001b[0m\r\n2024-07-05T10:43:00.2476784Z \u001b[0;34m node0 2024-07-05T10:32:54.089151Z [shutoff] [/home/runner/work/_temp/src/httprpc.cpp:383] [StopHTTPRPC] [rpc] Stopping HTTP RPC server \u001b[0m\r\n2024-07-05T10:43:00.2477590Z \u001b[0;34m node0 2024-07-05T10:32:54.089165Z [shutoff] [/home/runner/work/_temp/src/httpserver.cpp:758] [UnregisterHTTPHandler] [http] Unregistering HTTP handler for / (exactmatch 1) \u001b[0m\r\n2024-07-05T10:43:00.2478273Z \u001b[0;34m node0 2024-07-05T10:32:54.089178Z [shutoff] [/home/runner/work/_temp/src/rpc/server.cpp:320] [operator()] [rpc] Stopping RPC \u001b[0m\r\n2024-07-05T10:43:00.2478926Z \u001b[0;34m node0 2024-07-05T10:32:54.089237Z [addcon] [/home/runner/work/_temp/src/util/thread.cpp:22] [TraceThread] addcon thread exit \u001b[0m\r\n2024-07-05T10:43:00.2479490Z \u001b[0;34m node0 2024-07-05T10:32:54.089320Z [shutoff] [/home/runner/work/_temp/src/init.cpp:443] [OnRPCStopped] [rpc] RPC stopped. \u001b[0m\r\n2024-07-05T10:43:00.2480124Z \u001b[0;34m node0 2024-07-05T10:32:54.089328Z [shutoff] [/home/runner/work/_temp/src/httpserver.cpp:508] [StopHTTPServer] [http] Stopping HTTP server \u001b[0m\r\n2024-07-05T10:43:00.2480841Z \u001b[0;34m node0 2024-07-05T10:32:54.089333Z [shutoff] [/home/runner/work/_temp/src/httpserver.cpp:510] [StopHTTPServer] [http] Waiting for HTTP worker threads to exit \u001b[0m\r\n2024-07-05T10:43:00.2481551Z \u001b[0;34m node0 2024-07-05T10:32:54.089404Z [shutoff] [/home/runner/work/_temp/src/httpserver.cpp:538] [StopHTTPServer] [http] Waiting for HTTP event thread to exit \u001b[0m\r\n2024-07-05T10:43:00.2482157Z \u001b[0;34m node0 2024-07-05T10:32:54.089426Z [http] [/home/runner/work/_temp/src/httpserver.cpp:352] [ThreadHTTP] [http] Exited http event loop \u001b[0m\r\n2024-07-05T10:43:00.2482785Z \u001b[0;34m node0 2024-07-05T10:32:54.089498Z [shutoff] [/home/runner/work/_temp/src/httpserver.cpp:544] [StopHTTPServer] [http] Stopped HTTP server \u001b[0m\r\n2024-07-05T10:43:00.2483325Z \u001b[0;34m node0 2024-07-05T10:32:54.136587Z [net] [/home/runner/work/_temp/src/util/thread.cpp:22] [TraceThread] net thread exit \u001b[0m\r\n2024-07-05T10:43:00.2483910Z \u001b[0;34m node0 2024-07-05T10:32:54.186604Z [msghand] [/home/runner/work/_temp/src/util/thread.cpp:22] [TraceThread] msghand thread exit \u001b[0m\r\n2024-07-05T10:43:00.2484577Z \u001b[0;34m node0 2024-07-05T10:32:54.187928Z [shutoff] [/home/runner/work/_temp/src/net.cpp:2328] [DumpAddresses] [net] Flushed 0 addresses to peers.dat  1ms \u001b[0m\r\n2024-07-05T10:43:00.2485177Z \u001b[0;34m node0 2024-07-05T10:32:54.317180Z [scheduler] [/home/runner/work/_temp/src/util/thread.cpp:22] [TraceThread] scheduler thread exit \u001b[0m\r\n2024-07-05T10:43:00.2485646Z \u001b[0;36m test  2024-07-05T10:42:54.132000Z TestFramework.utils (ERROR): wait_until() failed. Predicate: '''' \u001b[0m\r\n2024-07-05T10:43:00.2486144Z \u001b[0;36m                                           self.wait_until(lambda: self.is_node_stopped(**kwargs), timeout=timeout)\u001b[0m\r\n2024-07-05T10:43:00.2486418Z \u001b[0;36m                                   '''\u001b[0m\r\n```\r\n\r\n\r\nOne can see that the `initload` thread does not stop, indicating that it hangs forever.\r\n\r\n\r\nI've also reproduced this outside of cmake: (full datadir)\r\n\r\nhttps://drahtbot.space/temp_scratch/feature_reindex_243_st.tar.zstd\r\n\r\nThe tail looks similar:\r\n\r\n```\r\n node0 2024-07-06T14:30:49.994884Z [initload] [validationinterface.cpp:210] [BlockConnected] [validation] Enqueuing BlockConnected: block hash=33b86c0c25bc28b3d58d8dd3d06d927bd2aabc69a604283f3539bf90d0c69085 block height=21 \r\n node0 2024-07-06T14:30:49.994902Z [initload] [validationinterface.cpp:180] [UpdatedBlockTip] [validation] Enqueuing UpdatedBlockTip: new block hash=33b86c0c25bc28b3d58d8dd3d06d927bd2aabc69a604283f3539bf90d0c69085 fork block hash=6f1cd206b4238dc974a98e62a08a105d6e91021405c57f2be587863340c1f541 (in IBD=true) \r\n node0 2024-07-06T14:30:49.995034Z [httpworker.2] [rpc/request.cpp:232] [parse] [rpc] ThreadRPCServer method=stop user=__cookie__ \r\n node0 2024-07-06T14:30:49.995291Z [init] [httpserver.cpp:498] [InterruptHTTPServer] [http] Interrupting HTTP server \r\n node0 2024-07-06T14:30:49.995456Z [init] [httprpc.cpp:378] [InterruptHTTPRPC] [rpc] Interrupting HTTP RPC server \r\n node0 2024-07-06T14:30:49.995486Z [init] [rpc/server.cpp:308] [operator()] [rpc] Interrupting RPC \r\n node0 2024-07-06T14:30:49.995543Z [init] [init.cpp:276] [Shutdown] Shutdown: In progress... \r\n node0 2024-07-06T14:30:49.995571Z [shutoff] [httprpc.cpp:383] [StopHTTPRPC] [rpc] Stopping HTTP RPC server \r\n node0 2024-07-06T14:30:49.995588Z [shutoff] [httpserver.cpp:760] [UnregisterHTTPHandler] [http] Unregistering HTTP handler for / (exactmatch 1) \r\n node0 2024-07-06T14:30:49.995611Z [addcon] [util/thread.cpp:22] [TraceThread] addcon thread exit \r\n node0 2024-07-06T14:30:49.995689Z [shutoff] [httpserver.cpp:760] [UnregisterHTTPHandler] [http] Unregistering HTTP handler for /wallet/ (exactmatch 0) \r\n node0 2024-07-06T14:30:49.995712Z [shutoff] [rpc/server.cpp:320] [operator()] [rpc] Stopping RPC \r\n node0 2024-07-06T14:30:49.995863Z [shutoff] [init.cpp:443] [OnRPCStopped] [rpc] RPC stopped. \r\n node0 2024-07-06T14:30:49.995883Z [shutoff] [httpserver.cpp:510] [StopHTTPServer] [http] Stopping HTTP server \r\n node0 2024-07-06T14:30:49.995908Z [shutoff] [httpserver.cpp:512] [StopHTTPServer] [http] Waiting for HTTP worker threads to exit \r\n node0 2024-07-06T14:30:49.995963Z [shutoff] [httpserver.cpp:540] [StopHTTPServer] [http] Waiting for HTTP event thread to exit \r\n node0 2024-07-06T14:30:49.995987Z [http] [httpserver.cpp:354] [ThreadHTTP] [http] Exited http event loop \r\n node0 2024-07-06T14:30:49.996087Z [shutoff] [httpserver.cpp:546] [StopHTTPServer] [http] Stopped HTTP server \r\n node0 2024-07-06T14:30:50.087354Z [net] [util/thread.cpp:22] [TraceThread] net thread exit \r\n node0 2024-07-06T14:30:50.087685Z [scheduler] [validationinterface.cpp:180] [operator()] [validation] UpdatedBlockTip: new block hash=4ce0c52bd550b08742147a543466e7510f10f889e6370264e9d5bc32fc6980da fork block hash=749675d2e5744e412229528d60749a25079418d36602c7c10497f7ba858e1798 (in IBD=true) \r\n node0 2024-07-06T14:30:50.087716Z [scheduler] [validationinterface.cpp:220] [operator()] [validation] MempoolTransactionsRemovedForBlock: block height=18 txs removed=0 \r\n node0 2024-07-06T14:30:50.087774Z [scheduler] [validationinterface.cpp:210] [operator()] [validation] BlockConnected: block hash=29b484857bff1534ae62576263136066ea100fcaac7ae1b6486e779a4a01b708 block height=18 \r\n node0 2024-07-06T14:30:50.088010Z [scheduler] [validationinterface.cpp:180] [operator()] [validation] UpdatedBlockTip: new block hash=29b484857bff1534ae62576263136066ea100fcaac7ae1b6486e779a4a01b708 fork block hash=4ce0c52bd550b08742147a543466e7510f10f889e6370264e9d5bc32fc6980da (in IBD=true) \r\n node0 2024-07-06T14:30:50.088056Z [scheduler] [validationinterface.cpp:220] [operator()] [validation] MempoolTransactionsRemovedForBlock: block height=19 txs removed=0 \r\n node0 2024-07-06T14:30:50.088084Z [scheduler] [validationinterface.cpp:210] [operator()] [validation] BlockConnected: block hash=0c48535b5c968dc6af40a9610748eb0578492ae2ba4d5800bc7f43574015f5c5 block height=19 \r\n node0 2024-07-06T14:30:50.088246Z [scheduler] [validationinterface.cpp:180] [operator()] [validation] UpdatedBlockTip: new block hash=0c48535b5c968dc6af40a9610748eb0578492ae2ba4d5800bc7f43574015f5c5 fork block hash=29b484857bff1534ae62576263136066ea100fcaac7ae1b6486e779a4a01b708 (in IBD=true) \r\n node0 2024-07-06T14:30:50.088294Z [scheduler] [validationinterface.cpp:220] [operator()] [validation] MempoolTransactionsRemovedForBlock: block height=20 txs removed=0 \r\n node0 2024-07-06T14:30:50.088321Z [scheduler] [validationinterface.cpp:210] [operator()] [validation] BlockConnected: block hash=6f1cd206b4238dc974a98e62a08a105d6e91021405c57f2be587863340c1f541 block height=20 \r\n node0 2024-07-06T14:30:50.088475Z [scheduler] [validationinterface.cpp:180] [operator()] [validation] UpdatedBlockTip: new block hash=6f1cd206b4238dc974a98e62a08a105d6e91021405c57f2be587863340c1f541 fork block hash=0c48535b5c968dc6af40a9610748eb0578492ae2ba4d5800bc7f43574015f5c5 (in IBD=true) \r\n node0 2024-07-06T14:30:50.088515Z [msghand] [util/thread.cpp:22] [TraceThread] msghand thread exit \r\n node0 2024-07-06T14:30:50.089252Z [shutoff] [net.cpp:2327] [DumpAddresses] [net] Flushed 0 addresses to peers.dat  0ms \r\n node0 2024-07-06T14:30:50.089308Z [scheduler] [util/thread.cpp:22] [TraceThread] scheduler thread exit \r\n test  2024-07-06T15:10:50.029000Z TestFramework.utils (ERROR): wait_until() failed. Predicate: '''' \r\n                                           self.wait_until(lambda: self.is_node_stopped(**kwargs), timeout=timeout)\r\n                                   '''\r\n\r\n\r\n",
    "user": {
      "login": "maflcko",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maflcko",
      "html_url": "https://github.com/maflcko",
      "followers_url": "https://api.github.com/users/maflcko/followers",
      "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
      "organizations_url": "https://api.github.com/users/maflcko/orgs",
      "repos_url": "https://api.github.com/users/maflcko/repos",
      "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/maflcko/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64585,
        "node_id": "MDU6TGFiZWw2NDU4NQ==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Bug",
        "name": "Bug",
        "color": "FBBAAB",
        "default": false
      },
      {
        "id": 219890555,
        "node_id": "MDU6TGFiZWwyMTk4OTA1NTU=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Block%20storage",
        "name": "Block storage",
        "color": "000000",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/66",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/66",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/66/labels",
      "id": 10314936,
      "node_id": "MI_kwDOABII584AnWS4",
      "number": 66,
      "state": "closed",
      "title": "28.0",
      "creator": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "open_issues": 0,
      "closed_issues": 98,
      "created_at": "2023-12-15T12:08:23Z",
      "updated_at": "2024-10-16T15:52:11Z",
      "closed_at": "2024-10-16T15:52:11Z"
    },
    "locked": true,
    "comments": 5,
    "closed_at": "2024-07-16T16:32:04Z",
    "closed_by": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "created_at": "2024-07-10T17:21:41Z",
    "updated_at": "2025-07-16T11:40:15Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 13459709170,
      "node_id": "LE_lADOABII586PIPBizwAAAAMiQtzy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13459709170",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-10T17:21:50Z",
      "label": {
        "name": "Bug",
        "color": "FBBAAB"
      }
    },
    {
      "event": "labeled",
      "id": 13459709183,
      "node_id": "LE_lADOABII586PIPBizwAAAAMiQtz_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13459709183",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-10T17:21:50Z",
      "label": {
        "name": "Block storage",
        "color": "000000"
      }
    },
    {
      "event": "labeled",
      "id": 13459709192,
      "node_id": "LE_lADOABII586PIPBizwAAAAMiQt0I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13459709192",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-10T17:21:50Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "milestoned",
      "id": 13459717576,
      "node_id": "MIE_lADOABII586PIPBizwAAAAMiQv3I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13459717576",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-10T17:22:30Z",
      "milestone": {
        "title": "28.0"
      }
    },
    {
      "event": "commented",
      "id": 2223311441,
      "node_id": "IC_kwDOABII586EhQpR",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2223311441",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T15:57:06Z",
      "updated_at": "2024-07-11T15:57:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "> There is no reindex progess (it should pick up the previous work and try to make progess)\r\n\r\nI don't think that is the problem here. We have the (in my opinion slightly weird) behavior that when reindex continues after an interrupted reindex run, it calls [ActivateBestChain](https://github.com/bitcoin/bitcoin/blob/9b480f7a25a737c9c4ebc33401e94d66c2da9ec3/src/validation.cpp#L5112-L5115) immediately when processing the genesis block, which result in multiple blocks being connected that were reindexed in the previous run. Only then, the rest of the actual reindex continues.\r\nThis can be seen in the logs, several blocks are being connected, so progress is being made - but then it's again being interrupted while `initload` is still in `ActivateBestChain()`, and the shutdown problems occur.\r\n\r\nBut that is just a side topic, I couldn't understand or replicate the actual error yet.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30424#issuecomment-2223311441",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424"
    },
    {
      "event": "commented",
      "id": 2223676434,
      "node_id": "IC_kwDOABII586EipwS",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2223676434",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T18:58:28Z",
      "updated_at": "2024-07-11T18:58:57Z",
      "author_association": "CONTRIBUTOR",
      "body": "I now have a hypothesis what might be happening. In `Shutdown()`, we first stop the scheduler thread and then the import blocks thread [here](https://github.com/bitcoin/bitcoin/blob/00feabf6c59c954c1e3a5a46e58cb80cd8d55911/src/init.cpp#L301-L302).\r\nWhen the import blocks thread calls `ActivateBestChain()`, this can call `LimitValidationInterfaceQueue` [here](https://github.com/bitcoin/bitcoin/blob/00feabf6c59c954c1e3a5a46e58cb80cd8d55911/src/validation.cpp#L3487). In a case of unfortunate timing, this may call `SyncWithValidationInterfaceQueue()` after the scheduler thread was stopped, so that it would hang forever. I could reproduce the failure in `feature_reindex.py` locally by adding a sleep like this:\r\n\r\n```diff\r\ndiff --git a/src/validation.cpp b/src/validation.cpp\r\nindex 74f0e4975c..be1706fdaf 100644\r\n--- a/src/validation.cpp\r\n+++ b/src/validation.cpp\r\n@@ -3446,6 +3446,7 @@ static void LimitValidationInterfaceQueue(ValidationSignals& signals) LOCKS_EXCL\r\n     AssertLockNotHeld(cs_main);\r\n \r\n     if (signals.CallbacksPending() > 10) {\r\n+        std::this_thread::sleep_for(std::chrono::milliseconds(50));\r\n         signals.SyncWithValidationInterfaceQueue();\r\n     }\r\n }\r\n```\r\n\r\nI think a simple fix would be to change the order in `Shutdown()`, stopping import block before the scheduler:\r\n```diff\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex e4b65fbfa9..e0aae3699f 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -298,8 +298,8 @@ void Shutdown(NodeContext& node)\r\n \r\n     // After everything has been shut down, but before things get flushed, stop the\r\n     // scheduler and load block thread.\r\n-    if (node.scheduler) node.scheduler->stop();\r\n     if (node.chainman && node.chainman->m_thread_load.joinable()) node.chainman->m_thread_load.join();\r\n+    if (node.scheduler) node.scheduler->stop();\r\n \r\n     // After the threads that potentially access these pointers have been stopped,\r\n     // destruct and reset all to nullptr.\r\n```\r\n\r\nI'd have to think a bit more if changing that order breaks something else, will then open a fix. Would also be good to check if that fixes the issue in the reproducible cmake / sanitizer environment (fyi @hebasto).",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30424#issuecomment-2223676434",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424"
    },
    {
      "event": "mentioned",
      "id": 13476247027,
      "node_id": "MEE_lADOABII586PIPBizwAAAAMjPzXz",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13476247027",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T18:58:29Z"
    },
    {
      "event": "subscribed",
      "id": 13476247044,
      "node_id": "SE_lADOABII586PIPBizwAAAAMjPzYE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13476247044",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T18:58:29Z"
    },
    {
      "event": "referenced",
      "id": 13476909577,
      "node_id": "REFE_lADOABII586PIPBizwAAAAMjSVIJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13476909577",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "cb47f434a7c21fe95d611b65ebdd2f4b62d518d4",
      "commit_url": "https://api.github.com/repos/hebasto/bitcoin/commits/cb47f434a7c21fe95d611b65ebdd2f4b62d518d4",
      "created_at": "2024-07-11T19:50:00Z"
    },
    {
      "event": "referenced",
      "id": 13477232100,
      "node_id": "REFE_lADOABII586PIPBizwAAAAMjTj3k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13477232100",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "9ca563bdf2d08f11dc0feee29491c37495e7562a",
      "commit_url": "https://api.github.com/repos/hebasto/bitcoin/commits/9ca563bdf2d08f11dc0feee29491c37495e7562a",
      "created_at": "2024-07-11T20:03:34Z"
    },
    {
      "event": "commented",
      "id": 2223971606,
      "node_id": "IC_kwDOABII586Ejx0W",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2223971606",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T21:30:17Z",
      "updated_at": "2024-07-11T21:30:17Z",
      "author_association": "MEMBER",
      "body": "> I think a simple fix would be to change the order in `Shutdown()`, stopping import block before the scheduler:\r\n> \r\n> ```diff\r\n> diff --git a/src/init.cpp b/src/init.cpp\r\n> index e4b65fbfa9..e0aae3699f 100644\r\n> --- a/src/init.cpp\r\n> +++ b/src/init.cpp\r\n> @@ -298,8 +298,8 @@ void Shutdown(NodeContext& node)\r\n>  \r\n>      // After everything has been shut down, but before things get flushed, stop the\r\n>      // scheduler and load block thread.\r\n> -    if (node.scheduler) node.scheduler->stop();\r\n>      if (node.chainman && node.chainman->m_thread_load.joinable()) node.chainman->m_thread_load.join();\r\n> +    if (node.scheduler) node.scheduler->stop();\r\n>  \r\n>      // After the threads that potentially access these pointers have been stopped,\r\n>      // destruct and reset all to nullptr.\r\n> ```\r\n> \r\n> I'd have to think a bit more if changing that order breaks something else, will then open a fix. Would also be good to check if that fixes the issue in the reproducible cmake / sanitizer environment (fyi @hebasto).\r\n\r\nI can confirm that the suggested diff indeed fixes the issue in all my cmake / sanitizer setups.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30424#issuecomment-2223971606",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424"
    },
    {
      "event": "mentioned",
      "id": 13478284517,
      "node_id": "MEE_lADOABII586PIPBizwAAAAMjXkzl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13478284517",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T21:30:19Z"
    },
    {
      "event": "subscribed",
      "id": 13478284524,
      "node_id": "SE_lADOABII586PIPBizwAAAAMjXkzs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13478284524",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T21:30:19Z"
    },
    {
      "event": "commented",
      "id": 2224098060,
      "node_id": "IC_kwDOABII586EkQsM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2224098060",
      "actor": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-07-11T23:09:28Z",
      "updated_at": "2024-07-11T23:09:28Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks!\r\nJust saw that #23234 describes the same issue (and suggests the same fix).",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30424#issuecomment-2224098060",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30424"
    },
    {
      "event": "closed",
      "id": 13524088386,
      "node_id": "CE_lADOABII586PIPBizwAAAAMmGTZC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13524088386",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "1d24d383b45ec54b65da2c9ea86554f45a8f1b06",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d24d383b45ec54b65da2c9ea86554f45a8f1b06",
      "created_at": "2024-07-16T16:32:04Z"
    },
    {
      "event": "referenced",
      "id": 13524101008,
      "node_id": "REFE_lADOABII586PIPBizwAAAAMmGWeQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/13524101008",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "1d24d383b45ec54b65da2c9ea86554f45a8f1b06",
      "commit_url": "https://api.github.com/repos/fanquake/bitcoin/commits/1d24d383b45ec54b65da2c9ea86554f45a8f1b06",
      "created_at": "2024-07-16T16:33:15Z"
    },
    {
      "event": "locked",
      "id": 18657574377,
      "node_id": "LOE_lADOABII586PIPBizwAAAARYE_3p",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18657574377",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-16T11:40:15Z"
    }
  ]
}