{
  "type": "issue",
  "issue": {
    "id": 3394100636,
    "node_id": "I_kwDOABII587KTd2c",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33341",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33341/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33341/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33341/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33341",
    "number": 33341,
    "state": "open",
    "state_reason": null,
    "title": "ipc: crash on `submitSolution` call with invalid coinbase",
    "body": "There seems to be an unhandled exception when deserializing an invalid coinbase in `submitSolution`. \n<details>\n<summary>log</summary>\n\n```bash\nnode0 2025-09-08T11:26:56.165687Z [capnp-loop] [../../../src/ipc/capnp/protocol.cpp:35] [void ipc::capnp::(anonymous namespace)::IpcLogFn(bool, std::string)] [ipc] {bitcoin-node-166995/b-capnp-loop-166997} IPC server recv request  #14 BlockTemplate.submitSolution$Params (context = (thread = <external capability>), version = 0, timestamp = 0, nonce = 0, coinbase = \"\") \n node0 2025-09-08T11:26:56.165711Z [capnp-loop] [../../../src/ipc/capnp/protocol.cpp:35] [void ipc::capnp::(anonymous namespace)::IpcLogFn(bool, std::string)] [ipc] {bitcoin-node-166995/b-capnp-loop-166997} IPC server post request  #14 {bitcoin-node-166995/b-capnp-loop-167036 (from pythread)} \n test  2025-09-08T11:26:56.207859Z TestFramework (ERROR): Unexpected exception \n                                   Traceback (most recent call last):\n                                     File \"/root/bitcoin/test/functional/test_framework/test_framework.py\", line 199, in main\n                                       self.run_test()\n                                     File \"/root/bitcoin/./debugbuild/test/functional/interface_ipc.py\", line 186, in run_test\n                                       self.run_mining_test()\n                                     File \"/root/bitcoin/./debugbuild/test/functional/interface_ipc.py\", line 182, in run_mining_test\n                                       asyncio.run(capnp.run(async_routine()))\n                                     File \"/usr/lib/python3.11/asyncio/runners.py\", line 190, in run\n                                       return runner.run(main)\n                                              ^^^^^^^^^^^^^^^^\n                                     File \"/usr/lib/python3.11/asyncio/runners.py\", line 118, in run\n                                       return self._loop.run_until_complete(task)\n                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                     File \"/usr/lib/python3.11/asyncio/base_events.py\", line 653, in run_until_complete\n                                       return future.result()\n                                              ^^^^^^^^^^^^^^^\n                                     File \"capnp/lib/capnp.pyx\", line 1965, in run\n                                     File \"capnp/lib/capnp.pyx\", line 1966, in capnp.lib.capnp.run\n                                     File \"/root/bitcoin/./debugbuild/test/functional/interface_ipc.py\", line 128, in async_routine\n                                       result = await template.result.submitSolution(ctx, 0, 0, 0, b\"\")\n                                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n                                   capnp.lib.capnp.KjException: capnp/rpc.c++:2778: disconnected: Peer disconnected.\n                                   stack: 7fd1cba914c4 7fd1cba87d10 7fd1cba777c0 7fd1cb9164f0 7fd1cb9187d0\n test  2025-09-08T11:26:56.218026Z TestFramework (DEBUG): Closing down network thread \n test  2025-09-08T11:26:56.268255Z TestFramework (INFO): Not stopping nodes as test failed. The dangling processes will be cleaned up later. \n test  2025-09-08T11:26:56.268354Z TestFramework (WARNING): Not cleaning up dir /tmp/bitcoin_func_test_jp4hfh13 \n test  2025-09-08T11:26:56.268384Z TestFramework (ERROR): Test failed. Test logging available at /tmp/bitcoin_func_test_jp4hfh13/test_framework.log \n test  2025-09-08T11:26:56.268453Z TestFramework (ERROR): \n test  2025-09-08T11:26:56.268517Z TestFramework (ERROR): Hint: Call /root/bitcoin/test/functional/combine_logs.py '/tmp/bitcoin_func_test_jp4hfh13' to consolidate all logs \n test  2025-09-08T11:26:56.268547Z TestFramework (ERROR): \n test  2025-09-08T11:26:56.268569Z TestFramework (ERROR): If this failure happened unexpectedly or intermittently, please file a bug and provide a link or upload of the combined log. \n test  2025-09-08T11:26:56.268603Z TestFramework (ERROR): https://github.com/bitcoin/bitcoin/issues \n test  2025-09-08T11:26:56.268627Z TestFramework (ERROR): \n\n node0 stderr terminate called after throwing an instance of 'std::ios_base::failure[abi:cxx11]'\n  what():  SpanReader::read(): end of data: iostream error \n```\n\n</details>\n\nI found this while using fuzzamoto to test the mining interface, but the easiest way to reproduce would be to just add \n```c++\nawait template.result.submitSolution(ctx, 0, 0, 0, b\"\")\n```\nafter creating the block template in the IPC functional test (`interface_ipc.py`).",
    "user": {
      "login": "marcofleon",
      "id": 95179662,
      "node_id": "U_kgDOBaxTjg",
      "avatar_url": "https://avatars.githubusercontent.com/u/95179662?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcofleon",
      "html_url": "https://github.com/marcofleon",
      "followers_url": "https://api.github.com/users/marcofleon/followers",
      "following_url": "https://api.github.com/users/marcofleon/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/marcofleon/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/marcofleon/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/marcofleon/subscriptions",
      "organizations_url": "https://api.github.com/users/marcofleon/orgs",
      "repos_url": "https://api.github.com/users/marcofleon/repos",
      "events_url": "https://api.github.com/users/marcofleon/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/marcofleon/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 2260068353,
        "node_id": "MDU6TGFiZWwyMjYwMDY4MzUz",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/interfaces",
        "name": "interfaces",
        "description": "",
        "color": "83c9fc",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 1,
    "created_at": "2025-09-08T12:53:25Z",
    "updated_at": "2025-09-08T12:55:32Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 3266183002,
      "node_id": "IC_kwDOABII587Crf9a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3266183002",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-08T12:55:26Z",
      "updated_at": "2025-09-08T12:55:26Z",
      "author_association": "MEMBER",
      "body": "@Sjors @ryanofsky ",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33341#issuecomment-3266183002",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33341"
    },
    {
      "event": "mentioned",
      "id": 19564462274,
      "node_id": "MEE_lADOABII587KTd2czwAAAASOIgDC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19564462274",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-08T12:55:27Z"
    },
    {
      "event": "subscribed",
      "id": 19564462316,
      "node_id": "SE_lADOABII587KTd2czwAAAASOIgDs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19564462316",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-08T12:55:28Z"
    },
    {
      "event": "mentioned",
      "id": 19564462374,
      "node_id": "MEE_lADOABII587KTd2czwAAAASOIgEm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19564462374",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-08T12:55:28Z"
    },
    {
      "event": "subscribed",
      "id": 19564462412,
      "node_id": "SE_lADOABII587KTd2czwAAAASOIgFM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19564462412",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-08T12:55:28Z"
    },
    {
      "event": "labeled",
      "id": 19564463774,
      "node_id": "LE_lADOABII587KTd2czwAAAASOIgae",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19564463774",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-08T12:55:32Z",
      "label": {
        "name": "interfaces",
        "color": "83c9fc"
      }
    }
  ]
}