{
  "type": "issue",
  "issue": {
    "id": 2854785350,
    "node_id": "I_kwDOABII586qKJFG",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31873",
    "number": 31873,
    "state": "open",
    "state_reason": null,
    "title": "guix: Unable to reproduce macOS SDK tarball on Fedora 40",
    "body": "On Fedora 40, following the instructions in [`contrib/macdeploy/README.md`](https://github.com/bitcoin/bitcoin/tree/master/contrib/macdeploy#readme) to generate the macOS SDK tarball that is used during GUIX builds, I am not able to reproduce the hash in the readme for the generated tarball. I have reproduced this on two different Fedora 40 machines, and with a Fedora 40 docker image, but the issue does not appear when generating the tarball in an Ubuntu 24.04 docker image, or on a macOS Sequoia arm device, I've included reproduction instructions below.\n\n# Steps to reproduce\n\nYou first have to acquire the `Xcode_15.xip` archive according to the instructions in [`contrib/macdeploy/README.md`](https://github.com/bitcoin/bitcoin/tree/master/contrib/macdeploy#readme). The steps below assume you have placed this archive at `~/xcode/Xcode_15.xip`.\n\n## Making the bad tarball using Fedora 40\n### Container setup\n```bash\nsha256sum ~/xcode/Xcode_15.xip\n# 4daaed2ef2253c9661779fa40bfff50655dc7ec45801aba5a39653e7bcdde48e  /home/user/xcode/Xcode_15.xip\ndocker pull fedora:40\ndocker run -it \\\n  -v ~/xcode:/xcode \\\n  fedora:40 \\\n  /bin/bash\n```\n\n### In the container\n\n```bash\nsha256sum /xcode/Xcode_15.xip\n# 4daaed2ef2253c9661779fa40bfff50655dc7ec45801aba5a39653e7bcdde48e  /xcode/Xcode_15.xip\ndnf install cpio git python -y\ngit clone --depth 1 https://github.com/bitcoin/bitcoin.git\ngit clone --depth 1 https://github.com/bitcoin-core/apple-sdk-tools.git\npython3 apple-sdk-tools/extract_xcode.py -f /xcode/Xcode_15.xip | cpio -d -i\n# 23498380 blocks\n/bitcoin/contrib/macdeploy/gen-sdk Xcode.app/\n# Found Xcode (version: 15.0, build id: 15A240d)\n# Found MacOSX SDK (version: 14.0, build id: 23A334)\n# Creating output .tar.gz file...\n# Adding MacOSX SDK 14.0 files...\n# Done! Find the resulting gzipped tarball at:\n/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\nsha256sum Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n# 5b1a05d3e79fd14f5c8f6d3565762c89a522c7f5e7efbed4353d878410f2d765  Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n# Wrong hash!\n```\n\n## Making a good tarball using Ubuntu 24.04\n\n### Container setup\n```bash\nsha256sum ~/xcode/Xcode_15.xip\n# 4daaed2ef2253c9661779fa40bfff50655dc7ec45801aba5a39653e7bcdde48e  /home/user/xcode/Xcode_15.xip\ndocker pull ubuntu:24.04\ndocker run -it \\\n  -v ~/xcode:/xcode \\\n  ubuntu:24.04 \\\n  /bin/bash\n```\n\n### In the container\n```bash\nexport DEBIAN_FRONTEND=noninteractive # prevents apt from halting to interact\nsha256sum /xcode/Xcode_15.xip\n# 4daaed2ef2253c9661779fa40bfff50655dc7ec45801aba5a39653e7bcdde48e  /xcode/Xcode_15.xip\napt update\napt install cpio git python3 -y\ngit clone --depth 1 https://github.com/bitcoin/bitcoin.git\ngit clone --depth 1 https://github.com/bitcoin-core/apple-sdk-tools.git\npython3 apple-sdk-tools/extract_xcode.py -f /xcode/Xcode_15.xip | cpio -d -i\n# 23498380 blocks\n/bitcoin/contrib/macdeploy/gen-sdk Xcode.app/\n# Found Xcode (version: 15.0, build id: 15A240d)\n# Found MacOSX SDK (version: 14.0, build id: 23A334)\n# Creating output .tar.gz file...\n# Adding MacOSX SDK 14.0 files...\n# Done! Find the resulting gzipped tarball at:\n# /Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\nsha256sum Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n# c0c2e7bb92c1fee0c4e9f3a485e4530786732d6c6dd9e9f418c282aa6892f55d  Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n```\n\n# Further investigation\n\n`pkgdiff` reports the contents of the two tarballs are identical:\n\n```console\n$ sha256sum badsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n5b1a05d3e79fd14f5c8f6d3565762c89a522c7f5e7efbed4353d878410f2d765  badsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n$ sha256sum goodsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\nc0c2e7bb92c1fee0c4e9f3a485e4530786732d6c6dd9e9f418c282aa6892f55d  goodsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n$ pkgdiff badsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz goodsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\nReading packages ...\nComparing packages ...\ncreating report ...\nresult: UNCHANGED\n```\n<details> \n\n<summary> pkgdiff report screenshot </summary>\n\n![Image](https://github.com/user-attachments/assets/364c072b-bcb1-412a-92b0-ea2491878865)\n\n</details>",
    "user": {
      "login": "davidgumberg",
      "id": 2257631,
      "node_id": "MDQ6VXNlcjIyNTc2MzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidgumberg",
      "html_url": "https://github.com/davidgumberg",
      "followers_url": "https://api.github.com/users/davidgumberg/followers",
      "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
      "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
      "repos_url": "https://api.github.com/users/davidgumberg/repos",
      "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 6,
    "created_at": "2025-02-14T22:10:00Z",
    "updated_at": "2025-02-15T07:01:59Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2660423530,
      "node_id": "IC_kwDOABII586ektdq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660423530",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-14T22:50:18Z",
      "updated_at": "2025-02-14T22:50:18Z",
      "author_association": "MEMBER",
      "body": "> `pkgdiff` reports the contents of the two tarballs are identical:\n\nTry `diffoscope` (be prepared for very long output, and probably very long runtime).",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31873#issuecomment-2660423530",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873"
    },
    {
      "event": "commented",
      "id": 2660517967,
      "node_id": "IC_kwDOABII586elEhP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660517967",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-14T23:50:08Z",
      "updated_at": "2025-02-14T23:50:25Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Try `diffoscope` (be prepared for very long output, and probably very long runtime).\n\n`diffoscope` says:\n\n> Format-specific differences are supported for Gzipped files but no file-specific differences were detected; falling back to a binary diff.`\n\n```bash\ndiffoscope --no-default-limits --max-page-diff-block-line 16384 --html diffoscope.html badsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz  goodsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n```\n\nand the binary seems totally different to my untrained eyes:\n\nFirst 16,000 lines of diff: https://davidgumberg.github.io/fg/other/sdkdiffoscope.html\n\n<details>\n\n<summary> screenshot of diffoscope html output </summary>\n\n![Image](https://github.com/user-attachments/assets/cebc6149-ce83-434c-8f94-671cff66feb6)\n\n</details>",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31873#issuecomment-2660517967",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873"
    },
    {
      "event": "commented",
      "id": 2660536157,
      "node_id": "IC_kwDOABII586elI9d",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660536157",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-15T00:02:05Z",
      "updated_at": "2025-02-15T00:02:05Z",
      "author_association": "MEMBER",
      "body": "Can you `gunzip` the files and compare the `.tar`s?",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31873#issuecomment-2660536157",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873"
    },
    {
      "event": "commented",
      "id": 2660561659,
      "node_id": "IC_kwDOABII586elPL7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660561659",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-15T00:21:31Z",
      "updated_at": "2025-02-15T01:17:53Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Can you `gunzip` the files and compare the `.tar`s?\n\nNice, the `gunzip`'ed tars are identical:\n\n```console\n$ gunzip badsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n$ gunzip goodsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n$ sha256sum badsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar\nd91d39ca0dbff805677afc46abe0064056e7406728aa58e67ad98e147ef0e04c  badsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar\n$ sha256sum goodsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar\nd91d39ca0dbff805677afc46abe0064056e7406728aa58e67ad98e147ef0e04c  goodsdk/Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar\n```\n\nFedora 40 has gzip 1.13 and Ubuntu 24.04 has gzip 1.12, I'll see if this issue occurs with gzip 1.13 on ubuntu.\n\n---\nEdit: No change after swapping out gzip version on both Fedora and Ubuntu, and I realized that python's gzip module doesn't rely on the system's gzip binary\n\n```python\nimport zlib\nprint(zlib.ZLIB_VERSION)\n```\n\n1.3.1.zlib-ng on Fedora 40 and 1.3 on Ubuntu 24.04",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31873#issuecomment-2660561659",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873"
    },
    {
      "event": "commented",
      "id": 2660692458,
      "node_id": "IC_kwDOABII586elvHq",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660692458",
      "actor": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-15T03:26:25Z",
      "updated_at": "2025-02-15T03:28:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "Tried Fedora with the same zlib and python version as Ubuntu 24.04 and I still get the same bad hash.\n\n<details>\n\n<summary> python 3.12.3  w/ zlib-1.3 on fedora </summary>\n\n```bash\nsudo dnf install gcc openssl-devel xz-devel\ncurl -L https://github.com/madler/zlib/releases/download/v1.3/zlib-1.3.tar.gz | tar xzvf -\ncd zlib-1.3 && ./configure && make -j $(nproc) && make install && cd ..\n\ncurl https://pyenv.run | bash\nexport PYENV_ROOT=\"$HOME/.pyenv\"\n[[ -d $PYENV_ROOT/bin ]] && export PATH=\"$PYENV_ROOT/bin:$PATH\"\neval \"$(pyenv init - bash)\"\n\npyenv install 3.12.3\npyenv global 3.12.3\n\n# verify zlib version\npython -c \"import zlib; print(zlib.ZLIB_VERSION)\"\n# 1.3\n\n# regenerate Xcode.app\nrm -rf Xcode.app/ && python3 apple-sdk-tools/extract_xcode.py -f /xcode/Xcode_15.xip | cpio -d -i\n/bitcoin/contrib/macdeploy/gen-sdk Xcode.app/\nsha256sum Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n# 5b1a05d3e79fd14f5c8f6d3565762c89a522c7f5e7efbed4353d878410f2d765  Xcode-15.0-15A240d-extracted-SDK-with-li\nbcxx-headers.tar.gz\n```\n\n</details>\n\nI also tried the opposite on ubuntu,  python 3.12.8 with the zlib-ng \"1.3\" and I got the same bad hash as fedora 40:\n\n<details>\n\n<summary> python 3.12.8 w/ zlib-ng 1.3.1 on ubuntu </summary>\n\n```bash\napt install -y build-essential curl liblzma-dev libssl-dev pkg-config\ncurl -L https://github.com/zlib-ng/zlib-ng/archive/refs/tags/2.2.3.tar.gz | tar xzvf -\ncd zlib-ng-2.2.3/ && ./configure --zlib-compat && make -j $(nproc) && make install && cd ../\n\ncurl https://pyenv.run | bash\nexport PYENV_ROOT=\"$HOME/.pyenv\"\n[[ -d $PYENV_ROOT/bin ]] && export PATH=\"$PYENV_ROOT/bin:$PATH\"\neval \"$(pyenv init - bash)\"\n\npyenv install 3.12.8\npyenv global 3.12.8\n\n# verify zlib version\npython -c \"import zlib; print(zlib.ZLIB_VERSION)\"\n# 1.3.1.zlib-ng\n\n\n# try gen-sdk again\nrm -rf Xcode.app/ && python3 apple-sdk-tools/extract_xcode.py -f /xcode/Xcode_15.xip | cpio -d -i\n/bitcoin/contrib/macdeploy/gen-sdk Xcode.app/\nsha256sum Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n# 5b1a05d3e79fd14f5c8f6d3565762c89a522c7f5e7efbed4353d878410f2d765  Xcode-15.0-15A240d-extracted-SDK-with-libcxx-headers.tar.gz\n```\n\n</details>\n\nA bit mysterious,  I'll keep experimenting.\n\n\n\n\n",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31873#issuecomment-2660692458",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873"
    },
    {
      "event": "commented",
      "id": 2660780429,
      "node_id": "IC_kwDOABII586emEmN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660780429",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-15T07:01:59Z",
      "updated_at": "2025-02-15T07:01:59Z",
      "author_association": "CONTRIBUTOR",
      "body": "Is the output of `tar tvvf` the same for both archives?",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31873#issuecomment-2660780429",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31873"
    }
  ]
}