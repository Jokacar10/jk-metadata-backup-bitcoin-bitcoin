{
  "type": "issue",
  "issue": {
    "id": 3363223465,
    "node_id": "I_kwDOABII587Idrep",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33267",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33267/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33267/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33267/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/33267",
    "number": 33267,
    "state": "closed",
    "state_reason": "completed",
    "title": "124th peer connection closed every second",
    "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nI'm on Bitcoin Core v29.0.0\n\nI noticed that when at the max number of peers (124 total; 10 outbound; 114 inbound) the most recent peer connection is continually dropped after 1 second and another peer is selected. I can't imagine this is good behavior for the network.\n\nAs you can see, my peer count is very high (basically == number of seconds I've been at 124 peers) and the most recent peer only ever has an age of 1s.\n\n<img width=\"968\" height=\"648\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/eb770a4b-a576-41e6-9d97-13c40fb13ca0\" />\n\n### Expected behaviour\n\nI would expect the program to stop accepting connections when peers == max_peers, instead of accepting the connection and dropping it 1 second later.\n\n### Steps to reproduce\n\nLeave client running on a high speed network long enough to hit 124 peers.\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv29.0.0\n\n### Operating system and version\n\nFreeBSD 14.3\n\n### Machine specifications\n\n_No response_",
    "user": {
      "login": "lnxsrt",
      "id": 8828658,
      "node_id": "MDQ6VXNlcjg4Mjg2NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8828658?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lnxsrt",
      "html_url": "https://github.com/lnxsrt",
      "followers_url": "https://api.github.com/users/lnxsrt/followers",
      "following_url": "https://api.github.com/users/lnxsrt/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/lnxsrt/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/lnxsrt/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/lnxsrt/subscriptions",
      "organizations_url": "https://api.github.com/users/lnxsrt/orgs",
      "repos_url": "https://api.github.com/users/lnxsrt/repos",
      "events_url": "https://api.github.com/users/lnxsrt/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/lnxsrt/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 477890092,
        "node_id": "MDU6TGFiZWw0Nzc4OTAwOTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Questions%20and%20Help",
        "name": "Questions and Help",
        "color": "006688",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 1,
    "closed_at": "2025-08-28T13:45:54Z",
    "closed_by": {
      "login": "maflcko",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maflcko",
      "html_url": "https://github.com/maflcko",
      "followers_url": "https://api.github.com/users/maflcko/followers",
      "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
      "organizations_url": "https://api.github.com/users/maflcko/orgs",
      "repos_url": "https://api.github.com/users/maflcko/repos",
      "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/maflcko/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "created_at": "2025-08-28T12:54:28Z",
    "updated_at": "2025-08-28T13:45:54Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 3233540722,
      "node_id": "IC_kwDOABII587Au-py",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3233540722",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T13:37:07Z",
      "updated_at": "2025-08-28T13:37:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "This is likely normal behavior and not a bug. What you are seeing is Bitcoin Core's inbound connection eviction in action. When a new inbound connection comes in, another connection may be closed in favor of it. This avoids an attacker filling all of your inbound connections in an attempt to eclipse you from the network. The inbound eviction algorithm takes care to protect certain peers from being disconnected - you can find details [here](https://github.com/bitcoin/bitcoin/blob/6ca6f3b37b992591726bd13b494369bee3bd6468/src/node/eviction.cpp#L178). \n\n> the most recent peer connection is continually dropped after 1 second and another peer is selected. I can't imagine this is good behavior for the network.\n\nThe connection that's repeatedly dropped is probably an inbound connection from a network group (a /16 IP address range) with many existing inbound connections to you.\n\nhttps://github.com/bitcoin/bitcoin/blob/6ca6f3b37b992591726bd13b494369bee3bd6468/src/node/eviction.cpp#L238-L239\n\n> As you can see, my peer count is very high\n\nGiven you have already seen 3.2M peers, there's probably someone frequently reconnecting to your node from the same network group(s). Based on what I see at my nodes, my guess is that this is related to [LinkingLion](https://b10c.me/observations/06-linkinglion/). If the IP addresses match, you could consider banning the related subnets to avoid these connections.\n\n\n",
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/33267#issuecomment-3233540722",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33267"
    },
    {
      "event": "labeled",
      "id": 19392239116,
      "node_id": "LE_lADOABII587IdrepzwAAAASD3hYM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19392239116",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T13:45:19Z",
      "label": {
        "name": "Questions and Help",
        "color": "006688"
      }
    },
    {
      "event": "labeled",
      "id": 19392240310,
      "node_id": "LE_lADOABII587IdrepzwAAAASD3hq2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19392240310",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T13:45:22Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "closed",
      "id": 19392250209,
      "node_id": "CE_lADOABII587IdrepzwAAAASD3kFh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19392250209",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T13:45:54Z"
    }
  ]
}