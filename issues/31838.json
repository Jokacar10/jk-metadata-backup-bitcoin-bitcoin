{
  "type": "issue",
  "issue": {
    "id": 2843708122,
    "node_id": "I_kwDOABII586pf4ra",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31838",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31838/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31838/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31838/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31838",
    "number": 31838,
    "state": "open",
    "state_reason": null,
    "title": "`rpc_getblockstats.py` fails with `--gen-test-data`",
    "body": "The test only pass with the currently generated data. It will fail when using the integrated feature to generate this data and running against it.\n\nReproduction instructions. On top of current master 1d813e4bf52a207ec526303df7b2e3d40d5eaa54 create a clean default build and run the test:\n```\ncmake -B repro\ncmake --build repro -j20\n./repro/test/functional/rpc_getblockstats.py --gen-test-data\n```\n\nInitially it will fail because it's missing the wallet arguments. Patch it with:\n```diff\ndiff --git a/test/functional/rpc_getblockstats.py b/test/functional/rpc_getblockstats.py\nindex 002763201a5..2a7c8ac34af 100755\n--- a/test/functional/rpc_getblockstats.py\n+++ b/test/functional/rpc_getblockstats.py\n@@ -24,6 +24,7 @@ class GetblockstatsTest(BitcoinTestFramework):\n     max_stat_pos = 2\n \n     def add_options(self, parser):\n+        self.add_wallet_options(parser)\n         parser.add_argument('--gen-test-data', dest='gen_test_data',\n                             default=False, action='store_true',\n                             help='Generate test data')\n```\n\nRun the test again. It will now fail in its own business logic:\n```python\n[...]\n2025-02-10T21:30:27.577000Z TestFramework (INFO): Test tip including OP_RETURN\n2025-02-10T21:30:27.577000Z TestFramework (ERROR): Assertion failed\nTraceback (most recent call last):\n  File \"/home/darosior/code/core/bitcoin/test/functional/test_framework/test_framework.py\", line 135, in main\n    self.run_test()\n  File \"/home/darosior/code/core/bitcoin/./repro/test/functional/rpc_getblockstats.py\", line 182, in run_test\n    assert_equal(tip_stats[\"utxo_size_inc\"], 441)\n  File \"/home/darosior/code/core/bitcoin/test/functional/test_framework/util.py\", line 77, in assert_equal\n    raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\nAssertionError: not(450 == 441)\n[...]\n```",
    "user": {
      "login": "darosior",
      "id": 22457751,
      "node_id": "MDQ6VXNlcjIyNDU3NzUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/darosior",
      "html_url": "https://github.com/darosior",
      "followers_url": "https://api.github.com/users/darosior/followers",
      "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
      "organizations_url": "https://api.github.com/users/darosior/orgs",
      "repos_url": "https://api.github.com/users/darosior/repos",
      "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/darosior/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 1,
    "created_at": "2025-02-10T21:32:28Z",
    "updated_at": "2025-02-12T14:19:43Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2653847441,
      "node_id": "IC_kwDOABII586eLn-R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2653847441",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-12T14:19:41Z",
      "updated_at": "2025-02-12T14:19:41Z",
      "author_association": "MEMBER",
      "body": "The test should be using the miniwallet. Otherwise, it seems likely that some wallet change can affect the transactions and thus block stats.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31838#issuecomment-2653847441",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31838"
    }
  ]
}