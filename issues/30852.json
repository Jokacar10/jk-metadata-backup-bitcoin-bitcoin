{
  "type": "issue",
  "issue": {
    "id": 2513740991,
    "node_id": "I_kwDOABII586V1KS_",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/30852",
    "number": 30852,
    "state": "closed",
    "state_reason": "completed",
    "title": "Increasing self-hosted runner raw performance",
    "body": "_disclaimer_: The following should **not** replace us investigating and fixing the root causes of timeouts and intermittent test runtime performance.\r\n\r\nNow seems an opportune time to open a discussion on some investigation I have been doing into our self-hosted runners, as our CI has been struggling again recently.\r\n\r\nI wanted to see what the cost/benefit implications would be on upgrading our self-hosted runners would look like. Hooking up a single [Hetzner AX52](https://www.hetzner.com/dedicated-rootserver/ax52/) (70 €/month) as a self-hosted runner saw each job run on average 3-5x faster (result image shown at end), which is not surprising in itself.\r\n\r\nIIUC correctly we currently have about 25 low powered, shared vCPU x86_64 runners (plus a sprinkling of ARM ones). If we had the appetite, and could find the funding, we might consider:\r\n\r\n1. upgrade the x86_64 runners to 12 dedicated CPU servers. At 70€ this would total 840€ per month, or 10080€ per year, vs current spend of ~3840€, so 2.5x more cost for 3-5x more speed. This feels like a decent return.\r\n\r\nalternatively\r\n\r\n2. Bump our current (shared vCPU) runners to the next \"level\" up. If e.g. [these](https://github.com/maflcko/bitcoin-core-qa-assets/wiki/Persistent-workers#set-up-servers) are the runners in use for us today, we could increment the CPX21s to CPX31s, and the CPX31s to CPX41s for a monthly cost of 505.6€ vs a current spend of 320€. I did not test performance gains of this path.\r\n\r\nWe could also\" just spend more\" buying larger numbers of the same (low-powered) runners, but IMO this would not be as effective as reducing the runtime of CI jobs, and eliminating CI run timeouts. Moving away from vCPUs feels like the correct choice, if we can, as it's possible that random contention on these could contribute to \"random\" timeouts and failures.\r\n\r\nAdditional thoughts in no particular order:\r\n\r\n- I have likely not considered all the benefits of having larger numbers of lower powered runners. Comments welcomed on this.\r\n  - These more powerful runners also (all) come with (some) more disk space, so we could potentially do things like configure total ccache size (across all jobs) to be something like 100's of GB, and try and maximize those cache hits!\r\n- I am not sure what the developer tradeoff is for \"CI startup time\" (i.e. when a job is picked up by a runner) vs \"CI runtime\".\r\n- Shold we employ a more scientific approach, which could be to caclulate total compute/€ and just get whatever wins out by that metric.\r\n\r\nI'd be curious to hear thoughts on whether this is something worth us looking at any further, or if folks have investigated this before and what they found.\r\n\r\n#### AX52 test\r\n\r\n1. A typical CI run using current runners (on a good day):\r\n\r\n![image](https://github.com/user-attachments/assets/d90bae58-0a96-460c-ad5d-210b1f9278c5)\r\n\r\n2. Jobs run using a single AX52 runner:\r\n\r\n![image](https://github.com/user-attachments/assets/60c7a80a-9e80-49c3-93b1-81f1e10bb6e2)\r\n",
    "user": {
      "login": "willcl-ark",
      "id": 6606587,
      "node_id": "MDQ6VXNlcjY2MDY1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/willcl-ark",
      "html_url": "https://github.com/willcl-ark",
      "followers_url": "https://api.github.com/users/willcl-ark/followers",
      "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
      "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
      "repos_url": "https://api.github.com/users/willcl-ark/repos",
      "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 64584,
        "node_id": "MDU6TGFiZWw2NDU4NA==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Brainstorming",
        "name": "Brainstorming",
        "color": "ebd775",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 30,
    "closed_at": "2025-09-03T06:04:38Z",
    "closed_by": {
      "login": "maflcko",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maflcko",
      "html_url": "https://github.com/maflcko",
      "followers_url": "https://api.github.com/users/maflcko/followers",
      "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
      "organizations_url": "https://api.github.com/users/maflcko/orgs",
      "repos_url": "https://api.github.com/users/maflcko/repos",
      "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/maflcko/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "created_at": "2024-09-09T11:49:47Z",
    "updated_at": "2025-09-03T06:04:38Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 14181994926,
      "node_id": "LE_lADOABII586V1KS_zwAAAANNUBGu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14181994926",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-09T11:49:47Z",
      "label": {
        "name": "Brainstorming",
        "color": "ebd775"
      }
    },
    {
      "event": "commented",
      "id": 2337987820,
      "node_id": "IC_kwDOABII586LWtzs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2337987820",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-09T12:26:05Z",
      "updated_at": "2024-09-09T12:26:05Z",
      "author_association": "MEMBER",
      "body": "> each job run[s] on average 3-5x faster\r\n\r\nNice find. I didn't expect such a difference, but your results look promising to give this a try.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2337987820",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2338471211,
      "node_id": "IC_kwDOABII586LYj0r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2338471211",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-09T15:46:04Z",
      "updated_at": "2024-09-09T15:46:04Z",
      "author_association": "MEMBER",
      "body": "Is the cause for the speedup a difference in the actual hardware are simply due to dedicated resources?\r\n\r\nI currently have some older server hardware that I am planning to dedicate to fuzzing. I could instead also set them up for our CI. These servers will live in a data center and should have 100% uptime.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2338471211",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2338512812,
      "node_id": "IC_kwDOABII586LYt-s",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2338512812",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-09T16:04:54Z",
      "updated_at": "2024-09-09T16:04:54Z",
      "author_association": "MEMBER",
      "body": "I haven't done the benchmarks here, so I can't say for sure, but the `AMD EPYC™ 9454P` all-core boost clock is lower than the base clock of the `AMD Ryzen™ 7 7700` that @willcl-ark did the benchmark on. So I guess it is a combination of faster clock + dedicated resources + more idle CPU waiting for work on the server?\r\n\r\nIf your older hardware has about 90 CPU threads, about 152 GB of RAM, and a 3 TB of SSD, and has comparable performance, it could also be used.\r\n\r\nI think you can compare the performance by just running a given CI task twice, measuring the time only on the second run.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2338512812",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "mentioned",
      "id": 14185907196,
      "node_id": "MEE_lADOABII586V1KS_zwAAAANNi8P8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14185907196",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-09T16:04:56Z"
    },
    {
      "event": "subscribed",
      "id": 14185907214,
      "node_id": "SE_lADOABII586V1KS_zwAAAANNi8QO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14185907214",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-09T16:04:56Z"
    },
    {
      "event": "commented",
      "id": 2339623497,
      "node_id": "IC_kwDOABII586Lc9JJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339623497",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T05:02:25Z",
      "updated_at": "2024-09-10T05:02:25Z",
      "author_association": "MEMBER",
      "body": "Not really that much faster: https://cirrus-ci.com/build/5557255590903808, but possibly also misconfigured as everything was setup to run on that one machine simultaneously, although it should enough cores and memory.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2339623497",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2339651980,
      "node_id": "IC_kwDOABII586LdEGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339651980",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T05:27:35Z",
      "updated_at": "2024-09-10T05:27:35Z",
      "author_association": "MEMBER",
      "body": "Hmm, you could also try to re-run the tasks individually to see the best possible performance (which is what was tested above as well).\r\n\r\nOtherwise, my suggestion would be to go with one of the AMD CPUs mentioned above. (I can give this a try in the coming days)\r\n",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2339651980",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2339988301,
      "node_id": "IC_kwDOABII586LeWNN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339988301",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T08:20:12Z",
      "updated_at": "2024-09-10T08:20:12Z",
      "author_association": "MEMBER",
      "body": "> Hmm, you could also try to re-run the tasks individually to see the best possible performance (which is what was tested above as well).\r\n\r\nCorrect, I used default `cirrus-cli` concurrency (of 1) on the server during testing. Some of these were second runs but ccache was not hit in all of them. E.g. it hit 0% in `depends, debug`, but 100% in `nowallet, libbitcoinkernel`. The run is here: https://cirrus-ci.com/build/6496417768800256\r\n\r\nIMO that @achow101 didn't see a great speedup further hints to me that dedicated resources are having quite a large impact here.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2339988301",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "mentioned",
      "id": 14194626854,
      "node_id": "MEE_lADOABII586V1KS_zwAAAANOENEm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14194626854",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T08:20:13Z"
    },
    {
      "event": "subscribed",
      "id": 14194626865,
      "node_id": "SE_lADOABII586V1KS_zwAAAANOENEx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14194626865",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T08:20:13Z"
    },
    {
      "event": "commented",
      "id": 2340006739,
      "node_id": "IC_kwDOABII586LeatT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2340006739",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T08:28:37Z",
      "updated_at": "2024-09-10T08:28:37Z",
      "author_association": "MEMBER",
      "body": "Another potential (and cheap) avenue we could explore is having a single massive shared ccache dir. This of course wouldn't speed up running tests themselves, but we could try for even more cache hits during compilation.\r\n\r\nHetzner has a \"storage box\" https://www.hetzner.com/storage/storage-box/ which, for 4€ per month gets unlimited internal traffic and 1TB of disk space. I don't much like the look of \"10 concurrent connections\" max, and unsure if it's SSD or spinning disk, but supposing the best we could in theory set up redis on one, and use ccache's [remote backend](https://ccache.dev/manual/4.10.2.html#_remote_storage_backends) option to try and guarantee higher numbers of cache hits.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2340006739",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2340096700,
      "node_id": "IC_kwDOABII586Lewq8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2340096700",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T09:07:06Z",
      "updated_at": "2024-09-10T09:07:06Z",
      "author_association": "MEMBER",
      "body": "I am thinking it would be less hassle to set up local storage. Ensuring that a given task type only runs on a given machine should be enough to ensure a \"single ccache dir\". (ccache results can't be shared between tasks anyway)\r\n\r\nThis would also avoid additional work or downtime when something goes wrong in the remote \"storage box\" (connection management, maintenance, configuration, ...) ",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2340096700",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2343610033,
      "node_id": "IC_kwDOABII586LsKax",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2343610033",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-11T13:01:16Z",
      "updated_at": "2024-09-11T13:01:16Z",
      "author_association": "MEMBER",
      "body": "There are a bunch of places where `CCACHE_MAXSIZE` is hardcoded, making it impossible to set a larger size. This needs to be fixed first, so I did that in https://github.com/bitcoin/bitcoin/pull/30869 (among other stuff).\r\n\r\nAssuming .5GB of caches per task, 10 tasks per push, 100 pushes per day, and a cache duration of 20 days, means that 10TB of storage should be sufficient.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2343610033",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2346027116,
      "node_id": "IC_kwDOABII586L1Yhs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2346027116",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-12T11:24:13Z",
      "updated_at": "2024-09-12T11:24:13Z",
      "author_association": "MEMBER",
      "body": "> There are a bunch of places where `CCACHE_MAXSIZE` is hardcoded, making it impossible to set a larger size. This needs to be fixed first, so I did that in #30869 (among other stuff).\r\n\r\nAwesome!\r\n \r\n> Assuming .5GB of caches per task, 10 tasks per push, 100 pushes per day, and a cache duration of 20 days, means that 10TB of storage should be sufficient.\r\n\r\nNot sure I understand this; the idea is to have \"one ccache per task\" surely, not one per push?\r\n\r\nI was thinking we should set up with:\r\n\r\n- 10x ccache dirs, one per task, on the (self) host(ed runner)\r\n- Use a large size for each (as space allows)\r\n- Mount the appropriate cache dir into the container according to task type\r\n- set `CCACHE_COMPILERCHECK` to `content` mode, which passes the compiler check when the hash of the compiler is the same (the default is `mdate` which will change with each container we create)\r\n\r\nThis means we will share hits between pushes, and all PRs, just based on task type.\r\n\r\nIs there something I'm missing for you to make your suggestion? I get a high cache hit-rate locally on new-PRs and pushes to master based on a single shared cache:\r\n\r\n<details>\r\n<summary>Details</summary>\r\n\r\n```fish\r\nwill@ubuntu in ~/src/bitcoin on  master [$?⇕] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ ccache -s\r\nCacheable calls:   348057 / 547383 (63.59%)\r\n  Hits:            263097 / 348057 (75.59%)\r\n    Direct:        239565 / 263097 (91.06%)\r\n    Preprocessed:   23532 / 263097 ( 8.94%)\r\n  Misses:           84960 / 348057 (24.41%)\r\nUncacheable calls: 199325 / 547383 (36.41%)\r\nErrors:                 1 / 547383 ( 0.00%)\r\nLocal storage:\r\n  Cache size (GB):   22.3 /   25.0 (89.37%)\r\n  Hits:            263098 / 348058 (75.59%)\r\n  Misses:           84960 / 348058 (24.41%)\r\n\r\nwill@ubuntu in ~/src/bitcoin on  master [$?⇕] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ ccache -z\r\nStatistics zeroed\r\n\r\n# ----------\r\n# Check out a random new branch\r\n# ----------\r\n\r\nwill@ubuntu in ~/src/bitcoin on  master [$?⇕] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ gh pr checkout 30866\r\nFrom https://github.com/bitcoin/bitcoin\r\n * [new ref]                 refs/pull/30866/head -> multipath-spkm-fuzz-crash\r\nSwitched to branch 'multipath-spkm-fuzz-crash'\r\n\r\nwill@ubuntu in ~/src/bitcoin on  multipath-spkm-fuzz-crash [$?] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ rm -i -Rf build\r\n\r\nwill@ubuntu in ~/src/bitcoin on  multipath-spkm-fuzz-crash [$?] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ cmake -B build &> /dev/null; and cmake --build build -j16 &> /dev/null\r\n\r\nwill@ubuntu in ~/src/bitcoin on  multipath-spkm-fuzz-crash [$?] via △ v3.30.3 : 🐍 (bitcoin) took 2m9s\r\n₿ ccache -s\r\nCacheable calls:    547 /  627 (87.24%)\r\n  Hits:             293 /  547 (53.56%)\r\n    Direct:         291 /  293 (99.32%)\r\n    Preprocessed:     2 /  293 ( 0.68%)\r\n  Misses:           254 /  547 (46.44%)\r\nUncacheable calls:   80 /  627 (12.76%)\r\nLocal storage:\r\n  Cache size (GB): 22.4 / 25.0 (89.63%)\r\n  Hits:             293 /  547 (53.56%)\r\n  Misses:           254 /  547 (46.44%)\r\n\r\n# ----------\r\n# rebuild\r\n# ----------\r\n\r\nwill@ubuntu in ~/src/bitcoin on  multipath-spkm-fuzz-crash [$?] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ ccache -z\r\nStatistics zeroed\r\n\r\nwill@ubuntu in ~/src/bitcoin on  multipath-spkm-fuzz-crash [$?] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ rm -i -Rf build\r\n\r\nwill@ubuntu in ~/src/bitcoin on  multipath-spkm-fuzz-crash [$?] via △ v3.30.3 : 🐍 (bitcoin)\r\n₿ cmake -B build &> /dev/null; and cmake --build build -j16 &> /dev/null\r\n\r\nwill@ubuntu in ~/src/bitcoin on  multipath-spkm-fuzz-crash [$?] via △ v3.30.3 : 🐍 (bitcoin) took 16s\r\n₿ ccache -s\r\nCacheable calls:    547 /  627 (87.24%)\r\n  Hits:             457 /  547 (83.55%)\r\n    Direct:         457 /  457 (100.0%)\r\n    Preprocessed:     0 /  457 ( 0.00%)\r\n  Misses:            90 /  547 (16.45%)\r\nUncacheable calls:   80 /  627 (12.76%)\r\nLocal storage:\r\n  Cache size (GB): 22.4 / 25.0 (89.63%)\r\n  Hits:             457 /  547 (83.55%)\r\n  Misses:            90 /  547 (16.45%)\r\n\r\n```\r\n\r\n</details>",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2346027116",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2348255358,
      "node_id": "IC_kwDOABII586L94h-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2348255358",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-13T07:42:22Z",
      "updated_at": "2024-09-13T14:51:34Z",
      "author_association": "MEMBER",
      "body": "The thing is that workers are \"shuffled\" by type, so one run may happen one one machine and another run of the same task may happen on another machine. It is of course possible to make each task its own type, but that seems a bit too much maintenance overhead when tasks are added or removed in one branch, but not all. As you mentioned earlier, it is of course also possible to set up a remote ccache. However, I think this is similarly going to be more maintenance overhead and extra moving parts, with the additional downside of added latency due to the distance. So I think the best way forward would be to have all workers of the same type on the same machine. (I am still running some performance tests to get an estimate if this make sense at all)\r\n\r\n<!-- Edit: Assuming this would be a possibility, it seems best to maximize the number of CPU threads on the machine. Looking at https://www.hetzner.com/dedicated-rootserver/#cores_threads_from=32%2B64 it seems that the EPYC with 96 threads or the Altera with 80 are the two largest ones. (However, I still haven't finished my tests) -->\r\n\r\n> I was thinking we should set up with:\r\n\r\nThat sounds like what is being done today already: Each cache dir is a volume (one volume per task) on each runner, except for using the default cache size and default `CCACHE_COMPILERCHECK`.\r\n",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2348255358",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2355045583,
      "node_id": "IC_kwDOABII586MXyTP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2355045583",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-17T09:34:45Z",
      "updated_at": "2024-09-17T09:34:45Z",
      "author_association": "MEMBER",
      "body": "> So I think the best way forward would be to have all workers of the same type on the same machine. (I am still running some performance tests to get an estimate if this make sense at all)\r\n\r\nDid a quick sanity check with a 100G shared ccache on a single machine `cpx51` and all tasks finished in under a hour. Some tasks were faster than the AX52 run above, some were slower:\r\n\r\n![Screenshot 2024-09-17 at 11-11-05 Merge commit 'fa99e4521b6fc0e7f6636d40bc0d6a7325227374' into main-with-ci - Cirrus CI](https://github.com/user-attachments/assets/7f28ea06-2115-4027-8033-249e26df18ee)\r\n\r\nSo my recommendation would be to try that with a dedicated AX162, because:\r\n\r\n* It is dedicated, without kvm, so possibly minimally faster, but certainly should not be slower than my `cpx51` trial run, or the current CI setup\r\n* It has 96 CPU threads, which is the most that Hetzner currently offers (There is also a Dell Intel setup with 128 threads, but it doesn't have an option for a single 10 TB ccache shared drive, only 7 TB)\r\n* It has an option for a 22 TB HDD, which can be used for the shared ccache folder\r\n\r\n",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2355045583",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2355833959,
      "node_id": "IC_kwDOABII586Mayxn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2355833959",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-17T13:37:21Z",
      "updated_at": "2024-09-17T13:37:21Z",
      "author_association": "MEMBER",
      "body": "> > So I think the best way forward would be to have all workers of the same type on the same machine. (I am still running some performance tests to get an estimate if this make sense at all)\r\n\r\nIs this so that re-runs (of the same PR) always hit the cache? If that's it I'm not _totally_ sure it's worth it. My intuition says that if we had multiple servers, even if a re-run took place on a different machine, we'd likely get a *pretty decent* cache hit from another run or a previous master build (or we simply get the benefit of a new, super-fast non-shared CPU vs the current ones today).\r\n\r\nThe tradeoff of using a single beast machine is CPU/io/disk contention for better ccache hits. I suspect the former may be more important, when comparing to say a handful of moderately powerful servers?\r\n\r\nIt looks like you got decent results in your testing though, to be honest, and, I'd be happy to try anything faster 😄 \r\n\r\n> \r\n> Did a quick sanity check with a 100G shared ccache on a single machine `cpx51` and all tasks finished in under a hour. Some tasks were faster than the AX52 run above, some were slower:\r\n\r\nThat seems like a decent result. Were all jobs running simultaneously? Did you change the `--jobs` number or anything else for the run?\r\n\r\n",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2355833959",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2356103199,
      "node_id": "IC_kwDOABII586Mb0gf",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2356103199",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-17T14:50:13Z",
      "updated_at": "2024-09-17T14:50:13Z",
      "author_association": "MEMBER",
      "body": "> Is this so that re-runs (of the same PR) always hit the cache? If that's it I'm not _totally_ sure it's worth it. My intuition says that if we had multiple servers, even if a re-run took place on a different machine, we'd likely get a _pretty decent_ cache hit from another run or a previous master build\r\n\r\nRight. It is unclear whether this is worth it. I think when it comes to builds on master, the speed doesn't matter at all, because no one is waiting for the result to appear immediately. So the thing where the cache matters a bit could be a  pull request. However, for a first push, the cache hit rate will be low either way. The only thing that could be optimized would be a (little) re-push to the same pull request (assuming little to no changes to master in the meantime), or any push on a \"little\" pull request (which can then use the cache from master). But I don't have a number how often that happens and whether it is worth it to optimize for.\r\n\r\n> (or we simply get the benefit of a new, super-fast non-shared CPU vs the current ones today).\r\n\r\nHetzner offers so many different CPUs, and I didn't want to rent all of them to find the \"fastest\" one. But reading the docs (https://www.amd.com/en/products/processors/desktops/ryzen/7000-series/amd-ryzen-9-7950x3d.html and https://www.amd.com/en/products/processors/desktops/ryzen/7000-series/amd-ryzen-7-7700.html), it seems like AX102 may be faster than AX52. So that could be another idea to look into?\r\n\r\nI think when it comes to \"sharing\" CPUs, the CI performs better by \"sharing\" (putting several workers on the same machine), because most tests are bottle-necked by a single long-running test. IIRC this is true for the unit tests (where the tail is the secp tests), the functional tests (where the tail is an \"extended\" or otherwise long running test), as well as the fuzz tests (which have a few long-running tests). Imagining a case where a pull request was merged, and a few pulls need rebase as a result, there may be several pushes at the same time (as well as the master build). Having servers with a single worker on them will make the servers go over the tasks one-by-one, whereas having the same servers with more workers on them allows them to possibly service all tasks at once. Given that the workload in this case (Bitcoin Core CI) is CPU-bound (and not IO-bound), the \"sharing\" approach with the same number of servers should never be slower. However, I haven't benchmarked this.\r\n\r\n\r\n\r\n\r\n\r\n> > Did a quick sanity check with a 100G shared ccache on a single machine `cpx51` and all tasks finished in under a hour. Some tasks were faster than the AX52 run above, some were slower:\r\n> \r\n> That seems like a decent result. Were all jobs running simultaneously? Did you change the `--jobs` number or anything else for the run?\r\n\r\n\r\nNah, it was just a sanity check where the `medium` and `small` worker were running at the same time on a single machine. I just wanted to check a single shared ccache on the machine. I left `MAKEJOBS` as-is.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2356103199",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2356181083,
      "node_id": "IC_kwDOABII586McHhb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2356181083",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-17T15:10:20Z",
      "updated_at": "2024-09-17T15:10:20Z",
      "author_association": "MEMBER",
      "body": "> CPU-bound (and not IO-bound)\r\n\r\nActually, the long-running fuzz test may be IO-bound so using a ramdisk could speed them up. So this would be another idea to look at.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2356181083",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2367971650,
      "node_id": "IC_kwDOABII586NJGFC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2367971650",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T11:44:48Z",
      "updated_at": "2024-09-23T11:44:48Z",
      "author_association": "MEMBER",
      "body": "> set `CCACHE_COMPILERCHECK` to `content` mode, which passes the compiler check when the hash of the compiler is the same (the default is `mdate` which will change with each container we create)\r\n\r\nAre you sure? At least on Ubuntu Noble `mdate` is set correctly for `clang` (and does not change with each container). I presume the same is true for Debian and GCC. So, if the `modify` is different, the content would be different as well (and vice-versa). See:\r\n\r\n```\r\n# stat /usr/bin/clang++\r\n  File: /usr/bin/clang++ -> ../lib/llvm-18/bin/clang++\r\n  Size: 26        \tBlocks: 0          IO Block: 4096   symbolic link\r\nDevice: 0,69\tInode: 7972159     Links: 1\r\nAccess: (0777/lrwxrwxrwx)  Uid: (    0/    root)   Gid: (    0/    root)\r\nAccess: 2024-09-23 11:18:23.212490379 +0000\r\nModify: 2024-03-30 11:19:55.000000000 +0000\r\nChange: 2024-09-23 11:18:15.408283849 +0000\r\n Birth: 2024-09-23 11:18:15.408283849 +0000\r\n```\r\n\r\nThe only exception may be the msan build, where the compiler is compiled.\r\n\r\n(Just leaving a reply for context, in case someone reads the thread and stumbles upon this)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2367971650",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2368164951,
      "node_id": "IC_kwDOABII586NJ1RX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2368164951",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-23T13:03:53Z",
      "updated_at": "2024-09-23T13:03:53Z",
      "author_association": "MEMBER",
      "body": "> > set `CCACHE_COMPILERCHECK` to `content` mode, which passes the compiler check when the hash of the compiler is the same (the default is `mdate` which will change with each container we create)\r\n> \r\n> Are you sure? At least on Ubuntu Noble `mdate` is set correctly for `clang` (and does not change with each container). I presume the same is true for Debian and GCC. So, if the `modify` is different, the content would be different as well (and vice-versa). See:\r\n> \r\n> ```\r\n> # stat /usr/bin/clang++\r\n>   File: /usr/bin/clang++ -> ../lib/llvm-18/bin/clang++\r\n>   Size: 26        \tBlocks: 0          IO Block: 4096   symbolic link\r\n> Device: 0,69\tInode: 7972159     Links: 1\r\n> Access: (0777/lrwxrwxrwx)  Uid: (    0/    root)   Gid: (    0/    root)\r\n> Access: 2024-09-23 11:18:23.212490379 +0000\r\n> Modify: 2024-03-30 11:19:55.000000000 +0000\r\n> Change: 2024-09-23 11:18:15.408283849 +0000\r\n>  Birth: 2024-09-23 11:18:15.408283849 +0000\r\n> ```\r\n> \r\n> The only exception may be the msan build, where the compiler is compiled.\r\n> \r\n> (Just leaving a reply for context, in case someone reads the thread and stumbles upon this)\r\n\r\nOh great, that will help simplify things a little then, as we can use more defaults. Not sure what I must've been looking at to come to the wrong conclusion here, but thanks for double-checking.\r\n",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2368164951",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2386732584,
      "node_id": "IC_kwDOABII586OQqYo",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2386732584",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-01T18:53:50Z",
      "updated_at": "2024-10-01T18:53:50Z",
      "author_association": "MEMBER",
      "body": "> > The only exception may be the msan build, where the compiler is compiled.\r\n> > (Just leaving a reply for context, in case someone reads the thread and stumbles upon this)\r\n> \r\n> Oh great, that will help simplify things a little then, as we can use more defaults. Not sure what I must've been looking at to come to the wrong conclusion here, but thanks for double-checking.\r\n\r\nIt isn't wrong. I presume it may still have to be set for the msan task, but this can probably be done in a follow-up and shouldn't be an initial blocker here.\r\n\r\n\r\n\r\n> Given that the workload in this case (Bitcoin Core CI) is CPU-bound (and not IO-bound), the \"sharing\" approach with the same number of servers should never be slower. However, I haven't benchmarked this.\r\n\r\nSorry for the delay, I finally got around to checking this. Apart from the inital clone+apt, the tasks are not IO-bound (at least not on Hetzner Cloud). Also checking a full build on two `cpx51` for each type (`small` and `medium`) shows that given a fixed number of machines, it is faster to put more workers on them, than not to. (Having many workers is needed when many commits are built at the same time. For example, a merge to master and 7 pull request pushes in half an hour are not rare. That is 80 tasks that need to be built, which is faster with more workers than with less)\r\n\r\nI compared two runs: A fresh install of the machines with just one worker each and another fresh install with the number of workers equal to the number of tasks.\r\n\r\nThe first one took 2h:40 end-to-end overall, the second one just 1h:40 and all tasks started at the same time. Obviously this doesn't represent reality, because ccache is usually filled and llvm doesn't need to be built from scratch each time, but it should give the idea. (I tested with https://github.com/bitcoin/bitcoin/pull/30935 for the llvm build)\r\n\r\n\r\n![Screen Shot 2024-10-01 at 18 08 49](https://github.com/user-attachments/assets/b9956325-d1e1-4ae3-b372-a543f43e13b7)\r\n\r\n![Screen Shot 2024-10-01 at 20 14 40](https://github.com/user-attachments/assets/553c9e82-e50e-4630-b213-94f38d1adc8c)\r\n\r\nGoing forward, I'd say to try AX162 and then watch it for a week or two in the real setting. If improvements are still possible afterward, it should be easy to adjust.\r\n\r\nHowever, I am not yet sure about a remote shared ccache dir. Given that CI sometimes seems to fail for inexplicable reasons (https://cirrus-ci.com/task/5392365521731584?logs=ci#L190, from https://github.com/bitcoin/bitcoin/issues/30998, possibly a buggy systemd?), and given that the remote ccache failure would be silent, my preference would be to keep the dir local for now.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2386732584",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2386850370,
      "node_id": "IC_kwDOABII586ORHJC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2386850370",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-01T19:38:35Z",
      "updated_at": "2024-10-01T19:38:35Z",
      "author_association": "MEMBER",
      "body": "> Apart from the inital clone+apt, the tasks are not IO-bound (at least not on Hetzner Cloud).\r\n\r\nI know in docker you can cache apt, I wonder if we can do the same on podman (having difficulty finding that they support the exact same flags)? e.g. in docker you can:\r\n\r\n```bash\r\nRUN --mount=target=/var/lib/apt/lists,type=cache,sharing=locked \\\r\n    --mount=target=/var/cache/apt,type=cache,sharing=locked \\\r\n```\r\n\r\nWe'd need likely to delineate between Ubuntu versions etc. and this may only help with package download time, not a limiting factor for us. I don't recall exactly how much it helps with the install/upgrade part of the job. I can test this myself in the meantime. \r\n\r\nDocker docs ref: https://docs.docker.com/build/cache/optimize/#use-cache-mounts\r\n\r\n> I compared two runs: A fresh install of the machines with just one worker each and another fresh install with the number of workers equal to the number of tasks.\r\n> \r\n> The first one took 2h:40 end-to-end overall, the second one just 1h:40 and all tasks started at the same time. Obviously this doesn't represent reality, because ccache is usually filled and llvm doesn't need to be built from scratch each time, but it should give the idea. (I tested with #30935 for the llvm build)\r\n\r\nThis sounds promising to me.\r\n\r\n> Going forward, I'd say to try AX162 and then watch it for a week or two in the real setting. If improvements are still possible afterward, it should be easy to adjust.\r\n\r\nI agree with this.\r\n\r\n> However, I am not yet sure about a remote shared ccache dir. Given that CI sometimes seems to fail for inexplicable reasons ([cirrus-ci.com/task/5392365521731584?logs=ci#L190](https://cirrus-ci.com/task/5392365521731584?logs=ci#L190), from #30998, possibly a buggy systemd?), and given that the remote ccache failure would be silent, my preference would be to keep the dir local for now.\r\n\r\nIn my experience `ccaache` was very resilient in terms of accessing a remote cache dir (it always maintains a local cache too to fallback to), but I agree that if opting for a single larger runner  with 2TB of disk space itself then a remote ccache doesn't make as much sense, and can be left as an optimisation for later if needed.\r\n\r\nWith the RAM on the AX162 we can probably get some more free speed by doing things like using a ramdisk as `--cachedir` on the functional tests for example.\r\n\r\nI do have one reservation though: IIUC currently we have more runners (and therefore workers) than jobs; I think the proposal of a single AX162 with number of workers == jobs would mean we are reducing net number of active workers? Just worried this may decrease our total throughput if these previous assumptions are correct (and not mitigated by better caching and faster CPU etc.)?\r\n\r\n",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2386850370",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2386938805,
      "node_id": "IC_kwDOABII586ORcu1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2386938805",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-01T19:55:14Z",
      "updated_at": "2024-10-01T19:55:14Z",
      "author_association": "MEMBER",
      "body": "> I know in docker you can cache apt\r\n\r\nInteresting. Though, I think the apt is rarely called, and would be just 30 seconds anyway (https://cirrus-ci.com/task/5200852661567488?logs=ci#L199). The reason the image cache exists is that network error are avoided and the expensive llvm build is cached.\r\n\r\n\r\n\r\n> resilient in terms of accessing a remote cache dir (it always maintains a local cache\r\n\r\nIt would be nice if the local cache was also shared, but I guess this can be done in the future, if needed.\r\n\r\n\r\n\r\n> AX162 with number of workers == jobs would mean we are reducing net number of active workers?\r\n\r\nI think all current workers exactly fit on it, so it wouldn't reduce the number of them. But it should be easy to get a second AX162, because there are two worker types.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2386938805",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2388071828,
      "node_id": "IC_kwDOABII586OVxWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2388071828",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-02T09:38:46Z",
      "updated_at": "2024-10-02T09:38:46Z",
      "author_association": "MEMBER",
      "body": "> ramdisk\r\n\r\nBenchmarking this is a bit more involved and I think requires changes to the CI scripts, so that the ramdisk is (1) mounted into the CI container and (2) picked up as the temp dir. I can take a look in the future, unless someone beats me to it.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2388071828",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2397251484,
      "node_id": "IC_kwDOABII586O4yec",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2397251484",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T15:29:05Z",
      "updated_at": "2024-10-07T15:29:05Z",
      "author_association": "MEMBER",
      "body": "I could also possibly supply a beefy dedicated threadripper machine in an MIT datacenter (which should have local-ish mirrors for apt and etc). When comparing costs, I think it makes sense to think of buying hardware vs renting as well.",
      "user": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2397251484",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2397283288,
      "node_id": "IC_kwDOABII586O46PY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2397283288",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T15:42:36Z",
      "updated_at": "2024-10-07T15:48:09Z",
      "author_association": "MEMBER",
      "body": "> threadripper\r\n\r\nNice. Any machine with at least 96 CPU threads, or two machines with at least 48 CPU threads should be a good start. (Less cores would be fine as well, but require the remote ccache, which could break. Generally, if there is something that can break, it will break, given enough time)\r\n\r\n> (which should have local-ish mirrors for apt and etc)\r\n\r\n`apt` should be cached in the docker image and doesn't take more than 30 seconds on a cache miss, so should be fine. Also, inside docker, any apt mirror is ignored by default, unless it is configured.\r\n",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2397283288",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2397286103,
      "node_id": "IC_kwDOABII586O467X",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2397286103",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T15:43:51Z",
      "updated_at": "2024-10-07T15:43:51Z",
      "author_association": "MEMBER",
      "body": "(I still want to benchmark the ramdisk difference, to see how much can be squeezed out before switching, but if people think a switch should be done sooner, that is fine, too)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2397286103",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2397293278,
      "node_id": "IC_kwDOABII586O48re",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2397293278",
      "actor": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T15:47:03Z",
      "updated_at": "2024-10-07T15:47:03Z",
      "author_association": "MEMBER",
      "body": "I'm pretty sure the potential hardware is 24core/48threads, so it doesn't quite meet those requirements. There's another available, though I'm currently using it, but I guess sacrificing that one is an option as well :)",
      "user": {
        "login": "theuni",
        "id": 417043,
        "node_id": "MDQ6VXNlcjQxNzA0Mw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/theuni",
        "html_url": "https://github.com/theuni",
        "followers_url": "https://api.github.com/users/theuni/followers",
        "following_url": "https://api.github.com/users/theuni/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/theuni/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/theuni/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
        "organizations_url": "https://api.github.com/users/theuni/orgs",
        "repos_url": "https://api.github.com/users/theuni/repos",
        "events_url": "https://api.github.com/users/theuni/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/theuni/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2397293278",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "subscribed",
      "id": 14725843792,
      "node_id": "SE_lADOABII586V1KS_zwAAAANtuotQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14725843792",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-18T18:56:13Z"
    },
    {
      "event": "commented",
      "id": 2449259598,
      "node_id": "IC_kwDOABII586R_LxO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2449259598",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-31T07:58:39Z",
      "updated_at": "2024-10-31T07:58:39Z",
      "author_association": "MEMBER",
      "body": "> > ramdisk\r\n> \r\n> Benchmarking this is a bit more involved and I think requires changes to the CI scripts, so that the ramdisk is (1) mounted into the CI container and (2) picked up as the temp dir. I can take a look in the future, unless someone beats me to it.\r\n\r\nDone in https://github.com/bitcoin/bitcoin/pull/31182, but I couldn't find any difference at all so far, which is a bit surprising.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2449259598",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 2558198430,
      "node_id": "IC_kwDOABII586YewKe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2558198430",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-21T18:34:51Z",
      "updated_at": "2025-02-17T12:22:08Z",
      "author_association": "CONTRIBUTOR",
      "body": "Inspired by discussions with @willcl-ark at and after the last CoreDev, I started working on a [NixOS](nixos.org) based configuration for a large host with multiple Cirrus CI runners with a focus on isolation and performance. \n\nTo isolate the runners, each runner lives in an ephemeral QEMU VM[^0] that's shut down and recreated after each run. While the runners are ephemeral and the QEMU VMs have a tmpfs as rootfs, the host maintains a shared cache. Since the cache is somewhat implicit on the current Cirrus CI runners (which aren't ephemeral), I figured it makes sense to document what needs  caching:\n\n- docker images\n  - base images: [ EDIT: likely not needed anymore since #31678 ]  an image cache for e.g. `ubuntu:24.04`, `debian:bookworm`, `quay.io/centos/amd64:stream9`, ...\n    - we need these to read \"System-dependent env vars\" https://github.com/bitcoin/bitcoin/blob/fc7b21484703da606c5c69b23daee8c39506d90c/ci/test/02_run_container.sh#L16-L17 \n    - caching this is needed to avoid connection problems downloading the docker base images and to avoid docker-hub rate-limiting\n    - the official docker registry supports a [pull-through-cache](https://docs.docker.com/docker-hub/image-library/mirror/#run-a-registry-as-a-pull-through-cache) mode, but only for hub.docker.com and not for e.g. quay.io: [\"It's currently not possible to mirror another private registry. Only the central Hub can be mirrored.\"](https://docs.docker.com/docker-hub/image-library/mirror/#gotcha). Other solutions exist, but would require to change the `CI_IMAGE_NAME_TAG`s to point another registry\n  - `docker build` cache: to avoid rebuilding the images for e.g. the `ci_i686_centos`, `ci_native_tidy`, `ci_native_msan`, ... containers\n    - this works with e.g. a [local docker build cache](https://docs.docker.com/build/cache/backends/local/)\n    - implementing support for this in https://github.com/bitcoin/bitcoin/pull/31545\n- ccache\n  - using `DANGER_CI_ON_HOST_CACHE_FOLDERS` with a custom `CCACHE_DIR` and `CCACHE_MAXSIZE=0` works well ([code](https://github.com/0xB10C/bitcoin-core-cirrus-runner/blob/57c882fd007ada7bd6358632d8a4e0a2588ad4a8/vm/cirrus-runner.nix#L217-L230]))\n  - it might be nice to have a ccache per task (as I don't think e.g. the `ci_i686_centos` and the `ci_native_msan` task will ever share something). But setting an env var like `CCACHE_DIR=\"/ci_container_base/ccache/${CONTAINER_NAME}\"` won't work as bash doesn't evaluate env vars in env vars.\n  - ccache is trimmed on the host (I haven't implemented it yet as I wanted to see how fast it grows)\n  - I've also tried [`CCACHE_REMOTE_STORAGE`](https://ccache.dev/manual/4.7.html#_remote_storage_backends)\n    - in http-mode to a local nginx: works well, but I've choose to limit the ability of the [cirrus-worker service](https://github.com/0xB10C/bitcoin-core-cirrus-runner/blob/57c882fd007ada7bd6358632d8a4e0a2588ad4a8/vm/cirrus-runner.nix#L189-L192) and docker container to interact with localhost in the VM. Could resort to this again though.\n    - in file-mode: doesn't work without modification of `DANGER_CI_ON_HOST_CACHE_FOLDERS` folders as we can't mount another directory to the docker container (a hack could be to use a sub-directory like `/ci_container_base/ccache/remote-ccache-storage` and hope it doesn't conflict with normal ccache - but I haven't tried this)\n- depends\n  - sources: \n    - we don't want to download the sources multiple times, mainly to avoid network issues\n    - using `DANGER_CI_ON_HOST_CACHE_FOLDERS` and caching them works well\n  - built:\n    - using `DANGER_CI_ON_HOST_CACHE_FOLDERS` and caching them works well\n    - avoids rebuilding them, which speeds up builds by a lot\n    - they are already placed nicely in sub directories by host-triplet (e.g. `i686-pc-linux-gnu`), depend, and a build recipe id: e.g. `depends/built/i686-pc-linux-gnu/bdb/bdb-4.8.30-3a1cdeca58f.tar.gz`\n- previous_releases\n  - again, `DANGER_CI_ON_HOST_CACHE_FOLDERS` works well\n\nEach VM has an `overlayfs` view of the shared cache on the host. While a malicious job can try to wipe the cache, it will only affect it's own cache for the duration of the task. After a task ends, only new cache contents will be copied from the `upper`-dir to the shared cache. I hope this reduces the potential CI cache vandalism to \"disk fill\" or \"inode exhaustion\". Additionally, the cirrus worker service runs in it's own hardened systemd service (inside the VM) under it's own user (and not `root`), docker runs in rootless mode inside the QEMU VM. I've tried to make it [harder](https://github.com/0xB10C/bitcoin-core-cirrus-runner/blob/57c882fd007ada7bd6358632d8a4e0a2588ad4a8/vm/cirrus-runner.nix#L118-L121) to extract the cirrus-token from the runners - which would allow a third party that is not in the org to add their own cirrus runners (these could then, for example, always succeed: [volkswagen](https://github.com/auchenberg/volkswagen)). The QEMU VMs also run as their own user in a hardened systemd service on the host. However, I have no doubt that it's possible to escalate privileges inside the VM or escape from the VM to the host, and escape privileges there. After all, a self-hosted CI runner is literally Remote-Code-Execution on our server. \n\nHaving a NixOS configuration allows people interested in it to quickly deploy their own instances of this for personal use or even contribute to the bitcoin/bitcoin pool. I've been testing on a 100€/month x86_64[^3] server with 256 GB of RAM and 2x AMD EPYC 7282 CPUs (16c/32t each, so 64t total, 2nd Gen EPYC released in 2019) with the following VM [configuration](https://github.com/0xB10C/bitcoin-core-cirrus-runner-infra/blob/e59018a7a3617fce00e3f55542146baa6a26f21e/flake.nix#L67-L78): \n\n- 6x small[^1] VMs a 4 treads and 8 GB each\n- 4x medium[^1] VMs a 8 threads and 16 GB each\ntotal: 56 threads & 112 GB RAM\n\nhttps://cirrus-ci.com/build/6017527349772288 is a fully cached run, all tasks started at the same time[^2]. I'd expect these to be faster on a [Hetzner AX162-R](https://www.hetzner.com/dedicated-rootserver/ax162-r) - which would also allow running more VMs. This was mentioned before, and I tested that its possible to over-provision on CPU (as cloud hosters do when the speak about shared-CPU) to that multiple VMs share CPUs. \n\n![image](https://github.com/user-attachments/assets/f6acbf2b-c40f-4bf5-972f-49a02a9b2cde)\n\nI running https://github.com/cirruslabs/cirrus-cli/pull/813 currently, which I hope to get merged sometime early in the new year. It's still missing some input on weird scheduling on Cirrus https://github.com/cirruslabs/cirrus-cli/pull/813#issuecomment-2500512964.\n\nOnce it's stable enough, I hope and plan on running and maintaining at least one of these instances for the medium-term (ideally with a sponsor for the server) adding the workers to the bitcoin/bitcoin worker pool. I think @willcl-ark might join or help out too. I don't think this is complete replacement for the existing workers, but might lift some work off of Marcos shoulders. For now, I'll work on documentation, automated testing of the NixOS configuration, ...\n\nIf you're into Nix, here's the module/flake https://github.com/0xB10C/bitcoin-core-cirrus-runner that you could import into you're own infrastructure and here is how I'm using it https://github.com/0xB10C/bitcoin-core-cirrus-runner-infra currently. Again, both are still work in progress and still lack documentation.\n\n[^0]: It only makes sense to run this on dedicated machine with KVM - which \"cloud\" machines which are already virtualized probably don't have.\n[^1]: small and medium are types/sizes defined in: https://github.com/bitcoin/bitcoin/blob/fc7b21484703da606c5c69b23daee8c39506d90c/.cirrus.yml#L15-L18\n[^2]: To avoid hitting the rather slow disk, the shared cache is on a 25 GB tmpfs in RAM. This does limit the size of e.g. the ccache, but I don't think a 1 TB ccache with mostly stale entries helps (AFAIK the runners currently have 500MB of ccache). If it does, happy to allow mounting the ccache to it's dedicated, large HDD.\n[^3]: I haven't tested it on ARM, but don't see a reason why it wouldn't work there too. ",
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2558198430",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "mentioned",
      "id": 15740078919,
      "node_id": "MEE_lADOABII586V1KS_zwAAAAOqLotH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15740078919",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-21T18:34:54Z"
    },
    {
      "event": "subscribed",
      "id": 15740078921,
      "node_id": "SE_lADOABII586V1KS_zwAAAAOqLotJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15740078921",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-21T18:34:54Z"
    },
    {
      "event": "commented",
      "id": 2650258443,
      "node_id": "IC_kwDOABII586d97wL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2650258443",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-11T09:32:56Z",
      "updated_at": "2025-02-11T09:33:33Z",
      "author_association": "MEMBER",
      "body": "As for the raw performance, the runners were upgraded, and the massive scheduling delays of last year (up to ~5hours (?) in peak times, when 10 pull requests or commits were pushed at the same time, resulting in about 100 CI tasks at the same time) should be a bit smoothed out this year. I don't have full metrics, but https://cirrus-ci.com/github/bitcoin/bitcoin/master shows \"Duration Chart\" as a proxy, with the end-to-end maximum duration. Currently, it shows a range of 44 minutes up to 2h:44minutes.\n\n(Possibly @0xB10C may have a more complete picture of the stats)\n\nI guess the remaining question would be whether the raw performance should be improved more, or if the CI performance is fine?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2650258443",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "mentioned",
      "id": 16261440512,
      "node_id": "MEE_lADOABII586V1KS_zwAAAAPJQeQA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16261440512",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-11T09:32:57Z"
    },
    {
      "event": "subscribed",
      "id": 16261440526,
      "node_id": "SE_lADOABII586V1KS_zwAAAAPJQeQO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16261440526",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-11T09:32:57Z"
    },
    {
      "event": "commented",
      "id": 2651790997,
      "node_id": "IC_kwDOABII586eDx6V",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2651790997",
      "actor": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-11T18:58:44Z",
      "updated_at": "2025-02-11T18:58:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "here a some per task stats on this:\n\ne.g. for the `fuzzer,address,undefined,integer, no depends` task\n\n\nscheduling + execution:\n![Image](https://github.com/user-attachments/assets/43f31027-4328-451a-882b-48768400cc16)\nhttps://0xb10c.github.io/bitcoin-core-ci-stats/graph/schedule-and-execution/\n\n\nscheduling only:\n![Image](https://github.com/user-attachments/assets/c005831e-b1f3-4e14-8ab8-c42799a8948b)\nhttps://0xb10c.github.io/bitcoin-core-ci-stats/graph/schedule/\n",
      "user": {
        "login": "0xB10C",
        "id": 19157360,
        "node_id": "MDQ6VXNlcjE5MTU3MzYw",
        "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/0xB10C",
        "html_url": "https://github.com/0xB10C",
        "followers_url": "https://api.github.com/users/0xB10C/followers",
        "following_url": "https://api.github.com/users/0xB10C/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/0xB10C/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/0xB10C/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
        "organizations_url": "https://api.github.com/users/0xB10C/orgs",
        "repos_url": "https://api.github.com/users/0xB10C/repos",
        "events_url": "https://api.github.com/users/0xB10C/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/0xB10C/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-2651790997",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "commented",
      "id": 3247801501,
      "node_id": "IC_kwDOABII587BlYSd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3247801501",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-03T06:04:38Z",
      "updated_at": "2025-09-03T06:04:38Z",
      "author_association": "MEMBER",
      "body": "Closing for now. I think we'll go with https://github.com/bitcoin/bitcoin/issues/31965, which may also increase performance, so there is no longer a need to upgrade the self-hosted runners.\n\nFeel free to continue discussion below. Also, this can be re-opened, or a new issue can be opened.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/30852#issuecomment-3247801501",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30852"
    },
    {
      "event": "closed",
      "id": 19474306946,
      "node_id": "CE_lADOABII586V1KS_zwAAAASIwleC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19474306946",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-03T06:04:38Z"
    }
  ]
}