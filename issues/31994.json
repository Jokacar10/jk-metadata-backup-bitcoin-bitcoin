{
  "type": "issue",
  "issue": {
    "id": 2897065979,
    "node_id": "I_kwDOABII586srbf7",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31994",
    "number": 31994,
    "state": "open",
    "state_reason": null,
    "title": "build: ccache doesn't hit across build dirs",
    "body": "This has regressed since 28.x. Opening an issue to track given #30861 has been closed. Tagged for 29.x because ideally this would be fixed, and any fix could be backported.",
    "user": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/69",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/69",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/69/labels",
      "id": 11324346,
      "node_id": "MI_kwDOABII584ArMu6",
      "number": 69,
      "state": "open",
      "title": "29.0",
      "description": "",
      "creator": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "open_issues": 9,
      "closed_issues": 110,
      "created_at": "2024-07-17T08:47:56Z",
      "updated_at": "2025-03-11T15:40:15Z"
    },
    "locked": false,
    "comments": 6,
    "created_at": "2025-03-05T11:30:16Z",
    "updated_at": "2025-03-11T16:49:13Z"
  },
  "events": [
    {
      "event": "milestoned",
      "id": 16598147965,
      "node_id": "MIE_lADOABII586srbf7zwAAAAPdU6N9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16598147965",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-05T11:30:16Z",
      "milestone": {
        "title": "29.0"
      }
    },
    {
      "event": "subscribed",
      "id": 16601604090,
      "node_id": "SE_lADOABII586srbf7zwAAAAPdiF_6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16601604090",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-05T15:22:38Z"
    },
    {
      "event": "commented",
      "id": 2708846512,
      "node_id": "IC_kwDOABII586hdbew",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2708846512",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-09T13:04:25Z",
      "updated_at": "2025-03-09T13:04:25Z",
      "author_association": "MEMBER",
      "body": "## TL;DR\n\nTo enable ccache hits across different build directories on Linux or macOS, configure the ccache options as follows:\n```\nbase_dir = <path_to_your_home_directory>\nhash_dir = false\n```\nor via environment variables:\n```\n$ export CCACHE_BASEDIR=$HOME\n$ export CCACHE_NOHASHDIR=1\n```\n\n## Detailed Solution\n\nAll following commands were executed on Ubuntu 24.04.2 LTS with [ccache 4.9.1](https://packages.ubuntu.com/noble/ccache) installed.\n\nConsider building in two separate build directories with [ccache debugging](https://ccache.dev/manual/4.9.1.html#_cache_debugging) enabled:\n```\n$ export CCACHE_DEBUG=1\n$ printenv | grep CCACHE\nCCACHE_DEBUG=1\n$ export CCACHE_DIR=$(mktemp -d)\n$ cmake -B build_first -DWITH_CCACHE=ON\n$ cmake --build build_first -t bitcoin_crypto -j $(nproc)\n$ cmake -B build_second -DWITH_CCACHE=ON\n$ ccache -z\n$ cmake --build build_second -t bitcoin_crypto -j $(nproc)\n$ ccache -s\nCacheable calls:     20 /  20 (100.0%)\n  Hits:               0 /  20 ( 0.00%)\n    Direct:           0\n    Preprocessed:     0\n  Misses:            20 /  20 (100.0%)\nLocal storage:\n  Cache size (GiB): 0.0 / 5.0 ( 0.09%)\n  Hits:               0 /  20 ( 0.00%)\n  Misses:            20 /  20 (100.0%)\n```\n\nThere were 100% misses. A comparison of the combined input used for hashing for an object file provides some clues:\n```diff\n$ diff -u build_first/src/crypto/CMakeFiles/bitcoin_crypto.dir/aes.cpp.o.*.ccache-input-text build_second/src/crypto/CMakeFiles/bitcoin_crypto.dir/aes.cpp.o.*.ccache-input-text\n--- build_first/src/crypto/CMakeFiles/bitcoin_crypto.dir/aes.cpp.o.20250309_113307_205745.ccache-input-text\t2025-03-09 11:33:07.669373196 +0000\n+++ build_second/src/crypto/CMakeFiles/bitcoin_crypto.dir/aes.cpp.o.20250309_113435_261959.ccache-input-text\t2025-03-09 11:34:35.664968636 +0000\n@@ -10,7 +10,7 @@\n ### LANG\n en_US.UTF-8\n ### cwd\n-/home/hebasto/dev/bitcoin/build_first\n+/home/hebasto/dev/bitcoin/build_second\n === DIRECT MODE ===\n ### cache entry version\n 1\n@@ -83,7 +83,7 @@\n ### arg\n -DENABLE_X86_SHANI\n ### arg\n--I/home/hebasto/dev/bitcoin/build_first/src\n+-I/home/hebasto/dev/bitcoin/build_second/src\n ### arg\n -I/home/hebasto/dev/bitcoin/src\n ### arg\n@@ -170,7 +170,7 @@\n /home/hebasto/dev/bitcoin/src/crypto/aes.cpp\n \"\n # 1 \"\n-/home/hebasto/dev/bitcoin/build_first\n+/home/hebasto/dev/bitcoin/build_second\n \"\n # 0 \"\n <built-in>\n```\n\nHence, we need to address:\n1) Absolute paths in compiler invocation commands, and\n2) Hashing of the current working directory.\n\nThe documented method to resolve the first issue is the [`base_dir`](https://ccache.dev/manual/4.9.1.html#config_base_dir) ccache configuration option. The current [recommendation](https://github.com/bitcoin/bitcoin/blob/master/doc/productivity.md#cache-compilations-with-ccache) from our [Productivity Notes](https://github.com/bitcoin/bitcoin/blob/master/doc/productivity.md) remains valid:\n> `base_dir` is required for ccache to share cached compiles of the same file across different ... paths; it will only do this for paths under `base_dir`.\n\nAdditionally, ccache docs [state](https://ccache.dev/manual/4.9.1.html#config_hash_dir):\n> The CWD will not be included in the hash if [`base_dir`](https://ccache.dev/manual/4.9.1.html#config_base_dir) is set (_and matches the CWD_) and the compiler option `-fdebug-prefix-map` is used. \n\nThe latter is always true:https://github.com/bitcoin/bitcoin/blob/4637cb1eec48d1af8d23eeae1bb4c6f8de55eed9/CMakeLists.txt#L473-L475\n\nHowever, in CMake builds the CWD is a build directory. Therefore, none of the meaningful values of `base_dir` will trigger the skipping of CWD hashing. We must explicitly use the `hash_dir` option to disable this behaviour.\n\nNow, let's set `base_dir` and disable `hash_dir`:\n```\n$ export CCACHE_BASEDIR=$HOME\n$ export CCACHE_NOHASHDIR=1\n$ export CCACHE_DIR=$(mktemp -d)\n$ cmake -B build_first -DWITH_CCACHE=ON\n$ cmake --build build_first -t bitcoin_crypto -j $(nproc)\n$ cmake -B build_second -DWITH_CCACHE=ON\n$ ccache -z\n$ cmake --build build_second -t bitcoin_crypto -j $(nproc)\n$ ccache -s\nCacheable calls:     20 /  20 (100.0%)\n  Hits:              20 /  20 (100.0%)\n    Direct:          20 /  20 (100.0%)\n    Preprocessed:     0 /  20 ( 0.00%)\n  Misses:             0 /  20 ( 0.00%)\nLocal storage:\n  Cache size (GiB): 0.0 / 5.0 ( 0.04%)\n  Hits:              20 /  20 (100.0%)\n  Misses:             0 /  20 ( 0.00%)\n```\n\nWe've got 100% hits.\n\nCcache docs [warn](https://ccache.dev/manual/4.9.1.html#config_hash_dir) about disabling CWD hashing:\n> The reason for including the CWD in the hash by default is to prevent a problem with the storage of the current working directory in the debug info of an object file, which can lead ccache to return a cached object file that has the working directory in the debug info set incorrectly.\n\nHowever, I do not see how this affects us, as all paths in the debug information of object files are mapped as mentioned above.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2708846512",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994"
    },
    {
      "event": "commented",
      "id": 2708848882,
      "node_id": "IC_kwDOABII586hdcDy",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2708848882",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-09T13:09:31Z",
      "updated_at": "2025-03-09T13:09:31Z",
      "author_association": "MEMBER",
      "body": "Amending our docs, as demonstrated in https://github.com/davidgumberg/bitcoin/commit/1c6ae1043d59d01cbf52f353e50a63b0afa883c4, could be an alternative to https://github.com/bitcoin/bitcoin/pull/30861.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2708848882",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994"
    },
    {
      "event": "commented",
      "id": 2714578102,
      "node_id": "IC_kwDOABII586hzSy2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2714578102",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-11T14:39:37Z",
      "updated_at": "2025-03-11T14:39:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "Thanks for writing this up so clearly. It would be good to add this to the documentation.\n\nre: https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2708846512\n\n> Additionally, ccache docs [state](https://ccache.dev/manual/4.9.1.html#config_hash_dir):\n> \n> > The CWD will not be included in the hash if [`base_dir`](https://ccache.dev/manual/4.9.1.html#config_base_dir) is set (_and matches the CWD_) and the compiler option `-fdebug-prefix-map` is used.\n\nI still don't understand why setting `hash_dir = false` or `CCACHE_NOHASHDIR=1` should be necessary. Both conditions listed would seem to be true. Both CWD's (/home/hebasto/dev/bitcoin/build_first and /home/hebasto/dev/bitcoin/build_second) should match the base_dir (/home/hebasto) because the according to the [base_dir](https://ccache.dev/manual/4.9.1.html#config_base_dir) documentation it matches \"absolute paths that begin with base_dir\". \n\n> However, in CMake builds the CWD is a build directory. Therefore, none of the meaningful values of `base_dir` will trigger the skipping of CWD hashing. We must explicitly use the `hash_dir` option to disable this behaviour.\n\nThis doesn't seem true. How do /home/hebasto/dev/bitcoin/build_first and /home/hebasto/dev/bitcoin/build_second not match /home/hebasto?",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2714578102",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994"
    },
    {
      "event": "commented",
      "id": 2714625797,
      "node_id": "IC_kwDOABII586hzecF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2714625797",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-11T14:50:35Z",
      "updated_at": "2025-03-11T14:50:35Z",
      "author_association": "MEMBER",
      "body": "> Thanks for writing this up so clearly. It would be good to add this to the documentation.\n> \n> re: [#31994 (comment)](https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2708846512)\n> \n> > Additionally, ccache docs [state](https://ccache.dev/manual/4.9.1.html#config_hash_dir):\n> > > The CWD will not be included in the hash if [`base_dir`](https://ccache.dev/manual/4.9.1.html#config_base_dir) is set (_and matches the CWD_) and the compiler option `-fdebug-prefix-map` is used.\n> \n> I still don't understand why setting `hash_dir = false` or `CCACHE_NOHASHDIR=1` should be necessary. Both conditions listed would seem to be true. Both CWD's (/home/hebasto/dev/bitcoin/build_first and /home/hebasto/dev/bitcoin/build_second) should match the base_dir (/home/hebasto) because the according to the [base_dir](https://ccache.dev/manual/4.9.1.html#config_base_dir) documentation it matches \"absolute paths that begin with base_dir\".\n\nThis interpretation of the Ccache documentation does not describe the actual behaviour on my different systems. I read \"`base_dir` matches the CWD\" as \"`base_dir` equals the CWD\". However, I might be wrong.",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2714625797",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994"
    },
    {
      "event": "commented",
      "id": 2714742260,
      "node_id": "IC_kwDOABII586hz630",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2714742260",
      "actor": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-11T15:21:13Z",
      "updated_at": "2025-03-11T15:21:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "> This interpretation of the Ccache documentation does not describe the actual behaviour on my different systems. I read \"base_dir matches the CWD\" as \"base_dir equals the CWD\". However, I might be wrong.\n\nYou are probably right but this behavior does not seem to make sense or correspond to documentation of base_dir. It is probably ok for us to force CCACHE_NOHASHDIR, but it seems like it would be safer if ccache just detected conditions it should and shouldn't hash CWD correctly itself. Ccache's behavior here seems nonsensical.",
      "user": {
        "login": "ryanofsky",
        "id": 7133040,
        "node_id": "MDQ6VXNlcjcxMzMwNDA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ryanofsky",
        "html_url": "https://github.com/ryanofsky",
        "followers_url": "https://api.github.com/users/ryanofsky/followers",
        "following_url": "https://api.github.com/users/ryanofsky/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ryanofsky/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ryanofsky/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
        "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
        "repos_url": "https://api.github.com/users/ryanofsky/repos",
        "events_url": "https://api.github.com/users/ryanofsky/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2714742260",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994"
    },
    {
      "event": "commented",
      "id": 2715048334,
      "node_id": "IC_kwDOABII586h1FmO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2715048334",
      "actor": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-11T16:49:12Z",
      "updated_at": "2025-03-11T16:49:12Z",
      "author_association": "MEMBER",
      "body": "> > This interpretation of the Ccache documentation does not describe the actual behaviour on my different systems. I read \"base_dir matches the CWD\" as \"base_dir equals the CWD\". However, I might be wrong.\n> \n> You are probably right but this behavior does not seem to make sense or correspond to documentation of base_dir. It is probably ok for us to force CCACHE_NOHASHDIR, but it seems like it would be safer if ccache just detected conditions it should and shouldn't hash CWD correctly itself. Ccache's behavior here seems nonsensical.\n\nIt looks like [this code](https://github.com/ccache/ccache/blob/2f5bf486d366c35c05c36719e2b8d784a9f1175f/src/ccache/ccache.cpp#L626-L628) is responsible for that behaviour:\n```c++\n      if (inc_path != ctx.apparent_cwd || ctx.config.hash_dir()) {\n        hash.hash(inc_path);\n      }\n```",
      "user": {
        "login": "hebasto",
        "id": 32963518,
        "node_id": "MDQ6VXNlcjMyOTYzNTE4",
        "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/hebasto",
        "html_url": "https://github.com/hebasto",
        "followers_url": "https://api.github.com/users/hebasto/followers",
        "following_url": "https://api.github.com/users/hebasto/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/hebasto/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/hebasto/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
        "organizations_url": "https://api.github.com/users/hebasto/orgs",
        "repos_url": "https://api.github.com/users/hebasto/repos",
        "events_url": "https://api.github.com/users/hebasto/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/hebasto/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31994#issuecomment-2715048334",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31994"
    }
  ]
}