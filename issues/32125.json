{
  "type": "issue",
  "issue": {
    "id": 2940946189,
    "node_id": "I_kwDOABII586vS0cN",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32125",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32125/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32125/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32125/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/32125",
    "number": 32125,
    "state": "open",
    "state_reason": null,
    "title": "Failed transactions on importing mempool",
    "body": "### Is there an existing issue for this?\n\n- [x] I have searched the existing issues\n\n### Current behaviour\n\nHello! This is rather a question. I am wondering: are the 10 failed related to package relaying?\n\n29.0rc2\n\n```\n2025-03-23T05:24:22Z SetNetworkActive: false\n2025-03-23T05:24:27Z Loading 20483 mempool transactions from file...\n2025-03-23T05:24:27Z Progress loading mempool transactions from file: 10% (tried 2049, 18434 remaining)\n2025-03-23T05:24:27Z Progress loading mempool transactions from file: 20% (tried 4097, 16386 remaining)\n2025-03-23T05:24:27Z Progress loading mempool transactions from file: 30% (tried 6145, 14338 remaining)\n2025-03-23T05:24:27Z Progress loading mempool transactions from file: 40% (tried 8194, 12289 remaining)\n2025-03-23T05:24:28Z Progress loading mempool transactions from file: 50% (tried 10242, 10241 remaining)\n2025-03-23T05:24:28Z Progress loading mempool transactions from file: 60% (tried 12290, 8193 remaining)\n2025-03-23T05:24:28Z Progress loading mempool transactions from file: 70% (tried 14339, 6144 remaining)\n2025-03-23T05:24:28Z Progress loading mempool transactions from file: 80% (tried 16387, 4096 remaining)\n2025-03-23T05:24:28Z Progress loading mempool transactions from file: 90% (tried 18435, 2048 remaining)\n2025-03-23T05:24:28Z Imported mempool transactions from file: 0 succeeded, 10 failed, 0 expired, 20473 already there, 0 waiting for initial broadcast\n2025-03-23T05:24:28Z SetNetworkActive: true\n```\n\nTo get fresh mempool ready to import, see:\n\n - mymempool: [txt](https://anyone.eu.org/mymempool.txt), [dat](https://anyone.eu.org/mymempool.dat), [log](https://anyone.eu.org/mymempool-log.txt), [getmempoolinfo (JSON)](https://anyone.eu.org/gmi-main.json)\n\n### Expected behaviour\n\nThe nodes I test are running on my local network so I guess all the transactions are importable, but the 10 failed could be 5 packages of 2.\n\n### Steps to reproduce\n\nImport from file using RPC\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nv29.0rc2\n\n### Operating system and version\n\nAlpine Linux 3.21.3\n\n### Machine specifications\n\nLinux x86_64",
    "user": {
      "login": "jsarenik",
      "id": 244565,
      "node_id": "MDQ6VXNlcjI0NDU2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jsarenik",
      "html_url": "https://github.com/jsarenik",
      "followers_url": "https://api.github.com/users/jsarenik/followers",
      "following_url": "https://api.github.com/users/jsarenik/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/jsarenik/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/jsarenik/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/jsarenik/subscriptions",
      "organizations_url": "https://api.github.com/users/jsarenik/orgs",
      "repos_url": "https://api.github.com/users/jsarenik/repos",
      "events_url": "https://api.github.com/users/jsarenik/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/jsarenik/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 477890092,
        "node_id": "MDU6TGFiZWw0Nzc4OTAwOTI=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Questions%20and%20Help",
        "name": "Questions and Help",
        "color": "006688",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "NONE",
    "locked": false,
    "comments": 3,
    "created_at": "2025-03-23T05:47:13Z",
    "updated_at": "2025-03-24T20:40:02Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2747360730,
      "node_id": "IC_kwDOABII586jwWXa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2747360730",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T08:59:48Z",
      "updated_at": "2025-03-24T08:59:48Z",
      "author_association": "MEMBER",
      "body": "> The nodes I test are running on my local network so I guess all the transactions are importable, but the 10 failed could be 5 packages of 2.\n\nCan you add exact steps to reproduce, please?\n\nThe mempool acceptance depends on the chain state (the best block hash of your node at the time of the mempool import), as well as the mempool file contents.\n\nWithout any exact info, my guess would be that the 10 failures are due to transactions already confirmed (either themselves or a replacement of themselves).\n\nAlso, package acceptance is already a todo comment in the code, see \n\nhttps://github.com/bitcoin/bitcoin/blob/770d39a37652d40885533fecce37e9f71cc0d051/test/functional/mempool_ephemeral_dust.py#L129-L135\n\n",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32125#issuecomment-2747360730",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32125"
    },
    {
      "event": "labeled",
      "id": 16951384558,
      "node_id": "LE_lADOABII586vS0cNzwAAAAPyYZnu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16951384558",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T09:00:01Z",
      "label": {
        "name": "Questions and Help",
        "color": "006688"
      }
    },
    {
      "event": "commented",
      "id": 2748705614,
      "node_id": "IC_kwDOABII586j1etO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2748705614",
      "actor": {
        "login": "jsarenik",
        "id": 244565,
        "node_id": "MDQ6VXNlcjI0NDU2NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/244565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jsarenik",
        "html_url": "https://github.com/jsarenik",
        "followers_url": "https://api.github.com/users/jsarenik/followers",
        "following_url": "https://api.github.com/users/jsarenik/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jsarenik/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jsarenik/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jsarenik/subscriptions",
        "organizations_url": "https://api.github.com/users/jsarenik/orgs",
        "repos_url": "https://api.github.com/users/jsarenik/repos",
        "events_url": "https://api.github.com/users/jsarenik/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jsarenik/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T16:22:59Z",
      "updated_at": "2025-03-24T19:16:57Z",
      "author_association": "NONE",
      "body": "Thank you for feedback, @maflcko ! In the end of this post I include shell script. The node is started always with `persistmempool=0` and I have also `mempool.dat` file symlinked to `/dev/null` just to remind me on a filesystem level.\n\nYes, my chainstate always contains the last-recent block when starting import.\n\nNow I tried to artificially change priority of each of the transactions before importing them (see in the script at the end) and it worked:\n\n```\n2025-03-24T16:06:18Z Imported mempool transactions from file: 40560 succeeded, 0 failed, 0 expired, 0 already there, 0 waiting for initial broadcast\n```\n\nJust that I imagine it could be much faster than 9 minutes I got with this shell hack if there was an option to `importmempool` RPC that would make sure every single (unless spent already) gets into mempool.\n\nHere is the script I call `mymempoolhere.sh`:\n\n```sh\n#!/bin/sh\n\nBN=89999115000 # arbitrary big number usable here\nhp=anyone.eu.org\nbitcoin-cli echo hello | grep -q . || exit 1\nping -qc 1 -W5 -w5 $hp >/dev/null || { hp=192.168.3.118:12321; scheme=http; }\nurl=${scheme:-\"https\"}://$hp\nout=/dev/shm/mempool.copy\ntouch $out 2>/dev/null || out=$HOME/mempool.copy\nrm -f $out\nuptime=$(bitcoin-cli uptime) || exit 1\ntest $uptime -gt 613 || bitcoin-cli setnetworkactive false\nwget -O $out $url/mempool.copy\nwget -qO - $url/mymempool.txt \\\n  | xargs -I TXID -n 1 -P 200 bitcoin-cli prioritisetransaction TXID \"0.0\" $BN \\\n    >/dev/null 2>&1\nbitcoin-cli importmempool $out '{\n\"apply_fee_delta_priority\":true,\n\"apply_unbroadcast_set\":true}'\nrm -f $out\nbitcoin-cli setnetworkactive true\ndate -u\n\n# optiontal clean-up would mess up logs so maybe exit before here\nbitcoin-cli getprioritisedtransactions \\\n  | grep -e '^  \"' -e '\"fee_delta\":' \\\n  | tr -d '  {,' | paste -d\" \" - - \\\n  | sed 's/\"fee_delta\":/\"0.0\" +/' \\\n  | sed 's/+-//' | tr '+' '-' | tr -d : \\\n  | xargs -n 3 -P 200 bitcoin-cli prioritisetransaction \\\n    >/dev/null 2>&1\n```\n\nUPDATE: it takes ~2 minutes on an already-loaded mempool so for me it is already OK",
      "user": {
        "login": "jsarenik",
        "id": 244565,
        "node_id": "MDQ6VXNlcjI0NDU2NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/244565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jsarenik",
        "html_url": "https://github.com/jsarenik",
        "followers_url": "https://api.github.com/users/jsarenik/followers",
        "following_url": "https://api.github.com/users/jsarenik/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jsarenik/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jsarenik/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jsarenik/subscriptions",
        "organizations_url": "https://api.github.com/users/jsarenik/orgs",
        "repos_url": "https://api.github.com/users/jsarenik/repos",
        "events_url": "https://api.github.com/users/jsarenik/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jsarenik/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32125#issuecomment-2748705614",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32125"
    },
    {
      "event": "mentioned",
      "id": 16959134385,
      "node_id": "MEE_lADOABII586vS0cNzwAAAAPy19qx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16959134385",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T16:23:00Z"
    },
    {
      "event": "subscribed",
      "id": 16959134410,
      "node_id": "SE_lADOABII586vS0cNzwAAAAPy19rK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16959134410",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T16:23:00Z"
    },
    {
      "event": "commented",
      "id": 2749337486,
      "node_id": "IC_kwDOABII586j34-O",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2749337486",
      "actor": {
        "login": "jsarenik",
        "id": 244565,
        "node_id": "MDQ6VXNlcjI0NDU2NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/244565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jsarenik",
        "html_url": "https://github.com/jsarenik",
        "followers_url": "https://api.github.com/users/jsarenik/followers",
        "following_url": "https://api.github.com/users/jsarenik/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jsarenik/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jsarenik/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jsarenik/subscriptions",
        "organizations_url": "https://api.github.com/users/jsarenik/orgs",
        "repos_url": "https://api.github.com/users/jsarenik/repos",
        "events_url": "https://api.github.com/users/jsarenik/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jsarenik/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-24T20:37:55Z",
      "updated_at": "2025-03-24T20:40:00Z",
      "author_association": "NONE",
      "body": "Another example of what I was thinking of in the beginning and what is already possible using the script that prioritizes transactions before importing them:\n\n```\nnewlines added\n2025-03-24T20:31:45Z\n  Imported mempool transactions from file:\n    1267 succeeded, 0 failed, 0 expired, 29536 already there,\n    0 waiting for initial broadcast\n```\n\nOne thing I can think of right now would be an RPC which clears all prioritization. No idea how to do it in Bitcoin Core yet, but the idea is here. Such RPC would shrink the clean-up part of my script to one line.",
      "user": {
        "login": "jsarenik",
        "id": 244565,
        "node_id": "MDQ6VXNlcjI0NDU2NQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/244565?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jsarenik",
        "html_url": "https://github.com/jsarenik",
        "followers_url": "https://api.github.com/users/jsarenik/followers",
        "following_url": "https://api.github.com/users/jsarenik/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jsarenik/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jsarenik/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jsarenik/subscriptions",
        "organizations_url": "https://api.github.com/users/jsarenik/orgs",
        "repos_url": "https://api.github.com/users/jsarenik/repos",
        "events_url": "https://api.github.com/users/jsarenik/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jsarenik/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/32125#issuecomment-2749337486",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32125"
    }
  ]
}