{
  "type": "issue",
  "issue": {
    "id": 2894749205,
    "node_id": "I_kwDOABII586sil4V",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31986",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31986/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31986/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31986/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31986",
    "number": 31986,
    "state": "open",
    "state_reason": null,
    "title": "TSan warning with legacy wallet on macos (\"too long mutex cycle found\")",
    "body": "master branch at 15717f0ef3960969ee550a4a41741987b86684dc\n\nbuilt on arm64/macos\n\nNotably there is no TSan warning when the test is run with `--descriptors`\n\nTo reproduce:\n```\n--> build_master/test/functional/wallet_listtransactions.py --legacy-wallet --nocleanup\n...\nAssertionError: Unexpected stderr WARNING: too long mutex cycle found\n```\n\ncomplete configuration:\n```\nConfigure summary\n=================\nExecutables:\n  bitcoind ............................ ON\n  bitcoin-node (multiprocess) ......... OFF\n  bitcoin-qt (GUI) .................... OFF\n  bitcoin-gui (GUI, multiprocess) ..... OFF\n  bitcoin-cli ......................... ON\n  bitcoin-tx .......................... ON\n  bitcoin-util ........................ ON\n  bitcoin-wallet ...................... ON\n  bitcoin-chainstate (experimental) ... OFF\n  libbitcoinkernel (experimental) ..... OFF\nOptional features:\n  wallet support ...................... ON\n   - descriptor wallets (SQLite) ...... ON\n   - legacy wallets (Berkeley DB) ..... ON\n  external signer ..................... ON\n  ZeroMQ .............................. ON\n  USDT tracing ........................ OFF\n  QR code (GUI) ....................... OFF\n  DBus (GUI, Linux only) .............. OFF\nTests:\n  test_bitcoin ........................ ON\n  test_bitcoin-qt ..................... OFF\n  bench_bitcoin ....................... OFF\n  fuzz binary ......................... OFF\n\nCross compiling ....................... FALSE\nC++ compiler .......................... Clang 19.1.7, /opt/homebrew/opt/llvm/bin/clang++\nCMAKE_BUILD_TYPE ...................... Debug\nPreprocessor defined macros ........... OBJC_OLD_DISPATCH_PROTOTYPES=0 DEBUG DEBUG_LOCKORDER DEBUG_LOCKCONTENTION RPC_DOC_CHECK ABORT_ON_FAILED_ASSUME\nC++ compiler flags .................... -O0 -ftrapv -g3 -std=c++20 -fPIC -fdebug-prefix-map=/Users/matthewzipkin/Desktop/work/bitcoin/src=. -fmacro-prefix-map=/Users/matthewzipkin/Desktop/work/bitcoin/src=. -fsanitize=thread -Wall -Wextra -Wgnu -Wformat -Wformat-security -Wvla -Wshadow-field -Wthread-safety -Wloop-analysis -Wredundant-decls -Wunused-member-function -Wdate-time -Wconditional-uninitialized -Woverloaded-virtual -Wsuggest-override -Wimplicit-fallthrough -Wunreachable-code -Wdocumentation -Wself-assign -Wundef -Wno-unused-parameter -Wstack-protector -fstack-protector-all -mbranch-protection=bti\nLinker flags .......................... -O0 -ftrapv -g3 -L/opt/homebrew/opt/llvm/lib -Wl,-dead_strip -Wl,-dead_strip_dylibs -Wl,-headerpad_max_install_names -fsanitize=thread -fstack-protector-all -Wl,-fixup_chains -fPIE -Xlinker -pie\n\nNOTE: The summary above may not exactly match the final applied build flags\n      if any additional CMAKE_* or environment variables have been modified.\n      To see the exact flags applied, build with the --verbose option.\n\nAttempt to harden executables ......... ON\nTreat compiler warnings as errors ..... OFF\nUse ccache for compiling .............. ON\n\n```",
    "user": {
      "login": "pinheadmz",
      "id": 2084648,
      "node_id": "MDQ6VXNlcjIwODQ2NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinheadmz",
      "html_url": "https://github.com/pinheadmz",
      "followers_url": "https://api.github.com/users/pinheadmz/followers",
      "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
      "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
      "repos_url": "https://api.github.com/users/pinheadmz/repos",
      "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [],
    "assignees": [],
    "author_association": "MEMBER",
    "locked": false,
    "comments": 1,
    "created_at": "2025-03-04T15:59:37Z",
    "updated_at": "2025-03-04T16:22:16Z"
  },
  "events": [
    {
      "event": "commented",
      "id": 2698225051,
      "node_id": "IC_kwDOABII586g06Wb",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2698225051",
      "actor": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-04T16:22:15Z",
      "updated_at": "2025-03-04T16:22:15Z",
      "author_association": "MEMBER",
      "body": "* I ran all wallet tests and only `wallet_listtransactions.py --legacy-wallet` fails with this warning",
      "user": {
        "login": "pinheadmz",
        "id": 2084648,
        "node_id": "MDQ6VXNlcjIwODQ2NDg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2084648?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pinheadmz",
        "html_url": "https://github.com/pinheadmz",
        "followers_url": "https://api.github.com/users/pinheadmz/followers",
        "following_url": "https://api.github.com/users/pinheadmz/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pinheadmz/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pinheadmz/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pinheadmz/subscriptions",
        "organizations_url": "https://api.github.com/users/pinheadmz/orgs",
        "repos_url": "https://api.github.com/users/pinheadmz/repos",
        "events_url": "https://api.github.com/users/pinheadmz/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pinheadmz/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/issues/31986#issuecomment-2698225051",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31986"
    }
  ]
}