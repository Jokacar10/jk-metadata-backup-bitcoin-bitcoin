{
  "type": "issue",
  "issue": {
    "id": 2840975823,
    "node_id": "I_kwDOABII586pVdnP",
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31830",
    "repository_url": "https://api.github.com/repos/bitcoin/bitcoin",
    "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31830/labels%7B/name%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31830/comments",
    "events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31830/events",
    "html_url": "https://github.com/bitcoin/bitcoin/issues/31830",
    "number": 31830,
    "state": "open",
    "state_reason": null,
    "title": "wallet: Branch and Bound producing change",
    "body": "My fuzz server crashed due to Branch and Bound producing change. I could reproduce the issue with the following test:\n\n```cpp\nBOOST_AUTO_TEST_CASE(bnb_change)\n{\n    FastRandomContext fast_random_context{};\n    CoinSelectionParams coin_params{\n        /*rng_fast*/fast_random_context,\n        /*change_output_size=*/31,\n        /*change_spend_size=*/68,\n        /*min_change_target=*/50'000,\n        /*effective_feerate=*/CFeeRate(5000),\n        /*long_term_feerate=*/CFeeRate(10'000),\n        /*discard_feerate=*/CFeeRate(3000),\n        /*tx_noinputs_size=*/11 + 31, //static header size + output size\n        /*avoid_partial=*/false,\n    };\n    coin_params.m_change_fee = /*155 sats=*/coin_params.m_effective_feerate.GetFee(coin_params.change_output_size);\n    coin_params.min_viable_change = /*204 sats=*/coin_params.m_discard_feerate.GetFee(coin_params.change_spend_size);\n    coin_params.m_cost_of_change = /*204 + 155 sats=*/coin_params.min_viable_change + coin_params.m_change_fee;\n    coin_params.m_subtract_fee_outputs = false;\n\n    std::vector<COutput> utxo_pool;\n    CMutableTransaction tx;\n    tx.vout.resize(8);\n    tx.vout[7].nValue = 1395186823946715;\n    tx.nLockTime = 1; // all transactions get different hashes\n    utxo_pool.emplace_back(COutPoint(tx.GetHash(), 7), tx.vout.at(7), /*depth=*/1, /*input_bytes=*/1578, /*spendable=*/true, /*solvable=*/true, /*safe=*/true, /*time=*/0, /*from_me=*/true, coin_params.m_effective_feerate.GetFee(1578));\n\n    std::vector<OutputGroup> output_groups;\n    auto output_group = OutputGroup(coin_params);\n    output_group.Insert(std::make_shared<COutput>(utxo_pool[0]), /*ancestors=*/0, /*descendants=*/0);\n    output_groups.push_back(output_group);\n\n    const auto target{1395186823938466};\n    auto result_bnb = SelectCoinsBnB(output_groups, target, coin_params.m_cost_of_change, 400000);\n    if (result_bnb) {\n        assert(result_bnb->GetChange(coin_params.min_viable_change, coin_params.m_change_fee) == 0);\n    }\n}\n```\n\nI noted that `change` and `min_viable_change` have the same values. For reference: https://bitcoincore.space/src/wallet/coinselection.cpp#987",
    "user": {
      "login": "brunoerg",
      "id": 19480819,
      "node_id": "MDQ6VXNlcjE5NDgwODE5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brunoerg",
      "html_url": "https://github.com/brunoerg",
      "followers_url": "https://api.github.com/users/brunoerg/followers",
      "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
      "organizations_url": "https://api.github.com/users/brunoerg/orgs",
      "repos_url": "https://api.github.com/users/brunoerg/repos",
      "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/brunoerg/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "assignees": [],
    "author_association": "CONTRIBUTOR",
    "locked": false,
    "comments": 0,
    "created_at": "2025-02-09T21:47:23Z",
    "updated_at": "2025-02-10T13:17:43Z"
  },
  "events": [
    {
      "event": "labeled",
      "id": 16242515973,
      "node_id": "LE_lADOABII586pVdnPzwAAAAPIISAF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16242515973",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-10T07:20:58Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "renamed",
      "id": 16247438340,
      "node_id": "RTE_lADOABII586pVdnPzwAAAAPIbDwE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16247438340",
      "actor": {
        "login": "brunoerg",
        "id": 19480819,
        "node_id": "MDQ6VXNlcjE5NDgwODE5",
        "avatar_url": "https://avatars.githubusercontent.com/u/19480819?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/brunoerg",
        "html_url": "https://github.com/brunoerg",
        "followers_url": "https://api.github.com/users/brunoerg/followers",
        "following_url": "https://api.github.com/users/brunoerg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/brunoerg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/brunoerg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/brunoerg/subscriptions",
        "organizations_url": "https://api.github.com/users/brunoerg/orgs",
        "repos_url": "https://api.github.com/users/brunoerg/repos",
        "events_url": "https://api.github.com/users/brunoerg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/brunoerg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-10T13:17:43Z",
      "rename": {
        "from": "Branch and Bound producing change",
        "to": "wallet: Branch and Bound producing change"
      }
    }
  ]
}