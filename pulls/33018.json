{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018",
    "id": 2679273445,
    "node_id": "PR_kwDOABII586fsnfl",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33018",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33018.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33018.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
    "number": 33018,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "coins: remove SetFresh method from CCoinsCacheEntry",
    "user": {
      "login": "andrewtoth",
      "id": 237213,
      "node_id": "MDQ6VXNlcjIzNzIxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andrewtoth",
      "html_url": "https://github.com/andrewtoth",
      "followers_url": "https://api.github.com/users/andrewtoth/followers",
      "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
      "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
      "repos_url": "https://api.github.com/users/andrewtoth/repos",
      "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "There is plenty of test code that exercises the code path for FRESH-but-not-DIRTY coins in CCoinsViewCache. However, we can see there is only one place in production code where we call `SetFresh` that is not preceded by `SetDirty`. This is in `CCoinsViewCache::FetchCoin` and we can see that this is called if the coin retrieved from `base->GetCoin` is spent. The `base` in this case can be another `CCoinsViewCache` or a `CCoinsViewDB`. In `CCoinsViewCache::GetCoin` we can see that we do not return spent coins, and in `CCoinsViewDB` we don't ever store spent coins so there are none to return.\r\n\r\nThus, we can safely remove this dead code, and now we can see that there are never any calls to `SetFresh` not preceded by `SetDirty`. This PR removes this dead code and replaces `SetFresh` by passing a `fresh` boolean flag to `SetDirty`. This simplifies the logic of `CCoinsViewCache` and lets us remove test cases checking for FRESH-but-not-DIRTY coins. It removes the possibility of FRESH-but-not-DIRTY coins being called from any code path, so we can eliminate this state entirely and reduce the cognitive load of having to consider it.\r\n\r\nThis is pulled out from https://github.com/bitcoin/bitcoin/pull/30673 to make the change simpler.",
    "labels": [
      {
        "id": 97470796,
        "node_id": "MDU6TGFiZWw5NzQ3MDc5Ng==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/UTXO%20Db%20and%20Indexes",
        "name": "UTXO Db and Indexes",
        "color": "fbca04",
        "default": false
      }
    ],
    "created_at": "2025-07-19T19:21:35Z",
    "updated_at": "2025-07-21T01:59:08Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "5bd8aa4ca57790386576f2f406683885f13fb61b",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "andrewtoth:remove-setfresh",
      "ref": "remove-setfresh",
      "sha": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 156145027,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNTYxNDUwMjc=",
        "name": "bitcoin",
        "full_name": "andrewtoth/bitcoin",
        "owner": {
          "login": "andrewtoth",
          "id": 237213,
          "node_id": "MDQ6VXNlcjIzNzIxMw==",
          "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/andrewtoth",
          "html_url": "https://github.com/andrewtoth",
          "followers_url": "https://api.github.com/users/andrewtoth/followers",
          "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
          "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
          "repos_url": "https://api.github.com/users/andrewtoth/repos",
          "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/andrewtoth/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/andrewtoth/bitcoin",
        "archive_url": "https://api.github.com/repos/andrewtoth/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/andrewtoth/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/andrewtoth/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/andrewtoth/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/andrewtoth/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/andrewtoth/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/andrewtoth/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/andrewtoth/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/andrewtoth/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/andrewtoth/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/andrewtoth/bitcoin/events",
        "forks_url": "https://api.github.com/repos/andrewtoth/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/andrewtoth/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/andrewtoth/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/andrewtoth/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/andrewtoth/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/andrewtoth/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/andrewtoth/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/andrewtoth/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/andrewtoth/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/andrewtoth/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/andrewtoth/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:andrewtoth/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/andrewtoth/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/andrewtoth/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/andrewtoth/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/andrewtoth/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/andrewtoth/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/andrewtoth/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/andrewtoth/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/andrewtoth/bitcoin/hooks",
        "svn_url": "https://github.com/andrewtoth/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 1,
        "watchers_count": 1,
        "size": 282373,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-07-21T01:28:47Z",
        "created_at": "2018-11-05T01:43:59Z",
        "updated_at": "2022-12-23T04:16:30Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "5878f35446ae260ccb0ab5051b795b4364f77951",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37547,
        "stargazers_count": 84654,
        "watchers_count": 84654,
        "size": 289329,
        "default_branch": "master",
        "open_issues_count": 764,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-07-19T05:17:27Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-07-21T01:26:06Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 47,
    "deletions": 93,
    "changed_files": 6,
    "commits": 7,
    "review_comments": 24,
    "comments": 1
  },
  "events": [
    {
      "event": "labeled",
      "id": 18712832524,
      "node_id": "LE_lADOABII587Bc6GezwAAAARbXyoM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18712832524",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-19T19:21:38Z",
      "label": {
        "name": "UTXO Db and Indexes",
        "color": "fbca04"
      }
    },
    {
      "event": "commented",
      "id": 3092526814,
      "node_id": "IC_kwDOABII5864VDbe",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3092526814",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-19T19:21:39Z",
      "updated_at": "2025-07-20T19:20:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33018.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036128101) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32313](https://github.com/bitcoin/bitcoin/pull/32313) (coins: fix `cachedCoinsUsage` accounting in `CCoinsViewCache` by l0rinc)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#issuecomment-3092526814",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33018"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18717562758,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbp1eG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18717562758",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "created_at": "2025-07-20T18:17:13Z"
    },
    {
      "event": "reviewed",
      "id": 3036128101,
      "node_id": "PRR_kwDOABII586096Nl",
      "url": null,
      "actor": null,
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nVery glad this is getting cleanup up, I found it worrying that a lot of tests were exercising invalid states in the first place - not the best foundation.\r\nQuickly went over the changes, I find the small commits and excellent commit messages easy to follow.\r\nI'll run a full IBD over this (maybe with some extra `SanityCheck` sprinkled around for extra measure) to make sure real usage doesn't trigger any invalid states we're not aware of.",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036128101",
      "submitted_at": "2025-07-20T19:20:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "reviewed",
      "id": 3036282843,
      "node_id": "PRR_kwDOABII5860-f_b",
      "url": null,
      "actor": null,
      "commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#pullrequestreview-3036282843",
      "submitted_at": "2025-07-21T01:11:46Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJmNDgxMDJhZjcyMGVjYTM1NTVlOGZlY2NkNmY4NWQxZWY0M2U2ZDM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bf48102af720eca3555e8feccd6f85d1ef43e6d3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bf48102af720eca3555e8feccd6f85d1ef43e6d3",
      "tree": {
        "sha": "19957735878fac651500183d9b59a43f1c4b0494",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/19957735878fac651500183d9b59a43f1c4b0494"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 19957735878fac651500183d9b59a43f1c4b0494\nparent 184159e4f30c6846cd0324ee07b59e7f8121a5ea\nauthor Andrew Toth <andrewstoth@gmail.com> 1752949714 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753061103 -0400\n\ntest: coins returned from GetCoin cannot be spent\n\nThis is already not possible for any production GetCoin\nimplementation, so this aligns tests with production code.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9lu8ACgkQYAB6/Ik4\nsBhlWg//dqkakqaUW9fYeDAJXdZ6+g+AxhbNk11ZnPC0yjJrxPVyVNIxy6i7G/YO\nSJThiqMivTTyfAAF0xjV4+fPVWW6FvJcmNS9Pty8GNrGzSSh+044jP1Pm1ZZ5XOU\n5pFquJafXwY3QmrGZipQWxXklqQfOpbRnZWzZyr7F6JCjV5J9/BVEjh5vqPe9iDF\nlyDphOdKc61ju7NXnrI4NkL8r+ZEXCuGy/osO1yDpf1esFLK6OuqmgxDPtYTjHsy\nfh2hk07/ONjqYESgOhKK1WZ4744yx99hWUlctciOXoTyd1dcWxGaytSUhQOckias\noBrQFCg/5aGcyoxqY4JniLYkm8RlRUIEJ4pu6Tf0WfyN4zOWHx65dzUOhI7IFt9/\nXqFU1jCVjglj9aQvOEssQIBz6UkISer6VTf9kBr1wS/O/3e3/7HIzAODtWKIynFn\n928kRPJVrbp8FmqRizrsBrybmkWK/m5n8t4LdXDbvXUIf3gtch1YVUN51AZUSgtW\nUbOV4goHFxJshlijtMBGkfo+Bl9wgK5YmTwHSOd8siNQyHn7uXNu92TMBeQLZdFv\nWaPePG1QTcl/f2PT/J1wUAHiU74d6t6WecJksH/DecQOD3Qvn4F32sfh+Ztp6f4H\nLu1WnCa8NtvEaSpO134ULJWl0pHH+/7KFbmolrNKO8SARIXeMSY=\n=cLmK\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/184159e4f30c6846cd0324ee07b59e7f8121a5ea",
          "sha": "184159e4f30c6846cd0324ee07b59e7f8121a5ea",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/184159e4f30c6846cd0324ee07b59e7f8121a5ea"
        }
      ],
      "message": "test: coins returned from GetCoin cannot be spent\n\nThis is already not possible for any production GetCoin\nimplementation, so this aligns tests with production code.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:25:03Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-19T18:28:34Z"
      },
      "sha": "bf48102af720eca3555e8feccd6f85d1ef43e6d3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQyODFhNDg3YTIxYjM2MDYyOTUyYmFkNDU3NzFiY2U4MjE3NzEwNGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4281a487a21b36062952bad45771bce82177104f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4281a487a21b36062952bad45771bce82177104f",
      "tree": {
        "sha": "5d38c27daeaf8ce5b0fb26aa90166c9179371c5a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5d38c27daeaf8ce5b0fb26aa90166c9179371c5a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5d38c27daeaf8ce5b0fb26aa90166c9179371c5a\nparent bf48102af720eca3555e8feccd6f85d1ef43e6d3\nauthor Andrew Toth <andrewstoth@gmail.com> 1753033832 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753061103 -0400\n\ncoins: remove SetFresh in FetchCoin\n\nThis is the only place in production code where SetFresh is called\nwhen not preceded by SetDirty.\nWe can see that coin is retrieved from base->GetCoin, and base can\nonly be another CCoinsViewCache or CCoinsViewDB.\nCCoinsViewCache::GetCoin does not return spent coins, and CCoinsViewDB\ndoes not store any spent coins to return.\nThus, we can conclude that this call to SetFresh is dead code and can\nbe safely removed.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9lu8ACgkQYAB6/Ik4\nsBggFQ//WyvpVvUYMQrgzSLRGiKiRiBqyRV+aAlNBmDuTComNMafKaovsvfHb0QB\nsWgg4o4CdHoGrP6vTZE4wnuzxJY1ujYqpdsvp7r5SugZCUxrRFa0CZ4V96vKYG1Q\ngjXr8EJt5q8D5QFMOrg6pDkfrKgt1FYBcEprX+xUdCOMwFkcoAZN1LjlgGV9QNNJ\nQOrzxDz5lK3l2yTHtB3wWEjrTSCi7TV1QcoCq41q9lGmgzlJbG5qKhVWk7AzBqh3\nx9Ff74T498aRSeO2AHZyfEUIDgec4mguJXAJdG7BrdCyyHvqRviHNyK1jcCeo//H\nFt0hRgLuOn3weljUdgORBWJPEf1ItzJBUC20oz3GHU/N27a3Gytbr/wHqXeLJI0Q\nKkTEOEssMNlGpOFj1QhyagSGweTT4xFslmWvMRdAC2tOCCrflpfOhQHCdpXKurpn\nG2EjcdaSHUuFLo3SdI0APVGfnRyeQc+rV+leGNv11Cm/Xp86t/j90Dwwn/kbCVtc\nbTPDuH3qGwv784AfvNiMinE4O1znbTDU9p1WkKJOFzmS9pVjxj209y03SMuNgOB5\n1eeUOBVL81n/Sa7S5K/VmWrN0O8dXZTEA2DttCdhziTwt+cytd/VwrirSjwGHX8Y\nPqZiQift1Z+s4p8YHRMoeN6LZw91isCwYZWDkGf4p9sVC+wyeb0=\n=18hj\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bf48102af720eca3555e8feccd6f85d1ef43e6d3",
          "sha": "bf48102af720eca3555e8feccd6f85d1ef43e6d3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bf48102af720eca3555e8feccd6f85d1ef43e6d3"
        }
      ],
      "message": "coins: remove SetFresh in FetchCoin\n\nThis is the only place in production code where SetFresh is called\nwhen not preceded by SetDirty.\nWe can see that coin is retrieved from base->GetCoin, and base can\nonly be another CCoinsViewCache or CCoinsViewDB.\nCCoinsViewCache::GetCoin does not return spent coins, and CCoinsViewDB\ndoes not store any spent coins to return.\nThus, we can conclude that this call to SetFresh is dead code and can\nbe safely removed.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:25:03Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:50:32Z"
      },
      "sha": "4281a487a21b36062952bad45771bce82177104f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY2ZDFlNTZjZTEzODcwMWNlZmI0MDRkZWE0YWNkZjJjNjYyODcyMWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f6d1e56ce138701cefb404dea4acdf2c6628721f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f6d1e56ce138701cefb404dea4acdf2c6628721f",
      "tree": {
        "sha": "4412ff15d2a70e88bba1e5335e20679ea5ee6645",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4412ff15d2a70e88bba1e5335e20679ea5ee6645"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 4412ff15d2a70e88bba1e5335e20679ea5ee6645\nparent 4281a487a21b36062952bad45771bce82177104f\nauthor Andrew Toth <andrewstoth@gmail.com> 1753033959 -0400\ncommitter Andrew Toth <andrewstoth@gmail.com> 1753061103 -0400\n\ntest: remove FRESH-but-not-DIRTY state from coins_tests\n\nThe FRESH-but-not-DIRTY state cannot occur in production code.\nThere are never any calls to SetFresh not preceded by SetDirty.\nWe should remove these test cases to simplify the test code and\nbetter align it with production code.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEISytpz6vNK/yCogaYAB6/Ik4sBgFAmh9lvAACgkQYAB6/Ik4\nsBgi6w//TjA05SRD7Hgna4cS/Pv2Y3VX3frbhfgSJ5GzQU9wC6c9ijbXqmEXT1w1\nUvJeYxutTQy7Lx1adW7jBIMF1XIm/H4hu322F9d9p4gHvWvtvdRJfeiHDIK8gezs\nDTW4vt0y2ZiSzySzNnkoiEcLUP6tE+ZXXvLZ8ZBlMAxyPU/1Itn/kZxFoYksX9U6\nAAvixEXs6aHlxrscdkSi3zQr8mPJ1Lyc17kW/M5V1P0twnxQ6aVtUzNThpizJMOh\nlZpRh+30/gtzkf2rX95VCU8I5eRBpsvhHTR7+oVNLXa3io2XxhoCz/8N7WUP2F4z\nEsiIJoq1KN5CU/yBy6Qw5qijJh9rxGapOUmvdu6n+ACTgVSLgf954pimPRozbG6v\nGoTZwp9wX3lsE5GV/2//d7qJmniX7hZp+7XKCY4XmLGfKhlyB2wqtuDH0VigioHr\nfn2NkYHAZqDDDvKlB/WvMcLAYYaFxhhsTQDIj/dd/dKScMTw5hlUomHWMDdwmbnZ\nQjOpyD3Sxel7YaiGoVn2In9bguKipcr+u/4wJcUi6GhL8LbmipJb2s77sN6/TVsV\nrc6IEVtJBGQoB1nkBHU1nlsDTzvGXQkn7NcRFbMr0Gnv1C9rYQRw5PK3E9CRu81y\nTz+keXZZjWcnl0U6HtsHlXUPGKk8lHQxavJTn7b3Jj6z0sFIjhs=\n=r00M\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4281a487a21b36062952bad45771bce82177104f",
          "sha": "4281a487a21b36062952bad45771bce82177104f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4281a487a21b36062952bad45771bce82177104f"
        }
      ],
      "message": "test: remove FRESH-but-not-DIRTY state from coins_tests\n\nThe FRESH-but-not-DIRTY state cannot occur in production code.\nThere are never any calls to SetFresh not preceded by SetDirty.\nWe should remove these test cases to simplify the test code and\nbetter align it with production code.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:25:03Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:52:39Z"
      },
      "sha": "f6d1e56ce138701cefb404dea4acdf2c6628721f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBkYThkNGI2MmYzZTJkZWI4ZjUwMDlmZjU0YzFkNTkzZWQyYzEyODc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0da8d4b62f3e2deb8f5009ff54c1d593ed2c1287",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0da8d4b62f3e2deb8f5009ff54c1d593ed2c1287",
      "tree": {
        "sha": "1359967b1cec2907a48d81ad62f68706636e7329",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1359967b1cec2907a48d81ad62f68706636e7329"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f6d1e56ce138701cefb404dea4acdf2c6628721f",
          "sha": "f6d1e56ce138701cefb404dea4acdf2c6628721f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f6d1e56ce138701cefb404dea4acdf2c6628721f"
        }
      ],
      "message": "test: always call SanityCheck for coins_tests\n\nWe can re-enable this everywhere since we removed invalid\nFRESH-but-not-DIRTY states.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:25:49Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:20:50Z"
      },
      "sha": "0da8d4b62f3e2deb8f5009ff54c1d593ed2c1287"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZlZmZiODdhMTZlMzMzMTBmYzU2ZmQzNmZlNWNjYjU3MzA5Y2M1YWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6effb87a16e33310fc56fd36fe5ccb57309cc5ac",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6effb87a16e33310fc56fd36fe5ccb57309cc5ac",
      "tree": {
        "sha": "adebbcad7c07f63ce808aeb9d5e35226c01a5391",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/adebbcad7c07f63ce808aeb9d5e35226c01a5391"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0da8d4b62f3e2deb8f5009ff54c1d593ed2c1287",
          "sha": "0da8d4b62f3e2deb8f5009ff54c1d593ed2c1287",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0da8d4b62f3e2deb8f5009ff54c1d593ed2c1287"
        }
      ],
      "message": "test: assert no FRESH-but-not-DIRTY coins can occur",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:25:49Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T17:55:47Z"
      },
      "sha": "6effb87a16e33310fc56fd36fe5ccb57309cc5ac"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDllN2JiMWY2Mjc1N2Q2OTYwNTFjYWE0NDNhNGExYjlhMzFmMmI2MmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9e7bb1f62757d696051caa443a4a1b9a31f2b62a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9e7bb1f62757d696051caa443a4a1b9a31f2b62a",
      "tree": {
        "sha": "0b75dabb7428109902ad3b8114993cfb450a5516",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0b75dabb7428109902ad3b8114993cfb450a5516"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6effb87a16e33310fc56fd36fe5ccb57309cc5ac",
          "sha": "6effb87a16e33310fc56fd36fe5ccb57309cc5ac",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6effb87a16e33310fc56fd36fe5ccb57309cc5ac"
        }
      ],
      "message": "coins: remove SetFresh method from CCoinsCacheEntry\n\nThere are no instances where SetFresh is called without being\npreceded by SetDirty. This replaces SetFresh with a boolean flag\npassed to SetDirty to indicate whether the DIRTY coin should also\nbe set to FRESH. This removes the possibility of setting a\nFRESH-but-not-DIRTY cached coin state.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:25:49Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T18:06:12Z"
      },
      "sha": "9e7bb1f62757d696051caa443a4a1b9a31f2b62a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk1ZjBmZjA2YjkxMWRkNzdmNGRlZDk3ZGZiNWI4MTU1YjhlN2IzZWY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "tree": {
        "sha": "8b22626347a5639e7acc909658788f52616c85c7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8b22626347a5639e7acc909658788f52616c85c7"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9e7bb1f62757d696051caa443a4a1b9a31f2b62a",
          "sha": "9e7bb1f62757d696051caa443a4a1b9a31f2b62a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9e7bb1f62757d696051caa443a4a1b9a31f2b62a"
        }
      ],
      "message": "coins: inline CCoinsViewCache::AddFlags into SetDirty\n\nThere is only one callsite now for AddFlags, so we can inline\nit into SetDirty.",
      "committer": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-21T01:25:49Z"
      },
      "author": {
        "name": "Andrew Toth",
        "email": "andrewstoth@gmail.com",
        "date": "2025-07-20T18:09:01Z"
      },
      "sha": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18719180874,
      "node_id": "HRFPE_lADOABII587Bc6GezwAAAARbwAhK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18719180874",
      "actor": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "commit_url": "https://api.github.com/repos/andrewtoth/bitcoin/commits/95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "created_at": "2025-07-21T01:28:49Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920312",
      "pull_request_review_id": 3036128101,
      "id": 2217920312,
      "node_id": "PRRC_kwDOABII586EMsc4",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We should be able to remove `HaveCoin` now, since\r\n```C++\r\nbool CCoinsView::HaveCoin(const COutPoint &outpoint) const\r\n{\r\n    return GetCoin(outpoint).has_value();\r\n}\r\n```\r\nis more accurate (especially with the new extra assert)",
      "created_at": "2025-07-20T19:01:06Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920312",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920312"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920379",
      "pull_request_review_id": 3036128101,
      "id": 2217920379,
      "node_id": "PRRC_kwDOABII586EMsd7",
      "diff_hunk": "@@ -51,10 +51,6 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n         if (auto coin{base->GetCoin(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-            if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins",
      "path": "src/coins.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Now that we've removed it we should at least add an `Assume(!ret->second.coin.IsSpent());` here - or even an `assert`, since if we're not sure about this we shouldn't do it in the first place",
      "created_at": "2025-07-20T19:01:26Z",
      "updated_at": "2025-07-20T19:26:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920379",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920379"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920517",
      "pull_request_review_id": 3036128101,
      "id": 2217920517,
      "node_id": "PRRC_kwDOABII586EMsgF",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I understand if you think it may modify too many things here, but I'd prefer an actual `Assume` instead of the comment:\r\n```suggestion\r\n    CoinsCachePair* Next() const noexcept\r\n    {\r\n        Assume(IsDirty());\r\n        return m_next;\r\n    }\r\n```\r\n\r\n(same for `Prev`)",
      "created_at": "2025-07-20T19:02:06Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920517",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920517"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920827",
      "pull_request_review_id": 3036128101,
      "id": 2217920827,
      "node_id": "PRRC_kwDOABII586EMsk7",
      "diff_hunk": "@@ -121,21 +121,6 @@ struct CCoinsCacheEntry\n     CoinsCachePair* m_next{nullptr};\n     uint8_t m_flags{0};\n \n-    //! Adding a flag requires a reference to the sentinel of the flagged pair linked list.\n-    static void AddFlags(uint8_t flags, CoinsCachePair& pair, CoinsCachePair& sentinel) noexcept\n-    {\n-        Assume(flags & (DIRTY | FRESH));",
      "path": "src/coins.h",
      "position": 35,
      "original_position": 7,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "we might want to mention in the commit message why we can safely remove this now",
      "created_at": "2025-07-20T19:03:03Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217920827",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217920827"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 134,
      "original_line": 134,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921211",
      "pull_request_review_id": 3036128101,
      "id": 2217921211,
      "node_id": "PRRC_kwDOABII586EMsq7",
      "diff_hunk": "@@ -169,7 +154,16 @@ struct CCoinsCacheEntry\n \n     static void SetDirty(CoinsCachePair& pair, CoinsCachePair& sentinel, bool fresh = false) noexcept\n     {\n-        AddFlags(fresh ? DIRTY | FRESH : DIRTY, pair, sentinel);\n+        if (!pair.second.m_flags) {\n+            Assume(!pair.second.m_prev && !pair.second.m_next);\n+            pair.second.m_prev = sentinel.second.m_prev;\n+            pair.second.m_next = &sentinel;\n+            sentinel.second.m_prev = &pair;\n+            pair.second.m_prev->second.m_next = &pair;\n+        }\n+        Assume(pair.second.m_prev && pair.second.m_next);\n+        pair.second.m_flags |= DIRTY;\n+        if (fresh) pair.second.m_flags |= FRESH;",
      "path": "src/coins.h",
      "position": 67,
      "original_position": 36,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "What should happen when `fresh` is `false`?\r\nShouldn't we assert something like:\r\n```C++\r\nif (fresh) {\r\n    pair.second.m_flags |= FRESH; \r\n} else {\r\n    assert(!(pair.second.m_flags & FRESH));\r\n}",
      "created_at": "2025-07-20T19:04:30Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217921211",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921211"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 166,
      "original_line": 166,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921830",
      "pull_request_review_id": 3036128101,
      "id": 2217921830,
      "node_id": "PRRC_kwDOABII586EMs0m",
      "diff_hunk": "@@ -154,16 +154,16 @@ BOOST_AUTO_TEST_CASE(linked_list_set_state)\n     BOOST_CHECK_EQUAL(sentinel.second.Next(), &n1);\n     BOOST_CHECK_EQUAL(sentinel.second.Prev(), &n1);\n \n-    // Check that setting FRESH on new node inserts it after n1\n-    CCoinsCacheEntry::SetFresh(n2, sentinel);\n-    BOOST_CHECK(n2.second.IsFresh() && !n2.second.IsDirty());\n+    // Check that setting DIRTY and FRESH on new node inserts it after n1\n+    CCoinsCacheEntry::SetDirty(n2, sentinel, /*fresh=*/true);\n+    BOOST_CHECK(n2.second.IsFresh() && n2.second.IsDirty());",
      "path": "src/test/coinscachepair_tests.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: for consistency with other `SetDirty` calls we could swap the parameter order:\r\n```suggestion\r\n    BOOST_CHECK(n2.second.IsDirty() && n2.second.IsFresh());\r\n```\r\n\r\n----\r\n\r\nAlternatively we could rename `IsFresh` to `IsDirtyAndFresh` and assert that if fresh is true, so is dirty - which would simplify this line to asserting just a single method.",
      "created_at": "2025-07-20T19:06:43Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217921830",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217921830"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 159,
      "original_line": 159,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922071",
      "pull_request_review_id": 3036128101,
      "id": 2217922071,
      "node_id": "PRRC_kwDOABII586EMs4X",
      "diff_hunk": "@@ -150,8 +150,7 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                         coins_cache_entry.coin = *opt_coin;\n                     }\n                     auto it{coins_map.emplace(random_out_point, std::move(coins_cache_entry)).first};\n-                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel);\n-                    if (fresh) CCoinsCacheEntry::SetFresh(*it, sentinel);\n+                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel, fresh);",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 15,
      "original_position": 6,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "definition of `fresh` should likely include `dirty` now:\r\n```C++\r\nconst auto fresh{dirty && fuzzed_data_provider.ConsumeBool()};\r\n```",
      "created_at": "2025-07-20T19:07:45Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217922071",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922071"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 153,
      "original_line": 153,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922169",
      "pull_request_review_id": 3036128101,
      "id": 2217922169,
      "node_id": "PRRC_kwDOABII586EMs55",
      "diff_hunk": "@@ -102,47 +102,25 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.",
      "path": "src/coins.h",
      "position": null,
      "original_position": 15,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n     * A flagged entry is any entry that is DIRTY or DIRTY-and-FRESH.\r\n```\r\n(the or/and combination is confusing otherwise)",
      "created_at": "2025-07-20T19:08:14Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217922169",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217922169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217923008",
      "pull_request_review_id": 3036128101,
      "id": 2217923008,
      "node_id": "PRRC_kwDOABII586EMtHA",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: for consistency with other overrides:\r\n```suggestion\r\n        if (auto it{m_data.find(outpoint)}; it != m_data.end()) {\r\n```",
      "created_at": "2025-07-20T19:10:42Z",
      "updated_at": "2025-07-20T19:20:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217923008",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217923008"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217925887",
      "pull_request_review_id": 3036128101,
      "id": 2217925887,
      "node_id": "PRRC_kwDOABII586EMtz_",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "great, now that we have this, can we call `SanityCheck` in more tests? I understood that we couldn't do it until now since we still had invalid states in fuzz/unit tests",
      "created_at": "2025-07-20T19:17:42Z",
      "updated_at": "2025-07-20T19:27:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2217925887",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2217925887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218040983",
      "pull_request_review_id": 3036282843,
      "id": 2218040983,
      "node_id": "PRRC_kwDOABII586ENJ6X",
      "diff_hunk": "@@ -203,11 +198,10 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n                     entry.coin = it->second.coin;\n                 }\n                 cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                CCoinsCacheEntry::SetDirty(*itUs, m_sentinel);",
      "path": "src/coins.cpp",
      "position": 26,
      "original_position": 25,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "note: the cursor contains dirty entries now, so `if (!it->second.IsDirty()) {` on line 186 is also a noop - could we add a TODO there to signal that we're aware of it but want to tackle it in a follow-up?",
      "created_at": "2025-07-21T01:11:45Z",
      "updated_at": "2025-07-21T01:11:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218040983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218040983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 206,
      "original_line": 206,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050169",
      "pull_request_review_id": 3036298262,
      "id": 2218050169,
      "node_id": "PRRC_kwDOABII586ENMJ5",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:29:05Z",
      "updated_at": "2025-07-21T01:29:05Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050169",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050169"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050233",
      "pull_request_review_id": 3036298324,
      "id": 2218050233,
      "node_id": "PRRC_kwDOABII586ENMK5",
      "diff_hunk": "@@ -51,10 +51,6 @@ CCoinsMap::iterator CCoinsViewCache::FetchCoin(const COutPoint &outpoint) const\n         if (auto coin{base->GetCoin(outpoint)}) {\n             ret->second.coin = std::move(*coin);\n             cachedCoinsUsage += ret->second.coin.DynamicMemoryUsage();\n-            if (ret->second.coin.IsSpent()) { // TODO GetCoin cannot return spent coins",
      "path": "src/coins.cpp",
      "position": 4,
      "original_position": 4,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920379,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:29:13Z",
      "updated_at": "2025-07-21T01:29:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050233",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050233"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050997",
      "pull_request_review_id": 3036299636,
      "id": 2218050997,
      "node_id": "PRRC_kwDOABII586ENMW1",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't see how that is different. `m_flags` being set implies `IsDirty()` now, so it is equivalent. I prefer not to change this.",
      "created_at": "2025-07-21T01:30:06Z",
      "updated_at": "2025-07-21T01:30:07Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218050997",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218050997"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218053411",
      "pull_request_review_id": 3036303265,
      "id": 2218053411,
      "node_id": "PRRC_kwDOABII586ENM8j",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`Assume(m_flags);` would also be true for fresh only - `Assume(IsDirty());` is stricter",
      "created_at": "2025-07-21T01:34:38Z",
      "updated_at": "2025-07-21T01:37:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218053411",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218053411"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218054579",
      "pull_request_review_id": 3036305261,
      "id": 2218054579,
      "node_id": "PRRC_kwDOABII586ENNOz",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {\n+            assert(!it->second.IsSpent());\n+            return it->second;\n+        }\n         return std::nullopt;\n     }\n ",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": 21,
      "original_position": 21,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920312,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Isn't that the same as the parent in `CCoinsView`?",
      "created_at": "2025-07-21T01:37:04Z",
      "updated_at": "2025-07-21T01:37:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218054579",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218054579"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 155,
      "original_line": 155,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218061776",
      "pull_request_review_id": 3036316470,
      "id": 2218061776,
      "node_id": "PRRC_kwDOABII586ENO_Q",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It's not possible to set fresh only now.",
      "created_at": "2025-07-21T01:47:42Z",
      "updated_at": "2025-07-21T01:47:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218061776",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218061776"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218064237",
      "pull_request_review_id": 3036320785,
      "id": 2218064237,
      "node_id": "PRRC_kwDOABII586ENPlt",
      "diff_hunk": "@@ -188,14 +177,14 @@ struct CCoinsCacheEntry\n     bool IsDirty() const noexcept { return m_flags & DIRTY; }\n     bool IsFresh() const noexcept { return m_flags & FRESH; }\n \n-    //! Only call Next when this entry is DIRTY, FRESH, or both\n+    //! Only call Next when this entry is DIRTY or DIRTY-and-FRESH\n     CoinsCachePair* Next() const noexcept\n     {\n         Assume(m_flags);",
      "path": "src/coins.h",
      "position": 80,
      "original_position": 80,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217920517,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Exactly, hence my recommendation ",
      "created_at": "2025-07-21T01:51:53Z",
      "updated_at": "2025-07-21T01:51:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218064237",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218064237"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": 180,
      "original_start_line": 180,
      "start_side": "RIGHT",
      "line": 183,
      "original_line": 183,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218067867",
      "pull_request_review_id": 3036325893,
      "id": 2218067867,
      "node_id": "PRRC_kwDOABII586ENQeb",
      "diff_hunk": "@@ -102,47 +102,25 @@ using CoinsCachePair = std::pair<const COutPoint, CCoinsCacheEntry>;\n  * - unspent, FRESH, DIRTY (e.g. a new coin created in the cache)\n  * - unspent, not FRESH, DIRTY (e.g. a coin changed in the cache during a reorg)\n  * - unspent, not FRESH, not DIRTY (e.g. an unspent coin fetched from the parent cache)\n- * - spent, FRESH, not DIRTY (e.g. a spent coin fetched from the parent cache)\n  * - spent, not FRESH, DIRTY (e.g. a coin is spent and spentness needs to be flushed to the parent)\n  */\n struct CCoinsCacheEntry\n {\n private:\n     /**\n      * These are used to create a doubly linked list of flagged entries.\n-     * They are set in SetDirty, SetFresh, and unset in SetClean.\n-     * A flagged entry is any entry that is either DIRTY, FRESH, or both.\n+     * They are set in SetDirty and unset in SetClean.\n+     * A flagged entry is any entry that is DIRTY or DIRTY and FRESH.",
      "path": "src/coins.h",
      "position": null,
      "original_position": 15,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217922169,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:56:35Z",
      "updated_at": "2025-07-21T01:56:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218067867",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218067867"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068273",
      "pull_request_review_id": 3036326661,
      "id": 2218068273,
      "node_id": "PRRC_kwDOABII586ENQkx",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We can't since we are still calling this with spent, dirty, and fresh entries. These would be deleted in production code. That can also be tackled in a follow-up.",
      "created_at": "2025-07-21T01:57:14Z",
      "updated_at": "2025-07-21T01:57:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068273",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068273"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068575",
      "pull_request_review_id": 3036327280,
      "id": 2218068575,
      "node_id": "PRRC_kwDOABII586ENQpf",
      "diff_hunk": "@@ -203,11 +198,10 @@ bool CCoinsViewCache::BatchWrite(CoinsViewCacheCursor& cursor, const uint256 &ha\n                     entry.coin = it->second.coin;\n                 }\n                 cachedCoinsUsage += entry.coin.DynamicMemoryUsage();\n-                CCoinsCacheEntry::SetDirty(*itUs, m_sentinel);",
      "path": "src/coins.cpp",
      "position": 26,
      "original_position": 25,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2218040983,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "There are quite a few places where we can clean up production and test logic to not have to deal with non-dirty entries in BatchWrite. I think there would be too many TODOs.",
      "created_at": "2025-07-21T01:57:47Z",
      "updated_at": "2025-07-21T01:57:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068575",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068575"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 206,
      "original_line": 206,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068664",
      "pull_request_review_id": 3036327359,
      "id": 2218068664,
      "node_id": "PRRC_kwDOABII586ENQq4",
      "diff_hunk": "@@ -148,8 +146,10 @@ class CoinsViewBottom final : public CCoinsView\n public:\n     std::optional<Coin> GetCoin(const COutPoint& outpoint) const final\n     {\n-        // TODO GetCoin shouldn't return spent coins\n-        if (auto it = m_data.find(outpoint); it != m_data.end()) return it->second;\n+        if (auto it = m_data.find(outpoint); it != m_data.end()) {",
      "path": "src/test/fuzz/coinscache_sim.cpp",
      "position": null,
      "original_position": 15,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217923008,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:57:54Z",
      "updated_at": "2025-07-21T01:57:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218068664",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218068664"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 149,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069073",
      "pull_request_review_id": 3036328308,
      "id": 2218069073,
      "node_id": "PRRC_kwDOABII586ENQxR",
      "diff_hunk": "@@ -321,8 +315,8 @@ void CCoinsViewCache::SanityCheck() const\n         if (entry.IsDirty()) attr |= 1;\n         if (entry.IsFresh()) attr |= 2;\n         if (entry.coin.IsSpent()) attr |= 4;\n-        // Only 5 combinations are possible.\n-        assert(attr != 2 && attr != 4 && attr != 7);\n+        // Only 4 combinations are possible.\n+        assert(attr != 2 && attr != 4 && attr != 6 && attr != 7);",
      "path": "src/coins.cpp",
      "position": 42,
      "original_position": 41,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217925887,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "You did enable it for a few additional cases, that's already a win 👍 ",
      "created_at": "2025-07-21T01:59:02Z",
      "updated_at": "2025-07-21T01:59:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218069073",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069073"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 320,
      "original_line": 320,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069128",
      "pull_request_review_id": 3036328369,
      "id": 2218069128,
      "node_id": "PRRC_kwDOABII586ENQyI",
      "diff_hunk": "@@ -150,8 +150,7 @@ void TestCoinsView(FuzzedDataProvider& fuzzed_data_provider, CCoinsView& backend\n                         coins_cache_entry.coin = *opt_coin;\n                     }\n                     auto it{coins_map.emplace(random_out_point, std::move(coins_cache_entry)).first};\n-                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel);\n-                    if (fresh) CCoinsCacheEntry::SetFresh(*it, sentinel);\n+                    if (dirty) CCoinsCacheEntry::SetDirty(*it, sentinel, fresh);",
      "path": "src/test/fuzz/coins_view.cpp",
      "position": 15,
      "original_position": 6,
      "commit_id": "95f0ff06b911dd77f4ded97dfb5b8155b8e7b3ef",
      "original_commit_id": "8eb06adaaae4534b31aba0a4d0e4862b72f5c310",
      "in_reply_to_id": 2217922071,
      "user": {
        "login": "andrewtoth",
        "id": 237213,
        "node_id": "MDQ6VXNlcjIzNzIxMw==",
        "avatar_url": "https://avatars.githubusercontent.com/u/237213?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/andrewtoth",
        "html_url": "https://github.com/andrewtoth",
        "followers_url": "https://api.github.com/users/andrewtoth/followers",
        "following_url": "https://api.github.com/users/andrewtoth/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/andrewtoth/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/andrewtoth/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/andrewtoth/subscriptions",
        "organizations_url": "https://api.github.com/users/andrewtoth/orgs",
        "repos_url": "https://api.github.com/users/andrewtoth/repos",
        "events_url": "https://api.github.com/users/andrewtoth/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/andrewtoth/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-07-21T01:59:08Z",
      "updated_at": "2025-07-21T01:59:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33018#discussion_r2218069128",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2218069128"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33018"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 153,
      "original_line": 153,
      "side": "RIGHT"
    }
  ]
}