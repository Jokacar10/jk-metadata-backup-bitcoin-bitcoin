{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597",
    "id": 2538516709,
    "node_id": "PR_kwDOABII586XTrDl",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32597",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32597.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32597.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32597",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32597/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/47237cd1938058b29fdec242c3a37611e255fda0",
    "number": 32597,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "wallet: Always set descriptor cache upgraded flag for new wallets",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Newly created wallets will always have an upgraded descriptor cache, so set those.\r\n\r\nAlso, to verify this behavior, add a new `flags` field to `getwalletinfo` and check that in the functional tests.\r\n\r\nSplit from #32489",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      }
    ],
    "created_at": "2025-05-23T00:39:49Z",
    "updated_at": "2025-07-08T13:47:40Z",
    "closed_at": "2025-06-25T20:15:00Z",
    "mergeable_state": "unknown",
    "merged": true,
    "merged_at": "2025-06-25T20:15:00Z",
    "merged_by": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "merge_commit_sha": "8578fabb95face25d9fa7dfaad38d0a2857c2481",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "head": {
      "label": "achow101:desc-cache-is-upgraded",
      "ref": "desc-cache-is-upgraded",
      "sha": "47237cd1938058b29fdec242c3a37611e255fda0",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 45006379,
        "node_id": "MDEwOlJlcG9zaXRvcnk0NTAwNjM3OQ==",
        "name": "bitcoin",
        "full_name": "achow101/bitcoin",
        "owner": {
          "login": "achow101",
          "id": 3782274,
          "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
          "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/achow101",
          "html_url": "https://github.com/achow101",
          "followers_url": "https://api.github.com/users/achow101/followers",
          "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
          "organizations_url": "https://api.github.com/users/achow101/orgs",
          "repos_url": "https://api.github.com/users/achow101/repos",
          "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/achow101/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/achow101/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/achow101/bitcoin",
        "archive_url": "https://api.github.com/repos/achow101/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/achow101/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/achow101/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/achow101/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/achow101/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/achow101/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/achow101/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/achow101/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/achow101/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/achow101/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/achow101/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/achow101/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/achow101/bitcoin/events",
        "forks_url": "https://api.github.com/repos/achow101/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/achow101/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/achow101/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/achow101/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/achow101/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/achow101/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/achow101/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/achow101/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/achow101/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/achow101/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/achow101/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/achow101/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/achow101/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/achow101/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/achow101/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/achow101/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:achow101/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/achow101/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/achow101/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/achow101/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/achow101/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/achow101/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/achow101/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/achow101/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/achow101/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/achow101/bitcoin/hooks",
        "svn_url": "https://github.com/achow101/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 10,
        "stargazers_count": 42,
        "watchers_count": 42,
        "size": 301695,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-07-07T23:14:42Z",
        "created_at": "2015-10-27T00:20:28Z",
        "updated_at": "2025-05-11T17:20:16Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "2df824f4e62b6bc569044819cd64f66f3839ba13",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37494,
        "stargazers_count": 84461,
        "watchers_count": 84461,
        "size": 288844,
        "default_branch": "master",
        "open_issues_count": 742,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-07-08T09:38:01Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-07-08T13:43:52Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 53,
    "deletions": 12,
    "changed_files": 5,
    "commits": 3,
    "review_comments": 7,
    "comments": 4
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY5ZjU4OGE5OWE3YTc5ZDFkNzIzMDBiYzBmMmM4NDc1Zjk1ZjZjNmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "tree": {
        "sha": "fa5d0c46d6079ead670a8fd463e790644b15397b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fa5d0c46d6079ead670a8fd463e790644b15397b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2df824f4e62b6bc569044819cd64f66f3839ba13",
          "sha": "2df824f4e62b6bc569044819cd64f66f3839ba13",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2df824f4e62b6bc569044819cd64f66f3839ba13"
        }
      ],
      "message": "wallet: Set upgraded descriptor cache flag for newly created wallets\n\nAlthough WalletBatch::LoadWallet performs the descriptor cache upgrade,\nbecause new wallets do not have the descriptor flag set yet, the upgrade\ndoes not run and set the flag.\n\nSince new wallets will always being using the upgraded cache, there's no\nreason to wait to set the flag, so set it when the wallet flags are\nbeing initialized for new wallets.",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-05-23T00:36:32Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-05-13T21:33:45Z"
      },
      "sha": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJjMmEyNmIyOTYyMzhjYmVhZDYwMTJjMDcxYmM3NzQxYzQwZmJkMDI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bc2a26b296238cbead6012c071bc7741c40fbd02",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bc2a26b296238cbead6012c071bc7741c40fbd02",
      "tree": {
        "sha": "71a266573d38de2fcd26e2d2cb041eff1442e403",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/71a266573d38de2fcd26e2d2cb041eff1442e403"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
          "sha": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/69f588a99a7a79d1d72300bc0f2c8475f95f6c6a"
        }
      ],
      "message": "wallet: Add GetWalletFlags",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-05-23T00:37:41Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-05-12T21:00:28Z"
      },
      "sha": "bc2a26b296238cbead6012c071bc7741c40fbd02"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ3MjM3Y2QxOTM4MDU4YjI5ZmRlYzI0MmMzYTM3NjExZTI1NWZkYTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/47237cd1938058b29fdec242c3a37611e255fda0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/47237cd1938058b29fdec242c3a37611e255fda0",
      "tree": {
        "sha": "49955501e9d370fce5ec5968d37191b5f9fb7ac0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/49955501e9d370fce5ec5968d37191b5f9fb7ac0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bc2a26b296238cbead6012c071bc7741c40fbd02",
          "sha": "bc2a26b296238cbead6012c071bc7741c40fbd02",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bc2a26b296238cbead6012c071bc7741c40fbd02"
        }
      ],
      "message": "wallet, rpc: Output wallet flags in getwalletinfo",
      "committer": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-05-23T00:37:41Z"
      },
      "author": {
        "name": "Ava Chow",
        "email": "github@achow101.com",
        "date": "2025-05-23T00:29:21Z"
      },
      "sha": "47237cd1938058b29fdec242c3a37611e255fda0"
    },
    {
      "event": "commented",
      "id": 2902953826,
      "node_id": "IC_kwDOABII586tB49i",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2902953826",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-23T00:39:52Z",
      "updated_at": "2025-06-17T19:31:37Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32597.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [Sjors](https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-2944074815), [w0xlt](https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2918828047), [rkrux](https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2936775302) |\n| Concept ACK | [adyshimony](https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-2910699910) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-2902953826",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32597"
    },
    {
      "event": "labeled",
      "id": 17781432329,
      "node_id": "LE_lADOABII58633w7ZzwAAAAQj2yAJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17781432329",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-23T00:40:02Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "commented",
      "id": 2910699910,
      "node_id": "IC_kwDOABII586tfcGG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2910699910",
      "actor": {
        "login": "adyshimony",
        "id": 6388409,
        "node_id": "MDQ6VXNlcjYzODg0MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6388409?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adyshimony",
        "html_url": "https://github.com/adyshimony",
        "followers_url": "https://api.github.com/users/adyshimony/followers",
        "following_url": "https://api.github.com/users/adyshimony/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adyshimony/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adyshimony/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adyshimony/subscriptions",
        "organizations_url": "https://api.github.com/users/adyshimony/orgs",
        "repos_url": "https://api.github.com/users/adyshimony/repos",
        "events_url": "https://api.github.com/users/adyshimony/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adyshimony/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-05-26T22:16:43Z",
      "updated_at": "2025-05-28T22:42:10Z",
      "author_association": "NONE",
      "body": "ACK \r\n\r\n[47237cd](https://github.com/bitcoin/bitcoin/pull/32597/commits/47237cd1938058b29fdec242c3a37611e255fda0)\r\n\r\n<details><summary>Test details</summary>\r\n<p>\r\n\r\n\r\nManual tests:\r\n\r\n```\r\n\r\n./bitcoin-cli createwallet \"test_32597_wallet\" false false \"\" false true\r\n{\r\n  \"name\": \"test_32597_wallet\",\r\n  \"warnings\": [\r\n    \"Empty string given as passphrase, wallet will not be encrypted.\"\r\n  ]\r\n}\r\n\r\n\r\n\r\n./bitcoin-cli -rpcwallet=test_32597_wallet getwalletinfo\r\n{\r\n  \"walletname\": \"test_32597_wallet\",\r\n  \"walletversion\": 169900,\r\n  \"format\": \"sqlite\",\r\n  \"balance\": 0.00000000,\r\n  \"unconfirmed_balance\": 0.00000000,\r\n  \"immature_balance\": 0.00000000,\r\n  \"txcount\": 0,\r\n  \"keypoolsize\": 4000,\r\n  \"keypoolsize_hd_internal\": 4000,\r\n  \"paytxfee\": 0.00000000,\r\n  \"private_keys_enabled\": true,\r\n  \"avoid_reuse\": false,\r\n  \"scanning\": false,\r\n  \"descriptors\": true,\r\n  \"external_signer\": false,\r\n  \"blank\": false,\r\n  \"birthtime\": 1748289166,\r\n  \"flags\": [\r\n    \"last_hardened_xpub_cached\",\r\n    \"descriptor_wallet\"\r\n  ],\r\n  \"lastprocessedblock\": {\r\n    \"hash\": \"0000000000000000000104185d6d17742c6f4e4a7b005af0e14c55176037ad95\",\r\n    \"height\": 898492\r\n  }\r\n}\r\n```\r\n\r\nFunctional tests:\r\n\r\n```\r\nbuild/test/functional/wallet_avoidreuse.py\r\n2025-05-26T20:24:39.668000Z TestFramework (INFO): PRNG seed is: 1859031226962638324\r\n2025-05-26T20:24:39.669000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_b3fqengx\r\n2025-05-26T20:24:40.193000Z TestFramework (INFO): Test wallet files persist avoid_reuse flag\r\n2025-05-26T20:24:40.761000Z TestFramework (INFO): Test immutable wallet flags\r\n2025-05-26T20:24:42.050000Z TestFramework (INFO): Test that change doesn't turn into non-change when spent\r\n2025-05-26T20:24:42.135000Z TestFramework (INFO): Test sending from reused address with avoid_reuse=false\r\n2025-05-26T20:24:42.289000Z TestFramework (INFO): Test sending from reused legacy address fails\r\n2025-05-26T20:24:43.382000Z TestFramework (INFO): Test sending from reused p2sh-segwit address fails\r\n2025-05-26T20:24:43.452000Z TestFramework (INFO): Test sending from reused bech32 address fails\r\n2025-05-26T20:24:43.531000Z TestFramework (INFO): Test getbalances used category\r\n2025-05-26T20:24:45.734000Z TestFramework (INFO): Test that full destination groups are preferred in coin selection\r\n2025-05-26T20:24:47.031000Z TestFramework (INFO): Test that all destination groups are used\r\n2025-05-26T20:24:49.956000Z TestFramework (INFO): Stopping nodes\r\n2025-05-26T20:24:50.010000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_b3fqengx on exit\r\n2025-05-26T20:24:50.010000Z TestFramework (INFO): Tests successful\r\n```\r\n\r\n\r\n```\r\nbuild/test/functional/wallet_createwallet.py\r\n2025-05-26T20:25:07.813000Z TestFramework (INFO): PRNG seed is: 2684982768405465258\r\n2025-05-26T20:25:07.814000Z TestFramework (INFO): Initializing test directory /tmp/bitcoin_func_test_p9897jvk\r\n2025-05-26T20:25:08.134000Z TestFramework (INFO): Run createwallet with invalid parameters.\r\n2025-05-26T20:25:08.150000Z TestFramework (INFO): Test disableprivatekeys creation.\r\n2025-05-26T20:25:08.169000Z TestFramework (INFO): Test that private keys cannot be imported\r\n2025-05-26T20:25:08.182000Z TestFramework (INFO): Test blank creation with private keys disabled.\r\n2025-05-26T20:25:08.199000Z TestFramework (INFO): Test blank creation with private keys enabled.\r\n2025-05-26T20:25:08.255000Z TestFramework (INFO): Test blank creation with privkeys enabled and then encryption\r\n2025-05-26T20:25:08.691000Z TestFramework (INFO): Test blank creation with privkeys disabled and then encryption\r\n2025-05-26T20:25:08.711000Z TestFramework (INFO): New blank and encrypted wallets can be created\r\n2025-05-26T20:25:09.108000Z TestFramework (INFO): Test creating a new encrypted wallet.\r\n2025-05-26T20:25:09.547000Z TestFramework (INFO): Test making a wallet with avoid reuse flag\r\n2025-05-26T20:25:09.563000Z TestFramework (INFO): Using a passphrase with private keys disabled returns error\r\n2025-05-26T20:25:09.564000Z TestFramework (INFO): Test that legacy wallets cannot be created\r\n2025-05-26T20:25:09.565000Z TestFramework (INFO): Check that the version number is being logged correctly\r\n2025-05-26T20:25:09.658000Z TestFramework (INFO): Stopping nodes\r\n2025-05-26T20:25:09.810000Z TestFramework (INFO): Cleaning up /tmp/bitcoin_func_test_p9897jvk on exit\r\n2025-05-26T20:25:09.810000Z TestFramework (INFO): Tests successful\r\n\r\n```\r\n\r\nbitcoin-cli help shows the new flags field:\r\n\r\n```\r\nbuild/bin/bitcoin-cli help getwalletinfo\r\ngetwalletinfo\r\n\r\nReturns an object containing various wallet state info.\r\n\r\nResult:\r\n{                                         (json object)\r\n  \"walletname\" : \"str\",                   (string) the wallet name\r\n  \"walletversion\" : n,                    (numeric) the wallet version\r\n  \"format\" : \"str\",                       (string) the database format (only sqlite)\r\n  \"balance\" : n,                          (numeric) DEPRECATED. Identical to getbalances().mine.trusted\r\n  \"unconfirmed_balance\" : n,              (numeric) DEPRECATED. Identical to getbalances().mine.untrusted_pending\r\n  \"immature_balance\" : n,                 (numeric) DEPRECATED. Identical to getbalances().mine.immature\r\n  \"txcount\" : n,                          (numeric) the total number of transactions in the wallet\r\n  \"keypoololdest\" : xxx,                  (numeric, optional) the UNIX epoch time of the oldest pre-generated key in the key pool. Legacy wallets only.\r\n  \"keypoolsize\" : n,                      (numeric) how many new keys are pre-generated (only counts external keys)\r\n  \"keypoolsize_hd_internal\" : n,          (numeric, optional) how many new keys are pre-generated for internal use (used for change outputs, only appears if the wallet is using this feature, otherwise external keys are used)\r\n  \"unlocked_until\" : xxx,                 (numeric, optional) the UNIX epoch time until which the wallet is unlocked for transfers, or 0 if the wallet is locked (only present for passphrase-encrypted wallets)\r\n  \"paytxfee\" : n,                         (numeric) the transaction fee configuration, set in BTC/kvB\r\n  \"private_keys_enabled\" : true|false,    (boolean) false if privatekeys are disabled for this wallet (enforced watch-only wallet)\r\n  \"avoid_reuse\" : true|false,             (boolean) whether this wallet tracks clean/dirty coins in terms of reuse\r\n  \"scanning\" : {                          (json object) current scanning details, or false if no scan is in progress\r\n    \"duration\" : n,                       (numeric) elapsed seconds since scan start\r\n    \"progress\" : n                        (numeric) scanning progress percentage [0.0, 1.0]\r\n  },\r\n  \"descriptors\" : true|false,             (boolean) whether this wallet uses descriptors for output script management\r\n  \"external_signer\" : true|false,         (boolean) whether this wallet is configured to use an external signer such as a hardware wallet\r\n  \"blank\" : true|false,                   (boolean) Whether this wallet intentionally does not contain any keys, scripts, or descriptors\r\n  \"birthtime\" : xxx,                      (numeric, optional) The start time for blocks scanning. It could be modified by (re)importing any descriptor with an earlier timestamp.\r\n  \"flags\" : [                             (json array) The flags currently set on the wallet\r\n    \"str\",                                (string) The name of the flag\r\n    ...\r\n  ],\r\n  \"lastprocessedblock\" : {                (json object) hash and height of the block this information was generated on\r\n    \"hash\" : \"hex\",                       (string) hash of the block this information was generated on\r\n    \"height\" : n                          (numeric) height of the block this information was generated on\r\n  }\r\n}\r\n\r\n```\r\n\r\n\r\n</p>\r\n</details> ",
      "user": {
        "login": "adyshimony",
        "id": 6388409,
        "node_id": "MDQ6VXNlcjYzODg0MDk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6388409?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/adyshimony",
        "html_url": "https://github.com/adyshimony",
        "followers_url": "https://api.github.com/users/adyshimony/followers",
        "following_url": "https://api.github.com/users/adyshimony/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/adyshimony/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/adyshimony/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/adyshimony/subscriptions",
        "organizations_url": "https://api.github.com/users/adyshimony/orgs",
        "repos_url": "https://api.github.com/users/adyshimony/repos",
        "events_url": "https://api.github.com/users/adyshimony/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/adyshimony/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-2910699910",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32597"
    },
    {
      "event": "reviewed",
      "id": 2872012392,
      "node_id": "PRR_kwDOABII586rL25o",
      "url": null,
      "actor": null,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, code review 69f588a99a7a79d1d72300bc0f2c8475f95f6c6a\r\n\r\n> Newly created wallets will always have an upgraded descriptor cache, so set those.\r\n\r\nBesides the logical accuracy, is there any other advantage of doing this that is used in #32489? Probably can mention it in the PR description.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2872012392",
      "submitted_at": "2025-05-27T18:04:44Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
    },
    {
      "event": "commented",
      "id": 2944074815,
      "node_id": "IC_kwDOABII586vewQ_",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2944074815",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-05T12:35:09Z",
      "updated_at": "2025-06-05T12:37:28Z",
      "author_association": "MEMBER",
      "body": "ACK 47237cd1938058b29fdec242c3a37611e255fda0\r\n\r\n> Also, to verify this behavior, add a new flags field to getwalletinfo and check that in the functional tests.\r\n\r\nI checked that reverting the first commit breaks the new tests.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-2944074815",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32597"
    },
    {
      "event": "review_requested",
      "id": 18000105939,
      "node_id": "RRE_lADOABII58633w7ZzwAAAAQw49HT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18000105939",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-05T12:35:13Z",
      "requested_reviewer": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2918828047,
      "node_id": "PRR_kwDOABII586t-cgP",
      "url": null,
      "actor": null,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK https://github.com/bitcoin/bitcoin/pull/32597/commits/47237cd1938058b29fdec242c3a37611e255fda0",
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2918828047",
      "submitted_at": "2025-06-11T21:48:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
    },
    {
      "event": "reviewed",
      "id": 2936775302,
      "node_id": "PRR_kwDOABII586vC6KG",
      "url": null,
      "actor": null,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "ACK 47237cd1938058b29fdec242c3a37611e255fda0\r\n\r\nI have verified and agree that this flag should be setup during wallet creation. The addition of the wallet flags in the RPC response in this PR is an added bonus that also closes the loop on the wallet flag integer values & their corresponding string representations.",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2936775302",
      "submitted_at": "2025-06-17T19:31:34Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
    },
    {
      "event": "merged",
      "id": 18323673248,
      "node_id": "ME_lADOABII58633w7ZzwAAAARELRCg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18323673248",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8578fabb95face25d9fa7dfaad38d0a2857c2481",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8578fabb95face25d9fa7dfaad38d0a2857c2481",
      "created_at": "2025-06-25T20:15:00Z"
    },
    {
      "event": "closed",
      "id": 18323673277,
      "node_id": "CE_lADOABII58633w7ZzwAAAARELRC9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18323673277",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-25T20:15:00Z"
    },
    {
      "event": "reviewed",
      "id": 2964165780,
      "node_id": "PRR_kwDOABII586wrZSU",
      "url": null,
      "actor": null,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "post-merge tACK 47237cd1938058b29fdec242c3a37611e255fda0\r\n\r\n> Newly created wallets will always have an upgraded descriptor cache, so set those.\r\n\r\nYes, because the other scenario when the flag is set is when (~after) the wallet is loaded (and descriptor cache is upgraded).\r\n\r\n> Also, to verify this behavior, add a new flags field to getwalletinfo and check that in the functional tests.\r\n\r\nChecked.",
      "user": {
        "login": "pablomartin4btc",
        "id": 110166421,
        "node_id": "U_kgDOBpEBlQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/110166421?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/pablomartin4btc",
        "html_url": "https://github.com/pablomartin4btc",
        "followers_url": "https://api.github.com/users/pablomartin4btc/followers",
        "following_url": "https://api.github.com/users/pablomartin4btc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/pablomartin4btc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/pablomartin4btc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/pablomartin4btc/subscriptions",
        "organizations_url": "https://api.github.com/users/pablomartin4btc/orgs",
        "repos_url": "https://api.github.com/users/pablomartin4btc/repos",
        "events_url": "https://api.github.com/users/pablomartin4btc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/pablomartin4btc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#pullrequestreview-2964165780",
      "submitted_at": "2025-06-27T00:09:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
    },
    {
      "event": "commented",
      "id": 3049044422,
      "node_id": "IC_kwDOABII5861vLnG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3049044422",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-07-08T13:47:40Z",
      "updated_at": "2025-07-08T13:47:40Z",
      "author_association": "MEMBER",
      "body": "As far as I can tell, this change is the cause of non-determinism when Guix building the Windows binaries, on different architectures: #32923.",
      "user": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#issuecomment-3049044422",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32597"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109813437",
      "pull_request_review_id": 2872012392,
      "id": 2109813437,
      "node_id": "PRRC_kwDOABII5859wTK9",
      "diff_hunk": "@@ -2904,7 +2904,9 @@ std::shared_ptr<CWallet> CWallet::Create(WalletContext& context, const std::stri\n         // ensure this wallet.dat can only be opened by clients supporting HD with chain split and expects no default key",
      "path": "src/wallet/wallet.cpp",
      "position": 13,
      "original_position": 1,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "original_commit_id": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In 69f588a99a7a79d1d72300bc0f2c8475f95f6c6a\r\n\r\n> Since new wallets will always being using the upgraded cache, there's no\r\nreason to wait to set the flag, so set it when the wallet flags are\r\nbeing initialized for new wallets.\r\n\r\nConceptually, it makes sense to me that the `WALLET_FLAG_LAST_HARDENED_XPUB_CACHED` is set at the time of wallet creation.\r\n\r\n> Although WalletBatch::LoadWallet performs the descriptor cache upgrade,\r\nbecause new wallets do not have the descriptor flag set yet, the upgrade\r\ndoes not run and set the flag.\r\n\r\nHowever, as mentioned above^ and as I checked in the code as well, since the cache upgrade is not run, it therefore is not recorded in the DB as well. If so far the presence of this flag leads to a presence of the corresponding DB entry, it'd be preferable if this behaviour is preserved here as well, which I believe is not happening. I will double check if this can lead to errors in some other parts of the wallet flows.\r\n",
      "created_at": "2025-05-27T17:50:19Z",
      "updated_at": "2025-05-27T18:04:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#discussion_r2109813437",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109813437"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2909,
      "original_line": 2904,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109834391",
      "pull_request_review_id": 2872012392,
      "id": 2109834391,
      "node_id": "PRRC_kwDOABII5859wYSX",
      "diff_hunk": "@@ -2904,7 +2904,9 @@ std::shared_ptr<CWallet> CWallet::Create(WalletContext& context, const std::stri\n         // ensure this wallet.dat can only be opened by clients supporting HD with chain split and expects no default key\n         walletInstance->SetMinVersion(FEATURE_LATEST);\n \n-        walletInstance->InitWalletFlags(wallet_creation_flags);\n+        // Init with passed flags.\n+        // Always set the cache upgrade flag as this feature is supported from the beginning.\n+        walletInstance->InitWalletFlags(wallet_creation_flags | WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);",
      "path": "src/wallet/wallet.cpp",
      "position": 19,
      "original_position": 7,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "original_commit_id": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't suppose it's a big issue but while going through the creation flow it seems odd that this flag is set prior to even the setup of the SPKMs. I have not tried it but from a code flow perspective a call to `UpgradeDescriptorCache` can come right after `SetupDescriptorScriptPubKeyMans` that will set both the cache keys in the database along with this flag.",
      "created_at": "2025-05-27T18:02:03Z",
      "updated_at": "2025-05-27T18:04:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#discussion_r2109834391",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109834391"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2914,
      "original_line": 2909,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109902489",
      "pull_request_review_id": 2872156043,
      "id": 2109902489,
      "node_id": "PRRC_kwDOABII5859wo6Z",
      "diff_hunk": "@@ -2904,7 +2904,9 @@ std::shared_ptr<CWallet> CWallet::Create(WalletContext& context, const std::stri\n         // ensure this wallet.dat can only be opened by clients supporting HD with chain split and expects no default key",
      "path": "src/wallet/wallet.cpp",
      "position": 13,
      "original_position": 1,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "original_commit_id": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "in_reply_to_id": 2109813437,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "There can be no DB entries when upgrade is run on a newly created wallet as the descriptors don't even exist yet.",
      "created_at": "2025-05-27T18:38:35Z",
      "updated_at": "2025-05-27T18:38:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#discussion_r2109902489",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109902489"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2909,
      "original_line": 2904,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109907898",
      "pull_request_review_id": 2872164043,
      "id": 2109907898,
      "node_id": "PRRC_kwDOABII5859wqO6",
      "diff_hunk": "@@ -2904,7 +2904,9 @@ std::shared_ptr<CWallet> CWallet::Create(WalletContext& context, const std::stri\n         // ensure this wallet.dat can only be opened by clients supporting HD with chain split and expects no default key\n         walletInstance->SetMinVersion(FEATURE_LATEST);\n \n-        walletInstance->InitWalletFlags(wallet_creation_flags);\n+        // Init with passed flags.\n+        // Always set the cache upgrade flag as this feature is supported from the beginning.\n+        walletInstance->InitWalletFlags(wallet_creation_flags | WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);",
      "path": "src/wallet/wallet.cpp",
      "position": 19,
      "original_position": 7,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "original_commit_id": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "in_reply_to_id": 2109834391,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The only behavior that is conditional on this flag is whether the upgrade needs to be run. It exists only as a startup optimization to ensure that we aren't re-running the same upgrade over and over. The `DescriptorScriptPubKeyMan` will always write the records for the upgraded cache, regardless of whether the flag exists. There is no need to upgrade the cache either as the upgraded cache is always used regardless of the flag.",
      "created_at": "2025-05-27T18:41:12Z",
      "updated_at": "2025-05-27T18:41:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#discussion_r2109907898",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2109907898"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2914,
      "original_line": 2909,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141169742",
      "pull_request_review_id": 2918828047,
      "id": 2141169742,
      "node_id": "PRRC_kwDOABII585_n6hO",
      "diff_hunk": "@@ -160,14 +160,24 @@ static constexpr uint64_t KNOWN_WALLET_FLAGS =\n static constexpr uint64_t MUTABLE_WALLET_FLAGS =\n         WALLET_FLAG_AVOID_REUSE;\n \n-static const std::map<std::string,WalletFlags> WALLET_FLAG_MAP{\n-    {\"avoid_reuse\", WALLET_FLAG_AVOID_REUSE},\n-    {\"blank\", WALLET_FLAG_BLANK_WALLET},\n-    {\"key_origin_metadata\", WALLET_FLAG_KEY_ORIGIN_METADATA},\n-    {\"last_hardened_xpub_cached\", WALLET_FLAG_LAST_HARDENED_XPUB_CACHED},\n-    {\"disable_private_keys\", WALLET_FLAG_DISABLE_PRIVATE_KEYS},\n-    {\"descriptor_wallet\", WALLET_FLAG_DESCRIPTORS},\n-    {\"external_signer\", WALLET_FLAG_EXTERNAL_SIGNER}\n+static const std::map<WalletFlags, std::string> WALLET_FLAG_TO_STRING{",
      "path": "src/wallet/wallet.h",
      "position": 12,
      "original_position": 12,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "original_commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "in_reply_to_id": null,
      "user": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: `string_view` can be used, as it is read-only access to a string and can avoid unnecessary memory allocation and copying.\r\nIn this case, you also would need to do:\r\n\r\n```diff\r\nstatic RPCHelpMan setwalletflag()\r\n{\r\n            std::string flags;\r\n            for (auto& it : STRING_TO_WALLET_FLAG)\r\n                if (it.second & MUTABLE_WALLET_FLAGS)\r\n-                    flags += (flags == \"\" ? \"\" : \", \") + it.first;             \r\n+                    flags += (flags == \"\" ? \"\" : \", \") + std::string(it.first);\r\n```\r\n\r\n```suggestion\r\nstatic const std::map<WalletFlags, std::string_view> WALLET_FLAG_TO_STRING{\r\n```",
      "created_at": "2025-06-11T21:48:29Z",
      "updated_at": "2025-06-11T21:48:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#discussion_r2141169742",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2141169742"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 163,
      "original_line": 163,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2152973926",
      "pull_request_review_id": 2936775302,
      "id": 2152973926,
      "node_id": "PRRC_kwDOABII586AU8Zm",
      "diff_hunk": "@@ -2904,7 +2904,9 @@ std::shared_ptr<CWallet> CWallet::Create(WalletContext& context, const std::stri\n         // ensure this wallet.dat can only be opened by clients supporting HD with chain split and expects no default key\n         walletInstance->SetMinVersion(FEATURE_LATEST);\n \n-        walletInstance->InitWalletFlags(wallet_creation_flags);\n+        // Init with passed flags.\n+        // Always set the cache upgrade flag as this feature is supported from the beginning.\n+        walletInstance->InitWalletFlags(wallet_creation_flags | WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);",
      "path": "src/wallet/wallet.cpp",
      "position": 19,
      "original_position": 7,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "original_commit_id": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "in_reply_to_id": 2109834391,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I finally got a chance to dive deeper and found that the corresponding caches values are recorded in the DB via `TopUpWithDB` inside `SetupDescriptorGeneration` through `SetupDescriptorScriptPubKeyMans` in the first run of the wallet, i.e., creation. So, as answered by your reply, there is no need to call `UpgradeDescriptorCache` right after, contrary to what I suggested in my first comment.\r\nhttps://github.com/bitcoin/bitcoin/blob/5e6dbfd14ea9eace1c7e5ee76b140be46a0ec855/src/wallet/scriptpubkeyman.cpp#L1050-L1054\r\n\r\nBut it does not set the wallet flag, and hence the need of this PR. \r\n\r\n> It exists only as a startup optimization to ensure that we aren't re-running the same upgrade over and over.\r\n\r\nI wanted to see how the flow would run the same upgrade over and over for which I checked out master, created a new wallet, unloaded it, & then loaded it - then repeated the unload/load activity. \r\nI found that after creation, the flag is not set which is incorrect and this PR will fix it. On the first load after creation, the `CWallet::UpgradeDescriptorCache` is run because of absence of the flag and the `DescriptorScriptPubKeyMan::UpgradeDescriptorCache` is also entered but the actual descriptor expansion and cache insertion in DB is not done because of the below check. Even though the flag was not set during creation but the `m_last_hardened_xpubs` was still populated.\r\nhttps://github.com/bitcoin/bitcoin/blob/5e6dbfd14ea9eace1c7e5ee76b140be46a0ec855/src/wallet/scriptpubkeyman.cpp#L1545-L1548\r\n\r\nAnd on the second load, `CWallet::UpgradeDescriptorCache` early returns because the flag was set in the previous load. So, I don't suppose the upgrade would run over and over? ",
      "created_at": "2025-06-17T19:00:35Z",
      "updated_at": "2025-06-17T19:34:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#discussion_r2152973926",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2152973926"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2914,
      "original_line": 2909,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153214250",
      "pull_request_review_id": 2937160015,
      "id": 2153214250,
      "node_id": "PRRC_kwDOABII586AV3Eq",
      "diff_hunk": "@@ -2904,7 +2904,9 @@ std::shared_ptr<CWallet> CWallet::Create(WalletContext& context, const std::stri\n         // ensure this wallet.dat can only be opened by clients supporting HD with chain split and expects no default key\n         walletInstance->SetMinVersion(FEATURE_LATEST);\n \n-        walletInstance->InitWalletFlags(wallet_creation_flags);\n+        // Init with passed flags.\n+        // Always set the cache upgrade flag as this feature is supported from the beginning.\n+        walletInstance->InitWalletFlags(wallet_creation_flags | WALLET_FLAG_LAST_HARDENED_XPUB_CACHED);",
      "path": "src/wallet/wallet.cpp",
      "position": 19,
      "original_position": 7,
      "commit_id": "47237cd1938058b29fdec242c3a37611e255fda0",
      "original_commit_id": "69f588a99a7a79d1d72300bc0f2c8475f95f6c6a",
      "in_reply_to_id": 2109834391,
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`UpgradeDescriptorCache` is always called, so it always runs. However, the check for the flag is also always done first, so the actual upgrade itself will be skipped.",
      "created_at": "2025-06-17T21:38:01Z",
      "updated_at": "2025-06-17T21:38:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32597#discussion_r2153214250",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2153214250"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32597"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2914,
      "original_line": 2909,
      "side": "RIGHT"
    }
  ]
}