{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601",
    "id": 1342790968,
    "node_id": "PR_kwDOABII585QCV04",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/27601",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/27601.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/27601.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/349a8f04012a386208045e6143d2c64daea60e68",
    "number": 27601,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "wallet: don't duplicate change output if already exist",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "If the transaction includes an output that goes to the custom change\r\naddress (`CoinControl::destChange`), the transaction creation process\r\nshould avoid creating duplicate outputs to the same address.\r\n\r\nInstead, it should reuse the existing output to prevent revealing which\r\naddress is the change address, which could compromise privacy.\r\n\r\nThis will also be useful to make other wallet processes less confusing\r\nand error-prone. For instance, within the bumpfee functionality, we\r\nmanually extract the change recipient from the transaction before calling\r\n'CreateTransaction' to ensure that the change output is not duplicated.\r\n\r\nSide note:\r\nThis is something that will be using for the #26732 rework.",
    "labels": [
      {
        "id": 149424,
        "node_id": "MDU6TGFiZWwxNDk0MjQ=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Wallet",
        "name": "Wallet",
        "color": "08a781",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2023-05-08T21:03:48Z",
    "updated_at": "2025-03-11T07:37:55Z",
    "closed_at": "2024-03-11T22:28:44Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged": false,
    "merge_commit_sha": "12778aa503cd3126a0bf2f2ad8126e80aceb60ba",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "furszy:2023_wallet_double_change_output",
      "ref": "2023_wallet_double_change_output",
      "sha": "349a8f04012a386208045e6143d2c64daea60e68",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 420752,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-03-05T15:40:12Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2025-02-19T14:05:48Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "df5af114df19730dc1d2936e5819e07273182a76",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36901,
        "stargazers_count": 82427,
        "watchers_count": 82427,
        "size": 276270,
        "default_branch": "master",
        "open_issues_count": 682,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-03-09T16:44:52Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-03-11T06:16:42Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
      }
    },
    "author_association": "MEMBER",
    "draft": true,
    "additions": 188,
    "deletions": 100,
    "changed_files": 8,
    "commits": 8,
    "review_comments": 23,
    "comments": 18
  },
  "events": [
    {
      "event": "commented",
      "id": 1539047166,
      "node_id": "IC_kwDOABII585bu_7-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1539047166",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T21:03:51Z",
      "updated_at": "2023-10-18T07:19:32Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27601).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [luke-jr](https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1604559997), [murchandamus](https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1622376656) |\n| Approach ACK | [S3RK](https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1637521709) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28453](https://github.com/bitcoin/bitcoin/pull/28453) (wallet: Receive silent payment transactions by achow101)\n* [#28372](https://github.com/bitcoin/bitcoin/pull/28372) (fuzz: coinselection, improve `min_viable_change`/`change_output_size` by brunoerg)\n* [#28366](https://github.com/bitcoin/bitcoin/pull/28366) (Fix waste calculation in SelectionResult by murchandamus)\n* [#28246](https://github.com/bitcoin/bitcoin/pull/28246) (wallet: Use CTxDestination in CRecipient instead of just scriptPubKey by achow101)\n* [#28201](https://github.com/bitcoin/bitcoin/pull/28201) (Silent Payments: sending by josibake)\n* [#28122](https://github.com/bitcoin/bitcoin/pull/28122) (Silent Payments: Implement BIP352 by josibake)\n* [#27827](https://github.com/bitcoin/bitcoin/pull/27827) (Silent Payments: send and receive by josibake)\n* [#26152](https://github.com/bitcoin/bitcoin/pull/26152) (Bump unconfirmed ancestor transactions to target feerate by murchandamus)\n* [#25273](https://github.com/bitcoin/bitcoin/pull/25273) (wallet: Pass through transaction locktime and preset input sequences and scripts to CreateTransaction by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1539047166",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "labeled",
      "id": 9194443829,
      "node_id": "LE_lADOABII585lYjWozwAAAAIkCBQ1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9194443829",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T21:03:53Z",
      "label": {
        "name": "Wallet",
        "color": "08a781"
      }
    },
    {
      "event": "labeled",
      "id": 9194810890,
      "node_id": "LE_lADOABII585lYjWozwAAAAIkDa4K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9194810890",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-08T22:03:16Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 9196994012,
      "node_id": "UNLE_lADOABII585lYjWozwAAAAIkLv3c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9196994012",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-09T06:34:13Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1480176356,
      "node_id": "PRR_kwDOABII585YObLk",
      "url": null,
      "actor": null,
      "commit_id": "7ec42848aa6033ae982dbf90ef33348c979c83e0",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1480176356",
      "submitted_at": "2023-06-14T19:57:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "unsubscribed",
      "id": 9536663165,
      "node_id": "UE_lADOABII585lYjWozwAAAAI4be59",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9536663165",
      "actor": {
        "login": "joostjager",
        "id": 4638168,
        "node_id": "MDQ6VXNlcjQ2MzgxNjg=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4638168?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/joostjager",
        "html_url": "https://github.com/joostjager",
        "followers_url": "https://api.github.com/users/joostjager/followers",
        "following_url": "https://api.github.com/users/joostjager/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/joostjager/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/joostjager/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/joostjager/subscriptions",
        "organizations_url": "https://api.github.com/users/joostjager/orgs",
        "repos_url": "https://api.github.com/users/joostjager/repos",
        "events_url": "https://api.github.com/users/joostjager/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/joostjager/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-15T07:26:01Z"
    },
    {
      "event": "commented",
      "id": 1604559997,
      "node_id": "IC_kwDOABII585fo6R9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1604559997",
      "actor": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-23T17:01:28Z",
      "updated_at": "2023-06-23T17:01:28Z",
      "author_association": "MEMBER",
      "body": "Concept ACK",
      "user": {
        "login": "luke-jr",
        "id": 1095675,
        "node_id": "MDQ6VXNlcjEwOTU2NzU=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1095675?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/luke-jr",
        "html_url": "https://github.com/luke-jr",
        "followers_url": "https://api.github.com/users/luke-jr/followers",
        "following_url": "https://api.github.com/users/luke-jr/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/luke-jr/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/luke-jr/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/luke-jr/subscriptions",
        "organizations_url": "https://api.github.com/users/luke-jr/orgs",
        "repos_url": "https://api.github.com/users/luke-jr/repos",
        "events_url": "https://api.github.com/users/luke-jr/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/luke-jr/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1604559997",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9688607417,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJBfGq5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9688607417",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e46c1276b222a27e46c8be635af6211588107471",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/e46c1276b222a27e46c8be635af6211588107471",
      "created_at": "2023-06-30T14:37:53Z"
    },
    {
      "event": "reviewed",
      "id": 1507352028,
      "node_id": "PRR_kwDOABII585Z2F3c",
      "url": null,
      "actor": null,
      "commit_id": "e46c1276b222a27e46c8be635af6211588107471",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback, thanks @Xekyo.\r\n\r\nAdded test coverage verifying that the same fee is paid when the wallet creates a change output automatically vs when the user provides the change output and the wallet just use it as recipient for the fee surplus.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1507352028",
      "submitted_at": "2023-06-30T14:53:01Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9688911750,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJBgQ-G",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9688911750",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8f499022d9744bb15918c2b390878d02df0d48ac",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/8f499022d9744bb15918c2b390878d02df0d48ac",
      "created_at": "2023-06-30T15:06:47Z"
    },
    {
      "event": "labeled",
      "id": 9688913660,
      "node_id": "LE_lADOABII585lYjWozwAAAAJBgRb8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9688913660",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-30T15:06:54Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9689404185,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJBiJMZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9689404185",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "ffcfe0847fde1bc3eb11528729f6276f3a8e2037",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/ffcfe0847fde1bc3eb11528729f6276f3a8e2037",
      "created_at": "2023-06-30T15:56:05Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9697886876,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJCCgKc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9697886876",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "a8ac2ad88e15b7bc3dd90d92c26793c12bd20cb1",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/a8ac2ad88e15b7bc3dd90d92c26793c12bd20cb1",
      "created_at": "2023-07-01T22:40:11Z"
    },
    {
      "event": "commented",
      "id": 1617526433,
      "node_id": "IC_kwDOABII585gaX6h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1617526433",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-03T07:29:38Z",
      "updated_at": "2023-07-03T07:29:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "How would it work if coinselection produced result without change output? ",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1617526433",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "reviewed",
      "id": 1511239594,
      "node_id": "PRR_kwDOABII585aE6-q",
      "url": null,
      "actor": null,
      "commit_id": "a8ac2ad88e15b7bc3dd90d92c26793c12bd20cb1",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "> How would it work if coinselection produced result without change output?\r\n\r\nThere is a test exercising the behavior inside a8ac2ad8 and also an explanation there.\r\n\r\nBut essentially, the process must adhere to the outputs specified by the user. If the change destination option in 'fundrawtransaction' matches one of the output scripts, the wallet is instructed to 'increase the specified output only if there is any change' and must not discard outputs predefined by the user under any circumstances",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1511239594",
      "submitted_at": "2023-07-03T14:09:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "commented",
      "id": 1620572868,
      "node_id": "IC_kwDOABII585gl_rE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1620572868",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-04T17:38:11Z",
      "updated_at": "2023-07-04T17:38:11Z",
      "author_association": "MEMBER",
      "body": "From CI https://cirrus-ci.com/task/4675435070488576?logs=ci#L3365:\r\n\r\n```\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-i686-pc-linux-gnu/test/functional/wallet_fundrawtransaction.py\", line 337, in test_double_change\r\n                                       assert_equal(wallet.gettransaction(desc_tx['vin'][0]['txid'])['amount'], Decimal(50))  # assert input value\r\n                                     File \"/tmp/cirrus-ci-build/ci/scratch/build/bitcoin-i686-pc-linux-gnu/test/functional/test_framework/util.py\", line 57, in assert_equal\r\n                                       raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\n                                   AssertionError: not(0E-8 == 50)",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1620572868",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9812585612,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJI4CyM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9812585612",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "a8f9633522d062c778cd89607a8f76d34798a949",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/a8f9633522d062c778cd89607a8f76d34798a949",
      "created_at": "2023-07-13T15:23:59Z"
    },
    {
      "event": "unlabeled",
      "id": 9813949635,
      "node_id": "UNLE_lADOABII585lYjWozwAAAAJI9PzD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9813949635",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-13T17:44:12Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9822397832,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJJdeWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9822397832",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "06e0248cb87db14c54bd4e4f4256ce955c150c57",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/06e0248cb87db14c54bd4e4f4256ce955c150c57",
      "created_at": "2023-07-14T14:14:18Z"
    },
    {
      "event": "reviewed",
      "id": 1530430019,
      "node_id": "PRR_kwDOABII585bOIJD",
      "url": null,
      "actor": null,
      "commit_id": "06e0248cb87db14c54bd4e4f4256ce955c150c57",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated.  Added required changes to make coin selection, change and fee calculations take into consideration the presence of an existing change output. Avoiding cases where we end up having to increase the change output at the end of the process by the fee surplus.\r\n\r\nChanges:\r\n* Cleaned two change related members from the `CoinSelectedParams` struct that are not used inside the coin selection process. They were only intermediate results used to calculate other values.\r\n* Excluded the change cost from the waste score when the transaction already accounts for it.\r\n* In transactions with an existing change output, the spending process will no longer compute all the change related coin selection params. By setting them to 0, we instruct coin selection to produce results closer to the target.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1530430019",
      "submitted_at": "2023-07-14T14:36:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "reviewed",
      "id": 1532133649,
      "node_id": "PRR_kwDOABII585bUoER",
      "url": null,
      "actor": null,
      "commit_id": "9dc5bbe042f4d1febde8753a8c56da35eedd9d3e",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1532133649",
      "submitted_at": "2023-07-17T07:15:21Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "reviewed",
      "id": 1532142635,
      "node_id": "PRR_kwDOABII585bUqQr",
      "url": null,
      "actor": null,
      "commit_id": "ea57562b4ab4071fd1a716f09e13d19ff68e99f1",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1532142635",
      "submitted_at": "2023-07-17T07:22:15Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "commented",
      "id": 1637521709,
      "node_id": "IC_kwDOABII585hmpkt",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1637521709",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-17T07:32:22Z",
      "updated_at": "2023-07-17T07:32:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK\r\n\r\nI think setting change related params to 0 in case where we reuse existing output is the correct way to go.",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1637521709",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9862575014,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJL2vOm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9862575014",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "88916b1f6dd420d82f66c1e1fd6cd2a7d3728b15",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/88916b1f6dd420d82f66c1e1fd6cd2a7d3728b15",
      "created_at": "2023-07-19T13:27:27Z"
    },
    {
      "event": "reviewed",
      "id": 1537117279,
      "node_id": "PRR_kwDOABII585bnoxf",
      "url": null,
      "actor": null,
      "commit_id": "88916b1f6dd420d82f66c1e1fd6cd2a7d3728b15",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Updated per feedback. Thanks.\r\n\r\nAdded docs for the `ComputeChangeParams` new function.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1537117279",
      "submitted_at": "2023-07-19T13:35:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "commented",
      "id": 1654432367,
      "node_id": "IC_kwDOABII585inKJv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1654432367",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-27T19:40:07Z",
      "updated_at": "2023-07-27T19:40:07Z",
      "author_association": "MEMBER",
      "body": "While I agree that doing something smart like this in the context of fee bumping is fine, `CreateTransaction` is a generic function for the wallet's transaction building so changing the behavior here will have an effect on other uses as well, so I don't think this is the right approach. In general, we shouldn't assume what the change is when it is ambiguous - conceivably a user could be reusing addresses or otherwise actually wants a particular change address that is also one of the outputs. Doing this is allowed now, and I don't think we should change the meaning of the change address argument.\r\n\r\n> Instead, it should reuse the existing output to prevent revealing which\r\naddress is the change address, which could compromise privacy.\r\n\r\nNo, reusing the output reveals the change since the amount changes.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1654432367",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "commented",
      "id": 1654451888,
      "node_id": "IC_kwDOABII585inO6w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1654451888",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-27T19:48:06Z",
      "updated_at": "2023-07-27T19:48:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "Perhaps this is a good way forward: only merge the new change output and the existing output on the original transaction if either a) Bitcoin Core organically detects that the original output was the change and it is also provided as the custom change address again, or b) if the user explicitly instructs the wallet to treat the original transaction’s output as the change per https://github.com/bitcoin/bitcoin/pull/26467 and provides the same address as custom change again. Otherwise, if the output script associated with the custom change address  matches an existing output on the original transaction, it should fail and request more precise instructions from the user.\r\n\r\nOther than that, I agree that a surveillant seeing the same output script in the original and replacement transaction but with different amounts would have a strong hint that it’s the change. Two outputs to the same output script would also be suspicious, especially if the tx fingerprint matches Bitcoin Core, since it does not permit duplicate outputs to the same output script usually.",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1654451888",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "reviewed",
      "id": 1550813509,
      "node_id": "PRR_kwDOABII585cb4lF",
      "url": null,
      "actor": null,
      "commit_id": "88916b1f6dd420d82f66c1e1fd6cd2a7d3728b15",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "> In general, we shouldn't assume what the change is when it is ambiguous - conceivably a user could be reusing addresses or otherwise actually wants a particular change address that is also one of the outputs. Doing this is allowed now, and I don't think we should change the meaning of the change address argument.\r\n\r\nThat is not really how the wallet behaves for regular outputs. Not sure why it should\r\nbehave differently for change outputs only.\r\n\r\nRight now, the user cannot duplicate outputs in any of the wallet related RPC commands.\r\nThey are all blocking dup output scripts (Check `ConstructTransaction`, inside `AddOutputs`).\r\nOnly the change output is auto-magically duplicated by the wallet without the user consent.\r\n\r\nThe only way for users to duplicate outputs destinations is to use the `createrawtransaction`\r\ncommand. Which I think that is good, the wallet RPC related commands should be \"safe\" to\r\nuse (they shouldn't duplicate outputs automatically nor do stuff that can leak information),\r\nand then the raw creation commands should be rules free for people to do whatever they want.\r\n\r\n\r\n> > Instead, it should reuse the existing output to prevent revealing which\r\n> > address is the change address, which could compromise privacy.\r\n> \r\n> No, reusing the output reveals the change since the amount changes.\r\n\r\nDepends on the context. If this is used to bump certain transaction, the outcome is\r\npractically the same for both. Either increasing the single change output or creating another\r\noutput with the same script compromises privacy (more if we are the only software doing it).\r\n\r\nBut, for transactions being funded (not published), it is worst to create a tx with\r\ntwo outputs going to the same script rather than increasing the amount of one of them.\r\n\r\n---------------------------------------\r\n\r\nI think that if your concern is about allowing the user to have a second output going to\r\nthe same change address, they could also do it with this as well. They just need to\r\ncraft a raw transaction with two outputs going to the change address. The wallet\r\nwill take one of them as change, and increase it.\r\n\r\nStill, will think more about this. I'm feeling that you surely have a point (other than\r\nthe ones written above) but I'm not seeing it yet. It feels that it is related to a\r\n\"use existing change output if exist\" option instead of automatically using one of\r\nthe outputs when it matches to the user provided change destination.\r\n\r\nBut.. this last thing also sound weird. The user provided the outputs, and also set\r\na custom change destination that matches one of them. So.. it should be more than\r\nfine to interpret it as \"use this output for change\". ",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1550813509",
      "submitted_at": "2023-07-27T21:19:31Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "labeled",
      "id": 10202692583,
      "node_id": "LE_lADOABII585lYjWozwAAAAJgILvn",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10202692583",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-27T23:32:16Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10209317345,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJghdHh",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10209317345",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8c39deed70e506f7672373c618d168c37e980a64",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/8c39deed70e506f7672373c618d168c37e980a64",
      "created_at": "2023-08-28T13:30:43Z"
    },
    {
      "event": "reviewed",
      "id": 1598318971,
      "node_id": "PRR_kwDOABII585fRGl7",
      "url": null,
      "actor": null,
      "commit_id": "8c39deed70e506f7672373c618d168c37e980a64",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Rebased due a silent merge conflict.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1598318971",
      "submitted_at": "2023-08-28T13:38:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUwNWQxNGU1MWZiYmQ3MTQxNjNkNjFmZWU1MjZkNGUxYjE1YzM5NGI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e05d14e51fbbd714163d61fee526d4e1b15c394b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e05d14e51fbbd714163d61fee526d4e1b15c394b",
      "tree": {
        "sha": "30596db61f81041f409cdeeacf45c8b6ba7f66ef",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/30596db61f81041f409cdeeacf45c8b6ba7f66ef"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 30596db61f81041f409cdeeacf45c8b6ba7f66ef\nparent df5af114df19730dc1d2936e5819e07273182a76\nauthor furszy <matiasfurszyfer@protonmail.com> 1683390603 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425627 -0300\n\nwallet: refactor, move recipients sum loop after change script creation\n\nthis will be used in the follow-up commit to detect whether one of the\nrecipients matches the change script or not.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9sACgkQXdI8zGhq\npiOZKQ/+JWuyCA6XolbGllq+PeiAqMKNURfT+Zo30ur1lRT6pf4iihPgrp3dOm1g\nu46Cd/u6uvGmeWqXNTPAsEuI+b79zHBD1DOB42U7s+TFl2UVrff3w/WI9mPEKb41\nsgHwRKtaJwYM0Q8nQGdJ0Od5ihtckXpMXo/LvX8x4KQ3bE3F6H2JQoQ6cTfPhk3z\nay5ga1ZxqHvbGBvbYjmZNSMZfjimwjR7AZ/gEEqK5nt0ppBW6B2WQkSz23su38uH\nX3BIibehYPPG+Jn9jzVRG8lvlbfaavqmF2Z/ZGOAZrOqbav1vxuOWBIs129vrFDa\nb8oh9ScT0CxYuJKC7LqOT8DVdq06BVBoOcOPNMg0XfxhKiCNLzOhFU/ijuTnwogf\nbkbkz0ddnvtKKKxmFQ+bIoRDc3H61MRHRc1EKUNZ6+zrYATjhX+/+S9Xu+0lPL44\n5Z9H+m5Ss7rPUcm9VfpzywOo3GZpyKveCaT8Z+dCjtcAUeUeoEvru2e95jbQS0IA\nM2ZTlANr0l7krnHnEOzfHq1lEggqHShDthSQ527KW2LvUlJ4qaAuHkOhGchIxzCQ\n1Y8UdU9jq6dv1XmJwU/NeM5ccqudVeEviDgP9J2DKOZv43B08kzzt6l1s1Ouhl5U\nV2emgd8xoLvtRXhavsJnywTXCJwPabOOjCW150BCV7viWHtDO6s=\n=I0O/\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/df5af114df19730dc1d2936e5819e07273182a76",
          "sha": "df5af114df19730dc1d2936e5819e07273182a76",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/df5af114df19730dc1d2936e5819e07273182a76"
        }
      ],
      "message": "wallet: refactor, move recipients sum loop after change script creation\n\nthis will be used in the follow-up commit to detect whether one of the\nrecipients matches the change script or not.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:27Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-06T16:30:03Z"
      },
      "sha": "e05d14e51fbbd714163d61fee526d4e1b15c394b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE4MzQyMzQ2ODBlMDE0ZDhkZTUzYzVjYTZmZTJhOTQ4NDFiYjI0N2U",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a834234680e014d8de53c5ca6fe2a94841bb247e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a834234680e014d8de53c5ca6fe2a94841bb247e",
      "tree": {
        "sha": "c0e86d12b823b4e68181c1b6e7dbf24991f2dd60",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0e86d12b823b4e68181c1b6e7dbf24991f2dd60"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c0e86d12b823b4e68181c1b6e7dbf24991f2dd60\nparent e05d14e51fbbd714163d61fee526d4e1b15c394b\nauthor furszy <matiasfurszyfer@protonmail.com> 1682718291 +0100\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425627 -0300\n\nwallet: FundTransaction, don't add change as another recipient if exists\n\nIf the transaction includes an output that goes to the custom change\naddress (CoinControl::destChange), the transaction creation process\nshould avoid creating duplicate outputs to the same address.\n\nInstead, it should reuse the existing output to prevent revealing\nwhich address is the change address, which could compromise privacy.\n\nThis will also be useful to make other wallet processes less\nconfusing and error-prone. For instance, within the bumpfee\nfunctionality, we are extracting the change recipient from the\ntransaction before calling 'CreateTransaction' to ensure that the\nchange output is not duplicated.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9sACgkQXdI8zGhq\npiPnIg//ZSP3wsa0hwVg7xy3xMiwzs+gEPModTaZdZPRUUuiT/1UEi44ezcL0dwK\nssfygQKypVBM451xP5oNV5yatABIzsDflBUyXBAu9QxdgDt6A1imEWXdPYpODnKK\nM0ESuole83aKRoO0BizDAWlqR6EjhJV6JJcbObYb00h2W6setBZCYYryktBTdlwj\nUGW+oP2gzemK6Wt9Nom8k/p9mAP+S0aRzG4c/u7ZWQGFgMJELiF0r8lru9DKaeHf\nfm2fb256ObrIvlLcQ6lpsm3bVCyACQ37z5Og4UGKZK7rX7sAC7gLMhlNTiYouetH\nuyK9EvtmUWmOY11VL8IhO8xSE/3nb4wAWq+JjgeXKfHzRU5QxpSqaYgAvrLeFJHI\n4euvTjAHgaSysPKYXrqlot5LnfOxIH5hrvltULAsBgTDTsJB0j9w2jFQWxeJYhax\nGBa2ea0YRgjuSu/ln2zdG6DEgVeYGFASGiWIXfFa8Pa9MCgs6jGvKlm2CcsFkN9Y\nwBVjhZmHu/xuaBXnP7JOEAq798Z2IumyM50lBJIaoCZFDw3tVv6yIS+zcOeHygwl\nbhBqeFisN/Uw+uSwC+qWcgVDNQSxE/llD+ndEGZjSI7aiCyHf2LfjMdt0Tkeo2Ql\n/CN7xL7HB4vcmaThhDkIC/goWd2bFzDrKQmsnR1gP1tvSO2+XGY=\n=iRxp\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e05d14e51fbbd714163d61fee526d4e1b15c394b",
          "sha": "e05d14e51fbbd714163d61fee526d4e1b15c394b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e05d14e51fbbd714163d61fee526d4e1b15c394b"
        }
      ],
      "message": "wallet: FundTransaction, don't add change as another recipient if exists\n\nIf the transaction includes an output that goes to the custom change\naddress (CoinControl::destChange), the transaction creation process\nshould avoid creating duplicate outputs to the same address.\n\nInstead, it should reuse the existing output to prevent revealing\nwhich address is the change address, which could compromise privacy.\n\nThis will also be useful to make other wallet processes less\nconfusing and error-prone. For instance, within the bumpfee\nfunctionality, we are extracting the change recipient from the\ntransaction before calling 'CreateTransaction' to ensure that the\nchange output is not duplicated.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:27Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-04-28T21:44:51Z"
      },
      "sha": "a834234680e014d8de53c5ca6fe2a94841bb247e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg0YTM3ZjhhNWJjNTIxMzFkMzQxYTZhZTllYjJkNTUzMmEwMTAwMjc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84a37f8a5bc52131d341a6ae9eb2d5532a010027",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/84a37f8a5bc52131d341a6ae9eb2d5532a010027",
      "tree": {
        "sha": "369d54a153d6b6afdf9b36d707dcfef5244e6941",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/369d54a153d6b6afdf9b36d707dcfef5244e6941"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 369d54a153d6b6afdf9b36d707dcfef5244e6941\nparent a834234680e014d8de53c5ca6fe2a94841bb247e\nauthor furszy <matiasfurszyfer@protonmail.com> 1683384685 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425627 -0300\n\ntest: fundrawtxn, add coverage for double change output creation\n\nCoverage for fundrawtxn:\n\n1) Should not create a second change output if there is\n   one already going to that address.\n\n2) The wallet changeless predilection should never discard\n   a manually set output by the user.\n   e.g. the user manually crafted a tx that already contain a\n   change output with certain value. This output shouldn't get\n   lost as it was predefined by the user. Only should be used\n   as recipient of the \"inputs - outputs\" surplus during\n   'fundrawtransaction'.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9sACgkQXdI8zGhq\npiNpwQ/7BQTIm4N2tPaUyusPhKMcR/+q0oR9jNCZGF6Ddfxl7JM+08+nJJYR08FN\nouRJuvB47tenFEOSTWlZweLvVJh/B92OYM3qeSTr/oBpxIqMwDrkg8qT16/EImDi\nQa5AXOytRrKPw/4Ba56vgqiUyksH37373mc8DPWhh64P9NF+rwCYQhi9Xv8Ishlf\n9oyeLUOmcrB9SalN7B0epwTqYIFyhnR/FZQAOAHMc5vzEf6VTAoz4twG3O1gfdyB\nmxrgIwVZAuIf5Tg8AHi9VlUklAy7qOCYhi2Dm/hBuT/wNgTUf52b8o22gtDYd2fe\nJBPwHMgv4pHA1G0Jv8d6pv8TQJff2jTXayk+jlSvvC6/AwHsnjra8ydg8qcxSmEz\n8Ka9ZBNDJqNOKOj64NXZv6JB7SWCp+6Dn5xzr+FpXmjOAvZDLVxU0oLtASCk8PPV\nRMutKFZizLk/Vu2oXzhw0L5+KMIeLWA54+zcrbbMrVep6PLOCZ3vL2eHte6K22PU\n/y1ll7jzWtCVRvKE3X4wO8yV46zp8GBezYh+sRS2B8bFib3NJlkhiyGb78rwW6+R\nGbqxqnVnwyVpbxBVZjB2o3rDqifn9nr6agOaEEEDMVSLXCFHBCGM/7Fi5cRCVc8C\nxWQ3jCOyY7hv2hPTfk9K3XnsXYTC8EX1B4PWMIpt9cdtwR0xAJ8=\n=cQZL\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a834234680e014d8de53c5ca6fe2a94841bb247e",
          "sha": "a834234680e014d8de53c5ca6fe2a94841bb247e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a834234680e014d8de53c5ca6fe2a94841bb247e"
        }
      ],
      "message": "test: fundrawtxn, add coverage for double change output creation\n\nCoverage for fundrawtxn:\n\n1) Should not create a second change output if there is\n   one already going to that address.\n\n2) The wallet changeless predilection should never discard\n   a manually set output by the user.\n   e.g. the user manually crafted a tx that already contain a\n   change output with certain value. This output shouldn't get\n   lost as it was predefined by the user. Only should be used\n   as recipient of the \"inputs - outputs\" surplus during\n   'fundrawtransaction'.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:27Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-05-06T14:51:25Z"
      },
      "sha": "84a37f8a5bc52131d341a6ae9eb2d5532a010027"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJhZmY3MDA3M2FkODlhYmY1MjVjMzJkMzI5NmMyMDk0ZTk2Y2NjOTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2aff70073ad89abf525c32d3296c2094e96ccc91",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2aff70073ad89abf525c32d3296c2094e96ccc91",
      "tree": {
        "sha": "79d7cfa80b06230ca804e2bc49de54f2f409deb4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/79d7cfa80b06230ca804e2bc49de54f2f409deb4"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 79d7cfa80b06230ca804e2bc49de54f2f409deb4\nparent 84a37f8a5bc52131d341a6ae9eb2d5532a010027\nauthor furszy <matiasfurszyfer@protonmail.com> 1688759945 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425627 -0300\n\nrefactor: remove change_spend_size field from CoinSelectionParams\n\nThe field is an intermediate result used to calculate other values\nand not read anywhere inside coin selection.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9sACgkQXdI8zGhq\npiOKsg//U4HmIA8ccBlF+O1aTgSdQa2aiAC427O7eDwIY0IwP19IjXGRBvjM8I9F\n9C55qb4hZtJcHfFXvsIrAumcsc246kWgNfT9GIgtCdbsr8PBcaR0sy4cSOx5WurJ\nv2BKxtQzHhfFXszcBl0nJDZKNfVzUzTQD8q3FoxiYroJ5jYWLTEgtbw5aNSWYSuW\nUIersIBvIo5Q3DFbTeFs2gyibYIQelV6cKw5sAYkS3FXh6ml9H/1bfAFYXPLAHzp\nvQsqUBA7jLU6BeR3nFJB4/OuIBn2LHuK7i71eCRQleKMLLl5kskejBKtxzqG+1nE\ndzxOb4aQiAvyrSs40pPsTt2xBvFLmAwJdeJyyQs3B/TU7onTp0aZKCIRQHSU7It3\nKlCDZHS+CUSZQ3c0EYEB9xdnzoBvyP33YSm7lyPGu/z/6C0tiU+Jzh72Z7ub8uqN\nmMgZzWxWKRtsE8CNuISV28MneVTUbvpbHZcv59fXYGps8TT/zbmCX3u2ilsgQucr\n4gRpLZjt4EXq4tVmUaU2KAeAqiSA65chy0jlLjKSj9Uu2sKniIey3e1UAZk/mwE7\n4nVwIV51ofBmJtbItAn0AfMv7X9XspFZAJ2SvghS3nbGvS/KQ+oowlMCqv6uSThR\nBYpIB2ps9UaPopqj1uN8ffzznCenROgJv+AxsjUU1yKNzGMrZwo=\n=gso7\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84a37f8a5bc52131d341a6ae9eb2d5532a010027",
          "sha": "84a37f8a5bc52131d341a6ae9eb2d5532a010027",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/84a37f8a5bc52131d341a6ae9eb2d5532a010027"
        }
      ],
      "message": "refactor: remove change_spend_size field from CoinSelectionParams\n\nThe field is an intermediate result used to calculate other values\nand not read anywhere inside coin selection.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:27Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-07T19:59:05Z"
      },
      "sha": "2aff70073ad89abf525c32d3296c2094e96ccc91"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDA5ODk5ZmY4ZTQ2MTllMWU1NjA2ZmIzZGJlMzc5Y2U1NTkxYWZmZjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09899ff8e4619e1e5606fb3dbe379ce5591afff0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/09899ff8e4619e1e5606fb3dbe379ce5591afff0",
      "tree": {
        "sha": "730d4e5a8903a29d455266c2c8171ad10eb3137d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/730d4e5a8903a29d455266c2c8171ad10eb3137d"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 730d4e5a8903a29d455266c2c8171ad10eb3137d\nparent 2aff70073ad89abf525c32d3296c2094e96ccc91\nauthor furszy <matiasfurszyfer@protonmail.com> 1689256976 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425627 -0300\n\nrefactor: remove discard_feerate field from CoinSelectionParams\n\nThe field is an intermediate result used to calculate other values\nand not read anywhere inside coin selection.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9sACgkQXdI8zGhq\npiOuexAAyYA+xeBkfQ48ih3f8GdY5zMxVN/ci1f3yUHvOBQHqAPnN6rRZC8hA1y4\njZ0YxrDqljg11m8BjJH8BPlnnCaP3uwhgtQfo+khyTgevZIuanHIFBBiE0nWcndj\nVFBgNQCCWw40G0m48KZ9+pXPnpY/z/+ALl5gfsOhbT304TS5YWrU+3dQORGoErPy\nrqGJkjQ5yYzcXex7synyEUusMMOSgVrin/cDGIyjl+ntsolTgfRQ/gOsktv+ujyY\nKXDnLQrKhAV6AoYoZFZ55NlrvMlNddqHNQ3YMX5IJijpJLaUm7Bm77xJHbOXuXJu\nX4DGkOCpJnuI24yLAoQKH263WBecQiTdJdjRlcyH2ahOVZYEkLt+Huhr+81H5amS\ndZ/DfQyRB/6SIMRuJoQUG4qUiY5SzzursGFD4rD4CCh0w++r3Cm9VP7F6A+wrQWU\nbjKtJI9/GzpzbTtZ+FexDIl5Xt8u08pMlktBPCJbpxirZQKaRdF9PjSA7QKs1lxh\nb+4RshnirtHkqRZpktiMNaszrWkm0i4CxNf50OVMPAWzPEefZfLKCv9+KSirLtye\noZe0zF5MJvaiPvTVGiSYJ7I76tIhS5WK13qN8wv50vkqgB8A2su0X55Egyt39E37\nLvGKoaZzvqH9dWvk0ofMkdOqzKrXB77ikqWCrVWQNgkKktB9RTg=\n=ZYA7\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2aff70073ad89abf525c32d3296c2094e96ccc91",
          "sha": "2aff70073ad89abf525c32d3296c2094e96ccc91",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2aff70073ad89abf525c32d3296c2094e96ccc91"
        }
      ],
      "message": "refactor: remove discard_feerate field from CoinSelectionParams\n\nThe field is an intermediate result used to calculate other values\nand not read anywhere inside coin selection.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:27Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-13T14:02:56Z"
      },
      "sha": "09899ff8e4619e1e5606fb3dbe379ce5591afff0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgzZTg1YzA1OGFiN2I2M2FkY2Q5ZWFkM2FjODBjNzBkNjRjZjMxZWI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83e85c058ab7b63adcd9ead3ac80c70d64cf31eb",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/83e85c058ab7b63adcd9ead3ac80c70d64cf31eb",
      "tree": {
        "sha": "08dfb650cd880d2276acd8cdad23a3146ccd49c6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/08dfb650cd880d2276acd8cdad23a3146ccd49c6"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 08dfb650cd880d2276acd8cdad23a3146ccd49c6\nparent 09899ff8e4619e1e5606fb3dbe379ce5591afff0\nauthor furszy <matiasfurszyfer@protonmail.com> 1688761206 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425628 -0300\n\ncoinselection: option to exclude change cost from waste score\n\nUseful when the transaction already accounted for the change cost.\nWhich happens when the user, or wallet process, set the coin control\ncustom change address equal to one of the existing output addresses.\n\nIn other words, when the user selects one of the transaction existing\noutputs to be increased by the difference between inputs - output.\n\nThis will be connected to the transaction creation process in the\nfollowing-up commit.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9wACgkQXdI8zGhq\npiNMjw/9G9Z9T68wmp9exIRGbYtUyFKCFydoYoNo/kWp1/++z0jTw+pNkMCEYH8q\nOuyS2V7pz7YMFs50lW6Yo0UzgfHdAYGP0FkI2Dxb+pITr1oPu4L/6SPZIelNNhSy\n3H7ZPaziHno8tHxoUlxFZIt8M+zdpLp+uLEfhM7FGxS8712gV7OLCqc+PY4KFkUi\n0K3vt6TrrEbWhL7Cd4BIZr3rGaAGJrp9K+Y9fXmTnvEP/FWYV/0ukXo6vW151QnE\nu7FmchdKWPrhy8RudVcqgs5f3migAr8dqQE7Sxcm5kA9qMpvs37WBcczXbeRD7QO\nJKiad9Ivcxg63nBpnn59i+OI2qI1mk1BSx4W5IkJmFTZ3uhTZS2V2ZS1kfl+DUms\nhKrzj6mIS8i66q9KIeJZiUDZdFwAMrCHbFOjuhKHkDIbEmSfzTrpNz1ARoRMBUcU\nC09M1KQie16S5cXHV7ZhSD/HC/6jZKHx6pgwhhbHgY56uI8Fo/9H8apeECWKYpUb\nWphhnUToYef9CfeK0bhRVyRF9NpBeK6QW1tyXK7Rd8Bi7GobOdc73FLg6xyp9uht\nwWkvl2iB+3kwveiHfbP0mKlVaCh/WXqeG2zc2CnmELhnAdoI2Ts9FPBYO+lbbIgs\n4atSfddz8k60nz6LZ/H92s2kMDSRVgCAY4gxryW1ur/G1HT5+AU=\n=Kgwk\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/09899ff8e4619e1e5606fb3dbe379ce5591afff0",
          "sha": "09899ff8e4619e1e5606fb3dbe379ce5591afff0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/09899ff8e4619e1e5606fb3dbe379ce5591afff0"
        }
      ],
      "message": "coinselection: option to exclude change cost from waste score\n\nUseful when the transaction already accounted for the change cost.\nWhich happens when the user, or wallet process, set the coin control\ncustom change address equal to one of the existing output addresses.\n\nIn other words, when the user selects one of the transaction existing\noutputs to be increased by the difference between inputs - output.\n\nThis will be connected to the transaction creation process in the\nfollowing-up commit.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:28Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-07T20:20:06Z"
      },
      "sha": "83e85c058ab7b63adcd9ead3ac80c70d64cf31eb"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUwYzVlMjUyMDdlZmQxMGI0N2E5M2NhMjcyNDNlNjU3MGIzYjc5N2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/50c5e25207efd10b47a93ca27243e6570b3b797d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/50c5e25207efd10b47a93ca27243e6570b3b797d",
      "tree": {
        "sha": "c8c334e3dd8716f8b52919bdbf444fc6b45cee4a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c8c334e3dd8716f8b52919bdbf444fc6b45cee4a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c8c334e3dd8716f8b52919bdbf444fc6b45cee4a\nparent 83e85c058ab7b63adcd9ead3ac80c70d64cf31eb\nauthor furszy <matiasfurszyfer@protonmail.com> 1689208066 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425628 -0300\n\nrefactor: wallet spend, decouple change params initialization\n\nNo behavior change.\n\nThe initialization of all the CoinSelectionParams fields related\nto 'change' were moved to its own standalone function.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9wACgkQXdI8zGhq\npiPCLQ/9GbV5I4s1dCxukoknFHuBAYAh49Wr6UeUg9ohBh/dQtP6LuWFgbRu2ATa\nH0CYfIbgqxzIdqTN8XmAcwRTM5WfYGcZRFIEd7j6hlsJIat09dOg0WMFsqmKBVrE\nL86asVDwxXAPQ1HxO5wL2eYJR5wxIE5A7ERbWtMEHnYrZZvIvbdTHgG8vvBkWyUH\nnQPAbYR9LelLLmJjwo8QQzI4GtmNtMBQoDMTQ5Nya4R5mRZq0IhNtzgLTEcJQSNk\nATZwKZTZnbp8dnHsr7deQ8YcOZl98m+q3zlHvZf9WnNMm3F/6nMICAkr3JQliGBM\nCgXmbHsZR0MG3SH2Q+71EqPBndZumgxZvB7gRl6CzjLdE/EA6N+O5RIHn1Ge2E1J\ni0mYZjjZjAB7W7DoXM9ljkaUfnncS7kQty1r/IrVT2fGrHTO+Oj4JWegwDteckir\nnnIibuEtfuZLrja76F1XxPddxpYj18cPV5wCn6uNqFRfadYBmihATG3bBvLYYai2\n63ds0NxEdNMb9/HxT8dY73OX7TBKu2XzSAge4u0jWeNx+j5RWMVIZq+gPQ0qHYiV\ndJ4nZPhCGE2TLDUwC6jiouASOC5vKnAADGVJSiLTPOWAj5xKE/yHrRG85lt9RCSC\nSOWwacTSzhz+kQGb74CDo3XfshjuJ61Tc5mrTt/tg/aH7o63SCE=\n=IU+p\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83e85c058ab7b63adcd9ead3ac80c70d64cf31eb",
          "sha": "83e85c058ab7b63adcd9ead3ac80c70d64cf31eb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/83e85c058ab7b63adcd9ead3ac80c70d64cf31eb"
        }
      ],
      "message": "refactor: wallet spend, decouple change params initialization\n\nNo behavior change.\n\nThe initialization of all the CoinSelectionParams fields related\nto 'change' were moved to its own standalone function.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:28Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-13T00:27:46Z"
      },
      "sha": "50c5e25207efd10b47a93ca27243e6570b3b797d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM0OWE4ZjA0MDEyYTM4NjIwODA0NWU2MTQzZDJjNjRkYWVhNjBlNjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/349a8f04012a386208045e6143d2c64daea60e68",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/349a8f04012a386208045e6143d2c64daea60e68",
      "tree": {
        "sha": "a4e46beee57b526875122a81dbeb5c4e63b9f820",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a4e46beee57b526875122a81dbeb5c4e63b9f820"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree a4e46beee57b526875122a81dbeb5c4e63b9f820\nparent 50c5e25207efd10b47a93ca27243e6570b3b797d\nauthor furszy <matiasfurszyfer@protonmail.com> 1689211057 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1693425628 -0300\n\nwallet: compute change params only when we might produce change output\n\nInstructing coin selection to not account for the 'change' costs.\n\nFor example:\n\n* The minimum viable change will be 0, which means that the surplus\n  between inputs and outputs will never be sent to fees.\n\n* With change_fee=0:\n  - The target value being sought will be the exact target (and not\n     target + change_fee).\n  - 'GetChange' will not deduce the change_fee from the value\n     calculation.\n\n* The waste score calculation will exclude the change cost.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmTvn9wACgkQXdI8zGhq\npiORTBAAyQ96RS/Wo6XpD2worQcj+bA6wUk5EJ9tjI+f6F/LxgPASGCB1GfsCE6O\njA5nU6qpmDx9XJYadbdyrT3XkG15V1XLLKTrSrIJMoOmcsNtHkTzm6LnmB4OiOzM\nEg6t2pNSe0Iwj6nrDY1le/mgR6Cs4O5BgphkCsVZqPWLVVundzRy7blULJW9awkh\ndTNaD6Z1KDn+07+nAnJ6u5S6NfHLaPeD3DhdmvZ0Rtvr/D2qxus1EbzTe7SwNNZN\nJYhbb9bgzeRupSfX0zu/IMlyliKheBR3e4cCUoRfb4RSnidCu75VL7N2I58LTYzS\nA68goF+KlSQ7rkAMxrHBvnR0V6+W5qvTPjjwwdjpdrEPqUWx/0huMSTx13rV+Zrb\n57fDb8d2GixGR1WtLC6SCwiuAU+nhN0oJCNofi+ppVgBUUTn930UBZUWJm6MiV3y\nHgX+tDP2oPyUi1bPE6cyiTo1/PJB0rSgZWbV1Q3kaGzhL9Q8i7MQnMePBuZPJ68g\nw1qeo5M5j23Peuxj2gEnyH/RukohzQhKIL1xL65OOrQoJcWl8Y8MN3HEu+usExDE\nKCfowdFkLMMLs42Ej/lw2NKbvkLL/4THEqA2VzeDjtqiDqDBTVZT6QrmuF6nKlel\nHadPHKl3a0qEb4my5dZbjrGTLuy7wRnSFmhQ/NXjReOgCNeBF0s=\n=p+Bq\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/50c5e25207efd10b47a93ca27243e6570b3b797d",
          "sha": "50c5e25207efd10b47a93ca27243e6570b3b797d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/50c5e25207efd10b47a93ca27243e6570b3b797d"
        }
      ],
      "message": "wallet: compute change params only when we might produce change output\n\nInstructing coin selection to not account for the 'change' costs.\n\nFor example:\n\n* The minimum viable change will be 0, which means that the surplus\n  between inputs and outputs will never be sent to fees.\n\n* With change_fee=0:\n  - The target value being sought will be the exact target (and not\n     target + change_fee).\n  - 'GetChange' will not deduce the change_fee from the value\n     calculation.\n\n* The waste score calculation will exclude the change cost.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-08-30T20:00:28Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2023-07-13T01:17:37Z"
      },
      "sha": "349a8f04012a386208045e6143d2c64daea60e68"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 10236915908,
      "node_id": "HRFPE_lADOABII585lYjWozwAAAAJiKvDE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10236915908",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/349a8f04012a386208045e6143d2c64daea60e68",
      "created_at": "2023-08-30T20:03:24Z"
    },
    {
      "event": "unlabeled",
      "id": 10238456477,
      "node_id": "UNLE_lADOABII585lYjWozwAAAAJiQnKd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10238456477",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-31T00:23:38Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1707140505,
      "node_id": "IC_kwDOABII585lwOWZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1707140505",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-05T18:41:31Z",
      "updated_at": "2023-09-05T18:41:31Z",
      "author_association": "MEMBER",
      "body": "> That is not really how the wallet behaves for regular outputs. Not sure why it should\r\n> behave differently for change outputs only.\r\n\r\nThen it should just fail instead of merging the outputs. It should tell the user that they've done something wrong, as we do in the RPCs. I agree with @murchandamus's suggestion.\r\n\r\n> The only way for users to duplicate outputs destinations is to use the `createrawtransaction`\r\n> command.\r\n\r\nNo, that forbids duplicates too.\r\n\r\n> But.. this last thing also sound weird. The user provided the outputs, and also set\r\n> a custom change destination that matches one of them. So.. it should be more than\r\n> fine to interpret it as \"use this output for change\".\r\n\r\nI think the issue is mainly that this is not expected typical user behavior. We don't expect users to have an address as both a normal output and as the change address, in the same way that we don't expect users to have the same address twice. Because this is unexpected of our users, we shouldn't make assumptions about why they may be doing this and should instead tell them that they've done something unexpected.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1707140505",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "mentioned",
      "id": 10286951576,
      "node_id": "MEE_lADOABII585lYjWozwAAAAJlJmyY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10286951576",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-05T18:41:31Z"
    },
    {
      "event": "subscribed",
      "id": 10286951584,
      "node_id": "SE_lADOABII585lYjWozwAAAAJlJmyg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10286951584",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-05T18:41:31Z"
    },
    {
      "event": "reviewed",
      "id": 1613688605,
      "node_id": "PRR_kwDOABII585gLu8d",
      "url": null,
      "actor": null,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Thanks achow for the feedback :).\r\n\r\n\r\n> > That is not really how the wallet behaves for regular outputs. Not sure why it should\r\n> > behave differently for change outputs only.\r\n> \r\n> Then it should just fail instead of merging the outputs. It should tell the user that they've done something wrong, as we do in the RPCs. I agree with @murchandamus's suggestion.\r\n\r\nOk, great. We are almost on the same page. There is one point about Murch's suggestion that makes some noise in my head.\r\n\r\n#### Describing the general process first:\r\nWhen the user manually specifies a custom change address/script, the transaction creation and transaction funding processes are instructed to follow one of the following option:\r\n1) If there is an existing output matching the user provided change destination: the process will send the change amount to the existing output.\r\n2) If there is no output matching the user provided change destination: the process will create a new output under the provided destination and send the change amount to it.\r\n\r\n#### Murch's suggestion:\r\nThe only difference between the general process description and what murch suggested is the following one; he said to only perform (1) when the wallet organically detect the custom change address provided by the user as change (which makes the existing output matching this address also change). In other words, he said to only perform (1) when the wallet's `IsChange()` returns true for the provided destination.\r\n\r\n#### Now, the discussion point.\r\nWhat is the point behind forbidding this action? Does it have any advantage over the current status?\r\n\r\nIf the concerns are related to sending the change amount to an address not owned by the wallet; that is already possible today. Simply by specifying a custom change address, the user can send the change amount to any destination. This is part of the contract behind the utilization of the custom change address option.\r\n\r\nMy perspective is that what this PR introduces isn't radically different from our current process. The only difference arises when one of the user's manually specified outputs matches the user's manually specified change address. In such cases, we will increase the existing output instead of creating a second output going to the same address.\r\n\r\nI mean, I feel that what we are introducing here is a natural behavior rather than something unexpected. As a user, if I provide a custom change address that relates to one of the outputs that I provided, it suggests my intention to send the change to the existing output. I don't think that anyone would expect another behavior.\r\n\r\nBut, having that said, I agree with you that we should explicitly state this behavior on the RPC custom change address option description. So there are no doubts about it.\r\n\r\nWould you agree with this rationale, or do you still have second thoughts about it?",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1613688605",
      "submitted_at": "2023-09-06T15:52:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "commented",
      "id": 1709570158,
      "node_id": "IC_kwDOABII585l5fhu",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1709570158",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-07T06:47:33Z",
      "updated_at": "2023-09-07T06:48:02Z",
      "author_association": "CONTRIBUTOR",
      "body": "> We don't expect users to have an address as both a normal output and as the change address, in the same way that we don't expect users to have the same address twice. \r\n\r\nI think there is a difference in these two cases.\r\n\r\na) When user provided the same address twice and we show an error, then the user can easily achieve the intended goal by just summing the amounts. Having two UTXOs don't give an advantage over a one with combined amount as spending conditions are the same anyway, so there is no point.\r\n\r\nb) If user provided the same address for output and change and we show an error. What the user should do? Pick a different change address? But new change address will have different spending conditions, so this is not an equivalent substitute. And even then, it's more expensive as it forces an extra output. I could be wrong, but there is no way for the user to specify they want to send change to an existing output ",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1709570158",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "commented",
      "id": 1710576765,
      "node_id": "IC_kwDOABII585l9VR9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710576765",
      "actor": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-07T18:07:47Z",
      "updated_at": "2023-09-07T18:37:35Z",
      "author_association": "MEMBER",
      "body": "For the `send` RPC at least (have to think about the others) I think that if a user sets the same address in `outputs` and for `change_address` that should be considered an error. They should either remove it from outputs, ~or use the `change_position` argument.~\r\n\r\nBut the above doesn't answer what should happen if someone does `createrawtransaction` followed by `fundrawtransaction`.",
      "user": {
        "login": "Sjors",
        "id": 10217,
        "node_id": "MDQ6VXNlcjEwMjE3",
        "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Sjors",
        "html_url": "https://github.com/Sjors",
        "followers_url": "https://api.github.com/users/Sjors/followers",
        "following_url": "https://api.github.com/users/Sjors/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Sjors/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Sjors/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
        "organizations_url": "https://api.github.com/users/Sjors/orgs",
        "repos_url": "https://api.github.com/users/Sjors/repos",
        "events_url": "https://api.github.com/users/Sjors/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Sjors/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1710576765",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "commented",
      "id": 1710583393,
      "node_id": "IC_kwDOABII585l9W5h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1710583393",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-07T18:13:34Z",
      "updated_at": "2023-09-07T18:13:34Z",
      "author_association": "MEMBER",
      "body": "> I mean, I feel that what we are introducing here is a natural behavior rather than something unexpected. As a user, if I provide a custom change address that relates to one of the outputs that I provided, it suggests my intention to send the change to the existing output. I don't think that anyone would expect another behavior.\r\n\r\nI disagree. I think it's a mistake if that happens. If the user wants to use something for change, then they shouldn't be giving it some value first, because it's change, not an recipient.\r\n\r\nOn second thought, I think we should actually just always error, regardless of whether the wallet thinks the address is change.\r\n\r\n> If user provided the same address for output and change and we show an error. What the user should do? Pick a different change address?\r\n\r\nEither pick a different change address, or remove the output.\r\n\r\n> I could be wrong, but there is no way for the user to specify they want to send change to an existing output\r\n\r\nThere isn't, but it also doesn't make sense to me for someone to want to do that. Why specify an existing amount instead of just dropping it and letting the software add one if it has to? Maybe coin selection finds a solution that doesn't have change and the output doesn't actually need to exist.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1710583393",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "commented",
      "id": 1713262833,
      "node_id": "IC_kwDOABII585mHlDx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1713262833",
      "actor": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T06:43:38Z",
      "updated_at": "2023-09-11T06:43:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "> There isn't, but it also doesn't make sense to me for someone to want to do that. Why specify an existing amount instead of just dropping it and letting the software add one if it has to? Maybe coin selection finds a solution that doesn't have change and the output doesn't actually need to exist.\r\n\r\nI think this is the crux of the discussion here, and we should agree on the use-case before talking about implementation.\r\n\r\nSpecifying one of the existing outputs as change would be useful when a user wants to pay someone and send to themselves (at least X sats) in the same tx. I can think of following examples:\r\n* Consolidating UTXOs and adding a low priority payment to it.\r\n* Moving funds between wallets and paying someone.\r\n\r\nWhat do you think? From your experience, does it sound like realistic use-case?\r\n",
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1713262833",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "labeled",
      "id": 10330726564,
      "node_id": "LE_lADOABII585lYjWozwAAAAJnwmCk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10330726564",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-11T08:16:20Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1621391280,
      "node_id": "PRR_kwDOABII585gpHew",
      "url": null,
      "actor": null,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1621391280",
      "submitted_at": "2023-09-12T06:30:06Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "commented",
      "id": 1715795214,
      "node_id": "IC_kwDOABII585mRPUO",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1715795214",
      "actor": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-12T14:05:39Z",
      "updated_at": "2023-09-12T14:05:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Specifying one of the existing outputs as change would be useful when a user wants to pay someone and send to themselves (at least X sats) in the same tx. I can think of following examples:\r\n> \r\n>     * Consolidating UTXOs and adding a low priority payment to it.\r\n> \r\n>     * Moving funds between wallets and paying someone.\r\n> \r\n> What do you think? From your experience, does it sound like realistic use-case?\r\n\r\nYeah those sound like things that I would consider doing if I were operating a high-volume wallet, e.g. in a multi-wallet setup the receive-only wallet could send change to the cold-wallet when topping up the send-only withdrawal wallet.\r\n",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1715795214",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "reviewed",
      "id": 1622376656,
      "node_id": "PRR_kwDOABII585gs4DQ",
      "url": null,
      "actor": null,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, but I dislike the approach:",
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#pullrequestreview-1622376656",
      "submitted_at": "2023-09-12T15:52:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
    },
    {
      "event": "labeled",
      "id": 10377014041,
      "node_id": "LE_lADOABII585lYjWozwAAAAJqhKsZ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10377014041",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-14T21:22:33Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1720170327,
      "node_id": "IC_kwDOABII585mh7dX",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1720170327",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-14T21:22:34Z",
      "updated_at": "2023-09-14T21:22:34Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n🐙 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1720170327",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "commented",
      "id": 1767820945,
      "node_id": "IC_kwDOABII585pXs6R",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1767820945",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-18T07:19:30Z",
      "updated_at": "2023-10-18T07:19:30Z",
      "author_association": "MEMBER",
      "body": "Maybe mark as draft while this is stale?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1767820945",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "convert_to_draft",
      "id": 10732173852,
      "node_id": "CTDE_lADOABII585lYjWozwAAAAJ_r_oc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/10732173852",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-10-21T21:54:09Z"
    },
    {
      "event": "commented",
      "id": 1878466804,
      "node_id": "IC_kwDOABII585v9yD0",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1878466804",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-01-05T10:43:04Z",
      "updated_at": "2024-01-05T10:43:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\r\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\r\n\r\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\r\n* Is it no longer relevant? ➡️ Please close.\r\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\r\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1878466804",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "commented",
      "id": 1987836120,
      "node_id": "IC_kwDOABII5852e_jY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1987836120",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-11T08:10:54Z",
      "updated_at": "2024-03-11T08:10:54Z",
      "author_association": "MEMBER",
      "body": "Are you still working on this?",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1987836120",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "commented",
      "id": 1989555740,
      "node_id": "IC_kwDOABII5852ljYc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1989555740",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-11T22:28:44Z",
      "updated_at": "2024-03-11T22:28:44Z",
      "author_association": "MEMBER",
      "body": "> Are you still working on this?\r\n\r\nProbably next month. But no problem on closing it for now. Will re-open it or create a new one whenever I back to it.",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#issuecomment-1989555740",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27601"
    },
    {
      "event": "closed",
      "id": 12080836388,
      "node_id": "CE_lADOABII585lYjWozwAAAALQEu8k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12080836388",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-11T22:28:44Z"
    },
    {
      "event": "locked",
      "id": 16673855174,
      "node_id": "LOE_lADOABII585lYjWozwAAAAPh1tbG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16673855174",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-11T07:37:55Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230085873",
      "pull_request_review_id": 1480176356,
      "id": 1230085873,
      "node_id": "PRRC_kwDOABII585JUZ7x",
      "diff_hunk": "@@ -884,6 +874,19 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         // change keypool ran out, but change is required.\n         CHECK_NONFATAL(IsValidDestination(dest) != scriptChange.empty());\n     }\n+\n+    // Gather total out and whether SFFO is enabled or not",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "cc82f6f65a43711a36ab6b4635fc8d34082c0d4b",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n    // Gather sum of recipient output amounts and count number of outputs to subtract fees from\r\n```",
      "created_at": "2023-06-14T19:42:33Z",
      "updated_at": "2023-06-14T19:57:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1230085873",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230085873"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 878,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230096522",
      "pull_request_review_id": 1480176356,
      "id": 1230096522,
      "node_id": "PRRC_kwDOABII585JUciK",
      "diff_hunk": "@@ -987,14 +991,21 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n \n     const CAmount change_amount = result.GetChange(coin_selection_params.min_viable_change, coin_selection_params.m_change_fee);\n     if (change_amount > 0) {\n-        CTxOut newTxOut(change_amount, scriptChange);\n-        if (nChangePosInOut == -1) {\n-            // Insert change txn at random position:\n-            nChangePosInOut = rng_fast.randrange(txNew.vout.size() + 1);\n-        } else if ((unsigned int)nChangePosInOut > txNew.vout.size()) {\n-            return util::Error{_(\"Transaction change output index out of range\")};\n+        if (existent_change_out_index) {\n+            // If there is an output with the change address already, increase that one instead of creating a new output\n+            txNew.vout.at(*existent_change_out_index).nValue += change_amount;",
      "path": "src/wallet/spend.cpp",
      "position": 157,
      "original_position": 42,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "6499c4c007019945f1f42c40f70c19b781a7ae64",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I would expect `GetChange(…)` to deduct the fee for the change, but if you already have a change output, wouldn’t that mean that you account for the change fee twice? You might need to add the change_fee back in the case where you just increase an existing change output.",
      "created_at": "2023-06-14T19:54:19Z",
      "updated_at": "2023-06-14T19:57:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1230096522",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230096522"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1009,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230098983",
      "pull_request_review_id": 1480176356,
      "id": 1230098983,
      "node_id": "PRRC_kwDOABII585JUdIn",
      "diff_hunk": "@@ -315,6 +316,67 @@ def test_change_type(self):\n         dec_tx = self.nodes[2].decoderawtransaction(rawtx['hex'])\n         assert_equal('witness_v0_keyhash', dec_tx['vout'][rawtx['changepos']]['scriptPubKey']['type'])\n \n+    def test_double_change(self):\n+        self.log.info(\"Test fundrawtxn funding a tx with an existent change output and the same custom change addr\")\n+        wallet = self.nodes[0]\n+\n+        # 1) fundrawtxn shouldn't create a second change output if there is one already going to that address\n+        change_addr = wallet.getrawchangeaddress()\n+        external_addr = wallet.getnewaddress()\n+        outputs = {external_addr: Decimal(40.0), change_addr: Decimal(3)}\n+        rawtx = wallet.createrawtransaction([], outputs)\n+        funded_tx = wallet.fundrawtransaction(hexstring=rawtx, options={'changeAddress': change_addr})\n+\n+        # Verify change output existence\n+        change_pos = funded_tx['changepos']\n+        assert change_pos != -1\n+\n+        # Verify outputs now; the wallet must have increased the existent change out value instead of creating a new one\n+        dec_tx = wallet.decoderawtransaction(funded_tx['hex'])\n+        assert_equal(wallet.gettransaction(dec_tx['vin'][0]['txid'])['amount'], Decimal(50))  # assert input value\n+        assert_equal(len(dec_tx['vout']), 2)\n+        for index in range(2):\n+            out = dec_tx['vout'][index]\n+            if index == change_pos:\n+                # Change must have increased its value, change = input - outputs - fee.\n+                assert_equal(out['value'], Decimal(50) - outputs[external_addr] - funded_tx['fee'])\n+                assert_equal(out['scriptPubKey']['address'], change_addr)\n+            else:\n+                # Non-change output must remain the same\n+                assert_equal(out['value'], outputs[external_addr])\n+                assert_equal(out['scriptPubKey']['address'], external_addr)\n+\n+        # 2) Fund tx and verify that the second output going to the change address is not discarded by the wallet\n+        #    changeless txs predilection. Even when the output is \"change\" under the wallet perspective, the user has\n+        #    set it manually, so it must not be discarded.\n+        outputs = {external_addr: Decimal(\"49.998\"), change_addr: Decimal(3)}\n+        rawtx = wallet.createrawtransaction([], outputs)\n+        funded_tx = wallet.fundrawtransaction(hexstring=rawtx, options={'changeAddress': change_addr})\n+\n+        # Verify change output existence\n+        change_pos = funded_tx['changepos']\n+        assert change_pos != -1\n+\n+        # Verify outputs once more; the wallet must have increased the existent change out value instead of removing it\n+        # in favor of a changeless solution\n+        dec_tx = wallet.decoderawtransaction(funded_tx['hex'])\n+        # assert inputs value\n+        assert_equal(len(dec_tx['vin']), 2)\n+        for input in dec_tx['vin']:\n+            assert_equal(wallet.gettransaction(input['txid'])['amount'], Decimal(50))\n+\n+        assert_equal(len(dec_tx['vout']), 2)\n+        for index in range(2):\n+            out = dec_tx['vout'][index]\n+            if index == change_pos:\n+                # Change must have increased its value, change = input - outputs - fee.\n+                assert_equal(out['value'], Decimal(100) - outputs[external_addr] - funded_tx['fee'])\n+                assert_equal(out['scriptPubKey']['address'], change_addr)\n+            else:\n+                # Non-change output must remain the same\n+                assert_equal(out['value'], outputs[external_addr])\n+                assert_equal(out['scriptPubKey']['address'], external_addr)\n+",
      "path": "test/functional/wallet_fundrawtransaction.py",
      "position": 87,
      "original_position": 72,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "7ec42848aa6033ae982dbf90ef33348c979c83e0",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Perhaps you should add a test that checks how much fees you’ve paid for the change outputs. I suspect you might pay two change fees when increasing an existing change, unless that gets cleaned up in some fashion. A test that rules it out would be neat.",
      "created_at": "2023-06-14T19:57:07Z",
      "updated_at": "2023-06-14T19:57:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1230098983",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1230098983"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 387,
      "original_line": 387,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247203254",
      "pull_request_review_id": 1506174314,
      "id": 1247203254,
      "node_id": "PRRC_kwDOABII585KVs-2",
      "diff_hunk": "@@ -987,14 +991,21 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n \n     const CAmount change_amount = result.GetChange(coin_selection_params.min_viable_change, coin_selection_params.m_change_fee);\n     if (change_amount > 0) {\n-        CTxOut newTxOut(change_amount, scriptChange);\n-        if (nChangePosInOut == -1) {\n-            // Insert change txn at random position:\n-            nChangePosInOut = rng_fast.randrange(txNew.vout.size() + 1);\n-        } else if ((unsigned int)nChangePosInOut > txNew.vout.size()) {\n-            return util::Error{_(\"Transaction change output index out of range\")};\n+        if (existent_change_out_index) {\n+            // If there is an output with the change address already, increase that one instead of creating a new output\n+            txNew.vout.at(*existent_change_out_index).nValue += change_amount;",
      "path": "src/wallet/spend.cpp",
      "position": 157,
      "original_position": 42,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "6499c4c007019945f1f42c40f70c19b781a7ae64",
      "in_reply_to_id": 1230096522,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It depends on how the output was crafted. If it was created manually, it will not account for the fee. And also, it will not account for it if it was created in a previous `createTransaction` call with SFFO enabled.\r\n\r\nI think that is fine to \"overpay\" the fee at this line because later in the process (50 lines below) we check if the final fee is above the needed one, automatically increasing the change by the surplus if needed.",
      "created_at": "2023-06-29T21:42:40Z",
      "updated_at": "2023-06-29T22:00:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1247203254",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247203254"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1009,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247950494",
      "pull_request_review_id": 1507332746,
      "id": 1247950494,
      "node_id": "PRRC_kwDOABII585KYjae",
      "diff_hunk": "@@ -315,6 +316,67 @@ def test_change_type(self):\n         dec_tx = self.nodes[2].decoderawtransaction(rawtx['hex'])\n         assert_equal('witness_v0_keyhash', dec_tx['vout'][rawtx['changepos']]['scriptPubKey']['type'])\n \n+    def test_double_change(self):\n+        self.log.info(\"Test fundrawtxn funding a tx with an existent change output and the same custom change addr\")\n+        wallet = self.nodes[0]\n+\n+        # 1) fundrawtxn shouldn't create a second change output if there is one already going to that address\n+        change_addr = wallet.getrawchangeaddress()\n+        external_addr = wallet.getnewaddress()\n+        outputs = {external_addr: Decimal(40.0), change_addr: Decimal(3)}\n+        rawtx = wallet.createrawtransaction([], outputs)\n+        funded_tx = wallet.fundrawtransaction(hexstring=rawtx, options={'changeAddress': change_addr})\n+\n+        # Verify change output existence\n+        change_pos = funded_tx['changepos']\n+        assert change_pos != -1\n+\n+        # Verify outputs now; the wallet must have increased the existent change out value instead of creating a new one\n+        dec_tx = wallet.decoderawtransaction(funded_tx['hex'])\n+        assert_equal(wallet.gettransaction(dec_tx['vin'][0]['txid'])['amount'], Decimal(50))  # assert input value\n+        assert_equal(len(dec_tx['vout']), 2)\n+        for index in range(2):\n+            out = dec_tx['vout'][index]\n+            if index == change_pos:\n+                # Change must have increased its value, change = input - outputs - fee.\n+                assert_equal(out['value'], Decimal(50) - outputs[external_addr] - funded_tx['fee'])\n+                assert_equal(out['scriptPubKey']['address'], change_addr)\n+            else:\n+                # Non-change output must remain the same\n+                assert_equal(out['value'], outputs[external_addr])\n+                assert_equal(out['scriptPubKey']['address'], external_addr)\n+\n+        # 2) Fund tx and verify that the second output going to the change address is not discarded by the wallet\n+        #    changeless txs predilection. Even when the output is \"change\" under the wallet perspective, the user has\n+        #    set it manually, so it must not be discarded.\n+        outputs = {external_addr: Decimal(\"49.998\"), change_addr: Decimal(3)}\n+        rawtx = wallet.createrawtransaction([], outputs)\n+        funded_tx = wallet.fundrawtransaction(hexstring=rawtx, options={'changeAddress': change_addr})\n+\n+        # Verify change output existence\n+        change_pos = funded_tx['changepos']\n+        assert change_pos != -1\n+\n+        # Verify outputs once more; the wallet must have increased the existent change out value instead of removing it\n+        # in favor of a changeless solution\n+        dec_tx = wallet.decoderawtransaction(funded_tx['hex'])\n+        # assert inputs value\n+        assert_equal(len(dec_tx['vin']), 2)\n+        for input in dec_tx['vin']:\n+            assert_equal(wallet.gettransaction(input['txid'])['amount'], Decimal(50))\n+\n+        assert_equal(len(dec_tx['vout']), 2)\n+        for index in range(2):\n+            out = dec_tx['vout'][index]\n+            if index == change_pos:\n+                # Change must have increased its value, change = input - outputs - fee.\n+                assert_equal(out['value'], Decimal(100) - outputs[external_addr] - funded_tx['fee'])\n+                assert_equal(out['scriptPubKey']['address'], change_addr)\n+            else:\n+                # Non-change output must remain the same\n+                assert_equal(out['value'], outputs[external_addr])\n+                assert_equal(out['scriptPubKey']['address'], external_addr)\n+",
      "path": "test/functional/wallet_fundrawtransaction.py",
      "position": 87,
      "original_position": 72,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "7ec42848aa6033ae982dbf90ef33348c979c83e0",
      "in_reply_to_id": 1230098983,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yeah, it gets cleaned at the end of the tx creation process (check https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1247203254).\r\n\r\nBut new tests never hurt, so just added it inside 8f49902. Thanks for pushing me to do it.",
      "created_at": "2023-06-30T14:43:38Z",
      "updated_at": "2023-06-30T15:07:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1247950494",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247950494"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 387,
      "original_line": 387,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247950832",
      "pull_request_review_id": 1507332746,
      "id": 1247950832,
      "node_id": "PRRC_kwDOABII585KYjfw",
      "diff_hunk": "@@ -884,6 +874,19 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         // change keypool ran out, but change is required.\n         CHECK_NONFATAL(IsValidDestination(dest) != scriptChange.empty());\n     }\n+\n+    // Gather total out and whether SFFO is enabled or not",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 32,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "cc82f6f65a43711a36ab6b4635fc8d34082c0d4b",
      "in_reply_to_id": 1230085873,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "done",
      "created_at": "2023-06-30T14:43:57Z",
      "updated_at": "2023-06-30T14:44:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1247950832",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1247950832"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 878,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1250387177",
      "pull_request_review_id": 1510542857,
      "id": 1250387177,
      "node_id": "PRRC_kwDOABII585Kh2Tp",
      "diff_hunk": "@@ -987,14 +991,21 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n \n     const CAmount change_amount = result.GetChange(coin_selection_params.min_viable_change, coin_selection_params.m_change_fee);\n     if (change_amount > 0) {\n-        CTxOut newTxOut(change_amount, scriptChange);\n-        if (nChangePosInOut == -1) {\n-            // Insert change txn at random position:\n-            nChangePosInOut = rng_fast.randrange(txNew.vout.size() + 1);\n-        } else if ((unsigned int)nChangePosInOut > txNew.vout.size()) {\n-            return util::Error{_(\"Transaction change output index out of range\")};\n+        if (existent_change_out_index) {\n+            // If there is an output with the change address already, increase that one instead of creating a new output\n+            txNew.vout.at(*existent_change_out_index).nValue += change_amount;",
      "path": "src/wallet/spend.cpp",
      "position": 157,
      "original_position": 42,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "6499c4c007019945f1f42c40f70c19b781a7ae64",
      "in_reply_to_id": 1230096522,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Isn't the fee for all outputs accounted for in `not_input_fees`? It seems to me this will always overpay and then will be corrected when we detect surplus fee.\r\n\r\nMaybe a clearer way to handle this would be to pass `chnage_fee=0` to `GetChange` if `existent_change_out_index=true`. I'd prefer to minimise number of cases when we need to correct fees at the later stage of transaction building. ",
      "created_at": "2023-07-03T07:26:13Z",
      "updated_at": "2023-07-03T07:26:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1250387177",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1250387177"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1009,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1250923477",
      "pull_request_review_id": 1511239594,
      "id": 1250923477,
      "node_id": "PRRC_kwDOABII585Kj5PV",
      "diff_hunk": "@@ -987,14 +991,21 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n \n     const CAmount change_amount = result.GetChange(coin_selection_params.min_viable_change, coin_selection_params.m_change_fee);\n     if (change_amount > 0) {\n-        CTxOut newTxOut(change_amount, scriptChange);\n-        if (nChangePosInOut == -1) {\n-            // Insert change txn at random position:\n-            nChangePosInOut = rng_fast.randrange(txNew.vout.size() + 1);\n-        } else if ((unsigned int)nChangePosInOut > txNew.vout.size()) {\n-            return util::Error{_(\"Transaction change output index out of range\")};\n+        if (existent_change_out_index) {\n+            // If there is an output with the change address already, increase that one instead of creating a new output\n+            txNew.vout.at(*existent_change_out_index).nValue += change_amount;",
      "path": "src/wallet/spend.cpp",
      "position": 157,
      "original_position": 42,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "6499c4c007019945f1f42c40f70c19b781a7ae64",
      "in_reply_to_id": 1230096522,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Isn't the fee for all outputs accounted for in not_input_fees? It seems to me this will always overpay and then will be corrected when we detect surplus fee.\r\n>\r\n> Maybe a clearer way to handle this would be to pass chnage_fee=0 to GetChange if existent_change_out_index=true. I'd prefer to minimise number of cases when we need to correct fees at the later stage of transaction building.\r\n\r\nGood point.\r\nCould go further and set the coin control `m_change_fee` and `min_viable_change` to 0 so coin selection produces results closer to the target (and don't drop any sats).\r\nAnd also, another improvement idea would be to set the `change_cost` to 0 as well. But.. that would need further modifications, so probably for a follow-up, because the waste calculation is not contemplating this scenario.",
      "created_at": "2023-07-03T13:49:35Z",
      "updated_at": "2023-07-03T14:09:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1250923477",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1250923477"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1009,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264962807",
      "pull_request_review_id": 1532133649,
      "id": 1264962807,
      "node_id": "PRRC_kwDOABII585LZcz3",
      "diff_hunk": "@@ -919,21 +916,24 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         return util::Error{strprintf(_(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable %s.\"), \"-fallbackfee\")};\n     }\n \n+    // When the cost to spend a change output at the discard feerate exceeds its value, drop it to fees.\n+    CFeeRate discard_feerate = GetDiscardRate(wallet);\n+\n     // Calculate the cost of change\n     // Cost of change is the cost of creating the change output + cost of spending the change output in the future.\n     // For creating the change output now, we use the effective feerate.\n     // For spending the change output in the future, we use the discard feerate for now.\n     // So cost of change = (change output size * effective feerate) + (size of spending change output * discard feerate)\n     coin_selection_params.m_change_fee = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.change_output_size);\n-    coin_selection_params.m_cost_of_change = coin_selection_params.m_discard_feerate.GetFee(change_spend_size) + coin_selection_params.m_change_fee;\n+    coin_selection_params.m_cost_of_change = discard_feerate.GetFee(change_spend_size) + coin_selection_params.m_change_fee;",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "9dc5bbe042f4d1febde8753a8c56da35eedd9d3e",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "in 9dc5bbe042f4d1febde8753a8c56da35eedd9d3e\r\n\r\nI know this preserves current behaviour, but don't we want to use `long_term_fee_rate` to determine cost of change?\r\n\r\n@murchandamus ",
      "created_at": "2023-07-17T07:15:21Z",
      "updated_at": "2023-07-17T07:22:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1264962807",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264962807"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 928,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264968527",
      "pull_request_review_id": 1532142635,
      "id": 1264968527,
      "node_id": "PRRC_kwDOABII585LZeNP",
      "diff_hunk": "@@ -819,6 +819,41 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n+static void ComputeChangeParams(CoinSelectionParams& coin_selection_params, CWallet& wallet, const CScript& scriptChange, CAmount recipients_sum, size_t recipients_size)",
      "path": "src/wallet/spend.cpp",
      "position": 8,
      "original_position": 4,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "ea57562b4ab4071fd1a716f09e13d19ff68e99f1",
      "in_reply_to_id": null,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "in ea57562b4ab4071fd1a716f09e13d19ff68e99f1\r\n\r\nI see how it's useful for the next commit, but the contract of the method is not really clear without reading the code.",
      "created_at": "2023-07-17T07:22:15Z",
      "updated_at": "2023-07-17T07:22:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1264968527",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264968527"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 828,
      "original_line": 828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265351007",
      "pull_request_review_id": 1532781263,
      "id": 1265351007,
      "node_id": "PRRC_kwDOABII585La7lf",
      "diff_hunk": "@@ -819,6 +819,41 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n+static void ComputeChangeParams(CoinSelectionParams& coin_selection_params, CWallet& wallet, const CScript& scriptChange, CAmount recipients_sum, size_t recipients_size)",
      "path": "src/wallet/spend.cpp",
      "position": 8,
      "original_position": 4,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "ea57562b4ab4071fd1a716f09e13d19ff68e99f1",
      "in_reply_to_id": 1264968527,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Guess that you are referring to the last two args?\r\n\r\nI think that it isn't much of a problem because it is an internal static helper function.\r\n\r\nThey are needed for Knapsack min change target calculation. What maybe could do is to pass them as one: `mean_amount = std::floor(recipients_sum / recipients_size)` and document the function properly.\r\n\r\nAnd also, in a follow-up, we could go further and move the else branch of the `scriptChange` block of code inside `ComputeChangeParams` too. That part is only needed when there isn't an existent change output.",
      "created_at": "2023-07-17T13:25:11Z",
      "updated_at": "2023-07-17T13:26:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1265351007",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265351007"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 828,
      "original_line": 828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266301780",
      "pull_request_review_id": 1534298080,
      "id": 1266301780,
      "node_id": "PRRC_kwDOABII585LejtU",
      "diff_hunk": "@@ -819,6 +819,41 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n+static void ComputeChangeParams(CoinSelectionParams& coin_selection_params, CWallet& wallet, const CScript& scriptChange, CAmount recipients_sum, size_t recipients_size)",
      "path": "src/wallet/spend.cpp",
      "position": 8,
      "original_position": 4,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "ea57562b4ab4071fd1a716f09e13d19ff68e99f1",
      "in_reply_to_id": 1264968527,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Let's document which part of `CoinSelectionParams` is modified and which is not.",
      "created_at": "2023-07-18T06:39:26Z",
      "updated_at": "2023-07-18T06:39:26Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1266301780",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266301780"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 828,
      "original_line": 828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266754466",
      "pull_request_review_id": 1535007122,
      "id": 1266754466,
      "node_id": "PRRC_kwDOABII585LgSOi",
      "diff_hunk": "@@ -819,6 +819,41 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n+static void ComputeChangeParams(CoinSelectionParams& coin_selection_params, CWallet& wallet, const CScript& scriptChange, CAmount recipients_sum, size_t recipients_size)",
      "path": "src/wallet/spend.cpp",
      "position": 8,
      "original_position": 4,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "ea57562b4ab4071fd1a716f09e13d19ff68e99f1",
      "in_reply_to_id": 1264968527,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Let's document which part of CoinSelectionParams is modified and which is not.\r\n\r\n@S3RK. `CoinSelectionParams` wasn't modified. Only change related code was moved from `CreateTransactionInternal` to `ComputeChangeParams`.",
      "created_at": "2023-07-18T13:11:46Z",
      "updated_at": "2023-07-18T13:11:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1266754466",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1266754466"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 828,
      "original_line": 828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267625784",
      "pull_request_review_id": 1536386673,
      "id": 1267625784,
      "node_id": "PRRC_kwDOABII585Ljm84",
      "diff_hunk": "@@ -819,6 +819,41 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n+static void ComputeChangeParams(CoinSelectionParams& coin_selection_params, CWallet& wallet, const CScript& scriptChange, CAmount recipients_sum, size_t recipients_size)",
      "path": "src/wallet/spend.cpp",
      "position": 8,
      "original_position": 4,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "ea57562b4ab4071fd1a716f09e13d19ff68e99f1",
      "in_reply_to_id": 1264968527,
      "user": {
        "login": "S3RK",
        "id": 1466284,
        "node_id": "MDQ6VXNlcjE0NjYyODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/S3RK",
        "html_url": "https://github.com/S3RK",
        "followers_url": "https://api.github.com/users/S3RK/followers",
        "following_url": "https://api.github.com/users/S3RK/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/S3RK/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/S3RK/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
        "organizations_url": "https://api.github.com/users/S3RK/orgs",
        "repos_url": "https://api.github.com/users/S3RK/repos",
        "events_url": "https://api.github.com/users/S3RK/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/S3RK/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I mean `ComputeChangeParams` computes some of `CoinSelectionParams`, but it's not immediately obvious which ones without reading the code of the function ",
      "created_at": "2023-07-19T07:03:17Z",
      "updated_at": "2023-07-19T07:03:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1267625784",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1267625784"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 828,
      "original_line": 828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268077213",
      "pull_request_review_id": 1537099800,
      "id": 1268077213,
      "node_id": "PRRC_kwDOABII585LlVKd",
      "diff_hunk": "@@ -819,6 +819,41 @@ static void DiscourageFeeSniping(CMutableTransaction& tx, FastRandomContext& rng\n     }\n }\n \n+static void ComputeChangeParams(CoinSelectionParams& coin_selection_params, CWallet& wallet, const CScript& scriptChange, CAmount recipients_sum, size_t recipients_size)",
      "path": "src/wallet/spend.cpp",
      "position": 8,
      "original_position": 4,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "ea57562b4ab4071fd1a716f09e13d19ff68e99f1",
      "in_reply_to_id": 1264968527,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> I mean `ComputeChangeParams` computes some of `CoinSelectionParams`, but it's not immediately obvious which ones without reading the code of the function\r\n\r\nOk. Added docs.\r\nThe function calculates all the `CoinSelectionParams` fields related to 'change'. No exceptions.",
      "created_at": "2023-07-19T13:28:17Z",
      "updated_at": "2023-07-19T13:28:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1268077213",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1268077213"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 828,
      "original_line": 828,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322489602",
      "pull_request_review_id": 1621391280,
      "id": 1322489602,
      "node_id": "PRRC_kwDOABII585O05cC",
      "diff_hunk": "@@ -308,6 +309,82 @@ def test_change_type(self):\n         dec_tx = self.nodes[2].decoderawtransaction(rawtx['hex'])\n         assert_equal('witness_v0_keyhash', dec_tx['vout'][rawtx['changepos']]['scriptPubKey']['type'])\n \n+    def test_double_change(self):\n+        self.log.info(\"Test fundrawtxn funding a tx with an existent change output and the same custom change addr\")\n+        wallet = self.nodes[0]\n+        wallet.syncwithvalidationinterfacequeue()  # up-to-date wallet\n+\n+        # 1) fundrawtxn shouldn't create a second change output if there is one already going to that address\n+        change_addr = wallet.getrawchangeaddress()\n+        external_addr = wallet.getnewaddress()\n+\n+        outputs = {external_addr: Decimal(45.0), change_addr: Decimal(3)}\n+        rawtx = wallet.createrawtransaction([], outputs)\n+        funded_tx = wallet.fundrawtransaction(hexstring=rawtx, options={'changeAddress': change_addr})\n+\n+        # Verify change output existence\n+        change_pos = funded_tx['changepos']\n+        assert change_pos != -1\n+\n+        # Instead of creating a new change value, the wallet should have increased the existing one\n+        desc_tx = wallet.decoderawtransaction(funded_tx['hex'])\n+        assert_equal(wallet.gettransaction(desc_tx['vin'][0]['txid'])['amount'], Decimal(50))  # assert input value",
      "path": "test/functional/wallet_fundrawtransaction.py",
      "position": 31,
      "original_position": 31,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```\r\n test  2023-09-11T08:16:14.393000Z TestFramework (ERROR): Assertion failed \r\n                                   Traceback (most recent call last):\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/test_framework.py\", line 131, in main\r\n                                       self.run_test()\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/wallet_fundrawtransaction.py\", line 127, in run_test\r\n                                       self.test_double_change()\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/wallet_fundrawtransaction.py\", line 331, in test_double_change\r\n                                       assert_equal(wallet.gettransaction(desc_tx['vin'][0]['txid'])['amount'], Decimal(50))  # assert input value\r\n                                     File \"/ci_container_base/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_framework/util.py\", line 57, in assert_equal\r\n                                       raise AssertionError(\"not(%s)\" % \" == \".join(str(arg) for arg in (thing1, thing2) + args))\r\n                                   AssertionError: not(-5.00000000 == 50)",
      "created_at": "2023-09-12T06:30:06Z",
      "updated_at": "2023-09-12T06:30:06Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1322489602",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1322489602"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 331,
      "original_line": 331,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323119889",
      "pull_request_review_id": 1622376656,
      "id": 1323119889,
      "node_id": "PRRC_kwDOABII585O3TUR",
      "diff_hunk": "@@ -987,14 +991,21 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n \n     const CAmount change_amount = result.GetChange(coin_selection_params.min_viable_change, coin_selection_params.m_change_fee);\n     if (change_amount > 0) {\n-        CTxOut newTxOut(change_amount, scriptChange);\n-        if (nChangePosInOut == -1) {\n-            // Insert change txn at random position:\n-            nChangePosInOut = rng_fast.randrange(txNew.vout.size() + 1);\n-        } else if ((unsigned int)nChangePosInOut > txNew.vout.size()) {\n-            return util::Error{_(\"Transaction change output index out of range\")};\n+        if (existent_change_out_index) {\n+            // If there is an output with the change address already, increase that one instead of creating a new output\n+            txNew.vout.at(*existent_change_out_index).nValue += change_amount;",
      "path": "src/wallet/spend.cpp",
      "position": 157,
      "original_position": 42,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "6499c4c007019945f1f42c40f70c19b781a7ae64",
      "in_reply_to_id": 1230096522,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "No, the `not_input_fees` only includes the fee for the recipient outputs. The fee for the change output is added conditionally after determining whether there will be change.\r\n\r\nMaybe I’m misunderstanding the intention here, but it seems to me that we treat the existing change output like any other recipient. If we get here by calling RBF, wouldn’t it make sense to start a bit higher up in the call stack?\r\n\r\nPerhaps we should provide the inputs of the original transaction as the “preset inputs”, remove the change output altogether from the output list if we can identify it, then redo coin selection and create a new change output to the provided custom change address or a new change address if none has been set manually?",
      "created_at": "2023-09-12T14:19:11Z",
      "updated_at": "2023-09-12T15:52:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1323119889",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323119889"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1009,
      "original_line": 1009,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323140226",
      "pull_request_review_id": 1622376656,
      "id": 1323140226,
      "node_id": "PRRC_kwDOABII585O3YSC",
      "diff_hunk": "@@ -308,6 +309,82 @@ def test_change_type(self):\n         dec_tx = self.nodes[2].decoderawtransaction(rawtx['hex'])\n         assert_equal('witness_v0_keyhash', dec_tx['vout'][rawtx['changepos']]['scriptPubKey']['type'])\n \n+    def test_double_change(self):\n+        self.log.info(\"Test fundrawtxn funding a tx with an existent change output and the same custom change addr\")\n+        wallet = self.nodes[0]\n+        wallet.syncwithvalidationinterfacequeue()  # up-to-date wallet\n+\n+        # 1) fundrawtxn shouldn't create a second change output if there is one already going to that address",
      "path": "test/functional/wallet_fundrawtransaction.py",
      "position": 17,
      "original_position": 17,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "84a37f8a5bc52131d341a6ae9eb2d5532a010027",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Regarding the commitment message and test in 84a37f8a5bc52131d341a6ae9eb2d5532a010027 (\"test: fundrawtxn, add coverage for double change output creation\"): If there is an output with a destination address and a manually set amount, it should not be considered change but a recipient. If there is an output that was calculated automatically and goes to the change address, it can be treated as ephemeral. Is there a way for us to reliably distinguish those two scenarios?\r\n\r\nEither way, if there is a recipient with an explicitly set amount and the same address is provided as a custom change destination, that sounds like a conflicting instruction to me.",
      "created_at": "2023-09-12T14:33:07Z",
      "updated_at": "2023-09-12T15:52:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1323140226",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323140226"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 317,
      "original_line": 317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323155241",
      "pull_request_review_id": 1622376656,
      "id": 1323155241,
      "node_id": "PRRC_kwDOABII585O3b8p",
      "diff_hunk": "@@ -919,21 +916,24 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         return util::Error{strprintf(_(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable %s.\"), \"-fallbackfee\")};\n     }\n \n+    // When the cost to spend a change output at the discard feerate exceeds its value, drop it to fees.\n+    CFeeRate discard_feerate = GetDiscardRate(wallet);\n+\n     // Calculate the cost of change\n     // Cost of change is the cost of creating the change output + cost of spending the change output in the future.\n     // For creating the change output now, we use the effective feerate.\n     // For spending the change output in the future, we use the discard feerate for now.\n     // So cost of change = (change output size * effective feerate) + (size of spending change output * discard feerate)\n     coin_selection_params.m_change_fee = coin_selection_params.m_effective_feerate.GetFee(coin_selection_params.change_output_size);\n-    coin_selection_params.m_cost_of_change = coin_selection_params.m_discard_feerate.GetFee(change_spend_size) + coin_selection_params.m_change_fee;\n+    coin_selection_params.m_cost_of_change = discard_feerate.GetFee(change_spend_size) + coin_selection_params.m_change_fee;",
      "path": "src/wallet/spend.cpp",
      "position": null,
      "original_position": 24,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "9dc5bbe042f4d1febde8753a8c56da35eedd9d3e",
      "in_reply_to_id": 1264962807,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don’t know why the implementer of the waste metric in Bitcoin Core chose to use `discard_feerate` instead of `LTFRE`, but it does use `discard_feerate` throughout, so this would be consistent.",
      "created_at": "2023-09-12T14:43:31Z",
      "updated_at": "2023-09-12T15:52:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1323155241",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323155241"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 928,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323160654",
      "pull_request_review_id": 1622376656,
      "id": 1323160654,
      "node_id": "PRRC_kwDOABII585O3dRO",
      "diff_hunk": "@@ -449,7 +449,7 @@ void OutputGroupTypeMap::Push(const OutputGroup& group, OutputType type, bool in\n     }\n }\n \n-CAmount GetSelectionWaste(const std::set<std::shared_ptr<COutput>>& inputs, CAmount change_cost, CAmount target, bool use_effective_value)\n+CAmount GetSelectionWaste(const std::set<std::shared_ptr<COutput>>& inputs, std::optional<CAmount> change_cost, CAmount target, bool use_effective_value)",
      "path": "src/wallet/coinselection.cpp",
      "position": 5,
      "original_position": 5,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "83e85c058ab7b63adcd9ead3ac80c70d64cf31eb",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The majority of 83e85c058ab7b63adcd9ead3ac80c70d64cf31eb \"coinselection: option to exclude change cost from waste score\" feels like a layer violation. If we don’t create change, that should be obvious from the excess being smaller than `min_viable_change + change_fee`. Let’s please not use `change_cost` as a dual-intent variable. `change_cost`/`cost_of_change` is the amount that it would cost to create and spend a change _if there is one_. If you want to communicate the intent of not creating change explicitly, please use a separate designated variable that only communicates that and only that.\r\n\r\nIf we can identify the change output, we should remove it before coin selection, redo coin selection with the existing inputs as preset inputs and then create a new change output. The change output should absolutely be part of the waste calculation, since the replacement transaction at a higher feerate may have multiple possible input sets, some of which might be changeless, which then should be preferred by the scoring accordingly.\r\n\r\nGenerally, if a custom change output address is provided, I would read that as “if there will be change, please send it to this”. If the user wants a specific output, they should add it as a recipient. If the user wants a specific output of at least some amount without creating change, they should send a higher amount and subtract the fee from that output, or use a `sendall` with preset inputs. So I don’t see how there should ever be a case of “the user explicitly wanted a specific change”—that would be the description of a recipient output.",
      "created_at": "2023-09-12T14:47:06Z",
      "updated_at": "2023-09-12T15:52:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1323160654",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323160654"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 452,
      "original_line": 452,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323166041",
      "pull_request_review_id": 1622376656,
      "id": 1323166041,
      "node_id": "PRRC_kwDOABII585O3elZ",
      "diff_hunk": "@@ -1071,7 +1071,7 @@ BOOST_AUTO_TEST_CASE(check_max_weight)\n         rand,\n         /*change_output_size=*/34,\n         /*min_change_target=*/CENT,\n-        /*effective_feerate=*/CFeeRate(0),\n+        /*effective_feerate=*/CFeeRate(1), // tiny feerate so the waste score isn't always 0.",
      "path": "src/wallet/test/coinselector_tests.cpp",
      "position": 118,
      "original_position": 59,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "83e85c058ab7b63adcd9ead3ac80c70d64cf31eb",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I would like us to get away from predominantly using values that the wallet would never encounter in the normal operation in our tests. Unless we are testing edge cases, using values that are out-of-scope for the normal operation just confuses. Please use at least 1,000 for the effective feerate.\r\n\r\nAlso see: https://github.com/bitcoin/bitcoin/issues/27754",
      "created_at": "2023-09-12T14:50:52Z",
      "updated_at": "2023-09-12T17:46:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1323166041",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323166041"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1074,
      "original_line": 1074,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323242077",
      "pull_request_review_id": 1622376656,
      "id": 1323242077,
      "node_id": "PRRC_kwDOABII585O3xJd",
      "diff_hunk": "@@ -946,8 +946,10 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         return util::Error{strprintf(_(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable %s.\"), \"-fallbackfee\")};\n     }\n \n-    // Set the 'change' related coin selection params\n-    ComputeChangeParams(coin_selection_params, wallet, scriptChange, recipients_sum, vecSend.size());\n+    // Only compute 'change' params when we might produce a change output\n+    if (!existent_change_out_index) {\n+        ComputeChangeParams(coin_selection_params, wallet, scriptChange, recipients_sum, vecSend.size());\n+    }",
      "path": "src/wallet/spend.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "in_reply_to_id": null,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "No, please don’t do this. This is hacky and muddles meaning of variables.\r\n\r\nThe parameters of creating change are independent of whether change is created or not. In fact, we use some of these value in some of the coinselection algorithms to determine whether we have a changeless solution as well as in transaction building to determine the size of the change output. By fiddling with these values, it feels like we are coding against the implementation of the `GetChange(…)` function rather than against the function definition. Please use a new designated variable to explicitly track that transaction building should not create a change output if we absolutely must have that.\r\n\r\nI would much prefer an approach that sidesteps this entire issue by starting the creation of an RBF transaction higher in the stack where we can remove a pre-existing identifiable change output from the draft transaction before just kicking off an entire transaction building process with some preset inputs.",
      "created_at": "2023-09-12T15:45:05Z",
      "updated_at": "2023-09-12T15:52:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1323242077",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323242077"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": 950,
      "original_start_line": 950,
      "start_side": "RIGHT",
      "line": 952,
      "original_line": 952,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323487150",
      "pull_request_review_id": 1623002926,
      "id": 1323487150,
      "node_id": "PRRC_kwDOABII585O4s-u",
      "diff_hunk": "@@ -946,8 +946,10 @@ static util::Result<CreatedTransactionResult> CreateTransactionInternal(\n         return util::Error{strprintf(_(\"Fee estimation failed. Fallbackfee is disabled. Wait a few blocks or enable %s.\"), \"-fallbackfee\")};\n     }\n \n-    // Set the 'change' related coin selection params\n-    ComputeChangeParams(coin_selection_params, wallet, scriptChange, recipients_sum, vecSend.size());\n+    // Only compute 'change' params when we might produce a change output\n+    if (!existent_change_out_index) {\n+        ComputeChangeParams(coin_selection_params, wallet, scriptChange, recipients_sum, vecSend.size());\n+    }",
      "path": "src/wallet/spend.cpp",
      "position": 9,
      "original_position": 9,
      "commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "original_commit_id": "349a8f04012a386208045e6143d2c64daea60e68",
      "in_reply_to_id": 1323242077,
      "user": {
        "login": "murchandamus",
        "id": 4060799,
        "node_id": "MDQ6VXNlcjQwNjA3OTk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/murchandamus",
        "html_url": "https://github.com/murchandamus",
        "followers_url": "https://api.github.com/users/murchandamus/followers",
        "following_url": "https://api.github.com/users/murchandamus/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/murchandamus/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/murchandamus/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/murchandamus/subscriptions",
        "organizations_url": "https://api.github.com/users/murchandamus/orgs",
        "repos_url": "https://api.github.com/users/murchandamus/repos",
        "events_url": "https://api.github.com/users/murchandamus/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/murchandamus/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This is also related to https://github.com/bitcoin/bitcoin/pull/28366 (last two commits only, rest is #26152).",
      "created_at": "2023-09-12T19:48:14Z",
      "updated_at": "2023-09-12T19:48:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27601#discussion_r1323487150",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1323487150"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27601"
        }
      },
      "start_line": 950,
      "original_start_line": 950,
      "start_side": "RIGHT",
      "line": 952,
      "original_line": 952,
      "side": "RIGHT"
    }
  ]
}