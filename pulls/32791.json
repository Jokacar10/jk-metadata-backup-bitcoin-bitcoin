{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32791",
    "id": 2609011180,
    "node_id": "PR_kwDOABII586bglns",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32791",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32791.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32791.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32791",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32791/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32791/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32791/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/f6cbadaec06d51f10a9681a5d787b3781e285daa",
    "number": 32791,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "checkqueue: implement a new scriptcheck worker pool with atomic variables",
    "user": {
      "login": "HowHsu",
      "id": 38499194,
      "node_id": "MDQ6VXNlcjM4NDk5MTk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/HowHsu",
      "html_url": "https://github.com/HowHsu",
      "followers_url": "https://api.github.com/users/HowHsu/followers",
      "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
      "organizations_url": "https://api.github.com/users/HowHsu/orgs",
      "repos_url": "https://api.github.com/users/HowHsu/repos",
      "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/HowHsu/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "    TL;DR\r\n    This patchset proposes a new design of scriptcheck worker pool with\r\n    atomic variables to leverage more cpu resource on a machine which the\r\n    current mutex version cannot. Achieve about 45% boost in performance.\r\n    \r\n    Main Idea:\r\n    \r\n    The current version of worker pool use mutex to do the synchronization\r\n    between worker threads, which makes the performance downgrade after\r\n    worker_threads_num >= 14. One root cause is the high contention on the\r\n    queue's mutex among worker threads. Workers repeatedly sleep and be woken\r\n    up in short time, leading to heavy context switching.\r\n    The idea is to use atomic variables to protect the queue, workers\r\n    acquire it and increase it with a batch_size(a small number). This\r\n    significantly reduces context switching.\r\n    \r\n    Implementation\r\n    \r\n    To implement it, below changes are made:(enabled in atomic mode)\r\n    - atomic<int> nNext is used to indicate the next available indice in the\r\n      queue\r\n    - atomic<int> nTodo2 is used to indicate the number of tasks left\r\n    - nBatchSize is the batch size of tasks everytime a worker consumes\r\n      it should be small to keep workload balance among workers\r\n    - m_mutex is still used, to protect m_result and conditional vars\r\n    - fAtomic to indicate which mode is enabled\r\n    - about the queue:\r\n    \r\n      - the queue is used as queue, not stacks any more\r\n      - the queue is 'add only', which means only adding tasks to it, don't\r\n        remove used tasks.\r\n    \r\n        the above two are a must to make this idea achievable, and the\r\n        second sacrifices space\r\n    \r\n      - start the workers only after all the tasks have been added to the\r\n        queue\r\n    \r\n        this is a trade-off to make the implementaion simple, a worker can\r\n        compare nNext + nBatchSize to queue.size() to find if there are\r\n        tasks undone in the queue, otherwise another atomic<int> tail is\r\n        needed, and race condition may exist in this way (need more\r\n        investigation). From my test, it's not 100% to say this is a\r\n        'trade-off' since it also brings something good, pros && cons:\r\n        - pros:\r\n            1. no contention among producer and consumers when adding tasks\r\n               to the queue\r\n            2. the adding period is very short compared to the verification\r\n               period\r\n        - cons:\r\n            1. the workers start later\r\n    \r\n    For details, please refer to the worker handler code\r\n    \r\n    Tests:\r\n    \r\n    - Numbers\r\n      - For blocks/s numbers\r\n        `./build/bin/bench_bitcoin --filter=ConnectBlockMixedEcdsaSchnor`\r\n      - For cpu usage numbers\r\n        `NANOBENCH_ENDLESS=ConnectBlockAllEcdsa ./build/bin/bench_bitcoin --filter=ConnectBlockAllEcdsa`\r\n    \r\n      - Some data is missing because the machine was billed by time, and there wasn't\r\n        enough time to complete all measurements.\r\n      - Some cells contain a range instead of a single value due to high fluctuations\r\n      - The numbers represent the average of multiple test runs.\r\n    \r\n               |     mutex verion       |   atomic version\r\n    nr_workers | blocks/s  | cpu usage  | blocks/s  | cpu usage2\r\n    -----------|-----------|------------|-----------|-------------\r\n    0          | 4.22      | 100%       | 4.2       | 100%\r\n    1          | 8.23      | 198%       | 8         | 191.3%\r\n    2          | 12.08     | 293.7%     | 11.6      | 276%\r\n    3          | 16        | 386.7%     | 14.9      | 354.5%\r\n    4          | 19.8      | 476.3%     |           |\r\n    5          | 23.12     | 565.4%     |           |\r\n    6          | 27.3      | 654%       | 23        | 560%\r\n    7          | 28.5      | 738%       |           |\r\n    8          | 33.8      | 809%       |           |\r\n    9          | 33.5      | 868%       | 28.5      | 730%\r\n    10         | 37.4      | 910%       | 30.5      | 777%\r\n    11         | 33~40     | 880%~928%  | 32        | 825%\r\n    12         | 22~39     | 860%~925%  | 32.5      | 830%\r\n    13         | 27.8~37   | 700%~913%  | 34.8      | 928%\r\n    15         | 24.8~38.9 | 640%~719%  | 38        | 1000%\r\n    19         | 18~23     | 370%~510%  | 41        | 1161%\r\n    22         | 7~18      | 270%~400%  |           |\r\n    25         | 6.4       | 260%       | 46        | 1400%\r\n    30         | 5         | 270%       | 49        | 1560%\r\n    60         | 5         | 280%       | 50~58     | 2100%\r\n    \r\n    - Env:\r\n     A virtual machine on cloud\r\n       Architecture:          x86_64\r\n       CPU op-mode(s):        32-bit, 64-bit\r\n       Address sizes:         46 bits physical, 48 bits virtual\r\n       Byte Order:            Little Endian\r\n       CPU(s):                64\r\n       On-line CPU(s) list:   0-63\r\n       Vendor ID:             GenuineIntel\r\n       Model name:            Intel Xeon Processor (Cascadelake)\r\n       CPU family:            6\r\n       Model:                 85\r\n       Thread(s) per core:    2\r\n       Core(s) per socket:    16\r\n       Socket(s):             2\r\n       Stepping:              6\r\n       BogoMIPS:              5985.93\r\n     Virtualization features:\r\n       Hypervisor vendor:     KVM\r\n       Virtualization type:   full\r\n     Caches (sum of all):\r\n       L1d:                   2 MiB (64 instances)\r\n       L1i:                   2 MiB (64 instances)\r\n       L2:                    128 MiB (32 instances)\r\n       L3:                    32 MiB (2 instances)\r\n     NUMA:\r\n       NUMA node(s):          2\r\n       NUMA node0 CPU(s):     0-31\r\n       NUMA node1 CPU(s):     32-63\r\n    \r\n    Signed-off-by: Hao Xu <hao.xu@linux.dev>\r\n",
    "labels": [
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-06-21T12:58:58Z",
    "updated_at": "2025-06-25T07:52:54Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "2af32c3f4ce4af206b25d9afb66be44745359575",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "HowHsu:checkqueue_atomic",
      "ref": "checkqueue_atomic",
      "sha": "f6cbadaec06d51f10a9681a5d787b3781e285daa",
      "user": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 196971921,
        "node_id": "MDEwOlJlcG9zaXRvcnkxOTY5NzE5MjE=",
        "name": "bitcoin",
        "full_name": "HowHsu/bitcoin",
        "owner": {
          "login": "HowHsu",
          "id": 38499194,
          "node_id": "MDQ6VXNlcjM4NDk5MTk0",
          "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/HowHsu",
          "html_url": "https://github.com/HowHsu",
          "followers_url": "https://api.github.com/users/HowHsu/followers",
          "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
          "organizations_url": "https://api.github.com/users/HowHsu/orgs",
          "repos_url": "https://api.github.com/users/HowHsu/repos",
          "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/HowHsu/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/HowHsu/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/HowHsu/bitcoin",
        "archive_url": "https://api.github.com/repos/HowHsu/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/HowHsu/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/HowHsu/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/HowHsu/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/HowHsu/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/HowHsu/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/HowHsu/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/HowHsu/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/HowHsu/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/HowHsu/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/HowHsu/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/HowHsu/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/HowHsu/bitcoin/events",
        "forks_url": "https://api.github.com/repos/HowHsu/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/HowHsu/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/HowHsu/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/HowHsu/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/HowHsu/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/HowHsu/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/HowHsu/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/HowHsu/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/HowHsu/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/HowHsu/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/HowHsu/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/HowHsu/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/HowHsu/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/HowHsu/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/HowHsu/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/HowHsu/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:HowHsu/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/HowHsu/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/HowHsu/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/HowHsu/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/HowHsu/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/HowHsu/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/HowHsu/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/HowHsu/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/HowHsu/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/HowHsu/bitcoin/hooks",
        "svn_url": "https://github.com/HowHsu/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 0,
        "watchers_count": 0,
        "size": 262968,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-25T07:52:53Z",
        "created_at": "2019-07-15T09:53:32Z",
        "updated_at": "2025-06-06T13:52:06Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "ad654a4807cd584be9ffcd8640f628ab40cb5170",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37416,
        "stargazers_count": 84310,
        "watchers_count": 84310,
        "size": 284350,
        "default_branch": "master",
        "open_issues_count": 754,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-24T13:18:22Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-06-25T07:44:33Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32791"
      }
    },
    "author_association": "NONE",
    "draft": false,
    "additions": 128,
    "deletions": 22,
    "changed_files": 7,
    "commits": 5,
    "review_comments": 0,
    "comments": 3
  },
  "events": [
    {
      "event": "commented",
      "id": 2993567990,
      "node_id": "IC_kwDOABII586ybjj2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2993567990",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-21T12:59:01Z",
      "updated_at": "2025-06-23T15:22:07Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32791.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#32699](https://github.com/bitcoin/bitcoin/pull/32699) (docs: adds correct updated documentation links by Zeegaths)\n* [#31132](https://github.com/bitcoin/bitcoin/pull/31132) (validation: fetch block inputs on parallel threads 10% faster IBD by andrewtoth)\n* [#28690](https://github.com/bitcoin/bitcoin/pull/28690) (build: Introduce internal kernel library by TheCharlatan)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32791#issuecomment-2993567990",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32791"
    },
    {
      "event": "labeled",
      "id": 18257363085,
      "node_id": "LE_lADOABII5868pyvtzwAAAARAOUCN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18257363085",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-21T14:21:11Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 2993606610,
      "node_id": "IC_kwDOABII586ybs_S",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2993606610",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-21T14:21:13Z",
      "updated_at": "2025-06-21T14:21:13Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `no wallet, libbitcoinkernel`: https://github.com/bitcoin/bitcoin/runs/44527955551</sub>\n<sub>LLM reason (✨ experimental): The CI failed due to a linker error: undefined reference to `GetNumCores()`, indicating a missing implementation or linkage of this function.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32791#issuecomment-2993606610",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32791"
    },
    {
      "event": "reviewed",
      "id": 2948091134,
      "node_id": "PRR_kwDOABII586vuEz-",
      "url": null,
      "actor": null,
      "commit_id": "ac947ffc0bed035a0f17b9e266e37df4d5c04556",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "98b1db9283b5c04775309fa5dc2161fc597b355a",
      "user": {
        "login": "Muaytie666",
        "id": 198508825,
        "node_id": "U_kgDOC9UBGQ",
        "avatar_url": "https://avatars.githubusercontent.com/u/198508825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Muaytie666",
        "html_url": "https://github.com/Muaytie666",
        "followers_url": "https://api.github.com/users/Muaytie666/followers",
        "following_url": "https://api.github.com/users/Muaytie666/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Muaytie666/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Muaytie666/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Muaytie666/subscriptions",
        "organizations_url": "https://api.github.com/users/Muaytie666/orgs",
        "repos_url": "https://api.github.com/users/Muaytie666/repos",
        "events_url": "https://api.github.com/users/Muaytie666/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Muaytie666/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32791#pullrequestreview-2948091134",
      "submitted_at": "2025-06-22T07:49:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32791"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18260972662,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARAcFR2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18260972662",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "7d2b002255d3adb2f2c6fe2c4dbadc7b704ed18d",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/7d2b002255d3adb2f2c6fe2c4dbadc7b704ed18d",
      "created_at": "2025-06-22T11:48:11Z"
    },
    {
      "event": "commented",
      "id": 2994271363,
      "node_id": "IC_kwDOABII586yePSD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2994271363",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-22T15:16:37Z",
      "updated_at": "2025-06-22T15:16:37Z",
      "author_association": "NONE",
      "body": "hmmm...Ok, I realized that this may only be suitable for when all the preout Coin are in CCoinsViewCache, otherwise the `Add()` is not fast due to I/O there.",
      "user": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32791#issuecomment-2994271363",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32791"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18275251899,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARBSja7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18275251899",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "15ca0201205114638d75313a03d50d0460958d99",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/15ca0201205114638d75313a03d50d0460958d99",
      "created_at": "2025-06-23T14:36:20Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJjNzFkNDdlZDNlNmRmOGU0MjIzMDEwODlhMGNiMTQxZWJiNmQwMzY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c71d47ed3e6df8e422301089a0cb141ebb6d036",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2c71d47ed3e6df8e422301089a0cb141ebb6d036",
      "tree": {
        "sha": "781ed16e2a6594b0c8c2cdeaac05db5e5b51e8dc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/781ed16e2a6594b0c8c2cdeaac05db5e5b51e8dc"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8a36a471e65239ddbc6234faba6c43d902f476ab",
          "sha": "8a36a471e65239ddbc6234faba6c43d902f476ab",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8a36a471e65239ddbc6234faba6c43d902f476ab"
        }
      ],
      "message": "contrib: tracing: Correctly read msg type in p2p_monitor.py",
      "committer": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-23T15:03:16Z"
      },
      "author": {
        "name": "David Gumberg",
        "email": "davidzgumberg@gmail.com",
        "date": "2025-06-18T18:35:06Z"
      },
      "sha": "2c71d47ed3e6df8e422301089a0cb141ebb6d036"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18275795411,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARBUoHT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18275795411",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "2f9fc5dd6af524a3663bcbc09a50b8f01810681b",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/2f9fc5dd6af524a3663bcbc09a50b8f01810681b",
      "created_at": "2025-06-23T15:03:48Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18276135226,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARBV7E6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18276135226",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "32f41ba0d05114676869404f6c01d43ae990ffa0",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/32f41ba0d05114676869404f6c01d43ae990ffa0",
      "created_at": "2025-06-23T15:22:00Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18276836545,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARBYmTB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18276836545",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "a6a694a2b0ebda4108c2e9caad8dbd90e9b3ec9b",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/a6a694a2b0ebda4108c2e9caad8dbd90e9b3ec9b",
      "created_at": "2025-06-23T16:01:52Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18277697641,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARBb4hp",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18277697641",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "50a5c2cdd417bb330f6d043bbfc7e8801192aa7c",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/50a5c2cdd417bb330f6d043bbfc7e8801192aa7c",
      "created_at": "2025-06-23T16:59:17Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18293655047,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARCYwYH",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18293655047",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "299d5b565262c519c45020ebea64cad50a7a228b",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/299d5b565262c519c45020ebea64cad50a7a228b",
      "created_at": "2025-06-24T12:16:09Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18294904890,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARCdhg6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18294904890",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "a22277944028622bb497e03454738e2ddf2d9e2f",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/a22277944028622bb497e03454738e2ddf2d9e2f",
      "created_at": "2025-06-24T13:22:45Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNlZjM1ZTkxYjQzMmRmMmEyZDA4NDM2NGY0MmIxNzNiMWM5ZmVjZmQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cef35e91b432df2a2d084364f42b173b1c9fecfd",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cef35e91b432df2a2d084364f42b173b1c9fecfd",
      "tree": {
        "sha": "e6f03d0cd2e97cfcb0950cc71c6cbd9dac9fd68c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e6f03d0cd2e97cfcb0950cc71c6cbd9dac9fd68c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c71d47ed3e6df8e422301089a0cb141ebb6d036",
          "sha": "2c71d47ed3e6df8e422301089a0cb141ebb6d036",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2c71d47ed3e6df8e422301089a0cb141ebb6d036"
        }
      ],
      "message": "checkqueue: implement a new scriptcheck worker pool with atomic variables\n\nTL;DR\nThis patchset proposes a new design of scriptcheck worker pool with\natomic variables to leverage more cpu resource on a machine which the\ncurrent mutex version cannot. Achieve about 45% boost in performance.\n\nMain Idea:\n\nThe current version of worker pool use mutex to do the synchronization\nbetween worker threads, which makes the performance downgrade after\nworker_threads_num >= 14. One root cause is the high contention on the\nqueue's mutex among worker threads. Workers repeatedly sleep and be woken\nup in short time, leading to heavy context switching.\nThe idea is to use atomic variables to protect the queue, workers\nacquire it and increase it with a batch_size(a small number). This\nsignificantly reduces context switching.\n\nImplementation\n\nTo implement it, below changes are made:(enabled in atomic mode)\n- atomic<int> nNext is used to indicate the next available indice in the\n  queue\n- atomic<int> nTodo2 is used to indicate the number of tasks left\n- nBatchSize is the batch size of tasks everytime a worker consumes\n  it should be small to keep workload balance among workers\n- m_mutex is still used, to protect m_result and conditional vars\n- fAtomic to indicate which mode is enabled\n- about the queue:\n\n  - the queue is used as queue, not stacks any more\n  - the queue is 'add only', which means only adding tasks to it, don't\n    remove used tasks.\n\n    the above two are a must to make this idea achievable, and the\n    second sacrifices space\n\n  - start the workers only after all the tasks have been added to the\n    queue\n\n    this is a trade-off to make the implementaion simple, a worker can\n    compare nNext + nBatchSize to queue.size() to find if there are\n    tasks undone in the queue, otherwise another atomic<int> tail is\n    needed, and race condition may exist in this way (need more\n    investigation). From my test, it's not 100% to say this is a\n    'trade-off' since it also brings something good, pros && cons:\n    - pros:\n        1. no contention among producer and consumers when adding tasks\n           to the queue\n        2. the adding period is very short compared to the verification\n           period\n    - cons:\n        1. the workers start later\n\nFor details, please refer to the worker handler code\n\nTests:\n\n- Numbers\n  - For blocks/s numbers\n    `./build/bin/bench_bitcoin --filter=ConnectBlockMixedEcdsaSchnor`\n  - For cpu usage numbers\n    `NANOBENCH_ENDLESS=ConnectBlockAllEcdsa ./build/bin/bench_bitcoin --filter=ConnectBlockAllEcdsa`\n\n  - Some data is missing because the machine was billed by time, and there wasn't\n    enough time to complete all measurements.\n  - Some cells contain a range instead of a single value due to high fluctuations\n  - The numbers represent the average of multiple test runs.\n\n           |     mutex verion       |   atomic version\nnr_workers | blocks/s  | cpu usage  | blocks/s  | cpu usage2\n-----------|-----------|------------|-----------|-------------\n0          | 4.22      | 100%       | 4.2       | 100%\n1          | 8.23      | 198%       | 8         | 191.3%\n2          | 12.08     | 293.7%     | 11.6      | 276%\n3          | 16        | 386.7%     | 14.9      | 354.5%\n4          | 19.8      | 476.3%     |           |\n5          | 23.12     | 565.4%     |           |\n6          | 27.3      | 654%       | 23        | 560%\n7          | 28.5      | 738%       |           |\n8          | 33.8      | 809%       |           |\n9          | 33.5      | 868%       | 28.5      | 730%\n10         | 37.4      | 910%       | 30.5      | 777%\n11         | 33~40     | 880%~928%  | 32        | 825%\n12         | 22~39     | 860%~925%  | 32.5      | 830%\n13         | 27.8~37   | 700%~913%  | 34.8      | 928%\n15         | 24.8~38.9 | 640%~719%  | 38        | 1000%\n19         | 18~23     | 370%~510%  | 41        | 1161%\n22         | 7~18      | 270%~400%  |           |\n25         | 6.4       | 260%       | 46        | 1400%\n30         | 5         | 270%       | 49        | 1560%\n60         | 5         | 280%       | 50~58     | 2100%\n\n- Env:\n A virtual machine on cloud\n   Architecture:          x86_64\n   CPU op-mode(s):        32-bit, 64-bit\n   Address sizes:         46 bits physical, 48 bits virtual\n   Byte Order:            Little Endian\n   CPU(s):                64\n   On-line CPU(s) list:   0-63\n   Vendor ID:             GenuineIntel\n   Model name:            Intel Xeon Processor (Cascadelake)\n   CPU family:            6\n   Model:                 85\n   Thread(s) per core:    2\n   Core(s) per socket:    16\n   Socket(s):             2\n   Stepping:              6\n   BogoMIPS:              5985.93\n Virtualization features:\n   Hypervisor vendor:     KVM\n   Virtualization type:   full\n Caches (sum of all):\n   L1d:                   2 MiB (64 instances)\n   L1i:                   2 MiB (64 instances)\n   L2:                    128 MiB (32 instances)\n   L3:                    32 MiB (2 instances)\n NUMA:\n   NUMA node(s):          2\n   NUMA node0 CPU(s):     0-31\n   NUMA node1 CPU(s):     32-63\n\nSigned-off-by: Hao Xu <hao.xu@linux.dev>",
      "committer": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-25T07:52:38Z"
      },
      "author": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-18T15:08:32Z"
      },
      "sha": "cef35e91b432df2a2d084364f42b173b1c9fecfd"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg5NjE0YzVmM2RkMDczMDU2OTQ1ZjA0NWIwNGRjM2RkYmFmNTU4Yjk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89614c5f3dd073056945f045b04dc3ddbaf558b9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/89614c5f3dd073056945f045b04dc3ddbaf558b9",
      "tree": {
        "sha": "c15e76a8c09a0bb753768cb5a179e955bca018e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c15e76a8c09a0bb753768cb5a179e955bca018e1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cef35e91b432df2a2d084364f42b173b1c9fecfd",
          "sha": "cef35e91b432df2a2d084364f42b173b1c9fecfd",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cef35e91b432df2a2d084364f42b173b1c9fecfd"
        }
      ],
      "message": "checkqueue: set max number of scriptcheck threads to GetNumCores()\n\nThe current max number of scriptcheck threads is MAX_SCRIPTCHECK_THREADS = 14\ndue to the limitation of the current mechanism, release it to GetNumCores() as\nwe have atomic mode of scriptcheck worker pool.\n\nSigned-off-by: Hao Xu <hao.xu@linux.dev>",
      "committer": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-25T07:52:46Z"
      },
      "author": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-19T16:37:37Z"
      },
      "sha": "89614c5f3dd073056945f045b04dc3ddbaf558b9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg3NTI1YzQ4NmRiZWM0ODEyMjViYjQ2NzEyM2Q1OTVhNjA5MDg5MTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/87525c486dbec481225bb467123d595a60908911",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/87525c486dbec481225bb467123d595a60908911",
      "tree": {
        "sha": "3e9e2f8f89e6d88d54b818449eac421bba0040c3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3e9e2f8f89e6d88d54b818449eac421bba0040c3"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89614c5f3dd073056945f045b04dc3ddbaf558b9",
          "sha": "89614c5f3dd073056945f045b04dc3ddbaf558b9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/89614c5f3dd073056945f045b04dc3ddbaf558b9"
        }
      ],
      "message": "checkqueue: introduce fResultDone to accelerate worker exit path\n\nWhen verification of a transaction get failed, make workers quit the\nwork doing path and sleep immediately.\n\nSigned-off-by: Hao Xu <hao.xu@linux.dev>",
      "committer": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-25T07:52:46Z"
      },
      "author": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-19T17:22:50Z"
      },
      "sha": "87525c486dbec481225bb467123d595a60908911"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGY2Y2JhZGFlYzA2ZDUxZjEwYTk2ODFhNWQ3ODdiMzc4MWUyODVkYWE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f6cbadaec06d51f10a9681a5d787b3781e285daa",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f6cbadaec06d51f10a9681a5d787b3781e285daa",
      "tree": {
        "sha": "2869b11dd499047bcf572d1090a992fc143050d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2869b11dd499047bcf572d1090a992fc143050d1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/87525c486dbec481225bb467123d595a60908911",
          "sha": "87525c486dbec481225bb467123d595a60908911",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/87525c486dbec481225bb467123d595a60908911"
        }
      ],
      "message": "checkqueue: fix: add common/system.cpp to libbitcoinkernel\n\nGetNumCores() is now used in checkqueue related code, thus it has to be\nadded to libbitcoinkernel to keep everything ok\n\nSigned-off-by: Hao Xu <hao.xu@linux.dev>",
      "committer": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-25T07:52:46Z"
      },
      "author": {
        "name": "Hao Xu",
        "email": "hao.xu@linux.dev",
        "date": "2025-06-21T16:57:24Z"
      },
      "sha": "f6cbadaec06d51f10a9681a5d787b3781e285daa"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 18310826061,
      "node_id": "HRFPE_lADOABII5868pyvtzwAAAARDaQhN",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18310826061",
      "actor": {
        "login": "HowHsu",
        "id": 38499194,
        "node_id": "MDQ6VXNlcjM4NDk5MTk0",
        "avatar_url": "https://avatars.githubusercontent.com/u/38499194?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/HowHsu",
        "html_url": "https://github.com/HowHsu",
        "followers_url": "https://api.github.com/users/HowHsu/followers",
        "following_url": "https://api.github.com/users/HowHsu/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/HowHsu/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/HowHsu/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/HowHsu/subscriptions",
        "organizations_url": "https://api.github.com/users/HowHsu/orgs",
        "repos_url": "https://api.github.com/users/HowHsu/repos",
        "events_url": "https://api.github.com/users/HowHsu/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/HowHsu/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "f6cbadaec06d51f10a9681a5d787b3781e285daa",
      "commit_url": "https://api.github.com/repos/HowHsu/bitcoin/commits/f6cbadaec06d51f10a9681a5d787b3781e285daa",
      "created_at": "2025-06-25T07:52:54Z"
    }
  ],
  "comments": []
}