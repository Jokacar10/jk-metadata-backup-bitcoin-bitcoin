{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742",
    "id": 1363377743,
    "node_id": "PR_kwDOABII585RQ35P",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/27742",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/27742.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/27742.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/2614777aa14f232f74cad18af44f7c6509a61528",
    "number": 27742,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "[NO MERGE] BIP331 Ancestor Package Relay",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "**WORK IN PROGRESS.** Please do not run it for any use other than testing.\r\n  \r\nThis PR is not meant for merge. This branch exists to help reviewers see what package relay would look like all together. I will open separate PRs for these components and expect to add more tests, docs, and polish along the way. This PR contains all of the functionality built in a linear manner. However, since there are pieces in various areas of the codebase and they can make progress in parallel, commits don't necessarily need to be merged in this order.\r\n\r\n**See #27463 for what PR(s) are open for review right now.**\r\n\r\n## Note to Reviewers\r\n\r\nThe major purpose of this PR is to solicit \"approach\" review.\r\n\r\nThis is a large project, and the first few p2p commits essentially define the interface. I'd like to get rough consensus on approach before we start looking at code details and merging PRs, because I believe it will help us \"get useful stuff in\" faster and avoid premature optimizations.\r\n\r\nHere are some questions I hope are answered before we try to merge anything (originally https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1572205313):\r\n\r\n1. Does the proposed protocol look sound?\r\n2. Are these 3 milestones appropriate?\r\n3. Is there important functionality that is in the \"todo improvements\" section but should be included in one of the 3 milestones? Alternatively, is there not-that-important stuff in the milestones that we should defer until later?\r\n4. Does it make sense to have this PeerManager <-> TxDownloadMan interface?\r\n\r\nComments about naming, typos, code details, etc. are also appreciated but please note I may wait until their respective PRs are open to incorporate your comments. Thank you for your patience.\r\n\r\n### Design Docs\r\n\r\nBIP: https://github.com/bitcoin/bips/pull/1382\r\nOrphanage changes: https://gist.github.com/glozow/7c0ff639f996e660146314edffa6f06c\r\n\r\n## Project Structure\r\n\r\n### 3 Major Milestones\r\n\r\nThis project is split into 3 milestones, each of which gives us something useful.\r\n\r\n1. Modularize and improve orphan-handling (also some refactoring).\r\n\t- Introduce a `TxDownloadManager` class, responsible for downloading transactions that have been announced to us.\r\n\t- Use all announcers as potential candidates for resolving an orphan. Add a `TxRequestTracker` Orphan Request Tracker which helps track orphans we need to resolve. Preferentially request orphan resolution from outbounds, preferred relay, etc., over inbounds.\r\n\r\n2. When package relay peers are available, use `ancpkginfo` instead of missing parents when handling orphans.\r\n\t- Add `sendpackages` negotiation logic.\r\n\t- Add a separate rejections filter for transactions that are eligible for reconsideration when validated together as a package, so that children of low-feerate transactions are still considered.\r\n\t- Send `getdata(MSG_ANCPKGINFO)` to package relay peers for orphan resolution. Use `ancpkginfo` to request missing ancestors through normal individual transaction relay.\r\n\r\n3. Download and validate ancestor packages using `getpkgtxns` and `pkgtxns`.\r\n\t- Add support for `getpkgtxns` and `pkgtxns`. Send a `pkgtxns` using the list of missing transactions from `ancpkginfo`.\r\n\t- Ensure we can process \"normal\" orphans even if a peer is trying to overwhelm/churn our orphanage. Do this by \"opportunistically\" protecting orphans from random eviction if they were sent by package relay peers, and redownloading orphans if we cannot afford to protect them. Each peer is allocated a certain amount of orphans they can protect at a time (\"token bucket\" style but the number of tokens is static for now). Outbound peers get more than inbounds.\r\n\t- If a transaction's parent(s) are below the fee filter, don't announce it (save the bandwidth of legacy nodes).\r\n\r\n###  Todo improvements \r\nThese could be added to the milestones or deferred until basic functionality is deployed.\r\n- Store orphans serialized instead of as CTransactionRefs to significantly reduce their memory usage.\r\n- Perhaps try to keep orphans in disk and/or process them asynchronously, given the incredibly DoSable nature of orphan handling.\r\n- Dynamically allocate tokens for orphan protection. For example, if a long-standing inbound peer continuously provides good packages for orphans, they should have more tokens. If a peer is obviously serving us garbage, reduce their tokens.\r\n- Detect when we have received all the transactions for a package, regardless of how (individual or block or other), and return `PackageToValidate`  in `GetTxToReconsider`.\r\n- New format for mempool.dat, packages instead of transactions.",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      },
      {
        "id": 955867938,
        "node_id": "MDU6TGFiZWw5NTU4Njc5Mzg=",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Needs%20rebase",
        "name": "Needs rebase",
        "description": "",
        "color": "cccccc",
        "default": false
      },
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2023-05-24T15:38:55Z",
    "updated_at": "2025-06-04T00:00:39Z",
    "mergeable": false,
    "mergeable_state": "dirty",
    "merged": false,
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": false,
    "head": {
      "label": "glozow:package-relay-token-bucket",
      "ref": "package-relay-token-bucket",
      "sha": "2614777aa14f232f74cad18af44f7c6509a61528",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 244262754,
        "node_id": "MDEwOlJlcG9zaXRvcnkyNDQyNjI3NTQ=",
        "name": "bitcoin",
        "full_name": "glozow/bitcoin",
        "owner": {
          "login": "glozow",
          "id": 25183001,
          "node_id": "MDQ6VXNlcjI1MTgzMDAx",
          "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/glozow",
          "html_url": "https://github.com/glozow",
          "followers_url": "https://api.github.com/users/glozow/followers",
          "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
          "organizations_url": "https://api.github.com/users/glozow/orgs",
          "repos_url": "https://api.github.com/users/glozow/repos",
          "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/glozow/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/glozow/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/glozow/bitcoin",
        "archive_url": "https://api.github.com/repos/glozow/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/glozow/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/glozow/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/glozow/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/glozow/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/glozow/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/glozow/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/glozow/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/glozow/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/glozow/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/glozow/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/glozow/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/glozow/bitcoin/events",
        "forks_url": "https://api.github.com/repos/glozow/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/glozow/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/glozow/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/glozow/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/glozow/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/glozow/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/glozow/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/glozow/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/glozow/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/glozow/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/glozow/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/glozow/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/glozow/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/glozow/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/glozow/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/glozow/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:glozow/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/glozow/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/glozow/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/glozow/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/glozow/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/glozow/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/glozow/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/glozow/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/glozow/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/glozow/bitcoin/hooks",
        "svn_url": "https://github.com/glozow/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 4,
        "stargazers_count": 15,
        "watchers_count": 15,
        "size": 273715,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-03T21:30:56Z",
        "created_at": "2020-03-02T02:31:56Z",
        "updated_at": "2025-06-03T14:57:22Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "f08d914a678f7ceb81e7584efe92d3840f3b9c95",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37310,
        "stargazers_count": 83952,
        "watchers_count": 83952,
        "size": 283271,
        "default_branch": "master",
        "open_issues_count": 745,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-03T19:21:22Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-06-03T22:54:10Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
      }
    },
    "author_association": "MEMBER",
    "draft": true,
    "additions": 3962,
    "deletions": 307,
    "changed_files": 39,
    "commits": 58,
    "review_comments": 130,
    "comments": 19
  },
  "events": [
    {
      "event": "commented",
      "id": 1561395468,
      "node_id": "IC_kwDOABII585dEQEM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1561395468",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T15:38:59Z",
      "updated_at": "2023-12-18T09:45:20Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/27742).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#28107](https://github.com/bitcoin/bitcoin/pull/28107) (rfc: Type-safe transaction identifiers by dergoegge)\n* [#28066](https://github.com/bitcoin/bitcoin/pull/28066) (fuzz: Generate process_message targets individually by MarcoFalke)\n* [#28043](https://github.com/bitcoin/bitcoin/pull/28043) (fuzz: Test headers pre-sync through p2p interface by dergoegge)\n* [#28031](https://github.com/bitcoin/bitcoin/pull/28031) (Package Relay 1/3: Introduce TxPackageTracker as Orphan Resolution Module by glozow)\n* [#27837](https://github.com/bitcoin/bitcoin/pull/27837) (net: introduce block tracker to retry to download blocks after failure by furszy)\n* [#27675](https://github.com/bitcoin/bitcoin/pull/27675) (p2p: Drop m_recently_announced_invs bloom filter by ajtowns)\n* [#27509](https://github.com/bitcoin/bitcoin/pull/27509) (Relay own transactions only via short-lived Tor or I2P connections by vasild)\n* [#27499](https://github.com/bitcoin/bitcoin/pull/27499) (net processing, refactor: Decouple PeerManager from gArgs by dergoegge)\n* [#27452](https://github.com/bitcoin/bitcoin/pull/27452) (test: cover addrv2 anchors by adding TorV3 to CAddress in messages.py by pinheadmz)\n* [#27385](https://github.com/bitcoin/bitcoin/pull/27385) (net, refactor: extract Network and BIP155Network logic to node/network by jonatack)\n* [#26711](https://github.com/bitcoin/bitcoin/pull/26711) (validate package transactions with their in-package ancestor sets by glozow)\n* [#26697](https://github.com/bitcoin/bitcoin/pull/26697) (logging: use bitset for categories by LarryRuane)\n* [#26621](https://github.com/bitcoin/bitcoin/pull/26621) (refactor: Continue moving application data from CNode to Peer by dergoegge)\n* [#26451](https://github.com/bitcoin/bitcoin/pull/26451) (Enforce incentive compatibility for all RBF replacements by sdaftuar)\n* [#25572](https://github.com/bitcoin/bitcoin/pull/25572) (refactor: Introduce EvictionManager and use it for the inbound eviction logic by dergoegge)\n* [#25268](https://github.com/bitcoin/bitcoin/pull/25268) (refactor: Introduce EvictionManager by dergoegge)\n* [#20892](https://github.com/bitcoin/bitcoin/pull/20892) (tests: Run both descriptor and legacy tests within a single test invocation by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1561395468",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "labeled",
      "id": 9329566212,
      "node_id": "LE_lADOABII585mxnIEzwAAAAIsFeIE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9329566212",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-24T15:39:40Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    },
    {
      "event": "labeled",
      "id": 9335701409,
      "node_id": "LE_lADOABII585mxnIEzwAAAAIsc3-h",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9335701409",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-05-25T06:04:15Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9379839908,
      "node_id": "HRFPE_lADOABII585mxnIEzwAAAAIvFP-k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9379839908",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "ae5556186b6f4b17825981895ffab0a51fcdb483",
      "commit_url": "https://api.github.com/repos/glozow/bitcoin/commits/ae5556186b6f4b17825981895ffab0a51fcdb483",
      "created_at": "2023-05-30T15:18:57Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9388508780,
      "node_id": "HRFPE_lADOABII585mxnIEzwAAAAIvmUZs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9388508780",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "9cfb77516b83e960ff90a517270f6d4e67f7b31f",
      "commit_url": "https://api.github.com/repos/glozow/bitcoin/commits/9cfb77516b83e960ff90a517270f6d4e67f7b31f",
      "created_at": "2023-05-31T10:33:16Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9391031418,
      "node_id": "HRFPE_lADOABII585mxnIEzwAAAAIvv8R6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9391031418",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": "https://api.github.com/repos/glozow/bitcoin/commits/cdb5b163d623db802ed7f8a3394b2674362f409b",
      "created_at": "2023-05-31T14:05:31Z"
    },
    {
      "event": "unlabeled",
      "id": 9397201008,
      "node_id": "UNLE_lADOABII585mxnIEzwAAAAIwHehw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9397201008",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-01T01:56:27Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1572135299,
      "node_id": "IC_kwDOABII585dtOGD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1572135299",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-01T14:12:00Z",
      "updated_at": "2023-06-01T14:12:00Z",
      "author_association": "MEMBER",
      "body": "> Approach review is very welcome on this PR\r\n\r\ndidn't real whole OP until now. In my not expert opinion, the orphan handling seems reasonable, and I think it makes to open it ASAP to take it out of draft",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1572135299",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 1572205313,
      "node_id": "IC_kwDOABII585dtfMB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1572205313",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-01T14:51:07Z",
      "updated_at": "2023-06-01T14:51:07Z",
      "author_association": "MEMBER",
      "body": "Offline feedback suggested I clarify what I mean by \"approach feedback welcome\" before \"I open separate PRs.\"\r\n\r\nThis is a large project, and the first few p2p commits essentially define the interface. I'd like to get rough consensus on approach before we start looking at code details and merging PRs, because I believe it will help us \"get useful stuff in\" faster and avoid premature optimizations.\r\n\r\nHere are some approach questions I think we should answer before diving in:\r\n1. Does the proposed protocol look sound?\r\n2. Are these 3 milestones appropriate?\r\n3. Is there important functionality that is in the \"todo improvements\" section but should be included in one of the 3 milestones? Alternatively, is there not-that-important stuff in the milestones that we should defer until later?\r\n4. Does it make sense to have this `PeerManager` <-> `TxPackageTracker` <-> `TxOrphanage` relationship?",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1572205313",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 1572526838,
      "node_id": "IC_kwDOABII585dutr2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1572526838",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-01T17:50:43Z",
      "updated_at": "2023-06-01T17:51:18Z",
      "author_association": "MEMBER",
      "body": "> redownloading orphans if we cannot afford to protect them\r\n\r\nIs the idea here that protection is a bandiwdth optimization to avoid fetching an orphan twice in a row in the presence of malicious peers or random churn? Reasonable if so, just want this to be explicitly stated if so.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1572526838",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 1573521731,
      "node_id": "IC_kwDOABII585dyglD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1573521731",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-02T10:38:52Z",
      "updated_at": "2023-06-02T10:38:52Z",
      "author_association": "MEMBER",
      "body": "> > redownloading orphans if we cannot afford to protect them\r\n> \r\n> Is the idea here that protection is a bandiwdth optimization to avoid fetching an orphan twice in a row in the presence of malicious peers or random churn? Reasonable if so, just want this to be explicitly stated if so.\r\n\r\nYes exactly. Worse is we want to avoid a situation where we requested the rest of the package while the orphan was in our orphanage, but then it fell out while we were waiting for the rest of the transactions. Then, we should re-download the orphan, but what do we do with the rest of them? We basically have to redownload the whole thing again, otherwise we might end up in an endless cycle of redownloading if we put them into an orphanage but don't necessarily protect them from eviction.\r\n\r\nHere is a more detailed doc for the orphanage protection and \"token bucket\" scheme: https://gist.github.com/glozow/7c0ff639f996e660146314edffa6f06c.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1573521731",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "reviewed",
      "id": 1451533873,
      "node_id": "PRR_kwDOABII585WhKYx",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Along with the gist, focused on orphan protection and bucketing for concept understanding. Dumping comments related to those, and left a note on the gist.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1451533873",
      "submitted_at": "2023-06-02T14:42:30Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1457677374,
      "node_id": "PRR_kwDOABII585W4mQ-",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Along with the gist, focused on orphan protection and bucketing for concept understanding. Dumping comments related to those, and left a note on the gist.",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1457677374",
      "submitted_at": "2023-06-02T14:42:35Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1458284571,
      "node_id": "PRR_kwDOABII585W66gb",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1458284571",
      "submitted_at": "2023-06-02T19:14:48Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1470579458,
      "node_id": "PRR_kwDOABII585Xp0MC",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "another bucket of comments to respond to later",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1470579458",
      "submitted_at": "2023-06-14T16:15:40Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1488606572,
      "node_id": "PRR_kwDOABII585YulVs",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1488606572",
      "submitted_at": "2023-06-20T17:00:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1488612374,
      "node_id": "PRR_kwDOABII585YumwW",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1488612374",
      "submitted_at": "2023-06-20T17:04:23Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "labeled",
      "id": 9593144218,
      "node_id": "LE_lADOABII585mxnIEzwAAAAI7y8Oa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9593144218",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-06-21T12:37:46Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1492306150,
      "node_id": "PRR_kwDOABII585Y8sjm",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1492306150",
      "submitted_at": "2023-06-22T05:27:10Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1493665162,
      "node_id": "PRR_kwDOABII585ZB4WK",
      "url": null,
      "actor": null,
      "commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "I reviewed part 1 (orphan handling), will continue to the p2p part next week.\r\n\r\nThese changes make sense to me on a high level, I think it would be ok to open a separate non-draft PR for this - \r\n maybe after adding some more context to commit messages, for example it would make review easier if there is a short explanation why something is changed, even if it becomes apparent in later commits.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1493665162",
      "submitted_at": "2023-06-22T22:58:28Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE3NDRjN2FlNWMyOTdkMzU1ZjA1ODdmYTA5OGVmYjg3NzdkNjg3ODQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a744c7ae5c297d355f0587fa098efb8777d68784",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a744c7ae5c297d355f0587fa098efb8777d68784",
      "tree": {
        "sha": "7458642d9754e1baab50c1b60df1e37608ba1684",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7458642d9754e1baab50c1b60df1e37608ba1684"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f08d914a678f7ceb81e7584efe92d3840f3b9c95",
          "sha": "f08d914a678f7ceb81e7584efe92d3840f3b9c95",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f08d914a678f7ceb81e7584efe92d3840f3b9c95"
        }
      ],
      "message": "[validation] require child feerate > package feerate",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-05-10T16:02:41Z"
      },
      "sha": "a744c7ae5c297d355f0587fa098efb8777d68784"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDgyMWY4NjVmMTM0ZWVhYzYwM2Q3YTMzMTBiMzkxZTNkODY2OTRjOTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/821f865f134eeac603d7a3310b391e3d86694c95",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/821f865f134eeac603d7a3310b391e3d86694c95",
      "tree": {
        "sha": "e3fab8401bc807aa2b4bc5ff6bfd4d03d0b5347f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e3fab8401bc807aa2b4bc5ff6bfd4d03d0b5347f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a744c7ae5c297d355f0587fa098efb8777d68784",
          "sha": "a744c7ae5c297d355f0587fa098efb8777d68784",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a744c7ae5c297d355f0587fa098efb8777d68784"
        }
      ],
      "message": "[test util] multi-input multi-output CreateValidMempoolTransaction",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-10-03T09:56:00Z"
      },
      "sha": "821f865f134eeac603d7a3310b391e3d86694c95"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYyYjIxNzBkNjg5Nzg3OWQ3ZmFlZDEzZWQwN2RiZWViMmIzMWZiNTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f2b2170d6897879d7faed13ed07dbeeb2b31fb54",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f2b2170d6897879d7faed13ed07dbeeb2b31fb54",
      "tree": {
        "sha": "575b55a6fa332576eae94c31a96f64acf4ab04e4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/575b55a6fa332576eae94c31a96f64acf4ab04e4"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/821f865f134eeac603d7a3310b391e3d86694c95",
          "sha": "821f865f134eeac603d7a3310b391e3d86694c95",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/821f865f134eeac603d7a3310b391e3d86694c95"
        }
      ],
      "message": "[unit test] parent pay for child is not allowed\n\nCo-authored-by: Andrew Chow <achow101@gmail.com>",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-05-10T18:46:26Z"
      },
      "sha": "f2b2170d6897879d7faed13ed07dbeeb2b31fb54"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFlNjVkM2QwMTNiZjY0MTQ3M2IyNDBhMmQ2YmQ4NzI4MWMzZTMwNTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e65d3d013bf641473b240a2d6bd87281c3e3054",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1e65d3d013bf641473b240a2d6bd87281c3e3054",
      "tree": {
        "sha": "7928b2a97768ef8c6ffb59d71f0d10a0caec17a8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7928b2a97768ef8c6ffb59d71f0d10a0caec17a8"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f2b2170d6897879d7faed13ed07dbeeb2b31fb54",
          "sha": "f2b2170d6897879d7faed13ed07dbeeb2b31fb54",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f2b2170d6897879d7faed13ed07dbeeb2b31fb54"
        }
      ],
      "message": "[rpc] allow submitpackage to be called outside of regtest",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-11T15:07:34Z"
      },
      "sha": "1e65d3d013bf641473b240a2d6bd87281c3e3054"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU1ZWMzZDMyNWRiYjg0MTRkNDk1NGZhMDg2ODJlNzA1YzBmOTRkNTc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e5ec3d325dbb8414d4954fa08682e705c0f94d57",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e5ec3d325dbb8414d4954fa08682e705c0f94d57",
      "tree": {
        "sha": "54d4270208b7c8191f2125c89c6950d82ac7abdb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/54d4270208b7c8191f2125c89c6950d82ac7abdb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e65d3d013bf641473b240a2d6bd87281c3e3054",
          "sha": "1e65d3d013bf641473b240a2d6bd87281c3e3054",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1e65d3d013bf641473b240a2d6bd87281c3e3054"
        }
      ],
      "message": "[doc] add release note for submitpackage",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-05-10T15:43:05Z"
      },
      "sha": "e5ec3d325dbb8414d4954fa08682e705c0f94d57"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDhiNzI0ZWU5MmUyNTM4ZDA3MmMzNDdiNTk1ZjNmOThlMDhiOWI0NTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8b724ee92e2538d072c347b595f3f98e08b9b451",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/8b724ee92e2538d072c347b595f3f98e08b9b451",
      "tree": {
        "sha": "1024c7345db7ea6f3b1517669924e1498f66a50a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1024c7345db7ea6f3b1517669924e1498f66a50a"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e5ec3d325dbb8414d4954fa08682e705c0f94d57",
          "sha": "e5ec3d325dbb8414d4954fa08682e705c0f94d57",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e5ec3d325dbb8414d4954fa08682e705c0f94d57"
        }
      ],
      "message": "[validation] call AcceptSingleTransaction when only 1 package tx left\n\nAvoid calling PackageMempoolChecks() when there is only 1 transaction.\nNote to reviewers: there is a slight change in the error type returned,\nas shown in the txpackage_tests change.  When a transaction is the last\none left in the package and its fee is too low, this returns a PCKG_TX\ninstead of PCKG_POLICY. This interface is clearer;\n\"package-fee-too-low\" for 1 transaction would be a bit misleading.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-12-15T18:00:04Z"
      },
      "sha": "8b724ee92e2538d072c347b595f3f98e08b9b451"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNhNzUwN2I1ZDVjNWVmMjQ4OGRjNjA0ZTE3N2QwYmQ4ZjM1NTI2NzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca7507b5d5c5ef2488dc604e177d0bd8f3552675",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ca7507b5d5c5ef2488dc604e177d0bd8f3552675",
      "tree": {
        "sha": "7552e509f96c840db7eb4c7bbf0ca3a9e8209880",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7552e509f96c840db7eb4c7bbf0ca3a9e8209880"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8b724ee92e2538d072c347b595f3f98e08b9b451",
          "sha": "8b724ee92e2538d072c347b595f3f98e08b9b451",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/8b724ee92e2538d072c347b595f3f98e08b9b451"
        }
      ],
      "message": "MOVEONLY: move package checks into helper functions",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-09-16T15:49:24Z"
      },
      "sha": "ca7507b5d5c5ef2488dc604e177d0bd8f3552675"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQ4YjEzYmMyYjJmNzBjZWE0MDQwMGYxMGY3ZTJkNTQ4Yzc4NTYwNTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d8b13bc2b2f70cea40400f10f7e2d548c7856055",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d8b13bc2b2f70cea40400f10f7e2d548c7856055",
      "tree": {
        "sha": "d6b2cc7c4d74f386d3b3ca0080abe8affb451850",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d6b2cc7c4d74f386d3b3ca0080abe8affb451850"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ca7507b5d5c5ef2488dc604e177d0bd8f3552675",
          "sha": "ca7507b5d5c5ef2488dc604e177d0bd8f3552675",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ca7507b5d5c5ef2488dc604e177d0bd8f3552675"
        }
      ],
      "message": "scripted-diff: rename CheckPackage to IsPackageWellFormed\n\n-BEGIN VERIFY SCRIPT-\nsed -i 's/CheckPackage(/IsPackageWellFormed(/g' $(git grep -l CheckPackage)\n-END VERIFY SCRIPT-",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-19T17:31:58Z"
      },
      "sha": "d8b13bc2b2f70cea40400f10f7e2d548c7856055"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVjNWVkZDJiMGQzNTgwNTQ5NDgzOTQ1NmQ4ZDlkMTA1NzUxYWM3MDA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c5edd2b0d35805494839456d8d9d105751ac700",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5c5edd2b0d35805494839456d8d9d105751ac700",
      "tree": {
        "sha": "6445e5b1150a682a0cdae57b6252b23ea097d1bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6445e5b1150a682a0cdae57b6252b23ea097d1bc"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d8b13bc2b2f70cea40400f10f7e2d548c7856055",
          "sha": "d8b13bc2b2f70cea40400f10f7e2d548c7856055",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d8b13bc2b2f70cea40400f10f7e2d548c7856055"
        }
      ],
      "message": "[packages] AncestorPackage sorts and builds ancestor subsets\n\nWe cannot require that peers send topologically sorted lists, because we\ncannot check for this property without ensuring we have the same chain\ntip and ensuring we have the full ancestor set. Instead, add the ability\nto handle arbitrarily ordered transaction lists.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-09-16T15:51:36Z"
      },
      "sha": "5c5edd2b0d35805494839456d8d9d105751ac700"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDE0YjdhNzMwMmVmODYxYWYyYzM5ZDU2OTBjNWRiNjg4NTE4ZmI0MDI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/14b7a7302ef861af2c39d5690c5db688518fb402",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/14b7a7302ef861af2c39d5690c5db688518fb402",
      "tree": {
        "sha": "baf04f9fdc3934a2dbf2e6980bdb9af7ee8fde36",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/baf04f9fdc3934a2dbf2e6980bdb9af7ee8fde36"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5c5edd2b0d35805494839456d8d9d105751ac700",
          "sha": "5c5edd2b0d35805494839456d8d9d105751ac700",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5c5edd2b0d35805494839456d8d9d105751ac700"
        }
      ],
      "message": "[fuzz] AncestorPackage",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-16T15:31:44Z"
      },
      "sha": "14b7a7302ef861af2c39d5690c5db688518fb402"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUzMTE0OTBlMGRkMjA3OWNhM2E0Y2FkNmVlYmU4MTA4NzYwM2Y0MTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5311490e0dd2079ca3a4cad6eebe81087603f410",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5311490e0dd2079ca3a4cad6eebe81087603f410",
      "tree": {
        "sha": "dd85d99520e8e098bc0adad5cea49b415aa055dc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dd85d99520e8e098bc0adad5cea49b415aa055dc"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/14b7a7302ef861af2c39d5690c5db688518fb402",
          "sha": "14b7a7302ef861af2c39d5690c5db688518fb402",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/14b7a7302ef861af2c39d5690c5db688518fb402"
        }
      ],
      "message": "[validation] skip and pre-fill txns with irreversibly invalid ancestors\n\nPackageifier calculates the in-package ancestors. We already know\nthis tx will fail because it depends on something invalid (specifically\nfor a non-policy reason). We also know that it is missing at least one\ninput (the tx that did not and will not make it into our mempool).\n\nNote to reviewers: slight behavior change. If this tx has multiple\nerrors, there may be a difference in which one is returned. For\nexample, if the tx has a dust output in addition to relying on\nthe invalid tx, we will return TX_MISSING_INPUTS when we previously\nwould have returned TX_NOT_STANDARD. This is simply because dust is\nchecked earlier within PreChecks().\n\nAdd a test that we don't quit *too* early and reject transactions we\nshould keep.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-12-14T13:38:32Z"
      },
      "sha": "5311490e0dd2079ca3a4cad6eebe81087603f410"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYwZTc0YzBkMTAwZjJiNzI5YTUxOTFlN2IxOTgzMzQwNGQ4ZTgwM2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f0e74c0d100f2b729a5191e7b19833404d8e803f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f0e74c0d100f2b729a5191e7b19833404d8e803f",
      "tree": {
        "sha": "4f415d83538e392894dc47d086eef542a42ac4f1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4f415d83538e392894dc47d086eef542a42ac4f1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5311490e0dd2079ca3a4cad6eebe81087603f410",
          "sha": "5311490e0dd2079ca3a4cad6eebe81087603f410",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5311490e0dd2079ca3a4cad6eebe81087603f410"
        }
      ],
      "message": "[validation] skip last tx in AcceptPackage \"submit individually\" loop\n\nPrior to this commit, if the last tx is invalid for a policy, missing\ninputs, or \"mempool full\", we validate it twice (once inside this loop,\nand then again afterwards). This is unnecessary.\nIf we come to the last transaction in the package, break.\n\nThis needs to be after the !subpackage quit early condition so that\nthat the child is present in the results map.\n\nsubfill the child state for missing inputs",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-12-16T10:31:52Z"
      },
      "sha": "f0e74c0d100f2b729a5191e7b19833404d8e803f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDdmMWQ0MmFjMTBhNDFjZmY4ZDQzNDVhZGY1N2ZkZThhMDdjMWE2MmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7f1d42ac10a41cff8d4345adf57fde8a07c1a62c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/7f1d42ac10a41cff8d4345adf57fde8a07c1a62c",
      "tree": {
        "sha": "1e93693265c28e2a2794c354d951b47bcbd78486",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1e93693265c28e2a2794c354d951b47bcbd78486"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f0e74c0d100f2b729a5191e7b19833404d8e803f",
          "sha": "f0e74c0d100f2b729a5191e7b19833404d8e803f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f0e74c0d100f2b729a5191e7b19833404d8e803f"
        }
      ],
      "message": "[validation] validate packages by submitting each tx's ancestor sub-packages\n\nThis results in the incentive-compatible transactions ending up in our\nmempool. Prior to this commit, if parents within the package relied on\neach other, we could end up (1) accepting a low-feerate child or (2)\nrejecting high-feerate parents. Instead of validating each transaction\n*individually* in turn, validate each one with their in-package ancestor\nset. This means parents with inter-dependencies are validated correctly,\nwhile we continue using aggregate totals for package feerate.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-12-15T18:17:47Z"
      },
      "sha": "7f1d42ac10a41cff8d4345adf57fde8a07c1a62c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFkOWQ2Y2M2NTFkYjQ2MDlkN2Q3OTZhNzJmMjZkMGUxMTgzOWY1NGY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ad9d6cc651db4609d7d796a72f26d0e11839f54f",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ad9d6cc651db4609d7d796a72f26d0e11839f54f",
      "tree": {
        "sha": "4efae9403c84dd836f440a43eb56ad1858fe1dea",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4efae9403c84dd836f440a43eb56ad1858fe1dea"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7f1d42ac10a41cff8d4345adf57fde8a07c1a62c",
          "sha": "7f1d42ac10a41cff8d4345adf57fde8a07c1a62c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/7f1d42ac10a41cff8d4345adf57fde8a07c1a62c"
        }
      ],
      "message": "[policy] allow any ancestor package, not just child-with-unconfirmed-parents\n\nWe can safely allow any ancestor package since Packageifier can handle\nthings that are out of order. Remove the check that \"all unconfirmed\nparents are present\" because, even if a tx is missing inputs, the other\ntransactions may be worth validating.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-17T13:42:52Z"
      },
      "sha": "ad9d6cc651db4609d7d796a72f26d0e11839f54f"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGIyZTczN2RkZjFjN2IxYjg0ZTdhNzcyODY0ZDQwNjE2ODc4NTMxZTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b2e737ddf1c7b1b84e7a772864d40616878531e8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b2e737ddf1c7b1b84e7a772864d40616878531e8",
      "tree": {
        "sha": "62676dfee0935540d7d2de75ee7019317592eeeb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/62676dfee0935540d7d2de75ee7019317592eeeb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ad9d6cc651db4609d7d796a72f26d0e11839f54f",
          "sha": "ad9d6cc651db4609d7d796a72f26d0e11839f54f",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ad9d6cc651db4609d7d796a72f26d0e11839f54f"
        }
      ],
      "message": "MOVEONLY: rename AcceptPackage to AcceptAncestorPackage",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-05-10T21:50:56Z"
      },
      "sha": "b2e737ddf1c7b1b84e7a772864d40616878531e8"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg3NmJmZGYyNmIxZGM4ODU2OTA2ODM3OGVmZGIyMTYxODRkYjBhNGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/876bfdf26b1dc88569068378efdb216184db0a4c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/876bfdf26b1dc88569068378efdb216184db0a4c",
      "tree": {
        "sha": "62676dfee0935540d7d2de75ee7019317592eeeb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/62676dfee0935540d7d2de75ee7019317592eeeb"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b2e737ddf1c7b1b84e7a772864d40616878531e8",
          "sha": "b2e737ddf1c7b1b84e7a772864d40616878531e8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b2e737ddf1c7b1b84e7a772864d40616878531e8"
        }
      ],
      "message": "-- Part 1: Orphan Resolution Module --\n\nCreate TxPackageTracker module, responsible for handling orphan\nresolution. Enable node to retry orphan parent downloading from multiple\npeers who announced the tx. Use preferred peers and avoid overloading\npeers with too many requests.\n\nMaking the orphanage more reliable is also necessary because it becomes\npart of the \"critical path\" for some transactions.  A 0-fee parent\nbumped by a child *must* be relayed via package relay; if the orphanage\noverflows or is churned by a malicious peer, the package would be\ncensored from the network.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T10:45:56Z"
      },
      "sha": "876bfdf26b1dc88569068378efdb216184db0a4c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDYxZjAyYTI0YTEzMmY5NDg0YzU2YTljN2I1NjA0ZTY2MmYyMzY1MGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/61f02a24a132f9484c56a9c7b5604e662f23650c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/61f02a24a132f9484c56a9c7b5604e662f23650c",
      "tree": {
        "sha": "386f6372c1552959518b3e30b22cd15ed41ea34b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/386f6372c1552959518b3e30b22cd15ed41ea34b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/876bfdf26b1dc88569068378efdb216184db0a4c",
          "sha": "876bfdf26b1dc88569068378efdb216184db0a4c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/876bfdf26b1dc88569068378efdb216184db0a4c"
        }
      ],
      "message": "[p2p] add tx package tracker",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-05-01T17:41:53Z"
      },
      "sha": "61f02a24a132f9484c56a9c7b5604e662f23650c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDVmZDFhZTY3ZTcyZDZiYjcxMGRmODk5YmRjNzBhYmY0OTZkZDhiODk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5fd1ae67e72d6bb710df899bdc70abf496dd8b89",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/5fd1ae67e72d6bb710df899bdc70abf496dd8b89",
      "tree": {
        "sha": "803255fee8dc1bc30ac435b5dae4f7c6f1241004",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/803255fee8dc1bc30ac435b5dae4f7c6f1241004"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/61f02a24a132f9484c56a9c7b5604e662f23650c",
          "sha": "61f02a24a132f9484c56a9c7b5604e662f23650c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/61f02a24a132f9484c56a9c7b5604e662f23650c"
        }
      ],
      "message": "[refactor] wrap TxOrphanage inside TxPackageTracker",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-10-06T11:02:29Z"
      },
      "sha": "5fd1ae67e72d6bb710df899bdc70abf496dd8b89"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGQzMGJlMGZhMGZmNTYzNzhlNzI5NWRkYjY2ZTMxMDU1NjNkYzcyZDM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d30be0fa0ff56378e7295ddb66e3105563dc72d3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/d30be0fa0ff56378e7295ddb66e3105563dc72d3",
      "tree": {
        "sha": "cdcaef87ffede390638da2375c2d09c34c30c556",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cdcaef87ffede390638da2375c2d09c34c30c556"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5fd1ae67e72d6bb710df899bdc70abf496dd8b89",
          "sha": "5fd1ae67e72d6bb710df899bdc70abf496dd8b89",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/5fd1ae67e72d6bb710df899bdc70abf496dd8b89"
        }
      ],
      "message": "[txorphange] use wtxid instead of txid, handle nullptr",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-24T13:14:31Z"
      },
      "sha": "d30be0fa0ff56378e7295ddb66e3105563dc72d3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMzNjBlN2M2OTEwNzlkMTE5YWMzOWMwOTFlYTkwMjQ1NDdmOTcxOGE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3360e7c691079d119ac39c091ea9024547f9718a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3360e7c691079d119ac39c091ea9024547f9718a",
      "tree": {
        "sha": "2dc15159b83b61415e76f456d2d967559e424dbc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2dc15159b83b61415e76f456d2d967559e424dbc"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d30be0fa0ff56378e7295ddb66e3105563dc72d3",
          "sha": "d30be0fa0ff56378e7295ddb66e3105563dc72d3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/d30be0fa0ff56378e7295ddb66e3105563dc72d3"
        }
      ],
      "message": "[txorphanage] return erased wtxids from EraseForBlock",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T09:59:14Z"
      },
      "sha": "3360e7c691079d119ac39c091ea9024547f9718a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI5YWY1M2VkNjcwZTEzOTNiZGNiZjNkYzI0Yjc0MDcyMDBjOWZiZDc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9af53ed670e1393bdcbf3dc24b7407200c9fbd7",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b9af53ed670e1393bdcbf3dc24b7407200c9fbd7",
      "tree": {
        "sha": "1657f7ddc264015c8f435f8bd6ef6644a76ded8f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1657f7ddc264015c8f435f8bd6ef6644a76ded8f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3360e7c691079d119ac39c091ea9024547f9718a",
          "sha": "3360e7c691079d119ac39c091ea9024547f9718a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3360e7c691079d119ac39c091ea9024547f9718a"
        }
      ],
      "message": "[log] add category TXPACKAGES for orphanage and package relay",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-03-06T16:46:18Z"
      },
      "sha": "b9af53ed670e1393bdcbf3dc24b7407200c9fbd7"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJiMjkwODIzOWZkZjFiMDEwMTVjNzliYWVhYjI3NDg2ZTZhYTcxMTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2b2908239fdf1b01015c79baeab27486e6aa7116",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2b2908239fdf1b01015c79baeab27486e6aa7116",
      "tree": {
        "sha": "05431f104fe4839e7d4dd0b6d4f1b41c458dd9ef",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/05431f104fe4839e7d4dd0b6d4f1b41c458dd9ef"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9af53ed670e1393bdcbf3dc24b7407200c9fbd7",
          "sha": "b9af53ed670e1393bdcbf3dc24b7407200c9fbd7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b9af53ed670e1393bdcbf3dc24b7407200c9fbd7"
        }
      ],
      "message": "[txorphanage] impose a maximum total size of orphans\n\nNo effect for now.\nTODO: add per-peer limits on orphan memory usage",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-03-31T09:58:09Z"
      },
      "sha": "2b2908239fdf1b01015c79baeab27486e6aa7116"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI4ODlmMGZhYTNlZjBlN2I2YjYxNmRiZjRiOGU0ODI2NTI3NWExOTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2889f0faa3ef0e7b6b616dbf4b8e48265275a195",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2889f0faa3ef0e7b6b616dbf4b8e48265275a195",
      "tree": {
        "sha": "9e29dd9e33784631a6b94e0c960546f5afc86334",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9e29dd9e33784631a6b94e0c960546f5afc86334"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2b2908239fdf1b01015c79baeab27486e6aa7116",
          "sha": "2b2908239fdf1b01015c79baeab27486e6aa7116",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2b2908239fdf1b01015c79baeab27486e6aa7116"
        }
      ],
      "message": "[txorphanage] track bytes provided per peer",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-18T10:06:51Z"
      },
      "sha": "2889f0faa3ef0e7b6b616dbf4b8e48265275a195"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFjYmJhYjVmOGFiYzk2ZjM4ODE1YzM4OTFiMTIxMDJmN2U4YmNjNTE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cbbab5f8abc96f38815c3891b12102f7e8bcc51",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1cbbab5f8abc96f38815c3891b12102f7e8bcc51",
      "tree": {
        "sha": "eb31730a0847cd8002bca2dea91aec72fbb4962c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/eb31730a0847cd8002bca2dea91aec72fbb4962c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2889f0faa3ef0e7b6b616dbf4b8e48265275a195",
          "sha": "2889f0faa3ef0e7b6b616dbf4b8e48265275a195",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2889f0faa3ef0e7b6b616dbf4b8e48265275a195"
        }
      ],
      "message": "[txpackagetracker] add orphan resolution tracker",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-24T13:12:56Z"
      },
      "sha": "1cbbab5f8abc96f38815c3891b12102f7e8bcc51"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ0OTdmNGQxZGRkOWRiYmRkNjIwNTlhZGJjMjM0YzUwMTgzMjAzMzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4497f4d1ddd9dbbdd62059adbc234c5018320335",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/4497f4d1ddd9dbbdd62059adbc234c5018320335",
      "tree": {
        "sha": "15434020cf6a6da3b8b46ac4342b7810fb845778",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/15434020cf6a6da3b8b46ac4342b7810fb845778"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cbbab5f8abc96f38815c3891b12102f7e8bcc51",
          "sha": "1cbbab5f8abc96f38815c3891b12102f7e8bcc51",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1cbbab5f8abc96f38815c3891b12102f7e8bcc51"
        }
      ],
      "message": "[refactor] use txpackagetracker for orphan resolution\n\nNo behavior change in this commit.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-10-06T13:24:26Z"
      },
      "sha": "4497f4d1ddd9dbbdd62059adbc234c5018320335"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNhMGI4MGE5MTViMzNkMWE2YjE4NWU3YmE3MGJkZGY2NThmNTUwNTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a0b80a915b33d1a6b185e7ba70bddf658f55054",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3a0b80a915b33d1a6b185e7ba70bddf658f55054",
      "tree": {
        "sha": "1d1605ba6f6f35a531acab72103765e6dbbe30b1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1d1605ba6f6f35a531acab72103765e6dbbe30b1"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4497f4d1ddd9dbbdd62059adbc234c5018320335",
          "sha": "4497f4d1ddd9dbbdd62059adbc234c5018320335",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/4497f4d1ddd9dbbdd62059adbc234c5018320335"
        }
      ],
      "message": "[txpackagetracker] delete unused OrphanageAddTx\n\nAdding/deleting is now strictly handled by TxPackageTracker, and should\nnot be exposed to the public.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-18T12:46:08Z"
      },
      "sha": "3a0b80a915b33d1a6b185e7ba70bddf658f55054"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE5MTc0NzE0ODllYzAxNTZiOTE3NWVjMGU2ZTU5YTg5NTZkMjAwOTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a917471489ec0156b9175ec0e6e59a8956d20094",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a917471489ec0156b9175ec0e6e59a8956d20094",
      "tree": {
        "sha": "c4c9ad834233789068e2af22f405443d1ae77abc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c4c9ad834233789068e2af22f405443d1ae77abc"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a0b80a915b33d1a6b185e7ba70bddf658f55054",
          "sha": "3a0b80a915b33d1a6b185e7ba70bddf658f55054",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3a0b80a915b33d1a6b185e7ba70bddf658f55054"
        }
      ],
      "message": "[txrequest] GetCandidatePeers and ResetRequestTimeout",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-03-20T10:37:23Z"
      },
      "sha": "a917471489ec0156b9175ec0e6e59a8956d20094"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMzZDYwMDBkZWNkYzRjMDE4MjAyNGFiMDhjYWI5NDdhODA0YTA5MTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/33d6000decdc4c0182024ab08cab947a804a0913",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/33d6000decdc4c0182024ab08cab947a804a0913",
      "tree": {
        "sha": "6358c87fb92e675bbe115645fe96dd58873f457c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6358c87fb92e675bbe115645fe96dd58873f457c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a917471489ec0156b9175ec0e6e59a8956d20094",
          "sha": "a917471489ec0156b9175ec0e6e59a8956d20094",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a917471489ec0156b9175ec0e6e59a8956d20094"
        }
      ],
      "message": "[txorphanage] support multiple announcers",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-18T15:02:58Z"
      },
      "sha": "33d6000decdc4c0182024ab08cab947a804a0913"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU5ODc2ZDc4MWU1ZDlmNDA5OTMyYWM0MzdiZmNlNTllYzQ4YWU1NTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/59876d781e5d9f409932ac437bfce59ec48ae550",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/59876d781e5d9f409932ac437bfce59ec48ae550",
      "tree": {
        "sha": "3608427a881d9be3cd37f3299c49cda0051c28b5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3608427a881d9be3cd37f3299c49cda0051c28b5"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/33d6000decdc4c0182024ab08cab947a804a0913",
          "sha": "33d6000decdc4c0182024ab08cab947a804a0913",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/33d6000decdc4c0182024ab08cab947a804a0913"
        }
      ],
      "message": "[unit test] orphanage: multiple announcers, eviction",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-18T18:12:35Z"
      },
      "sha": "59876d781e5d9f409932ac437bfce59ec48ae550"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGJiMzhlYzY1NWE3NzVlZjlkNTU3ZjYxYmQzNTVmYTI0ZjQwOTBkN2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bb38ec655a775ef9d557f61bd355fa24f4090d7d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/bb38ec655a775ef9d557f61bd355fa24f4090d7d",
      "tree": {
        "sha": "93d2a67638f50f1911144235ac7d60455610ce08",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/93d2a67638f50f1911144235ac7d60455610ce08"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/59876d781e5d9f409932ac437bfce59ec48ae550",
          "sha": "59876d781e5d9f409932ac437bfce59ec48ae550",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/59876d781e5d9f409932ac437bfce59ec48ae550"
        }
      ],
      "message": "[p2p] use all orphan announcers as potential parent sources\n\nMakes orphan handling more robust. We will also use the orphan\nresolution tracker for requesting ancpkginfo. The timeout in\np2p_segwit.py has been increased to account for the fact that parents\nare no longer immediately requested.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-10-06T13:24:26Z"
      },
      "sha": "bb38ec655a775ef9d557f61bd355fa24f4090d7d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJhNzQ1ZWViYjcyMDBiYWE5MjQ0OTg3NDVjNTMzNDI3ZWZkMmQ1NjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2a745eebb7200baa924498745c533427efd2d566",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2a745eebb7200baa924498745c533427efd2d566",
      "tree": {
        "sha": "6040f81ca3d903b8127238a3e649fdbe3ad0f7ce",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6040f81ca3d903b8127238a3e649fdbe3ad0f7ce"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bb38ec655a775ef9d557f61bd355fa24f4090d7d",
          "sha": "bb38ec655a775ef9d557f61bd355fa24f4090d7d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/bb38ec655a775ef9d557f61bd355fa24f4090d7d"
        }
      ],
      "message": "[doc] no notfound handling for orphan resolution by parent txid\n\nNote this is status quo.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-19T14:39:11Z"
      },
      "sha": "2a745eebb7200baa924498745c533427efd2d566"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQ3ZmM4YTM5OTQ1MDVjNTdlZDVmZmUzZDQxYzZiNzE1MDkzNGNmZGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/47fc8a3994505c57ed5ffe3d41c6b7150934cfdc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/47fc8a3994505c57ed5ffe3d41c6b7150934cfdc",
      "tree": {
        "sha": "ee322896c2a3a419eed38c8590d9f0cbc440b22c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ee322896c2a3a419eed38c8590d9f0cbc440b22c"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2a745eebb7200baa924498745c533427efd2d566",
          "sha": "2a745eebb7200baa924498745c533427efd2d566",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2a745eebb7200baa924498745c533427efd2d566"
        }
      ],
      "message": "[functional test] orphan handling with multiple announcers and dosers",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-19T14:40:18Z"
      },
      "sha": "47fc8a3994505c57ed5ffe3d41c6b7150934cfdc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAwZDFiM2Q3ZDgzMmJiMDk3YTI5YjVjMDljY2JlNDZmMWM5Zjk3M2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/00d1b3d7d832bb097a29b5c09ccbe46f1c9f973d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/00d1b3d7d832bb097a29b5c09ccbe46f1c9f973d",
      "tree": {
        "sha": "8897324d6dce5c21cf0c5441ed9ae89926188640",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8897324d6dce5c21cf0c5441ed9ae89926188640"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/47fc8a3994505c57ed5ffe3d41c6b7150934cfdc",
          "sha": "47fc8a3994505c57ed5ffe3d41c6b7150934cfdc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/47fc8a3994505c57ed5ffe3d41c6b7150934cfdc"
        }
      ],
      "message": "[txorphanage] add ability to protect from random eviction",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-05T16:24:39Z"
      },
      "sha": "00d1b3d7d832bb097a29b5c09ccbe46f1c9f973d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYwNjlkNGY1YTBlYWYyODYyYjllOGEzYTg3MTRkZjA4M2M2ZjhlYWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f069d4f5a0eaf2862b9e8a3a8714df083c6f8eae",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f069d4f5a0eaf2862b9e8a3a8714df083c6f8eae",
      "tree": {
        "sha": "226cf96fef41158f48215de2c27edfc42bbd1c7d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/226cf96fef41158f48215de2c27edfc42bbd1c7d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/00d1b3d7d832bb097a29b5c09ccbe46f1c9f973d",
          "sha": "00d1b3d7d832bb097a29b5c09ccbe46f1c9f973d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/00d1b3d7d832bb097a29b5c09ccbe46f1c9f973d"
        }
      ],
      "message": "[unit test] orphanage protection",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-05-09T21:08:27Z"
      },
      "sha": "f069d4f5a0eaf2862b9e8a3a8714df083c6f8eae"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU0NGIwMmEzYTlmYTc3YThlZDExZjU4NGMwYmM4NDRkZTY4NDk1ODQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/544b02a3a9fa77a8ed11f584c0bc844de6849584",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/544b02a3a9fa77a8ed11f584c0bc844de6849584",
      "tree": {
        "sha": "226cf96fef41158f48215de2c27edfc42bbd1c7d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/226cf96fef41158f48215de2c27edfc42bbd1c7d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f069d4f5a0eaf2862b9e8a3a8714df083c6f8eae",
          "sha": "f069d4f5a0eaf2862b9e8a3a8714df083c6f8eae",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f069d4f5a0eaf2862b9e8a3a8714df083c6f8eae"
        }
      ],
      "message": "-- Part 2: Negotiate Package Relay, Request Ancestor Package Info For Orphans --",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T10:49:27Z"
      },
      "sha": "544b02a3a9fa77a8ed11f584c0bc844de6849584"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDU5YWQxNThlMjEwZTM0NWRhOGNjNzAyZGUzZWE2MDkyYWMzNGJkOTU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/59ad158e210e345da8cc702de3ea6092ac34bd95",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/59ad158e210e345da8cc702de3ea6092ac34bd95",
      "tree": {
        "sha": "ef145787fd0ef3573db87ee21907a9bce38fb9af",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ef145787fd0ef3573db87ee21907a9bce38fb9af"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/544b02a3a9fa77a8ed11f584c0bc844de6849584",
          "sha": "544b02a3a9fa77a8ed11f584c0bc844de6849584",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/544b02a3a9fa77a8ed11f584c0bc844de6849584"
        }
      ],
      "message": "[txpackagetracker] negotiation logic",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T16:14:20Z"
      },
      "sha": "59ad158e210e345da8cc702de3ea6092ac34bd95"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGE0YzAyM2ZlYjc5ZGViMTgzM2YzNWRlNDA3ODkwY2RlNzFhNmY1Y2M",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a4c023feb79deb1833f35de407890cde71a6f5cc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/a4c023feb79deb1833f35de407890cde71a6f5cc",
      "tree": {
        "sha": "7f3681e46d336a6f120b5f55552b374168bc2138",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7f3681e46d336a6f120b5f55552b374168bc2138"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/59ad158e210e345da8cc702de3ea6092ac34bd95",
          "sha": "59ad158e210e345da8cc702de3ea6092ac34bd95",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/59ad158e210e345da8cc702de3ea6092ac34bd95"
        }
      ],
      "message": "[unit test] txpackagetracker tests",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:47Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T16:08:16Z"
      },
      "sha": "a4c023feb79deb1833f35de407890cde71a6f5cc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGUzMmRkOTllNDI0NzRlYzhiM2E5OTY3OTdlMWE0ZjkxMWE4ZTY1YTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e32dd99e42474ec8b3a996797e1a4f911a8e65a4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e32dd99e42474ec8b3a996797e1a4f911a8e65a4",
      "tree": {
        "sha": "e7b38294f4f566a4bfcd6290792e1a7ee0e17e4f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e7b38294f4f566a4bfcd6290792e1a7ee0e17e4f"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a4c023feb79deb1833f35de407890cde71a6f5cc",
          "sha": "a4c023feb79deb1833f35de407890cde71a6f5cc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/a4c023feb79deb1833f35de407890cde71a6f5cc"
        }
      ],
      "message": "[p2p] signal support for package relay",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-10-07T11:54:34Z"
      },
      "sha": "e32dd99e42474ec8b3a996797e1a4f911a8e65a4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDAwMzE5OTdiMjk4MTZkZjRjNWIzZmI1NmFiYzFkNzc0ZWQwZGQ5YzA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0031997b29816df4c5b3fb56abc1d774ed0dd9c0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0031997b29816df4c5b3fb56abc1d774ed0dd9c0",
      "tree": {
        "sha": "518381a4b9a6c9e40dcd19ff4a12db53c66dff5e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/518381a4b9a6c9e40dcd19ff4a12db53c66dff5e"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e32dd99e42474ec8b3a996797e1a4f911a8e65a4",
          "sha": "e32dd99e42474ec8b3a996797e1a4f911a8e65a4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e32dd99e42474ec8b3a996797e1a4f911a8e65a4"
        }
      ],
      "message": "[rpc] expose package relay on rpc",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-09-06T11:33:13Z"
      },
      "sha": "0031997b29816df4c5b3fb56abc1d774ed0dd9c0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGU3Y2ZkNTZjZGI5MDc4ZTFmZDA3MDE2Mzg3NTRjMDVkOTk5MWJhYzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e7cfd56cdb9078e1fd0701638754c05d9991bac1",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/e7cfd56cdb9078e1fd0701638754c05d9991bac1",
      "tree": {
        "sha": "f3d84694a4e27d5d1e57304dc8417f54e7ac2517",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f3d84694a4e27d5d1e57304dc8417f54e7ac2517"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0031997b29816df4c5b3fb56abc1d774ed0dd9c0",
          "sha": "0031997b29816df4c5b3fb56abc1d774ed0dd9c0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0031997b29816df4c5b3fb56abc1d774ed0dd9c0"
        }
      ],
      "message": "[packages] hash multiple transactions",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-09T14:54:34Z"
      },
      "sha": "e7cfd56cdb9078e1fd0701638754c05d9991bac1"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDM0OTRmOTZlYmFjZjUzY2JkNWZkMDlmNjQyMWQ5ZGFiZWM4NzM2MWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3494f96ebacf53cbd5fd09f6421d9dabec87361e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3494f96ebacf53cbd5fd09f6421d9dabec87361e",
      "tree": {
        "sha": "1d2aba6c1cc59375076b95c086410c9a6a7921f0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1d2aba6c1cc59375076b95c086410c9a6a7921f0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e7cfd56cdb9078e1fd0701638754c05d9991bac1",
          "sha": "e7cfd56cdb9078e1fd0701638754c05d9991bac1",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/e7cfd56cdb9078e1fd0701638754c05d9991bac1"
        }
      ],
      "message": "[validation/p2p] separate TxValidationResult and rejects filter for low fees\n\nWe wouldn't want to add a low-feerate transaction to m_recent_rejects\nbecause usually that means we won't give the child a chance\n(`fRejectedParents`); we instead want to fetch this orphan's low-feerate\nparents and potentially accept them.  However, we also shouldn't\nrevalidate transactions/packages that have already been rejected.\nContinue to cache low-fee rejections, but separately.\n\nNote: when ephemeral anchor transaction fails due to a missing spender,\nwe should similarly put it in the reconsiderable filter.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-09-12T09:43:33Z"
      },
      "sha": "3494f96ebacf53cbd5fd09f6421d9dabec87361e"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDg0ODc4MWMyZDY1ZDQ0MWNkNGM0YjQ3NGI5Y2RjZjA1OGM5YzBjYTk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/848781c2d65d441cd4c4b474b9cdcf058c9c0ca9",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/848781c2d65d441cd4c4b474b9cdcf058c9c0ca9",
      "tree": {
        "sha": "10bfea917cadb4622c66f4b49321d58004308019",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/10bfea917cadb4622c66f4b49321d58004308019"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3494f96ebacf53cbd5fd09f6421d9dabec87361e",
          "sha": "3494f96ebacf53cbd5fd09f6421d9dabec87361e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3494f96ebacf53cbd5fd09f6421d9dabec87361e"
        }
      ],
      "message": "[p2p] respond to getdata(ancpkginfo) requests with ancpkginfo\n\nConditions for responding to an ancpkginfo request are identical to\nresponding to a tx. That is, we only provide ancpkginfo if we would have\nprovided tx data as well.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-09-06T16:54:19Z"
      },
      "sha": "848781c2d65d441cd4c4b474b9cdcf058c9c0ca9"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGFlMjY2NDc5M2IxZDBkODZiZmEzMmMzZTYzNWQ4M2IxZWUwODNlNjA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
      "tree": {
        "sha": "e559f0cf28508b14cbf798cb8f21f5f964d19bd2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e559f0cf28508b14cbf798cb8f21f5f964d19bd2"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/848781c2d65d441cd4c4b474b9cdcf058c9c0ca9",
          "sha": "848781c2d65d441cd4c4b474b9cdcf058c9c0ca9",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/848781c2d65d441cd4c4b474b9cdcf058c9c0ca9"
        }
      ],
      "message": "[txpackagetracker] create ancpkginfo requests using orphan resolution tracker",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-24T13:12:56Z"
      },
      "sha": "ae2664793b1d0d86bfa32c3e635d83b1ee083e60"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGNkMWFjMWQ4M2E3MWZhMjUxOWI0MDRhMmU0YjMyMzdkMmE2NzZhNTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cd1ac1d83a71fa2519b404a2e4b3237d2a676a50",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/cd1ac1d83a71fa2519b404a2e4b3237d2a676a50",
      "tree": {
        "sha": "64ea6e2c4d126414cfc052c8b85eea042a946f7d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/64ea6e2c4d126414cfc052c8b85eea042a946f7d"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
          "sha": "ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ae2664793b1d0d86bfa32c3e635d83b1ee083e60"
        }
      ],
      "message": "[unit test] txpackagetracker orphan tracking",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T16:06:29Z"
      },
      "sha": "cd1ac1d83a71fa2519b404a2e4b3237d2a676a50"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRkNmZiMTM5Yjg4ODdmMzQwMGE2NWRjMGQ0YzRlZTU0Y2Y1M2QwYmM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc",
      "tree": {
        "sha": "117d4d41a72398770c4c92340071f05382a6cfe0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/117d4d41a72398770c4c92340071f05382a6cfe0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cd1ac1d83a71fa2519b404a2e4b3237d2a676a50",
          "sha": "cd1ac1d83a71fa2519b404a2e4b3237d2a676a50",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/cd1ac1d83a71fa2519b404a2e4b3237d2a676a50"
        }
      ],
      "message": "[p2p] Resolve orphans by requesting ancpkginfo and requesting txdata\n\nFor now, each tx in ancpkginfo is treated like an individual tx\nannouncement. When the tx arrives, it is validated individually as well.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-10-06T13:24:26Z"
      },
      "sha": "dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDUwZjJiMjU1YTBkMGZjOWZiZGY0YmRmM2IyMmY2YzA2MTcxODhhNDM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/50f2b255a0d0fc9fbdf4bdf3b22f6c0617188a43",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/50f2b255a0d0fc9fbdf4bdf3b22f6c0617188a43",
      "tree": {
        "sha": "117d4d41a72398770c4c92340071f05382a6cfe0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/117d4d41a72398770c4c92340071f05382a6cfe0"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc",
          "sha": "dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc"
        }
      ],
      "message": "-- Part 3: Download and Validate Packages --",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:21:48Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T10:50:12Z"
      },
      "sha": "50f2b255a0d0fc9fbdf4bdf3b22f6c0617188a43"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDEzMzljMDZjMDc0OGEwNGMyZThlMGRkMWExM2E5ZjljMDY3MzMzZTQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1339c06c0748a04c2e8e0dd1a13a9f9c067333e4",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1339c06c0748a04c2e8e0dd1a13a9f9c067333e4",
      "tree": {
        "sha": "969e434f8c098a199779654075cdcbc4962bb8f8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/969e434f8c098a199779654075cdcbc4962bb8f8"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/50f2b255a0d0fc9fbdf4bdf3b22f6c0617188a43",
          "sha": "50f2b255a0d0fc9fbdf4bdf3b22f6c0617188a43",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/50f2b255a0d0fc9fbdf4bdf3b22f6c0617188a43"
        }
      ],
      "message": "[p2p] respond to getpkgtxns with pkgtxns or notfound MSG_PKGTXNS",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:05Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2022-10-03T15:38:55Z"
      },
      "sha": "1339c06c0748a04c2e8e0dd1a13a9f9c067333e4"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDNhN2MxMGExMjNkNzIwYmJlMjEzZjA3ZTNlYTQ5OTk2Y2UyZjE0OTY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a7c10a123d720bbe213f07e3ea49996ce2f1496",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/3a7c10a123d720bbe213f07e3ea49996ce2f1496",
      "tree": {
        "sha": "ec945bde083cc29f1c67b2e5a52fb6f495ff3979",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ec945bde083cc29f1c67b2e5a52fb6f495ff3979"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1339c06c0748a04c2e8e0dd1a13a9f9c067333e4",
          "sha": "1339c06c0748a04c2e8e0dd1a13a9f9c067333e4",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1339c06c0748a04c2e8e0dd1a13a9f9c067333e4"
        }
      ],
      "message": "[txpackagetracker] track packages to download",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-05T16:57:00Z"
      },
      "sha": "3a7c10a123d720bbe213f07e3ea49996ce2f1496"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDlhNGQwYjdmMzI1YzU3ODcwZDZlNGUxY2E4YTI1MDg1NDM3YmZlN2I",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a4d0b7f325c57870d6e4e1ca8a25085437bfe7b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/9a4d0b7f325c57870d6e4e1ca8a25085437bfe7b",
      "tree": {
        "sha": "00641af1ff263c686af6e6986b9bd0c8d749f872",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/00641af1ff263c686af6e6986b9bd0c8d749f872"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a7c10a123d720bbe213f07e3ea49996ce2f1496",
          "sha": "3a7c10a123d720bbe213f07e3ea49996ce2f1496",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/3a7c10a123d720bbe213f07e3ea49996ce2f1496"
        }
      ],
      "message": "[txpackagetracker] handle pkgtxns/notfound, return validation work items",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-09T14:50:00Z"
      },
      "sha": "9a4d0b7f325c57870d6e4e1ca8a25085437bfe7b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBkMjBlOGM3NzY3YTJmNzMxODM2NDZjYzU1Mzk5NmM1NjRmYTQwZGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0d20e8c7767a2f73183646cc553996c564fa40de",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0d20e8c7767a2f73183646cc553996c564fa40de",
      "tree": {
        "sha": "8ffab4e63541d424d149a731549ad86c291f72bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8ffab4e63541d424d149a731549ad86c291f72bc"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9a4d0b7f325c57870d6e4e1ca8a25085437bfe7b",
          "sha": "9a4d0b7f325c57870d6e4e1ca8a25085437bfe7b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9a4d0b7f325c57870d6e4e1ca8a25085437bfe7b"
        }
      ],
      "message": "[txpackagetracker] track protections and token bucket it",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-05-09T23:22:05Z"
      },
      "sha": "0d20e8c7767a2f73183646cc553996c564fa40de"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDZiZWRkMDRkZWU5ZmFlNTRmM2M3MjBlMWZlNDFhMTRkMDkxNTI2MmE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6bedd04dee9fae54f3c720e1fe41a14d0915262a",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6bedd04dee9fae54f3c720e1fe41a14d0915262a",
      "tree": {
        "sha": "60c779f36004452403c5818713e2a803a8bc772b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/60c779f36004452403c5818713e2a803a8bc772b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0d20e8c7767a2f73183646cc553996c564fa40de",
          "sha": "0d20e8c7767a2f73183646cc553996c564fa40de",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0d20e8c7767a2f73183646cc553996c564fa40de"
        }
      ],
      "message": "[unit test] PkgInfoAllowed, ReceivedAncPkgInfo, ReceivedPkgTxns",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-02-20T16:33:09Z"
      },
      "sha": "6bedd04dee9fae54f3c720e1fe41a14d0915262a"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk2OTAwYjNmM2U4YmEyMTAwYjFkYmM1ZTM2MmE0ODA4ZjcwOTQ5OGM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/96900b3f3e8ba2100b1dbc5e362a4808f709498c",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/96900b3f3e8ba2100b1dbc5e362a4808f709498c",
      "tree": {
        "sha": "ed31d8b02479075ae6075d7663930b64cac5ef60",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ed31d8b02479075ae6075d7663930b64cac5ef60"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6bedd04dee9fae54f3c720e1fe41a14d0915262a",
          "sha": "6bedd04dee9fae54f3c720e1fe41a14d0915262a",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/6bedd04dee9fae54f3c720e1fe41a14d0915262a"
        }
      ],
      "message": "[p2p] use ancpkginfo to make getpkgtxns requests and validate packages",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-01-06T11:31:37Z"
      },
      "sha": "96900b3f3e8ba2100b1dbc5e362a4808f709498c"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDMxYjM2NTAwY2E1MzFjZWU4ODQ2OTliZmZhYmEzMzkwMmJiOGJkZTA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/31b36500ca531cee884699bffaba33902bb8bde0",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/31b36500ca531cee884699bffaba33902bb8bde0",
      "tree": {
        "sha": "7d00ae4bcf98eb4bd88a2f3ae868ba5d89cf4d27",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7d00ae4bcf98eb4bd88a2f3ae868ba5d89cf4d27"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/96900b3f3e8ba2100b1dbc5e362a4808f709498c",
          "sha": "96900b3f3e8ba2100b1dbc5e362a4808f709498c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/96900b3f3e8ba2100b1dbc5e362a4808f709498c"
        }
      ],
      "message": "[p2p] don't inv fee-bumping children to non-pkgrelay peers\n\nThese transactions can be more common with package relay, but\nnon-package-relay peers will only waste bandwidth and orphanage space,\nthen end up not accepting them. Save their bandwidth by dropping\nannouncements of transactions that have below-fee-filter parents.",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-04-04T09:01:00Z"
      },
      "sha": "31b36500ca531cee884699bffaba33902bb8bde0"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDJjMDE0ZTYxNDAxNTJkNzg2Y2M0MGQxZGQ3MmNkODYwMTdmMWIwMmI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c014e6140152d786cc40d1dd72cd86017f1b02b",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2c014e6140152d786cc40d1dd72cd86017f1b02b",
      "tree": {
        "sha": "2cac345a2f85dd947cbe702aefadc243c0e28490",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2cac345a2f85dd947cbe702aefadc243c0e28490"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/31b36500ca531cee884699bffaba33902bb8bde0",
          "sha": "31b36500ca531cee884699bffaba33902bb8bde0",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/31b36500ca531cee884699bffaba33902bb8bde0"
        }
      ],
      "message": "[functional test] package relay works despite peers DoSing orphanage",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-05-18T19:32:05Z"
      },
      "sha": "2c014e6140152d786cc40d1dd72cd86017f1b02b"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGVkNWYyZmU2MWVlNTI3NzY2OGIzMmNiMzU5MWQwNmU4NjgzODk3YWM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ed5f2fe61ee5277668b32cb3591d06e8683897ac",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/ed5f2fe61ee5277668b32cb3591d06e8683897ac",
      "tree": {
        "sha": "6fb074ce885953a3dc1ff87a94a16f45a897d4cd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6fb074ce885953a3dc1ff87a94a16f45a897d4cd"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c014e6140152d786cc40d1dd72cd86017f1b02b",
          "sha": "2c014e6140152d786cc40d1dd72cd86017f1b02b",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/2c014e6140152d786cc40d1dd72cd86017f1b02b"
        }
      ],
      "message": "fixup p2p: require PKG_RELAY_PKGTXNS negotiated for getpkgtxns",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-06-30T18:06:45Z"
      },
      "sha": "ed5f2fe61ee5277668b32cb3591d06e8683897ac"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDk4MDQ2NTk5ODEyYTRhYTFlNWM0M2Q5Mjk2OWE3Y2QyYTU1MjZiMWU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "tree": {
        "sha": "6fa57336b0c446c5756ccf5b1205fe165e3e1787",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6fa57336b0c446c5756ccf5b1205fe165e3e1787"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ed5f2fe61ee5277668b32cb3591d06e8683897ac",
          "sha": "ed5f2fe61ee5277668b32cb3591d06e8683897ac",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/ed5f2fe61ee5277668b32cb3591d06e8683897ac"
        }
      ],
      "message": "fixup: swap PKG_RELAY bits",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T10:22:07Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-07-04T09:59:35Z"
      },
      "sha": "98046599812a4aa1e5c43d92969a7cd2a5526b1e"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 9720335301,
      "node_id": "HRFPE_lADOABII585mxnIEzwAAAAJDYIvF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9720335301",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "commit_url": "https://api.github.com/repos/glozow/bitcoin/commits/98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "created_at": "2023-07-04T10:41:34Z"
    },
    {
      "event": "commented",
      "id": 1620036644,
      "node_id": "IC_kwDOABII585gj8wk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1620036644",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-04T11:03:14Z",
      "updated_at": "2023-07-04T11:03:14Z",
      "author_association": "MEMBER",
      "body": "Thanks everyone for the reviews!\r\nLast push:\r\n- Implemented changes that were discussed on the BIP PR https://github.com/bitcoin/bips/pull/1382\r\n    - Maximum of 100 transactions per `getpkgtxns` request\r\n    - Changed `versions` field in `sendpackages` to be 64b instead of 32b.\r\n    - Added a `PKG_RELAY_PKGTXNS` bit for negotiating `getpkgtxns`/`pkgtxns` support in `sendpackages`.\r\n- Fixed some of the bigger problems I found / pointed out by reviewers, e.g.\r\n    - https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1229835172\r\n    - https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224428421\r\n    - https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213639103\r\n- Rebased on master for the conflicts\r\n\r\nGiven the positive approach feedback, I'm going to polish up the Milestone 1 branch (incorporating comments from here as well) and open a non-draft PR for it.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1620036644",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "unlabeled",
      "id": 9720791612,
      "node_id": "UNLE_lADOABII585mxnIEzwAAAAJDZ4I8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9720791612",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-04T11:31:00Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "labeled",
      "id": 9721495342,
      "node_id": "LE_lADOABII585mxnIEzwAAAAJDcj8u",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9721495342",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-04T12:45:08Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 1514439276,
      "node_id": "PRR_kwDOABII585aRIJs",
      "url": null,
      "actor": null,
      "commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "Opened #28031 for milestone 1, addressing the comments here pertaining to those commits.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1514439276",
      "submitted_at": "2023-07-05T15:31:59Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1523258231,
      "node_id": "PRR_kwDOABII585ayxN3",
      "url": null,
      "actor": null,
      "commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1523258231",
      "submitted_at": "2023-07-11T01:15:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1531250506,
      "node_id": "PRR_kwDOABII585bRQdK",
      "url": null,
      "actor": null,
      "commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1531250506",
      "submitted_at": "2023-07-15T03:53:49Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "reviewed",
      "id": 1531801228,
      "node_id": "PRR_kwDOABII585bTW6M",
      "url": null,
      "actor": null,
      "commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Some initial comments on part 2 (Negotiate Package Relay, Request Ancestor Package Info For Orphans) - will move on to part 3 soon.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1531801228",
      "submitted_at": "2023-07-17T20:27:39Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "commented",
      "id": 1643703266,
      "node_id": "IC_kwDOABII585h-Ovi",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1643703266",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-20T10:52:10Z",
      "updated_at": "2023-07-20T10:52:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--cf906140f33d8803c4a75a2196329ecb-->\n🐙 This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1643703266",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "labeled",
      "id": 9872950024,
      "node_id": "LE_lADOABII585mxnIEzwAAAAJMeUMI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/9872950024",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-07-20T10:52:10Z",
      "label": {
        "name": "Needs rebase",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 1696113420,
      "node_id": "IC_kwDOABII585lGKMM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1696113420",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-28T18:00:24Z",
      "updated_at": "2023-08-28T18:00:24Z",
      "author_association": "MEMBER",
      "body": "I suspect this implementation, with an absurdly high ancestor chain limit being set, would violate the 100 txn limit for `getpackagetxns`: https://github.com/bitcoin/bips/blob/02ec218c7857ef60914e9a3d383b68caf987f70b/bip-0331.mediawiki#getpkgtxns\r\n\r\n",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1696113420",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 1697099748,
      "node_id": "IC_kwDOABII585lJ6_k",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1697099748",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-29T09:37:21Z",
      "updated_at": "2023-08-29T09:37:21Z",
      "author_association": "MEMBER",
      "body": "> I suspect this implementation, with an absurdly high ancestor chain limit being set, would violate the 100 txn limit for getpackagetxns: https://github.com/bitcoin/bips/blob/02ec218c7857ef60914e9a3d383b68caf987f70b/bip-0331.mediawiki#getpkgtxns\r\n\r\nAre you sure? We still require an `ancpkginfo` to have (non-configurable) `MAX_PACKAGE_COUNT` or fewer transactions, otherwise we exit \"discarding packageinfo, too many transactions\". But I can add a check that the list is <= `MAX_PKGTXNS_COUNT` prior to sending.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1697099748",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDBjYTYwYjc5ZmQ0NzI5ZDdlMzU0MTU4MzhlYmZmMTVkZWEzMjk3YzU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0ca60b79fd4729d7e35415838ebff15dea3297c5",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/0ca60b79fd4729d7e35415838ebff15dea3297c5",
      "tree": {
        "sha": "79d53f00b3c4fe47122c8023e53f67bf9b2c3743",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/79d53f00b3c4fe47122c8023e53f67bf9b2c3743"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/98046599812a4aa1e5c43d92969a7cd2a5526b1e",
          "sha": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/98046599812a4aa1e5c43d92969a7cd2a5526b1e"
        }
      ],
      "message": "fixup: make sure we never send getpkgtxns size > MAX_PKGTXNS_COUNT",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-08-29T10:56:13Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-08-29T10:54:33Z"
      },
      "sha": "0ca60b79fd4729d7e35415838ebff15dea3297c5"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDI2MTQ3NzdhYTE0ZjIzMmY3NGNhZDE4YWY0NGY3YzY1MDlhNjE1Mjg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2614777aa14f232f74cad18af44f7c6509a61528",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/2614777aa14f232f74cad18af44f7c6509a61528",
      "tree": {
        "sha": "52940a6a2f9b39aa1a25be1a9ed3c0f74074c154",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/52940a6a2f9b39aa1a25be1a9ed3c0f74074c154"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0ca60b79fd4729d7e35415838ebff15dea3297c5",
          "sha": "0ca60b79fd4729d7e35415838ebff15dea3297c5",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/0ca60b79fd4729d7e35415838ebff15dea3297c5"
        }
      ],
      "message": "fixup: use single-sha256 for MSG_PKGTXNS combined hash",
      "committer": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-08-29T10:58:03Z"
      },
      "author": {
        "name": "glozow",
        "email": "gloriajzhao@gmail.com",
        "date": "2023-08-29T10:58:03Z"
      },
      "sha": "2614777aa14f232f74cad18af44f7c6509a61528"
    },
    {
      "event": "commented",
      "id": 1697224567,
      "node_id": "IC_kwDOABII585lKZd3",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1697224567",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-08-29T11:00:50Z",
      "updated_at": "2023-08-29T11:00:50Z",
      "author_association": "MEMBER",
      "body": "Added check that outbound `getpkgtxns` is <= `MAX_PKGTXNS_COUNT`. Also changed the combined hash from double-sha256 to single-sha256 (which was changed in the BIP recently).",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1697224567",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 1706588280,
      "node_id": "IC_kwDOABII585luHh4",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1706588280",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-09-05T13:07:49Z",
      "updated_at": "2023-09-05T13:07:49Z",
      "author_association": "MEMBER",
      "body": "Dropping note from offline discussion: probably worthwhile to just to advise users that setting ancestor count higher than 25 may end in weird behavior with chains longer than what package relay can support. I don't know of anyone who sets this value higher manually for production usage, and the value can be updated later easily as an implementation detail. ",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1706588280",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "reviewed",
      "id": 1631576047,
      "node_id": "PRR_kwDOABII585hP9_v",
      "url": null,
      "actor": null,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#pullrequestreview-1631576047",
      "submitted_at": "2023-09-18T16:58:12Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
    },
    {
      "event": "commented",
      "id": 1859351934,
      "node_id": "IC_kwDOABII585u03V-",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1859351934",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-18T00:37:09Z",
      "updated_at": "2023-12-18T00:37:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\nThere hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1859351934",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 1859954716,
      "node_id": "IC_kwDOABII585u3Kgc",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/1859954716",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2023-12-18T09:45:17Z",
      "updated_at": "2023-12-18T09:45:17Z",
      "author_association": "MEMBER",
      "body": "Not intended for merge. Not planning on rebasing right now since this should be built on top of cluster mempool and other WIP projects.",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-1859954716",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 2000729346,
      "node_id": "IC_kwDOABII5853QLUC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2000729346",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-03-16T00:09:17Z",
      "updated_at": "2024-03-16T00:09:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n⌛ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-2000729346",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "referenced",
      "id": 12664780361,
      "node_id": "REFE_lADOABII585mxnIEzwAAAALy4TZJ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12664780361",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "d813ba1bc4b4da3ad1f3812b61ff125d1d664625",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d813ba1bc4b4da3ad1f3812b61ff125d1d664625",
      "created_at": "2024-04-30T22:41:04Z"
    },
    {
      "event": "commented",
      "id": 2164144076,
      "node_id": "IC_kwDOABII586A_jfM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2164144076",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-06-13T00:38:29Z",
      "updated_at": "2024-06-13T00:38:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n⌛ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-2164144076",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 2339400154,
      "node_id": "IC_kwDOABII586LcGna",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2339400154",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-09-10T00:50:10Z",
      "updated_at": "2024-09-10T00:50:10Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n⌛ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-2339400154",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 2525356341,
      "node_id": "IC_kwDOABII586WheE1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2525356341",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-12-08T00:24:42Z",
      "updated_at": "2024-12-08T00:24:42Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n⌛ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-2525356341",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "referenced",
      "id": 15962002326,
      "node_id": "REFE_lADOABII585mxnIEzwAAAAO3aNOW",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15962002326",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "335798c496371b7e12a7e159312a4377a858cfc3",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/335798c496371b7e12a7e159312a4377a858cfc3",
      "created_at": "2025-01-16T13:42:37Z"
    },
    {
      "event": "commented",
      "id": 2705291023,
      "node_id": "IC_kwDOABII586hP3cP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2705291023",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-07T01:13:14Z",
      "updated_at": "2025-03-07T01:13:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n⌛ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-2705291023",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    },
    {
      "event": "commented",
      "id": 2937780755,
      "node_id": "IC_kwDOABII586vGvoT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2937780755",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-04T00:00:39Z",
      "updated_at": "2025-06-04T00:00:39Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--13523179cfe9479db18ec6c5d236f789-->\n⌛ There hasn't been much activity lately and the patch still needs rebase. What is the status here?\n\n* Is it still relevant? ➡️ Please solve the conflicts to make it ready for review and to ensure the CI passes.\n* Is it no longer relevant? ➡️ Please close.\n* Did the author lose interest or time to work on this? ➡️ Please close it and mark it 'Up for grabs' with the label, so that it can be picked up in the future.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#issuecomment-2937780755",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/27742"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210682865",
      "pull_request_review_id": 1451533873,
      "id": 1210682865,
      "node_id": "PRRC_kwDOABII585IKY3x",
      "diff_hunk": "@@ -2932,7 +2932,7 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n             LogPrint(BCLog::MEMPOOL, \"   accepted orphan tx %s\\n\", orphanHash.ToString());\n             RelayTransaction(orphanHash, porphanTx->GetWitnessHash());\n             m_txpackagetracker->AddChildrenToWorkSet(*porphanTx);\n-            m_txpackagetracker->EraseOrphanTx(orphanHash);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "22e93f08a50a206b54717b07682e73a751cc6755",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "[[txorphange] use wtxid instead of txid, handle nullptr](https://github.com/bitcoin/bitcoin/pull/27742/commits/22e93f08a50a206b54717b07682e73a751cc6755)\r\n\r\nmaybe change commit message to be clearer we're erasing by wtxid, as the primary change?",
      "created_at": "2023-05-30T18:41:30Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210682865",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210682865"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2935,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210707099",
      "pull_request_review_id": 1451533873,
      "id": 1210707099,
      "node_id": "PRRC_kwDOABII585IKeyb",
      "diff_hunk": "@@ -4,12 +4,33 @@\n \n #include <node/txpackagetracker.h>\n \n+#include <common/bloom.h>\n+#include <logging.h>\n #include <txorphanage.h>\n+#include <txrequest.h>\n+#include <util/hasher.h>\n \n namespace node {\n+    /** How long to wait before requesting orphan ancpkginfo/parents from an additional peer.\n+     * Same as GETDATA_TX_INTERVAL. */",
      "path": "src/node/txpackagetracker.cpp",
      "position": 16,
      "original_position": 12,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "wouldn't reference it in case it drifts? If it's exactly the same and always should be, just use this constant value?",
      "created_at": "2023-05-30T19:04:20Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210707099",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210707099"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 16,
      "original_line": 16,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210708748",
      "pull_request_review_id": 1451533873,
      "id": 1210708748,
      "node_id": "PRRC_kwDOABII585IKfMM",
      "diff_hunk": "@@ -4,12 +4,33 @@\n \n #include <node/txpackagetracker.h>\n \n+#include <common/bloom.h>\n+#include <logging.h>\n #include <txorphanage.h>\n+#include <txrequest.h>\n+#include <util/hasher.h>\n \n namespace node {\n+    /** How long to wait before requesting orphan ancpkginfo/parents from an additional peer.\n+     * Same as GETDATA_TX_INTERVAL. */\n+    static constexpr auto ORPHAN_ANCESTOR_GETDATA_INTERVAL{60s};\n+\n+    /** Delay to add if an orphan resolution candidate is already using a lot of memory in the\n+     * orphanage. */\n+    static constexpr auto ORPHANAGE_OVERLOAD_DELAY{2s};\n+\n class TxPackageTracker::Impl {\n     /** Manages unvalidated tx data (orphan transactions for which we are downloading ancestors). */\n     TxOrphanage m_orphanage;\n+\n+    mutable Mutex m_mutex;\n+\n+    /** Tracks orphans for which we need to request ancestor information. All hashes stored are\n+     * wtxids, i.e., the wtxid of the orphan. However, the is_wtxid field is used to indicate",
      "path": "src/node/txpackagetracker.cpp",
      "position": 163,
      "original_position": 26,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> is_wtxid\r\n\r\nwhere is this defined?",
      "created_at": "2023-05-30T19:06:19Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210708748",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210708748"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 163,
      "original_line": 163,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210724340",
      "pull_request_review_id": 1451533873,
      "id": 1210724340,
      "node_id": "PRRC_kwDOABII585IKi_0",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);",
      "path": "src/node/txpackagetracker.h",
      "position": 83,
      "original_position": 17,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "really close to `OrphanageAddTx` even though the comments are clear of its purpose here. Maybe `AddKnownOrphanTx` or `AddAlreadyKnownOrphanTx`?",
      "created_at": "2023-05-30T19:21:23Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210724340",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210724340"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 83,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210729694",
      "pull_request_review_id": 1451533873,
      "id": 1210729694,
      "node_id": "PRRC_kwDOABII585IKkTe",
      "diff_hunk": "@@ -18,14 +39,119 @@ class TxPackageTracker::Impl {\n     bool OrphanageHaveTx(const GenTxid& gtxid) { return m_orphanage.HaveTx(gtxid); }\n     CTransactionRef GetTxToReconsider(NodeId peer) { return m_orphanage.GetTxToReconsider(peer); }\n     int EraseOrphanTx(const uint256& txid) { return m_orphanage.EraseTx(txid); }\n-    void DisconnectedPeer(NodeId peer) {\n-        m_orphanage.EraseForPeer(peer);\n+    void DisconnectedPeer(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        orphan_request_tracker.DisconnectedPeer(nodeid);\n+        m_orphanage.EraseForPeer(nodeid);\n+    }\n+    void BlockConnected(const CBlock& block) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        const auto wtxids_erased{m_orphanage.EraseForBlock(block)};\n+        std::set<uint256> block_wtxids;\n+        std::set<uint256> conflicted_wtxids;\n+        for (const CTransactionRef& ptx : block.vtx) {\n+            block_wtxids.insert(ptx->GetWitnessHash());\n+        }\n+        for (const auto& wtxid : wtxids_erased) {\n+            if (block_wtxids.count(wtxid) == 0) {\n+                conflicted_wtxids.insert(wtxid);\n+            }\n+        }\n+        FinalizeTransactions(block_wtxids, conflicted_wtxids);\n     }\n-    void BlockConnected(const CBlock& block) { m_orphanage.EraseForBlock(block); }\n     void LimitOrphans(unsigned int max_orphans) { m_orphanage.LimitOrphans(max_orphans); }\n     void AddChildrenToWorkSet(const CTransaction& tx) { m_orphanage.AddChildrenToWorkSet(tx); }\n     bool HaveTxToReconsider(NodeId peer) { return m_orphanage.HaveTxToReconsider(peer); }\n     size_t OrphanageSize() { return m_orphanage.Size(); }\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime)\n+        EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n+        if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n+\n+        // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.",
      "path": "src/node/txpackagetracker.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`is_wtxid=false`?",
      "created_at": "2023-05-30T19:26:05Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210729694",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210729694"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 77,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210734976",
      "pull_request_review_id": 1451533873,
      "id": 1210734976,
      "node_id": "PRRC_kwDOABII585IKlmA",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);",
      "path": "src/node/txpackagetracker.h",
      "position": 83,
      "original_position": 17,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "When should `tx` be `NULL`?",
      "created_at": "2023-05-30T19:30:31Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210734976",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210734976"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 83,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210736698",
      "pull_request_review_id": 1451533873,
      "id": 1210736698,
      "node_id": "PRRC_kwDOABII585IKmA6",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing\n+     * parents were requested), package info requests, tx data download, and packages in the\n+     * validation queue. */\n+    size_t Count(NodeId nodeid) const;\n+\n+    /** Number of packages we are currently working on with this peer (i.e. reserving memory for\n+     * storing orphan(s)). Includes in-flight package info requests, tx data download, and packages\n+     * in the validation queue. Excludes entries in the orphan tracker that are just candidates. */",
      "path": "src/node/txpackagetracker.h",
      "position": 93,
      "original_position": 27,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "What does this last sentence mean?",
      "created_at": "2023-05-30T19:32:29Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210736698",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210736698"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 93,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210769183",
      "pull_request_review_id": 1451533873,
      "id": 1210769183,
      "node_id": "PRRC_kwDOABII585IKt8f",
      "diff_hunk": "@@ -5860,6 +5859,18 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             }\n         }\n \n+        auto requestable_orphans = m_txpackagetracker->GetOrphanRequests(pto->GetId(), current_time);",
      "path": "src/net_processing.cpp",
      "position": 896,
      "original_position": 114,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "bb5e0b21520e6deebcfe9576ae17f4db15c31421",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "where did this behavior live prior, where this isn't a behavior change?",
      "created_at": "2023-05-30T20:04:00Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1210769183",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1210769183"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 6347,
      "original_line": 6347,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211763570",
      "pull_request_review_id": 1451533873,
      "id": 1211763570,
      "node_id": "PRRC_kwDOABII585IOgty",
      "diff_hunk": "@@ -667,6 +678,21 @@ class TxRequestTracker::Impl {\n         });\n     }\n \n+    void ResetRequestTimeout(NodeId peer, const uint256& txhash, std::chrono::microseconds new_expiry)\n+    {\n+        auto it = m_index.get<ByPeer>().find(ByPeerView{peer, false, txhash});",
      "path": "src/txrequest.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "212a7010257b43eff9fa017bcf625acfc84f650f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "since we're touching this, would you mind annotating the bool as `/* best */` to make it clearer what this is doing? New to tx tracking; would be helpful",
      "created_at": "2023-05-31T13:56:26Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1211763570",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211763570"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 687,
      "original_line": 687,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211861912",
      "pull_request_review_id": 1451533873,
      "id": 1211861912,
      "node_id": "PRRC_kwDOABII585IO4uY",
      "diff_hunk": "@@ -176,9 +207,13 @@ void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx)\n         const auto it_by_prev = m_outpoint_to_orphan_it.find(COutPoint(tx.GetHash(), i));\n         if (it_by_prev != m_outpoint_to_orphan_it.end()) {\n             for (const auto& elem : it_by_prev->second) {\n+                Assume(elem->second.announcers.size() >= 1);\n+                if (elem->second.announcers.empty()) break;\n+                // Pick the first peer from announcers set.",
      "path": "src/txorphanage.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "any reason for the first?",
      "created_at": "2023-05-31T14:59:41Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1211861912",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211861912"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 212,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211869199",
      "pull_request_review_id": 1451533873,
      "id": 1211869199,
      "node_id": "PRRC_kwDOABII585IO6gP",
      "diff_hunk": "@@ -24,7 +24,7 @@ static constexpr size_t MAX_ORPHAN_TOTAL_SIZE{100 * MAX_STANDARD_TX_WEIGHT};\n  */\n class TxOrphanage {\n public:\n-    /** Add a new orphan transaction */\n+    /** Add a new orphan transaction. If the tx already exists, add this peer to its list of announcers. */",
      "path": "src/txorphanage.h",
      "position": 23,
      "original_position": 5,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Should note that it only returns true if new",
      "created_at": "2023-05-31T15:04:44Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1211869199",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211869199"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 27,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211872666",
      "pull_request_review_id": 1451533873,
      "id": 1211872666,
      "node_id": "PRRC_kwDOABII585IO7Wa",
      "diff_hunk": "@@ -21,8 +21,14 @@ bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer)\n     if (tx == nullptr) return false;\n \n     const uint256& hash = tx->GetHash();\n-    if (m_orphans.count(hash))\n+    if (m_orphans.count(hash)) {",
      "path": "src/txorphanage.cpp",
      "position": 16,
      "original_position": 5,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "can we `Assume` that there's already an entry in the announcer list?",
      "created_at": "2023-05-31T15:07:26Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1211872666",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1211872666"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212076537",
      "pull_request_review_id": 1451533873,
      "id": 1212076537,
      "node_id": "PRRC_kwDOABII585IPtH5",
      "diff_hunk": "@@ -1418,16 +1423,47 @@ void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n     }\n }\n \n-void PeerManagerImpl::AddOrphanResolutionCandidate(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& orphan, std::chrono::microseconds current_time)\n+void PeerManagerImpl::AddOrphanAnnouncer(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& tx, std::chrono::microseconds current_time)\n {\n-    AssertLockHeld(::cs_main);\n+    AssertLockHeld(::cs_main); // For m_txrequest\n+    const bool connected = m_connman.ForNode(nodeid, [](CNode* node) { return node->fSuccessfullyConnected && !node->fDisconnect; });\n+    if (!connected) return;\n+    if (m_txpackagetracker->Count(nodeid) + m_txrequest.Count(nodeid) >= MAX_PEER_TX_ANNOUNCEMENTS) {\n+        // Too many queued announcements. Request from a different peer.\n+        // TODO: Allow peers with Relay permissions to bypass this restriction.\n+        return;\n+    }\n     const CNodeState* state = State(nodeid);\n-    // Decide the TxRequestTracker parameters for this orphan resolution:\n+    // Decide the TxRequestTracker parameters for this orphan resolution.\n+    // TxPackageTracker may also increase the delay.\n     // - \"preferred\": if fPreferredDownload is set (= outbound, or NetPermissionFlags::NoBan permission)\n-    // - \"reqtime\": current time\n+    // - \"reqtime\": current time plus delays for:\n+    //   - NONPREF_PEER_TX_DELAY for announcements from non-preferred connections\n+    //   - OVERLOADED_PEER_TX_DELAY for announcements from peers which have at least\n+    //     MAX_PEER_TX_REQUEST_IN_FLIGHT requests in flight\n+    //     TODO: allow peers with Relay permissions to bypass this restiction\n     auto delay{0us};\n     const bool preferred = state->fPreferredDownload;\n-    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, orphan, preferred, current_time + delay);\n+    if (!preferred) delay += NONPREF_PEER_TX_DELAY;\n+    const bool overloaded = m_txrequest.CountInFlight(nodeid) >= MAX_PEER_TX_REQUEST_IN_FLIGHT;\n+    if (overloaded) delay += OVERLOADED_PEER_TX_DELAY;\n+    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, tx, preferred, current_time + delay);\n+}\n+void PeerManagerImpl::AddOrphanResolutionCandidates(const CTransactionRef& orphan, NodeId originator)\n+{\n+    const auto current_time{GetTime<std::chrono::microseconds>()};\n+\n+    // The originator will not show up in GetCandidatePeers() since we already requested from them.\n+    AddOrphanAnnouncer(originator, orphan->GetWitnessHash(), orphan, current_time);\n+    // We prefer to request the orphan's ancestors via package relay rather than txids",
      "path": "src/net_processing.cpp",
      "position": 211,
      "original_position": 58,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "0671e1c178270350aadeba625da8b95d6ef2ff00",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "How is this preferred precisely?",
      "created_at": "2023-05-31T17:41:23Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1212076537",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212076537"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1532,
      "original_line": 1532,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212089989",
      "pull_request_review_id": 1451533873,
      "id": 1212089989,
      "node_id": "PRRC_kwDOABII585IPwaF",
      "diff_hunk": "@@ -3748,6 +3784,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 if (!fAlreadyHave && !m_chainman.ActiveChainstate().IsInitialBlockDownload()) {\n                     AddTxAnnouncement(pfrom, gtxid, current_time);\n                 }\n+                if (inv.IsMsgWtx() && m_txpackagetracker->OrphanageHaveTx(gtxid) && !m_chainman.ActiveChainstate().IsInitialBlockDownload()) {",
      "path": "src/net_processing.cpp",
      "position": 594,
      "original_position": 74,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "0671e1c178270350aadeba625da8b95d6ef2ff00",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this seems mutually exclusive with the above conditional since it implies `!fAlreadyHave`, make an `else if` to make it clearer?",
      "created_at": "2023-05-31T17:53:26Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1212089989",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212089989"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4117,
      "original_line": 4117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212101478",
      "pull_request_review_id": 1451533873,
      "id": 1212101478,
      "node_id": "PRRC_kwDOABII585IPzNm",
      "diff_hunk": "@@ -1418,16 +1423,47 @@ void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n     }\n }\n \n-void PeerManagerImpl::AddOrphanResolutionCandidate(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& orphan, std::chrono::microseconds current_time)\n+void PeerManagerImpl::AddOrphanAnnouncer(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& tx, std::chrono::microseconds current_time)\n {\n-    AssertLockHeld(::cs_main);\n+    AssertLockHeld(::cs_main); // For m_txrequest\n+    const bool connected = m_connman.ForNode(nodeid, [](CNode* node) { return node->fSuccessfullyConnected && !node->fDisconnect; });\n+    if (!connected) return;\n+    if (m_txpackagetracker->Count(nodeid) + m_txrequest.Count(nodeid) >= MAX_PEER_TX_ANNOUNCEMENTS) {\n+        // Too many queued announcements. Request from a different peer.\n+        // TODO: Allow peers with Relay permissions to bypass this restriction.\n+        return;\n+    }\n     const CNodeState* state = State(nodeid);\n-    // Decide the TxRequestTracker parameters for this orphan resolution:\n+    // Decide the TxRequestTracker parameters for this orphan resolution.\n+    // TxPackageTracker may also increase the delay.\n     // - \"preferred\": if fPreferredDownload is set (= outbound, or NetPermissionFlags::NoBan permission)\n-    // - \"reqtime\": current time\n+    // - \"reqtime\": current time plus delays for:\n+    //   - NONPREF_PEER_TX_DELAY for announcements from non-preferred connections\n+    //   - OVERLOADED_PEER_TX_DELAY for announcements from peers which have at least\n+    //     MAX_PEER_TX_REQUEST_IN_FLIGHT requests in flight\n+    //     TODO: allow peers with Relay permissions to bypass this restiction\n     auto delay{0us};\n     const bool preferred = state->fPreferredDownload;\n-    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, orphan, preferred, current_time + delay);\n+    if (!preferred) delay += NONPREF_PEER_TX_DELAY;\n+    const bool overloaded = m_txrequest.CountInFlight(nodeid) >= MAX_PEER_TX_REQUEST_IN_FLIGHT;\n+    if (overloaded) delay += OVERLOADED_PEER_TX_DELAY;\n+    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, tx, preferred, current_time + delay);\n+}\n+void PeerManagerImpl::AddOrphanResolutionCandidates(const CTransactionRef& orphan, NodeId originator)\n+{\n+    const auto current_time{GetTime<std::chrono::microseconds>()};\n+\n+    // The originator will not show up in GetCandidatePeers() since we already requested from them.\n+    AddOrphanAnnouncer(originator, orphan->GetWitnessHash(), orphan, current_time);\n+    // We prefer to request the orphan's ancestors via package relay rather than txids\n+    // of missing inputs. Also, if the first request fails, we should try again.\n+    // Get all peers that announced this transaction and prioritize accordingly...\n+    for (const auto nodeid : m_txrequest.GetCandidatePeers(orphan->GetWitnessHash())) {\n+        AddOrphanAnnouncer(nodeid, orphan->GetWitnessHash(), orphan, current_time);",
      "path": "src/net_processing.cpp",
      "position": 215,
      "original_position": 62,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "0671e1c178270350aadeba625da8b95d6ef2ff00",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Double checking that this is a no-op if the peer is already one the list of announcers? These seem to be called quite a bit as you get new announcements.",
      "created_at": "2023-05-31T18:02:00Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1212101478",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212101478"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1536,
      "original_line": 1536,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212157327",
      "pull_request_review_id": 1451533873,
      "id": 1212157327,
      "node_id": "PRRC_kwDOABII585IQA2P",
      "diff_hunk": "@@ -294,3 +297,57 @@ std::vector<uint256> TxOrphanage::EraseForBlock(const CBlock& block)\n     }\n     return vOrphanErase;\n }\n+\n+void TxOrphanage::ProtectOrphan(const uint256& wtxid)\n+{\n+    AssertLockNotHeld(m_mutex);\n+    LOCK(m_mutex);\n+    const auto it = m_wtxid_to_orphan_it.find(wtxid);\n+    if (it == m_wtxid_to_orphan_it.end()) return;\n+    // Already protected, increase its protection\n+    if (it->second->second.list_pos < 0) {\n+        it->second->second.list_pos -= 1;\n+        return;\n+    }\n+\n+    auto old_pos = it->second->second.list_pos;\n+    assert(m_orphan_list[old_pos] == it->second);\n+    if (old_pos + 1 != static_cast<int32_t>(m_orphan_list.size())) {\n+        // Unless we're deleting the last entry in m_orphan_list, move the last\n+        // entry to the position we're deleting.\n+        auto it_last = m_orphan_list.back();\n+        m_orphan_list[old_pos] = it_last;\n+        it_last->second.list_pos = old_pos;\n+    }\n+    m_orphan_list.pop_back();\n+    // Set list_pos to -1 to indicate this orphan is protected.\n+    it->second->second.list_pos = -1;\n+}\n+\n+void TxOrphanage::UndoProtectOrphan(const uint256& wtxid)\n+{\n+    AssertLockNotHeld(m_mutex);\n+    LOCK(m_mutex);\n+    const auto it = m_wtxid_to_orphan_it.find(wtxid);\n+    if (it == m_wtxid_to_orphan_it.end()) return;\n+    // Already not protected, nothing to do\n+    if (it->second->second.list_pos >= 0) {\n+        Assume(false);\n+        return;\n+    }\n+    // Protected by more than one peer. Remove one of the protections.\n+    if (it->second->second.list_pos < -1) {\n+        it->second->second.list_pos += 1;\n+        return;\n+    }\n+    // Add to the end or m_orphan_list",
      "path": "src/txorphanage.cpp",
      "position": 297,
      "original_position": 94,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "end of*",
      "created_at": "2023-05-31T18:46:14Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1212157327",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212157327"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 350,
      "original_line": 350,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212166925",
      "pull_request_review_id": 1451533873,
      "id": 1212166925,
      "node_id": "PRRC_kwDOABII585IQDMN",
      "diff_hunk": "@@ -294,3 +297,57 @@ std::vector<uint256> TxOrphanage::EraseForBlock(const CBlock& block)\n     }\n     return vOrphanErase;\n }\n+\n+void TxOrphanage::ProtectOrphan(const uint256& wtxid)\n+{\n+    AssertLockNotHeld(m_mutex);\n+    LOCK(m_mutex);\n+    const auto it = m_wtxid_to_orphan_it.find(wtxid);\n+    if (it == m_wtxid_to_orphan_it.end()) return;\n+    // Already protected, increase its protection\n+    if (it->second->second.list_pos < 0) {\n+        it->second->second.list_pos -= 1;\n+        return;\n+    }\n+\n+    auto old_pos = it->second->second.list_pos;\n+    assert(m_orphan_list[old_pos] == it->second);\n+    if (old_pos + 1 != static_cast<int32_t>(m_orphan_list.size())) {\n+        // Unless we're deleting the last entry in m_orphan_list, move the last\n+        // entry to the position we're deleting.\n+        auto it_last = m_orphan_list.back();\n+        m_orphan_list[old_pos] = it_last;\n+        it_last->second.list_pos = old_pos;\n+    }\n+    m_orphan_list.pop_back();\n+    // Set list_pos to -1 to indicate this orphan is protected.\n+    it->second->second.list_pos = -1;\n+}\n+\n+void TxOrphanage::UndoProtectOrphan(const uint256& wtxid)\n+{\n+    AssertLockNotHeld(m_mutex);\n+    LOCK(m_mutex);\n+    const auto it = m_wtxid_to_orphan_it.find(wtxid);\n+    if (it == m_wtxid_to_orphan_it.end()) return;\n+    // Already not protected, nothing to do\n+    if (it->second->second.list_pos >= 0) {\n+        Assume(false);\n+        return;\n+    }\n+    // Protected by more than one peer. Remove one of the protections.\n+    if (it->second->second.list_pos < -1) {\n+        it->second->second.list_pos += 1;\n+        return;\n+    }\n+    // Add to the end or m_orphan_list",
      "path": "src/txorphanage.cpp",
      "position": 297,
      "original_position": 94,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": 1212157327,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Say in comment the obvious \"protected by a single peer\" or add an `Assume` to that effect. Took me too long to figure this out even though it's obvious now.",
      "created_at": "2023-05-31T18:51:18Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1212166925",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1212166925"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 350,
      "original_line": 350,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213499613",
      "pull_request_review_id": 1451533873,
      "id": 1213499613,
      "node_id": "PRRC_kwDOABII585IVIjd",
      "diff_hunk": "@@ -256,12 +292,49 @@ class TxPackageTracker::Impl {\n             orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);\n         }\n \n-        if (tx != nullptr) {\n-            m_orphanage.AddTx(tx, nodeid);\n-        } else {\n-            m_orphanage.AddTx(m_orphanage.GetTx(wtxid), nodeid);\n-        }\n-\n+        m_orphanage.AddTx(ptx, nodeid);\n+        // Protection may or may not be possible. If the orphan is unprotected, it's possible it\n+        // will be evicted by the time we try to download ancestors. If we cannot protect now but",
      "path": "src/node/txpackagetracker.cpp",
      "position": 305,
      "original_position": 91,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d76bb9dbb85d840df36f6b73fb84a2e58ada8433",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "note: if child is evicted, will we attempt to process the rest of the package? will likely fail due to fee reasons, maybe this is just bandwidth loss?",
      "created_at": "2023-06-01T17:59:10Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213499613",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213499613"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 305,
      "original_line": 305,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213504016",
      "pull_request_review_id": 1451533873,
      "id": 1213504016,
      "node_id": "PRRC_kwDOABII585IVJoQ",
      "diff_hunk": "@@ -256,12 +292,49 @@ class TxPackageTracker::Impl {\n             orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);\n         }\n \n-        if (tx != nullptr) {\n-            m_orphanage.AddTx(tx, nodeid);\n-        } else {\n-            m_orphanage.AddTx(m_orphanage.GetTx(wtxid), nodeid);\n-        }\n-\n+        m_orphanage.AddTx(ptx, nodeid);\n+        // Protection may or may not be possible. If the orphan is unprotected, it's possible it\n+        // will be evicted by the time we try to download ancestors. If we cannot protect now but\n+        // still have it later, we will attempt to protect it again.\n+        MaybeProtectOrphan(nodeid, wtxid);\n+    }\n+    void MaybeProtectOrphan(NodeId nodeid, const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(m_mutex)\n+    {\n+        AssertLockHeld(m_mutex);\n+        auto peer_info_it = info_per_peer.find(nodeid);\n+        // Skip if this isn't a package relay peer.\n+        if (peer_info_it == info_per_peer.end()) return;\n+        const auto orphan_tx = m_orphanage.GetTx(wtxid);\n+        // Skip if the orphanage doesn't have this transaction.\n+        if (!orphan_tx) return;\n+        const auto orphan_size{orphan_tx->GetTotalSize()};\n+        // Skip if this peer is already protecting this orphan.\n+        if (peer_info_it->second.m_protected_orphan_map.count(wtxid) > 0) return;\n+        // Skip if this peer is already protecting too many orphans.\n+        if (peer_info_it->second.AvailableProtectionTokens() < orphan_size) return;\n+\n+        // Protect this orphan.\n+        LogPrint(BCLog::TXPACKAGES, \"\\nProtecting orphan %s for peer=%d\\n\", wtxid.ToString(), nodeid);\n+        m_orphanage.ProtectOrphan(wtxid);\n+        peer_info_it->second.m_protected_orphans_size += orphan_tx->GetTotalSize();",
      "path": "src/node/txpackagetracker.cpp",
      "position": 327,
      "original_position": 113,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d76bb9dbb85d840df36f6b73fb84a2e58ada8433",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "re-use `orphan_size`",
      "created_at": "2023-06-01T18:03:51Z",
      "updated_at": "2023-06-02T14:42:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213504016",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213504016"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 327,
      "original_line": 327,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213509093",
      "pull_request_review_id": 1451533873,
      "id": 1213509093,
      "node_id": "PRRC_kwDOABII585IVK3l",
      "diff_hunk": "@@ -16,10 +16,21 @@ namespace node {\n      * Same as GETDATA_TX_INTERVAL. */\n     static constexpr auto ORPHAN_ANCESTOR_GETDATA_INTERVAL{60s};\n \n-    /** Delay to add if an orphan resolution candidate is already using a lot of memory in the\n+    /** Delay to add if an orphan resolution candidate is protecting a lot of memory in the\n      * orphanage. */\n     static constexpr auto ORPHANAGE_OVERLOAD_DELAY{1s};\n \n+    /** Maximum amount of orphans we may protect for an inbound peer when they first connect.\n+     * The number of \"protection tokens\" an inbound peer starts with. */\n+    static constexpr size_t MAX_ORPHANAGE_PROTECTION_INBOUND{50000};\n+    /** Maximum amount of orphans we may protect for an outbound peer when they first connect.\n+     * The number of \"protection tokens\" an inbound peer starts with. Equal to one maximum-size orphan. */",
      "path": "src/node/txpackagetracker.cpp",
      "position": 27,
      "original_position": 13,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d76bb9dbb85d840df36f6b73fb84a2e58ada8433",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "make it clear that all these units are in serialized transaction bytes, not WU or vsize.",
      "created_at": "2023-06-01T18:09:19Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213509093",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213509093"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 27,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213527350",
      "pull_request_review_id": 1451533873,
      "id": 1213527350,
      "node_id": "PRRC_kwDOABII585IVPU2",
      "diff_hunk": "@@ -241,12 +267,22 @@ class TxPackageTracker::Impl {\n         LOCK(m_mutex);\n         // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n         if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n+        CTransactionRef ptx = tx ? tx : m_orphanage.GetTx(wtxid);\n \n         // Skip if already requested in the (recent-ish) past.\n         if (packageinfo_requested.contains(GetPackageInfoRequestId(nodeid, wtxid, PKG_RELAY_ANCPKG))) return;\n \n+        // Skip if this peer is already using a lot of space in the orphanage.\n+        if (m_orphanage.BytesFromPeer(nodeid) > MAX_ORPHANAGE_USAGE) return;",
      "path": "src/node/txpackagetracker.cpp",
      "position": 284,
      "original_position": 66,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d76bb9dbb85d840df36f6b73fb84a2e58ada8433",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`BytesFromPeer` counts all announced orphans, even if duplicates, correct?",
      "created_at": "2023-06-01T18:26:51Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213527350",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213527350"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 284,
      "original_line": 284,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213537090",
      "pull_request_review_id": 1451533873,
      "id": 1213537090,
      "node_id": "PRRC_kwDOABII585IVRtC",
      "diff_hunk": "@@ -303,6 +376,9 @@ class TxPackageTracker::Impl {\n             auto pending_iter = pending_package_info.find(packageid);\n             Assume(pending_iter != pending_package_info.end());\n             if (pending_iter != pending_package_info.end()) {\n+                for (const auto& [wtxid, missing] : pending_iter->second.m_txdata_status) {\n+                    if (!missing) MaybeUnprotectOrphan(nodeid, wtxid);",
      "path": "src/node/txpackagetracker.cpp",
      "position": 388,
      "original_position": 140,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d76bb9dbb85d840df36f6b73fb84a2e58ada8433",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "what is the conditional guarding against?",
      "created_at": "2023-06-01T18:37:53Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213537090",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213537090"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 388,
      "original_line": 388,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213551414",
      "pull_request_review_id": 1451533873,
      "id": 1213551414,
      "node_id": "PRRC_kwDOABII585IVVM2",
      "diff_hunk": "@@ -241,12 +267,22 @@ class TxPackageTracker::Impl {\n         LOCK(m_mutex);\n         // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n         if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n+        CTransactionRef ptx = tx ? tx : m_orphanage.GetTx(wtxid);\n \n         // Skip if already requested in the (recent-ish) past.\n         if (packageinfo_requested.contains(GetPackageInfoRequestId(nodeid, wtxid, PKG_RELAY_ANCPKG))) return;\n \n+        // Skip if this peer is already using a lot of space in the orphanage.\n+        if (m_orphanage.BytesFromPeer(nodeid) > MAX_ORPHANAGE_USAGE) return;",
      "path": "src/node/txpackagetracker.cpp",
      "position": 284,
      "original_position": 66,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d76bb9dbb85d840df36f6b73fb84a2e58ada8433",
      "in_reply_to_id": 1213527350,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "also, think we should use the new orphan tx size as well here to avoid going past MAX_ORPHANAGE_USAGE?",
      "created_at": "2023-06-01T18:53:28Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213551414",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213551414"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 284,
      "original_line": 284,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213639103",
      "pull_request_review_id": 1451533873,
      "id": 1213639103,
      "node_id": "PRRC_kwDOABII585IVqm_",
      "diff_hunk": "@@ -188,7 +191,7 @@ void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n         if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx due to expiration\\n\", nErased);\n     }\n     FastRandomContext rng;\n-    while (m_orphans.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)\n+    while (m_orphan_list.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)",
      "path": "src/txorphanage.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`m_orphan_list` seems more aptly named `m_unprotected_orphan_list` after this",
      "created_at": "2023-06-01T20:19:34Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213639103",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213639103"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213640730",
      "pull_request_review_id": 1451533873,
      "id": 1213640730,
      "node_id": "PRRC_kwDOABII585IVrAa",
      "diff_hunk": "@@ -188,7 +191,7 @@ void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n         if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx due to expiration\\n\", nErased);\n     }\n     FastRandomContext rng;\n-    while (m_orphans.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)\n+    while (m_orphan_list.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)",
      "path": "src/txorphanage.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": 1213639103,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If we connect to enough peers and protect transactions beyond `MAX_ORPHAN_TOTAL_SIZE`, this will result in an assert with randrange arg of 0 once m_orphan_list is empty? Should either check m_orphan_list is non-empty, or only count non-protected bytes with `m_total_unprotected_orphan_bytes`?\r\n\r\n",
      "created_at": "2023-06-01T20:21:34Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213640730",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213640730"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213651441",
      "pull_request_review_id": 1451533873,
      "id": 1213651441,
      "node_id": "PRRC_kwDOABII585IVtnx",
      "diff_hunk": "@@ -50,7 +50,12 @@ class TxOrphanage {\n     /** Erase all orphans included in or invalidated by a new block. Returns wtxids of erased txns. */\n     std::vector<uint256> EraseForBlock(const CBlock& block) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Limit the orphanage to the given maximum */\n+    /** Limit the orphanage to the given maximum. Delete orphans whose expiry has been reached.\n+     * The maximum does not apply to protected transactions, i.e., LimitOrphans(100) ensures\n+     * that the number of non-protected orphan entries does not exceed 100. Afterward, Size() may\n+     * return a number greater than 100.  It is the caller's responsibility to ensure that not too\n+     * many orphans are protected.\n+     */\n     void LimitOrphans(unsigned int max_orphans) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 58,
      "original_position": 11,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "rename arg `max_unprotected_orphans`?",
      "created_at": "2023-06-01T20:33:43Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1213651441",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1213651441"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 59,
      "original_line": 59,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214465487",
      "pull_request_review_id": 1451533873,
      "id": 1214465487,
      "node_id": "PRRC_kwDOABII585IY0XP",
      "diff_hunk": "@@ -74,21 +99,43 @@ int TxOrphanage::_EraseTx(const uint256& txid)\n             m_outpoint_to_orphan_it.erase(itPrev);\n     }\n \n-    size_t old_pos = it->second.list_pos;\n-    assert(m_orphan_list[old_pos] == it);\n-    if (old_pos + 1 != m_orphan_list.size()) {\n-        // Unless we're deleting the last entry in m_orphan_list, move the last\n-        // entry to the position we're deleting.\n-        auto it_last = m_orphan_list.back();\n-        m_orphan_list[old_pos] = it_last;\n-        it_last->second.list_pos = old_pos;\n+    if (it->second.list_pos >= 0) {",
      "path": "src/txorphanage.cpp",
      "position": 103,
      "original_position": 103,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Should this function ever be called with a protected orphan? Tests don't cover these lines for protected peers(added an assert, never hit), and seems suspect that it would delete things below this block if it's protected.",
      "created_at": "2023-06-02T14:38:20Z",
      "updated_at": "2023-06-02T14:42:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214465487",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214465487"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214484568",
      "pull_request_review_id": 1457714296,
      "id": 1214484568,
      "node_id": "PRRC_kwDOABII585IY5BY",
      "diff_hunk": "@@ -74,21 +99,43 @@ int TxOrphanage::_EraseTx(const uint256& txid)\n             m_outpoint_to_orphan_it.erase(itPrev);\n     }\n \n-    size_t old_pos = it->second.list_pos;\n-    assert(m_orphan_list[old_pos] == it);\n-    if (old_pos + 1 != m_orphan_list.size()) {\n-        // Unless we're deleting the last entry in m_orphan_list, move the last\n-        // entry to the position we're deleting.\n-        auto it_last = m_orphan_list.back();\n-        m_orphan_list[old_pos] = it_last;\n-        it_last->second.list_pos = old_pos;\n+    if (it->second.list_pos >= 0) {",
      "path": "src/txorphanage.cpp",
      "position": 103,
      "original_position": 103,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": 1214465487,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Should this function ever be called with a protected orphan?\r\n\r\nYes. It's called when orphans expire as well.\r\n\r\n> Tests don't cover these lines for protected peers\r\n\r\nSounds like I neglected to write a test for this. Expiry is pretty long, but theoretically we can hit this if we have multiple peers stalling us on the resolution of this orphan. We might happen to be trying package relay with one of the peers when the expiration is reached.",
      "created_at": "2023-06-02T14:55:32Z",
      "updated_at": "2023-06-02T14:55:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214484568",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214484568"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214486019",
      "pull_request_review_id": 1457717975,
      "id": 1214486019,
      "node_id": "PRRC_kwDOABII585IY5YD",
      "diff_hunk": "@@ -74,21 +99,43 @@ int TxOrphanage::_EraseTx(const uint256& txid)\n             m_outpoint_to_orphan_it.erase(itPrev);\n     }\n \n-    size_t old_pos = it->second.list_pos;\n-    assert(m_orphan_list[old_pos] == it);\n-    if (old_pos + 1 != m_orphan_list.size()) {\n-        // Unless we're deleting the last entry in m_orphan_list, move the last\n-        // entry to the position we're deleting.\n-        auto it_last = m_orphan_list.back();\n-        m_orphan_list[old_pos] = it_last;\n-        it_last->second.list_pos = old_pos;\n+    if (it->second.list_pos >= 0) {",
      "path": "src/txorphanage.cpp",
      "position": 103,
      "original_position": 103,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": 1214465487,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ah! Didn't put 2 and 2 together. Comment-worthy",
      "created_at": "2023-06-02T14:56:53Z",
      "updated_at": "2023-06-02T14:56:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214486019",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214486019"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214489207",
      "pull_request_review_id": 1457726341,
      "id": 1214489207,
      "node_id": "PRRC_kwDOABII585IY6J3",
      "diff_hunk": "@@ -188,7 +191,7 @@ void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n         if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx due to expiration\\n\", nErased);\n     }\n     FastRandomContext rng;\n-    while (m_orphans.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)\n+    while (m_orphan_list.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)",
      "path": "src/txorphanage.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": 1213639103,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ah yes, that's a bug! This `while` condition is very strange since one part applies to the unprotected orphanage and the other applies to the total orphanage. I think we should change the second condition to be on `m_total_unprotected_orphan_bytes`, yes.",
      "created_at": "2023-06-02T14:59:44Z",
      "updated_at": "2023-06-02T14:59:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214489207",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214489207"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214497418",
      "pull_request_review_id": 1457748132,
      "id": 1214497418,
      "node_id": "PRRC_kwDOABII585IY8KK",
      "diff_hunk": "@@ -176,9 +207,13 @@ void TxOrphanage::AddChildrenToWorkSet(const CTransaction& tx)\n         const auto it_by_prev = m_outpoint_to_orphan_it.find(COutPoint(tx.GetHash(), i));\n         if (it_by_prev != m_outpoint_to_orphan_it.end()) {\n             for (const auto& elem : it_by_prev->second) {\n+                Assume(elem->second.announcers.size() >= 1);\n+                if (elem->second.announcers.empty()) break;\n+                // Pick the first peer from announcers set.",
      "path": "src/txorphanage.cpp",
      "position": null,
      "original_position": 94,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": 1211861912,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Basically arbitrary. The relevance is basically which peer's message processing is blocked to process this, and would get a misbehaving score if the tx is invalid. Anyone who announced it is equally deserving of this burden imo. I suppose a more fair way to pick is uniformly randomly.",
      "created_at": "2023-06-02T15:07:28Z",
      "updated_at": "2023-06-02T15:07:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214497418",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214497418"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 212,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214696267",
      "pull_request_review_id": 1458284571,
      "id": 1214696267,
      "node_id": "PRRC_kwDOABII585IZstL",
      "diff_hunk": "@@ -72,6 +72,13 @@ class TxOrphanage {\n         LOCK(m_mutex);\n         return m_total_orphan_bytes;\n     }\n+    size_t BytesFromPeer(NodeId peer) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)",
      "path": "src/txorphanage.h",
      "position": 83,
      "original_position": 4,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "986f7622dabd422d6dc21bfc3319a0d04d4c4ecc",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think this introduces an interdependency between the number of outgoing transaction bytes we can receive from a peer and the maximum flow of LN commitment transaction+CPFP in weight a direct transaction-relay peer can announce to us and therefore we can validate. An `option_anchors_zero_fee_htlc_tx` LN commitment transaction weight is 900 WU with no pending HTLCs. As the orphan memory usage is implemented, it’s unclear if there is any processing guarantees for a peer announcing transaction to us, such processing guarantees are hard to enforce as we would be dependent on the full-node host performance.\r\n\r\nNote current `MAX_ORPHANAGE_USAGE` is defined as `MAX_ORPHANAGE_USAGE{10*MAX_ORPHANAGE_PROTECTION_OUTBOUND}` though it sounds applied on processing inbound announcement (L276 in `src/node/txpackagetracker.cpp`).",
      "created_at": "2023-06-02T18:42:45Z",
      "updated_at": "2023-06-02T19:14:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214696267",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214696267"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 91,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214712117",
      "pull_request_review_id": 1458284571,
      "id": 1214712117,
      "node_id": "PRRC_kwDOABII585IZwk1",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.",
      "path": "src/node/txpackagetracker.h",
      "position": 79,
      "original_position": 13,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "There is a argument that can be made if memory and throughputs limits (e.g `MAX_PEER_ANNOUNCEMENTS`) are applied in function of the type of transactions received (e.g v3 transactions) and that can be used to nudge multi-party and contracting protocols transactions broadcasters to use fee-bumping efficient mechanism such as one CPFP covering multiple parents due to the package limits. This would be a discount incentive by analogy with SegWit spending discounted by consensus validation rules.\r\n\r\nOn the other hand, such incentive might have “bad incentives” as such package topology might be unsafe (i.e if all the parents confirmation are time-sensitive) and this can become a further complication of our transaction-relay stack.\r\n\r\nThere is still a last open question if such lack of dissociation between type of traffic (e.g packages from simple transactions) could be abused when package validation is deployed, and CPU performance processing asymmetries (i.e `AcceptSingleTransaction` vs `AcceptMultipleTransactions` vs `AcceptPackageWrappingSingle` vs `AcceptAncestorPackage`) between our code paths could be exploited by a transaction-relay jamming adversary.",
      "created_at": "2023-06-02T18:57:00Z",
      "updated_at": "2023-06-02T19:14:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214712117",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214712117"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 79,
      "original_line": 79,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214720397",
      "pull_request_review_id": 1458284571,
      "id": 1214720397,
      "node_id": "PRRC_kwDOABII585IZymN",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing",
      "path": "src/node/txpackagetracker.h",
      "position": 86,
      "original_position": 20,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If I understand correctly the rate-limiting accounting introduced here, whatever the number of orphan parent missing, there will be an in-flight orphan parent requests issued (i.e if we’re missing 10 parents, we’re going to issue 10 in-flight orphan parent requests).\r\n\r\nI think this should be documented as multi-party applications and contracting protocols transactions issuers might have to assemble their packages in function.",
      "created_at": "2023-06-02T19:03:32Z",
      "updated_at": "2023-06-02T19:14:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214720397",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214720397"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 86,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214728153",
      "pull_request_review_id": 1458284571,
      "id": 1214728153,
      "node_id": "PRRC_kwDOABII585IZ0fZ",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing\n+     * parents were requested), package info requests, tx data download, and packages in the\n+     * validation queue. */\n+    size_t Count(NodeId nodeid) const;\n+\n+    /** Number of packages we are currently working on with this peer (i.e. reserving memory for\n+     * storing orphan(s)). Includes in-flight package info requests, tx data download, and packages\n+     * in the validation queue. Excludes entries in the orphan tracker that are just candidates. */\n+    size_t CountInFlight(NodeId nodeid) const;\n+\n+    /** Get list of requests that should be sent to resolve orphans. These may be wtxids to send\n+     * getdata(ANCPKGINFO) or txids corresponding to parents. Automatically marks the orphans as\n+     * having outgoing requests. */\n+    std::vector<GenTxid> GetOrphanRequests(NodeId nodeid, std::chrono::microseconds current_time);\n+\n+    /** Update transactions for which we have made \"final\" decisions: transactions that have\n+     * confirmed in a block, conflicted due to a block, or added to the mempool already.\n+     * Should be called on new block: valid=block transactions, invalid=conflicts.\n+     * Should be called when tx is added to mempool.\n+     * Should not be called when a tx fails validation.\n+     * */\n+    void FinalizeTransactions(const std::set<uint256>& valid, const std::set<uint256>& invalid);",
      "path": "src/node/txpackagetracker.h",
      "position": 107,
      "original_position": 41,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This is unclear what level of enforcement is granted to a “final” decision, if the transactions are added to any transaction-relay download filters such as `m_recent_rejects` or `m_recently_announced_invs`. Otherwise, in case of blocks re-orgs dropping out the first package component and a second package component still stuck in filters, this can be source of package propagation failure.",
      "created_at": "2023-06-02T19:10:09Z",
      "updated_at": "2023-06-02T19:14:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214728153",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214728153"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 107,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214732393",
      "pull_request_review_id": 1458284571,
      "id": 1214732393,
      "node_id": "PRRC_kwDOABII585IZ1hp",
      "diff_hunk": "@@ -43,7 +43,8 @@ class TxOrphanage {\n     /** Erase an orphan by wtxid */\n     int EraseTx(const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase all orphans announced by a peer (eg, after that peer disconnects) */\n+    /** Maybe erase all orphans announced by a peer (eg, after that peer disconnects). If an orphan",
      "path": "src/txorphanage.h",
      "position": 42,
      "original_position": 14,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think there can be a source of concerns if all the announced orphans are second components from a single common parent. All our peers would announce those second-stage components, only one of them will succeed in the mempool validation and other will be refused as conflicts, I think.",
      "created_at": "2023-06-02T19:14:42Z",
      "updated_at": "2023-06-02T19:14:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214732393",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214732393"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 46,
      "original_line": 46,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214751567",
      "pull_request_review_id": 1458376374,
      "id": 1214751567,
      "node_id": "PRRC_kwDOABII585IZ6NP",
      "diff_hunk": "@@ -72,6 +72,13 @@ class TxOrphanage {\n         LOCK(m_mutex);\n         return m_total_orphan_bytes;\n     }\n+    size_t BytesFromPeer(NodeId peer) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)",
      "path": "src/txorphanage.h",
      "position": 83,
      "original_position": 4,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "986f7622dabd422d6dc21bfc3319a0d04d4c4ecc",
      "in_reply_to_id": 1214696267,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Orphan usage would effect the CPFP transactions, IIUC, not the commitment transactions. The CPFP is deemed high enough, sent to the peer, the peer holds the child tx in orphan set and requests the full package, which isn't size-bound(beyond current mempool limits).",
      "created_at": "2023-06-02T19:34:01Z",
      "updated_at": "2023-06-02T19:34:01Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1214751567",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1214751567"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 91,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218144248",
      "pull_request_review_id": 1462664683,
      "id": 1218144248,
      "node_id": "PRRC_kwDOABII585Im2f4",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing",
      "path": "src/node/txpackagetracker.h",
      "position": 86,
      "original_position": 20,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": 1214720397,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "IIUC\r\n\r\ntotal number of inflights doesn't appear to be changed here, it's still `MAX_PEER_TX_ANNOUNCEMENTS`\r\n\r\nIf the protected buckets are taken by attackers, an honest party can still insert an orphan into the unprotected bucket(under the MAX_PEER_TX_ANNOUNCEMENTS limit), and the whole package including the child should get fetched after a short delay.\r\n\r\nSo from a time-sensitive contract perspective, things should be strictly better than today?",
      "created_at": "2023-06-05T14:19:36Z",
      "updated_at": "2023-06-05T14:19:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1218144248",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1218144248"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 86,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223106639",
      "pull_request_review_id": 1470017044,
      "id": 1223106639,
      "node_id": "PRRC_kwDOABII585I5yBP",
      "diff_hunk": "@@ -43,7 +43,8 @@ class TxOrphanage {\n     /** Erase an orphan by wtxid */\n     int EraseTx(const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase all orphans announced by a peer (eg, after that peer disconnects) */\n+    /** Maybe erase all orphans announced by a peer (eg, after that peer disconnects). If an orphan",
      "path": "src/txorphanage.h",
      "position": 42,
      "original_position": 14,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": 1214732393,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Can you elaborate on this concern? The orphan that isn't received yet may still be in orphanage, and will be connected to its parents normally?",
      "created_at": "2023-06-08T14:14:55Z",
      "updated_at": "2023-06-08T14:14:55Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223106639",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223106639"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 46,
      "original_line": 46,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223432211",
      "pull_request_review_id": 1470579458,
      "id": 1223432211,
      "node_id": "PRRC_kwDOABII585I7BgT",
      "diff_hunk": "@@ -56,6 +61,14 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    PackageRelayVersions GetSupportedVersions() const;\n+\n+    // We expect this to be called only once\n+    void ReceivedVersion(NodeId nodeid);\n+    void ReceivedSendpackages(NodeId nodeid, PackageRelayVersions versions);\n+    // Finalize the registration state.\n+    bool ReceivedVerack(NodeId nodeid, bool inbound, bool txrelay, bool wtxidrelay);",
      "path": "src/node/txpackagetracker.h",
      "position": 73,
      "original_position": 22,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "26e11e877e2848f99591894d6d46b7bf69756e60",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Note that it returns true if peer can relay some type of package that we accept",
      "created_at": "2023-06-08T18:54:40Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223432211",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223432211"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 73,
      "original_line": 73,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223435262",
      "pull_request_review_id": 1470579458,
      "id": 1223435262,
      "node_id": "PRRC_kwDOABII585I7CP-",
      "diff_hunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) 2021-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/txpackagetracker.h>\n+#include <txorphanage.h>\n+\n+#include <test/util/setup_common.h>\n+\n+#include <boost/test/unit_test.hpp>\n+\n+BOOST_FIXTURE_TEST_SUITE(txpackagetracker_tests, BasicTestingSetup)\n+BOOST_AUTO_TEST_CASE(pkginfo)\n+{\n+    TxOrphanage orphanage;\n+    node::TxPackageTracker tracker;\n+\n+    // Peer 0: successful handshake\n+    NodeId peer = 0;\n+    tracker.ReceivedVersion(peer);\n+    tracker.ReceivedSendpackages(peer, node::PKG_RELAY_ANCPKG);\n+    BOOST_CHECK(tracker.ReceivedVerack(peer, /*inbound`*/ true, /*txrelay=*/true, /*wtxidrelay=*/true));\n+\n+    // Peer 1: unsupported version(s)\n+    const node::PackageRelayVersions unsupported_package_type{1 << 29};\n+    peer = 1;\n+    tracker.ReceivedVersion(peer);\n+    tracker.ReceivedSendpackages(peer, unsupported_package_type);\n+    BOOST_CHECK(!tracker.ReceivedVerack(peer, /*inbound`*/ true, /*txrelay=*/true, /*wtxidrelay=*/true));\n+\n+    // Peer 2: no wtxidrelay\n+    peer = 2;\n+    tracker.ReceivedVersion(peer);\n+    tracker.ReceivedSendpackages(peer, node::PKG_RELAY_ANCPKG);\n+    BOOST_CHECK(!tracker.ReceivedVerack(peer, /*inbound`*/ true, /*txrelay=*/true, /*wtxidrelay=*/false));\n+\n+    // Peer 3: fRelay=false",
      "path": "src/test/txpackagetracker_tests.cpp",
      "position": 57,
      "original_position": 37,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "5e5afc5590171157a983a123a5b8150f9edbe582",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "should also test `PKG_RELAY_NONE`",
      "created_at": "2023-06-08T18:58:19Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223435262",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223435262"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 57,
      "original_line": 57,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223451646",
      "pull_request_review_id": 1470579458,
      "id": 1223451646,
      "node_id": "PRRC_kwDOABII585I7GP-",
      "diff_hunk": "@@ -3319,6 +3336,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (greatest_common_version >= WTXID_RELAY_VERSION) {\n             m_connman.PushMessage(&pfrom, msg_maker.Make(NetMsgType::WTXIDRELAY));\n+            if (m_enable_package_relay) {",
      "path": "src/net_processing.cpp",
      "position": 542,
      "original_position": 103,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "daa3802272fe4bb59eaba19b02ca2bb0288f8526",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "in what situation would we support ancestor packages but also be running blocksonly?",
      "created_at": "2023-06-08T19:15:13Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223451646",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223451646"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3621,
      "original_line": 3621,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223459823",
      "pull_request_review_id": 1470579458,
      "id": 1223459823,
      "node_id": "PRRC_kwDOABII585I7IPv",
      "diff_hunk": "@@ -0,0 +1,105 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test package relay messages\"\"\"\n+\n+import time\n+\n+from test_framework.messages import (\n+    msg_sendpackages,\n+    msg_verack,\n+    msg_wtxidrelay,\n+    PKG_RELAY_ANCPKG,\n+)\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PTxInvStore,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+def cleanup(func):\n+    def wrapper(self):\n+        assert len(self.nodes[0].getpeerinfo()) == 0\n+        assert len(self.nodes[0].getrawmempool()) == 0\n+        try:\n+            func(self)\n+        finally:\n+            # Clear mempool\n+            self.generate(self.nodes[0], 1)\n+            self.nodes[0].disconnect_p2ps()\n+    return wrapper\n+\n+class PackageRelayer(P2PTxInvStore):\n+    def __init__(self, send_sendpackages=True, send_wtxidrelay=True):\n+        super().__init__()\n+        # List versions of each sendpackages received\n+        self._sendpackages_received = []\n+        self._send_sendpackages = send_sendpackages\n+        self._send_wtxidrelay = send_wtxidrelay\n+\n+    @property\n+    def sendpackages_received(self):\n+        with p2p_lock:\n+            return self._sendpackages_received\n+\n+    def on_version(self, message):\n+        if self._send_wtxidrelay:\n+            self.send_message(msg_wtxidrelay())\n+        if self._send_sendpackages:\n+            sendpackages_message = msg_sendpackages()\n+            sendpackages_message.versions = PKG_RELAY_ANCPKG\n+            self.send_message(sendpackages_message)\n+        self.send_message(msg_verack())\n+        self.nServices = message.nServices\n+\n+    def on_sendpackages(self, message):\n+        self._sendpackages_received.append(message.versions)\n+\n+class PackageRelayTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-packagerelay=1\"]]\n+\n+    @cleanup\n+    def test_sendpackages(self):\n+        self.log.info(\"Test sendpackages during version handshake\")\n+        node = self.nodes[0]\n+        peer_normal = node.add_p2p_connection(PackageRelayer())\n+        assert_equal(node.getpeerinfo()[0][\"bytesrecv_per_msg\"][\"sendpackages\"], 28)\n+        assert_equal(node.getpeerinfo()[0][\"bytessent_per_msg\"][\"sendpackages\"], 28)\n+        assert_equal(peer_normal.sendpackages_received, [PKG_RELAY_ANCPKG])\n+        node.disconnect_p2ps()\n+\n+        self.log.info(\"Test sendpackages without wtxid relay\")\n+        node = self.nodes[0]\n+        peer_no_wtxidrelay = node.add_p2p_connection(PackageRelayer(send_wtxidrelay=False))\n+        assert_equal(node.getpeerinfo()[0][\"bytesrecv_per_msg\"][\"sendpackages\"], 28)\n+        assert_equal(node.getpeerinfo()[0][\"bytessent_per_msg\"][\"sendpackages\"], 28)\n+        assert_equal(peer_no_wtxidrelay.sendpackages_received, [PKG_RELAY_ANCPKG])\n+        node.disconnect_p2ps()\n+\n+        self.log.info(\"Test sendpackages is sent even so\")",
      "path": "test/functional/p2p_package_relay.py",
      "position": 248,
      "original_position": 85,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "daa3802272fe4bb59eaba19b02ca2bb0288f8526",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "log seems cut off?",
      "created_at": "2023-06-08T19:25:59Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223459823",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223459823"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 248,
      "original_line": 248,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223461978",
      "pull_request_review_id": 1470579458,
      "id": 1223461978,
      "node_id": "PRRC_kwDOABII585I7Ixa",
      "diff_hunk": "@@ -0,0 +1,105 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2022 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\"\"\"Test package relay messages\"\"\"\n+\n+import time\n+\n+from test_framework.messages import (\n+    msg_sendpackages,\n+    msg_verack,\n+    msg_wtxidrelay,\n+    PKG_RELAY_ANCPKG,\n+)\n+from test_framework.p2p import (\n+    p2p_lock,\n+    P2PTxInvStore,\n+)\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    assert_equal,\n+)\n+\n+def cleanup(func):\n+    def wrapper(self):\n+        assert len(self.nodes[0].getpeerinfo()) == 0\n+        assert len(self.nodes[0].getrawmempool()) == 0\n+        try:\n+            func(self)\n+        finally:\n+            # Clear mempool\n+            self.generate(self.nodes[0], 1)\n+            self.nodes[0].disconnect_p2ps()\n+    return wrapper\n+\n+class PackageRelayer(P2PTxInvStore):\n+    def __init__(self, send_sendpackages=True, send_wtxidrelay=True):\n+        super().__init__()\n+        # List versions of each sendpackages received\n+        self._sendpackages_received = []\n+        self._send_sendpackages = send_sendpackages\n+        self._send_wtxidrelay = send_wtxidrelay\n+\n+    @property\n+    def sendpackages_received(self):\n+        with p2p_lock:\n+            return self._sendpackages_received\n+\n+    def on_version(self, message):\n+        if self._send_wtxidrelay:\n+            self.send_message(msg_wtxidrelay())\n+        if self._send_sendpackages:\n+            sendpackages_message = msg_sendpackages()\n+            sendpackages_message.versions = PKG_RELAY_ANCPKG\n+            self.send_message(sendpackages_message)\n+        self.send_message(msg_verack())\n+        self.nServices = message.nServices\n+\n+    def on_sendpackages(self, message):\n+        self._sendpackages_received.append(message.versions)\n+\n+class PackageRelayTest(BitcoinTestFramework):\n+    def set_test_params(self):\n+        self.num_nodes = 1\n+        self.extra_args = [[\"-packagerelay=1\"]]\n+\n+    @cleanup\n+    def test_sendpackages(self):\n+        self.log.info(\"Test sendpackages during version handshake\")\n+        node = self.nodes[0]\n+        peer_normal = node.add_p2p_connection(PackageRelayer())\n+        assert_equal(node.getpeerinfo()[0][\"bytesrecv_per_msg\"][\"sendpackages\"], 28)\n+        assert_equal(node.getpeerinfo()[0][\"bytessent_per_msg\"][\"sendpackages\"], 28)\n+        assert_equal(peer_normal.sendpackages_received, [PKG_RELAY_ANCPKG])\n+        node.disconnect_p2ps()\n+\n+        self.log.info(\"Test sendpackages without wtxid relay\")",
      "path": "test/functional/p2p_package_relay.py",
      "position": 239,
      "original_position": 77,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "daa3802272fe4bb59eaba19b02ca2bb0288f8526",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "add a test where it's *not* sent if peer's protocol version doesn't support `WTXID_RELAY_VERSION`",
      "created_at": "2023-06-08T19:28:41Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223461978",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223461978"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 239,
      "original_line": 239,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223467513",
      "pull_request_review_id": 1470579458,
      "id": 1223467513,
      "node_id": "PRRC_kwDOABII585I7KH5",
      "diff_hunk": "@@ -244,6 +245,7 @@ static RPCHelpMan getpeerinfo()\n             heights.push_back(height);\n         }\n         obj.pushKV(\"inflight\", heights);\n+        obj.pushKV(\"relaytxpackages\", statestats.m_package_relay);",
      "path": "src/rpc/net.cpp",
      "position": 12,
      "original_position": 12,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d60b80edf0f347cb1f0d91ede77fcc3a85beadd0",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "would be nice to expose when `m_enable_package_relay` is true somewhere",
      "created_at": "2023-06-08T19:35:13Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223467513",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223467513"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 248,
      "original_line": 248,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223472785",
      "pull_request_review_id": 1470579458,
      "id": 1223472785,
      "node_id": "PRRC_kwDOABII585I7LaR",
      "diff_hunk": "@@ -293,16 +293,27 @@ BOOST_FIXTURE_TEST_CASE(noncontextual_package_tests, TestChain100Setup)\n         BOOST_CHECK_EQUAL(state.GetResult(), PackageValidationResult::PCKG_POLICY);\n         BOOST_CHECK_EQUAL(state.GetRejectReason(), \"package-not-sorted\");\n         BOOST_CHECK(IsChildWithParents({tx_parent, tx_child}));\n+        BOOST_CHECK_EQUAL(GetPackageHash({tx_child}), GetCombinedHash({tx_child->GetWitnessHash()}));",
      "path": "src/test/txpackage_tests.cpp",
      "position": 180,
      "original_position": 4,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "f1ec862c3f899b4a51145b4090cdf613bb19c84e",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "a regression test with two elements checking it's actually sorted lexigraphically would be good since this is a p2p message. I added a `std::reverse` to `GetCombinedHash` and passed tests.",
      "created_at": "2023-06-08T19:41:55Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223472785",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223472785"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 296,
      "original_line": 296,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223524179",
      "pull_request_review_id": 1470579458,
      "id": 1223524179,
      "node_id": "PRRC_kwDOABII585I7X9T",
      "diff_hunk": "@@ -2084,6 +2117,7 @@ bool PeerManagerImpl::AlreadyHaveTx(const GenTxid& gtxid, bool include_orphanage\n         // txs a second chance.\n         hashRecentRejectsChainTip = m_chainman.ActiveChain().Tip()->GetBlockHash();\n         m_recent_rejects.reset();\n+        m_recent_rejects_reconsiderable.reset();",
      "path": "src/net_processing.cpp",
      "position": 331,
      "original_position": 64,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "985b36ab71bffa4a53ac6edd000fa8380fa78ef7",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "maybe update comment above for this. Would the case be maybe fee situation has changed and we'd reconsider? ",
      "created_at": "2023-06-08T20:37:25Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1223524179",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1223524179"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2162,
      "original_line": 2162,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224415809",
      "pull_request_review_id": 1470579458,
      "id": 1224415809,
      "node_id": "PRRC_kwDOABII585I-xpB",
      "diff_hunk": "@@ -2436,6 +2480,7 @@ void PeerManagerImpl::ProcessGetData(CNode& pfrom, Peer& peer, const std::atomic\n                     for (const CTxMemPoolEntry& parent : parents) {\n                         if (parent.GetTime() > now - UNCONDITIONAL_RELAY_DELAY) {\n                             parent_ids_to_add.push_back(parent.GetTx().GetHash());\n+                            parent_ids_to_add.push_back(parent.GetTx().GetWitnessHash());",
      "path": "src/net_processing.cpp",
      "position": 422,
      "original_position": 84,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "a988ba3fddfea58908b3dc7d68a70811022ff97f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this feels unrelated? \r\n\r\n`parent_txid` in loop below should be renamed accordingly",
      "created_at": "2023-06-09T14:53:09Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224415809",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224415809"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 2525,
      "original_line": 2525,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224428421",
      "pull_request_review_id": 1470579458,
      "id": 1224428421,
      "node_id": "PRRC_kwDOABII585I-0uF",
      "diff_hunk": "@@ -223,6 +226,6 @@ std::vector<std::string> serviceFlagsToStr(uint64_t flags)\n \n GenTxid ToGenTxid(const CInv& inv)\n {\n-    assert(inv.IsGenTxMsg());\n+    assert(inv.IsGenTxMsg() || inv.IsMsgAncPkgInfo());\n     return inv.IsMsgWtx() ? GenTxid::Wtxid(inv.hash) : GenTxid::Txid(inv.hash);",
      "path": "src/protocol.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "a988ba3fddfea58908b3dc7d68a70811022ff97f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Seems like this is wrong? for an inv of type `MSG_ANCPKGINFO`, we'll be looking up the transaction as though it's a txid, not wtxid. Perhaps this isn't causing issues since `m_recently_announced_invs` contains both hashes even if m_mempool.info() would miss it?",
      "created_at": "2023-06-09T15:03:05Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224428421",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224428421"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 230,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224447994",
      "pull_request_review_id": 1470579458,
      "id": 1224447994,
      "node_id": "PRRC_kwDOABII585I-5f6",
      "diff_hunk": "@@ -498,6 +501,7 @@ class CInv\n     bool IsMsgFilteredBlk() const { return type == MSG_FILTERED_BLOCK; }\n     bool IsMsgCmpctBlk() const { return type == MSG_CMPCT_BLOCK; }\n     bool IsMsgWitnessBlk() const { return type == MSG_WITNESS_BLOCK; }\n+    bool IsMsgAncPkgInfo() const { return type == MSG_ANCPKGINFO; }",
      "path": "src/protocol.h",
      "position": 34,
      "original_position": 21,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "a988ba3fddfea58908b3dc7d68a70811022ff97f",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "IIUC this is the first INV you can't actually send anyone (yet). Might be nice to catch that and print a sensible error message instead of \"Unknown inv type\": https://github.com/bitcoin/bitcoin/blob/master/src/net_processing.cpp#L3765\r\n\r\nWould help future readers too, I think.",
      "created_at": "2023-06-09T15:21:48Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224447994",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224447994"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 512,
      "original_line": 512,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224493542",
      "pull_request_review_id": 1470579458,
      "id": 1224493542,
      "node_id": "PRRC_kwDOABII585I_Enm",
      "diff_hunk": "@@ -159,14 +165,26 @@ class TxPackageTracker::Impl {\n         // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n         if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n \n-        // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n-        orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);\n+        // Skip if already requested in the (recent-ish) past.",
      "path": "src/node/txpackagetracker.cpp",
      "position": 280,
      "original_position": 34,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "f5f4b6cd0bd8d545cf3cc16820b111aa43e25ee5",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "from this specific peer",
      "created_at": "2023-06-09T16:03:56Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224493542",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224493542"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 280,
      "original_line": 280,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224506179",
      "pull_request_review_id": 1470579458,
      "id": 1224506179,
      "node_id": "PRRC_kwDOABII585I_HtD",
      "diff_hunk": "@@ -99,6 +99,16 @@ class TxPackageTracker {\n      * Should not be called when a tx fails validation.\n      * */\n     void FinalizeTransactions(const std::set<uint256>& valid, const std::set<uint256>& invalid);\n+\n+    /** Whether a package info message is allowed (version-agnostic):\n+     * - We agreed to relay packages of this version with this peer.\n+     * - We solicited this package info somewhat recently.\n+     * Returns false if the message is not allowed and the peer should be disconnected. */\n+    bool PkgInfoAllowed(NodeId nodeid, const uint256& wtxid, PackageRelayVersions version);",
      "path": "src/node/txpackagetracker.h",
      "position": 113,
      "original_position": 9,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "f5f4b6cd0bd8d545cf3cc16820b111aa43e25ee5",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "These two functions are defined but not used in this commit. Could we put these changes in a commit that includes this functionality/tests?",
      "created_at": "2023-06-09T16:18:59Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224506179",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224506179"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 113,
      "original_line": 113,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224519916",
      "pull_request_review_id": 1470579458,
      "id": 1224519916,
      "node_id": "PRRC_kwDOABII585I_LDs",
      "diff_hunk": "@@ -44,6 +64,58 @@ BOOST_AUTO_TEST_CASE(pkginfo)\n         BOOST_CHECK_EQUAL(tracker.Count(i), 0);\n         BOOST_CHECK_EQUAL(tracker.CountInFlight(i), 0);\n     }\n+\n+    const auto current_time{GetTime<std::chrono::microseconds>()};\n+    const auto orphan0 = make_tx({COutPoint{det_rand.rand256(), 0}}, 1);\n+    const auto wtxid_parent1 = det_rand.rand256();\n+    const auto orphan1 = make_tx({COutPoint{wtxid_parent1, 0}, COutPoint{wtxid_parent1, 1}}, 1);\n+    const auto orphan2 = make_tx({COutPoint{det_rand.rand256(), 0}, COutPoint{det_rand.rand256(), 0}}, 1);\n+    tracker.AddOrphanTx(/*nodeid=*/0, orphan0->GetWitnessHash(), orphan0, /*is_preferred=*/false, current_time);\n+    tracker.AddOrphanTx(/*nodeid=*/1, orphan1->GetWitnessHash(), orphan1, /*is_preferred=*/false, current_time);\n+    tracker.AddOrphanTx(/*nodeid=*/1, orphan0->GetWitnessHash(), orphan0, /*is_preferred=*/false, current_time + 10s);\n+    tracker.AddOrphanTx(/*nodeid=*/2, orphan1->GetWitnessHash(), orphan1, /*is_preferred=*/false, current_time + 5s);\n+    tracker.AddOrphanTx(/*nodeid=*/3, orphan2->GetWitnessHash(), orphan2, /*is_preferred=*/true, current_time + 5s);\n+    tracker.AddOrphanTx(/*nodeid=*/4, orphan2->GetWitnessHash(), orphan2, /*is_preferred=*/false, current_time + 9s);",
      "path": "src/test/txpackagetracker_tests.cpp",
      "position": 78,
      "original_position": 53,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cd5520ccfa84f0a8d8792db3e867e4109ec8fcbe",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I don't know where this 4th peer came from? I suppose in the context of the test it would result in a peer we would fetch via legacy orphan handling.",
      "created_at": "2023-06-09T16:34:10Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224519916",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224519916"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 78,
      "original_line": 78,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224522961",
      "pull_request_review_id": 1470579458,
      "id": 1224522961,
      "node_id": "PRRC_kwDOABII585I_LzR",
      "diff_hunk": "@@ -44,6 +64,58 @@ BOOST_AUTO_TEST_CASE(pkginfo)\n         BOOST_CHECK_EQUAL(tracker.Count(i), 0);\n         BOOST_CHECK_EQUAL(tracker.CountInFlight(i), 0);\n     }\n+\n+    const auto current_time{GetTime<std::chrono::microseconds>()};\n+    const auto orphan0 = make_tx({COutPoint{det_rand.rand256(), 0}}, 1);\n+    const auto wtxid_parent1 = det_rand.rand256();\n+    const auto orphan1 = make_tx({COutPoint{wtxid_parent1, 0}, COutPoint{wtxid_parent1, 1}}, 1);\n+    const auto orphan2 = make_tx({COutPoint{det_rand.rand256(), 0}, COutPoint{det_rand.rand256(), 0}}, 1);\n+    tracker.AddOrphanTx(/*nodeid=*/0, orphan0->GetWitnessHash(), orphan0, /*is_preferred=*/false, current_time);\n+    tracker.AddOrphanTx(/*nodeid=*/1, orphan1->GetWitnessHash(), orphan1, /*is_preferred=*/false, current_time);\n+    tracker.AddOrphanTx(/*nodeid=*/1, orphan0->GetWitnessHash(), orphan0, /*is_preferred=*/false, current_time + 10s);\n+    tracker.AddOrphanTx(/*nodeid=*/2, orphan1->GetWitnessHash(), orphan1, /*is_preferred=*/false, current_time + 5s);\n+    tracker.AddOrphanTx(/*nodeid=*/3, orphan2->GetWitnessHash(), orphan2, /*is_preferred=*/true, current_time + 5s);\n+    tracker.AddOrphanTx(/*nodeid=*/4, orphan2->GetWitnessHash(), orphan2, /*is_preferred=*/false, current_time + 9s);\n+    BOOST_CHECK_EQUAL(tracker.Count(0), 1);\n+    BOOST_CHECK_EQUAL(tracker.Count(1), 2);\n+    BOOST_CHECK_EQUAL(tracker.Count(2), 1);\n+    BOOST_CHECK_EQUAL(tracker.Count(3), 1);\n+    BOOST_CHECK_EQUAL(tracker.Count(4), 1);\n+    const auto peer0_requests = tracker.GetOrphanRequests(/*nodeid=*/0, current_time + 1s);\n+    const auto peer1_requests = tracker.GetOrphanRequests(/*nodeid=*/1, current_time + 1s);\n+    const auto peer2_requests = tracker.GetOrphanRequests(/*nodeid=*/2, current_time + 1s);\n+    const auto peer3_requests = tracker.GetOrphanRequests(/*nodeid=*/3, current_time);\n+    const auto peer4_requests = tracker.GetOrphanRequests(/*nodeid=*/4, current_time);\n+    BOOST_CHECK_EQUAL(peer0_requests.size(), 1);\n+    BOOST_CHECK(peer0_requests.front().IsWtxid());\n+    BOOST_CHECK_EQUAL(peer0_requests.front().GetHash(), orphan0->GetWitnessHash());\n+    BOOST_CHECK_EQUAL(peer1_requests.size(), 1);\n+    BOOST_CHECK_EQUAL(peer1_requests.front().GetHash(), wtxid_parent1);\n+    BOOST_CHECK(!peer1_requests.front().IsWtxid());\n+    BOOST_CHECK(peer2_requests.empty());\n+    BOOST_CHECK(peer3_requests.empty());\n+    BOOST_CHECK(peer4_requests.empty());\n+    BOOST_CHECK_EQUAL(tracker.CountInFlight(0), 1);\n+    BOOST_CHECK_EQUAL(tracker.CountInFlight(1), 1);\n+    BOOST_CHECK_EQUAL(tracker.Count(1), 2);\n+    BOOST_CHECK_EQUAL(tracker.CountInFlight(2), 0);\n+    BOOST_CHECK_EQUAL(tracker.CountInFlight(3), 0);\n+    BOOST_CHECK_EQUAL(tracker.CountInFlight(4), 0);\n+    // After peer1 disconnects, request from peer2\n+    tracker.DisconnectedPeer(1);\n+    // After peer3 disconnects, request from peer4\n+    tracker.DisconnectedPeer(3);\n+    BOOST_CHECK_EQUAL(tracker.Count(3), 0);\n+    BOOST_CHECK_EQUAL(tracker.CountInFlight(3), 0);\n+    const auto peer2_requests_later = tracker.GetOrphanRequests(/*nodeid=*/2, current_time + 5s);",
      "path": "src/test/txpackagetracker_tests.cpp",
      "position": 110,
      "original_position": 85,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cd5520ccfa84f0a8d8792db3e867e4109ec8fcbe",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "for the two _later checks, would be nice to see `GetOrphanRequests` returns empty if reqtime wasn't reached yet, even if they're otherwise the best peer for it post-disconnect",
      "created_at": "2023-06-09T16:38:12Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224522961",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224522961"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 110,
      "original_line": 110,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224542605",
      "pull_request_review_id": 1470579458,
      "id": 1224542605,
      "node_id": "PRRC_kwDOABII585I_QmN",
      "diff_hunk": "@@ -4992,6 +5046,13 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     // If we receive a NOTFOUND message for a tx we requested, mark the announcement for it as\n                     // completed in TxRequestTracker.\n                     m_txrequest.ReceivedResponse(pfrom.GetId(), inv.hash);\n+                } else if (inv.IsMsgAncPkgInfo() && m_enable_package_relay) {\n+                    if (!m_txpackagetracker->PkgInfoAllowed(pfrom.GetId(), inv.hash, node::PKG_RELAY_ANCPKG)) {\n+                        LogPrint(BCLog::NET, \"\\nUnsolicited ancpkginfo sent, disconnecting peer=%d\\n\", pfrom.GetId());\n+                        // Unsolicited ancpkginfo or peer is not registered for package relay.",
      "path": "src/net_processing.cpp",
      "position": 851,
      "original_position": 82,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "39476ab805a950c184f2dcdea43b655aac17cbca",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "won't disconnect peer if `!m_enable_package_relay` but will if it's on?",
      "created_at": "2023-06-09T16:52:26Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224542605",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224542605"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5317,
      "original_line": 5317,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224550602",
      "pull_request_review_id": 1470579458,
      "id": 1224550602,
      "node_id": "PRRC_kwDOABII585I_SjK",
      "diff_hunk": "@@ -4174,6 +4178,56 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (msg_type == NetMsgType::ANCPKGINFO) {\n+        std::vector<uint256> package_wtxids;\n+        vRecv >> package_wtxids;\n+        if (package_wtxids.empty()) return;",
      "path": "src/net_processing.cpp",
      "position": 607,
      "original_position": 25,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "39476ab805a950c184f2dcdea43b655aac17cbca",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Empty ancpkginfo seems invalid, peer should have sent a `notfound`?\r\n\r\n\"The wtxid of the requested transaction must be the last item in the list\"",
      "created_at": "2023-06-09T17:02:11Z",
      "updated_at": "2023-06-14T16:15:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224550602",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224550602"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4382,
      "original_line": 4382,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224557823",
      "pull_request_review_id": 1470579458,
      "id": 1224557823,
      "node_id": "PRRC_kwDOABII585I_UT_",
      "diff_hunk": "@@ -4174,6 +4178,56 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (msg_type == NetMsgType::ANCPKGINFO) {\n+        std::vector<uint256> package_wtxids;\n+        vRecv >> package_wtxids;\n+        if (package_wtxids.empty()) return;\n+        if (!peer->m_package_relay) {\n+            LogPrint(BCLog::NET, \"ancpkginfo sent in violation of protocol, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+        if (!m_txpackagetracker->PkgInfoAllowed(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG)) {\n+            LogPrint(BCLog::NET, \"unsolicited ancpkginfo sent, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+\n+        const auto& rep_wtxid{package_wtxids.back()};\n+        if (package_wtxids.size() > MAX_PACKAGE_COUNT) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, too many transactions\\n\", rep_wtxid.ToString());\n+            m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+            return;\n+        }\n+        LOCK(::cs_main);\n+        if (m_chainman.ActiveChainstate().IsInitialBlockDownload()) return;\n+        // We have already validated this exact set of transactions recently, so don't do it again.\n+        if (m_recent_rejects_reconsiderable.contains(GetCombinedHash(package_wtxids))) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, this package has already been rejected\\n\",",
      "path": "src/net_processing.cpp",
      "position": 632,
      "original_position": 47,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "39476ab805a950c184f2dcdea43b655aac17cbca",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "*recently*",
      "created_at": "2023-06-09T17:11:37Z",
      "updated_at": "2023-06-14T16:15:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1224557823",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1224557823"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4407,
      "original_line": 4407,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229828735",
      "pull_request_review_id": 1470579458,
      "id": 1229828735,
      "node_id": "PRRC_kwDOABII585JTbJ_",
      "diff_hunk": "@@ -3992,6 +4255,78 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (msg_type == NetMsgType::ANCPKGINFO) {\n+        std::vector<uint256> package_wtxids;\n+        vRecv >> package_wtxids;\n+        if (package_wtxids.empty()) return;\n+        if (!peer->m_package_relay) {\n+            LogPrint(BCLog::NET, \"ancpkginfo sent in violation of protocol, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+        if (!m_txpackagetracker->PkgInfoAllowed(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG)) {\n+            LogPrint(BCLog::NET, \"unsolicited ancpkginfo sent, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+\n+        // Note: Multiple ancestor packages can have the same representative (different ancestors for\n+        // honest or malicious reasons). But since we're only using this to resolve orphans, we\n+        // should never be in a situation where we have multiple ancpkginfos out for the same wtxid\n+        const auto& rep_wtxid{package_wtxids.back()};\n+        if (package_wtxids.size() > MAX_PACKAGE_COUNT) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, too many transactions\\n\", rep_wtxid.ToString());\n+            m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+            return;\n+        }\n+        LOCK(::cs_main);\n+        if (m_chainman.ActiveChainstate().IsInitialBlockDownload()) return;\n+        // We have already validated this exact set of transactions recently, so don't do it again.\n+        if (m_recent_rejects_reconsiderable.contains(GetCombinedHash(package_wtxids))) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, this package has already been rejected\\n\",\n+                     rep_wtxid.ToString());\n+            m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+            return;\n+        }\n+        for (const auto& wtxid : package_wtxids) {\n+            // If a transaction is in m_recent_rejects and not m_recent_rejects_reconsiderable, that",
      "path": "src/net_processing.cpp",
      "position": 638,
      "original_position": 626,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n            // If a transaction is in m_recent_rejects and package not m_recent_rejects_reconsiderable, that\r\n```",
      "created_at": "2023-06-14T15:40:10Z",
      "updated_at": "2023-06-14T16:15:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1229828735",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229828735"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4413,
      "original_line": 4413,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229835172",
      "pull_request_review_id": 1470579458,
      "id": 1229835172,
      "node_id": "PRRC_kwDOABII585JTcuk",
      "diff_hunk": "@@ -817,6 +847,33 @@ class PeerManagerImpl final : public PeerManager\n      * Memory used: 1.3 MB\n      */\n     CRollingBloomFilter m_recent_rejects GUARDED_BY(::cs_main){120'000, 0.000'001};\n+    /**\n+     * Filter for transactions or packages of transactions that were recently rejected by\n+     * the mempool but are eligible for reconsideration if submitted with other transactions.\n+     * This filter only contains wtxids of individual transactions and combined hashes of packages\n+     * (see GetCombinedHash and GetPackageHash).\n+     *\n+     * When a transaction's error is TX_LOW_FEE (in a package or by itself), add its wtxid to this\n+     * filter. If it was in a package, also add the combined hash of the transactions in its\n+     * subpackage to this filter. When a package fails for any reason, add the combined hash of all\n+     * transactions in the package info to this filter.\n+     *\n+     * Upon receiving an announcement for a transaction, if it exists in this filter, do not\n+     * download the txdata. Upon receiving a package info, if the combined hash of its transactions\n+     * are in this filter, do not download the txdata.\n+     *\n+     * Reset this filter when the chain tip changes.\n+     *\n+     * We will only add wtxids to this filter. Groups of multiple transactions are represented by\n+     * the hash of their wtxids, concatenated together in lexicographical order.\n+     *\n+     * Parameters are picked to be identical to that of m_recent_rejects, with the same rationale.\n+     * Memory used: 1.3 MB\n+     * FIXME: this filter can probably be smaller, but how much smaller?\n+     */\n+    CRollingBloomFilter m_recent_rejects_reconsiderable GUARDED_BY(::cs_main){120'000, 0.000'001};",
      "path": "src/net_processing.cpp",
      "position": 143,
      "original_position": 143,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this filter has individual wtxids entered into it, but never actually checked for. All `contains` call sites I see are checking for package hashes only.\r\n\r\nIn other words, I think we'll re-fetch in those transactions individually when advertised erroneously.",
      "created_at": "2023-06-14T15:44:56Z",
      "updated_at": "2023-06-14T16:15:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1229835172",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229835172"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 871,
      "original_line": 871,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229847693",
      "pull_request_review_id": 1470579458,
      "id": 1229847693,
      "node_id": "PRRC_kwDOABII585JTfyN",
      "diff_hunk": "@@ -0,0 +1,673 @@\n+// Copyright (c) 2022\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/txpackagetracker.h>\n+\n+#include <common/bloom.h>\n+#include <logging.h>\n+#include <policy/policy.h>\n+#include <txorphanage.h>\n+#include <txrequest.h>\n+#include <util/hasher.h>\n+\n+namespace node {\n+    /** How long to wait before requesting orphan ancpkginfo/parents from an additional peer.\n+     * Same as GETDATA_TX_INTERVAL. */\n+    static constexpr auto ORPHAN_ANCESTOR_GETDATA_INTERVAL{60s};\n+\n+    /** Delay to add if an orphan resolution candidate is protecting a lot of memory in the\n+     * orphanage. */\n+    static constexpr auto ORPHANAGE_OVERLOAD_DELAY{1s};\n+\n+    /** Maximum amount of orphans we may protect for an inbound peer when they first connect.\n+     * The number of \"protection tokens\" an inbound peer starts with. */\n+    static constexpr size_t MAX_ORPHANAGE_PROTECTION_INBOUND{50000};\n+    /** Maximum amount of orphans we may protect for an outbound peer when they first connect.\n+     * The number of \"protection tokens\" an inbound peer starts with. Equal to one maximum-size orphan. */\n+    static constexpr size_t MAX_ORPHANAGE_PROTECTION_OUTBOUND{400000};\n+\n+    /** Number of orphanage bytes a peer may use before we start dropping their requests. */\n+    static constexpr size_t MAX_ORPHANAGE_USAGE{10*MAX_ORPHANAGE_PROTECTION_OUTBOUND};\n+\n+\n+class TxPackageTracker::Impl {\n+    /** Manages unvalidated tx data (orphan transactions for which we are downloading ancestors). */\n+    TxOrphanage m_orphanage;\n+\n+    mutable Mutex m_mutex;\n+    struct RegistrationState {\n+        // All of the following bools will need to be true\n+        /** Whether this peer allows transaction relay from us. */\n+        bool m_txrelay{true};\n+        // Whether this peer sent a BIP339 wtxidrelay message.\n+        bool m_wtxid_relay{false};\n+        /** Whether this peer says they can do package relay. */\n+        bool m_sendpackages_received{false};\n+        /** Versions of package relay supported by this node.\n+         * This is a subset of PACKAGE_RELAY_SUPPORTED_VERSIONS. */\n+        PackageRelayVersions m_versions_in_common;\n+        bool CanRelayPackages() {\n+            return m_txrelay && m_wtxid_relay && m_sendpackages_received && m_versions_in_common != PKG_RELAY_NONE;\n+        }\n+    };\n+    /** Represents AncPkgInfo for which we are missing transaction data. */\n+    struct PackageToDownload {\n+        /** Who provided the ancpkginfo - this is the peer whose work queue to add this package when\n+         * all tx data is received. We expect to receive tx data from this peer. */\n+        const NodeId m_pkginfo_provider;\n+\n+        /** When to stop trying to download this package if we haven't received tx data yet. */\n+        std::chrono::microseconds m_expiry;\n+\n+        /** Representative wtxid, i.e. the orphan in an ancestor package. */\n+        const uint256 m_rep_wtxid;\n+\n+        /** Map from wtxid to status (true indicates it is missing). This can be expanded to further\n+         * states such as \"already in mempool/confirmed\" in the future. */\n+        std::vector<std::pair<uint256, bool>> m_txdata_status;\n+\n+        // Package info without wtxids doesn't make sense.\n+        PackageToDownload() = delete;\n+        // Constructor if you already know size.\n+        PackageToDownload(NodeId nodeid,\n+                          std::chrono::microseconds expiry,\n+                          const uint256& rep_wtxid,\n+                          const std::vector<std::pair<uint256, bool>>& txdata_status) :\n+            m_pkginfo_provider{nodeid},\n+            m_expiry{expiry},\n+            m_rep_wtxid{rep_wtxid},\n+            m_txdata_status{txdata_status}\n+        {}\n+        bool HasTransactionIn(const std::set<uint256>& wtxidset) const {\n+            for (const auto& keyval : m_txdata_status) {\n+                if (wtxidset.count(keyval.first) > 0) return true;\n+            }\n+            return false;\n+        }\n+        /** Returns wtxid of representative transaction (i.e. the orphan in an ancestor package). */\n+        uint256 RepresentativeWtxid() const { return m_rep_wtxid; }\n+        /** Combined hash of all wtxids in package. */\n+        uint256 GetPackageHash() const {\n+            std::vector<uint256> all_wtxids;\n+            std::transform(m_txdata_status.cbegin(), m_txdata_status.cend(), std::back_inserter(all_wtxids),\n+                [](const auto& mappair) { return mappair.first; });\n+            return GetCombinedHash(all_wtxids);\n+        }\n+    };\n+\n+    using PackageInfoRequestId = uint256;\n+    PackageInfoRequestId GetPackageInfoRequestId(NodeId nodeid, const uint256& wtxid, uint32_t version) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << wtxid << version).GetHash();\n+    }\n+    using PackageTxnsRequestId = uint256;\n+    PackageTxnsRequestId GetPackageTxnsRequestId(NodeId nodeid, const std::vector<uint256>& wtxids) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << GetCombinedHash(wtxids)).GetHash();\n+    }\n+    PackageTxnsRequestId GetPackageTxnsRequestId(NodeId nodeid, const std::vector<CTransactionRef>& pkgtxns) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << GetPackageHash(pkgtxns)).GetHash();\n+    }\n+    PackageTxnsRequestId GetPackageTxnsRequestId(NodeId nodeid, const uint256& combinedhash) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << combinedhash).GetHash();\n+    }\n+    /** List of all ancestor package info we're currently requesting txdata for, indexed by the\n+     * nodeid and getpkgtxns request we would have sent them. */\n+    std::map<PackageTxnsRequestId, PackageToDownload> pending_package_info GUARDED_BY(m_mutex);\n+\n+    using PendingMap = decltype(pending_package_info);\n+    struct IteratorComparator {\n+        template<typename I>\n+        bool operator()(const I& a, const I& b) const { return &(*a) < &(*b); }\n+    };\n+\n+    struct PeerInfo {\n+        /** Whether this is an inbound peer. Affects how much of the orphanage we may protect for\n+         * this peer. */\n+        bool m_is_inbound;\n+        // What package versions we agreed to relay.\n+        PackageRelayVersions m_versions_supported;\n+        /** Amount of orphans protected for this peer, in bytes. */\n+        size_t m_protected_orphans_size{0};\n+        /** Maximum amount of orphans that can be protected for this peer, in bytes. */\n+        size_t m_max_orphans_to_protect{0};\n+        /** Wtxids and sizes of the orphans in the orphanage who are protected for this peer. */\n+        std::map<uint256, size_t> m_protected_orphan_map;\n+\n+        /** Iterators to items in pending_package_info originating from this peer. */\n+        std::set<PendingMap::iterator, IteratorComparator> m_package_info_provided;\n+\n+        PeerInfo(bool is_inbound, PackageRelayVersions versions) :\n+            m_is_inbound{is_inbound},\n+            m_versions_supported{versions},\n+            m_max_orphans_to_protect{is_inbound ? MAX_ORPHANAGE_PROTECTION_INBOUND : MAX_ORPHANAGE_PROTECTION_OUTBOUND}\n+        {}\n+        bool SupportsVersion(PackageRelayVersions version) { return m_versions_supported & version; }\n+        size_t AvailableProtectionTokens() {\n+            if (m_max_orphans_to_protect < m_protected_orphans_size) {\n+                Assume(false);\n+                return 0;\n+            }\n+            return m_max_orphans_to_protect - m_protected_orphans_size;\n+        }\n+    };\n+\n+    /** Stores relevant information about the peer prior to verack. Upon completion of version\n+     * handshake, we use this information to decide whether we relay packages with this peer. */\n+    std::map<NodeId, RegistrationState> registration_states GUARDED_BY(m_mutex);\n+\n+    /** Information for each peer we relay packages with. Membership in this map is equivalent to\n+     * whether or not we relay packages with a peer. */\n+    std::map<NodeId, PeerInfo> info_per_peer GUARDED_BY(m_mutex);\n+\n+    /** Tracks orphans for which we need to request ancestor information. All hashes stored are\n+     * wtxids, i.e., the wtxid of the orphan. However, the is_wtxid field is used to indicate\n+     * whether we would request the ancestor information by wtxid (via package relay) or by txid\n+     * (via prevouts of the missing inputs). */\n+    TxRequestTracker orphan_request_tracker GUARDED_BY(m_mutex);\n+\n+    /** Cache of package info requests sent. Used to identify unsolicited package info messages. */\n+    CRollingBloomFilter packageinfo_requested GUARDED_BY(m_mutex){50000, 0.000001};",
      "path": "src/node/txpackagetracker.cpp",
      "position": 169,
      "original_position": 169,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "make all fields `m_`-compliant?",
      "created_at": "2023-06-14T15:54:51Z",
      "updated_at": "2023-06-14T16:15:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1229847693",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229847693"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 169,
      "original_line": 169,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229850076",
      "pull_request_review_id": 1470579458,
      "id": 1229850076,
      "node_id": "PRRC_kwDOABII585JTgXc",
      "diff_hunk": "@@ -0,0 +1,673 @@\n+// Copyright (c) 2022\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <node/txpackagetracker.h>\n+\n+#include <common/bloom.h>\n+#include <logging.h>\n+#include <policy/policy.h>\n+#include <txorphanage.h>\n+#include <txrequest.h>\n+#include <util/hasher.h>\n+\n+namespace node {\n+    /** How long to wait before requesting orphan ancpkginfo/parents from an additional peer.\n+     * Same as GETDATA_TX_INTERVAL. */\n+    static constexpr auto ORPHAN_ANCESTOR_GETDATA_INTERVAL{60s};\n+\n+    /** Delay to add if an orphan resolution candidate is protecting a lot of memory in the\n+     * orphanage. */\n+    static constexpr auto ORPHANAGE_OVERLOAD_DELAY{1s};\n+\n+    /** Maximum amount of orphans we may protect for an inbound peer when they first connect.\n+     * The number of \"protection tokens\" an inbound peer starts with. */\n+    static constexpr size_t MAX_ORPHANAGE_PROTECTION_INBOUND{50000};\n+    /** Maximum amount of orphans we may protect for an outbound peer when they first connect.\n+     * The number of \"protection tokens\" an inbound peer starts with. Equal to one maximum-size orphan. */\n+    static constexpr size_t MAX_ORPHANAGE_PROTECTION_OUTBOUND{400000};\n+\n+    /** Number of orphanage bytes a peer may use before we start dropping their requests. */\n+    static constexpr size_t MAX_ORPHANAGE_USAGE{10*MAX_ORPHANAGE_PROTECTION_OUTBOUND};\n+\n+\n+class TxPackageTracker::Impl {\n+    /** Manages unvalidated tx data (orphan transactions for which we are downloading ancestors). */\n+    TxOrphanage m_orphanage;\n+\n+    mutable Mutex m_mutex;\n+    struct RegistrationState {\n+        // All of the following bools will need to be true\n+        /** Whether this peer allows transaction relay from us. */\n+        bool m_txrelay{true};\n+        // Whether this peer sent a BIP339 wtxidrelay message.\n+        bool m_wtxid_relay{false};\n+        /** Whether this peer says they can do package relay. */\n+        bool m_sendpackages_received{false};\n+        /** Versions of package relay supported by this node.\n+         * This is a subset of PACKAGE_RELAY_SUPPORTED_VERSIONS. */\n+        PackageRelayVersions m_versions_in_common;\n+        bool CanRelayPackages() {\n+            return m_txrelay && m_wtxid_relay && m_sendpackages_received && m_versions_in_common != PKG_RELAY_NONE;\n+        }\n+    };\n+    /** Represents AncPkgInfo for which we are missing transaction data. */\n+    struct PackageToDownload {\n+        /** Who provided the ancpkginfo - this is the peer whose work queue to add this package when\n+         * all tx data is received. We expect to receive tx data from this peer. */\n+        const NodeId m_pkginfo_provider;\n+\n+        /** When to stop trying to download this package if we haven't received tx data yet. */\n+        std::chrono::microseconds m_expiry;\n+\n+        /** Representative wtxid, i.e. the orphan in an ancestor package. */\n+        const uint256 m_rep_wtxid;\n+\n+        /** Map from wtxid to status (true indicates it is missing). This can be expanded to further\n+         * states such as \"already in mempool/confirmed\" in the future. */\n+        std::vector<std::pair<uint256, bool>> m_txdata_status;\n+\n+        // Package info without wtxids doesn't make sense.\n+        PackageToDownload() = delete;\n+        // Constructor if you already know size.\n+        PackageToDownload(NodeId nodeid,\n+                          std::chrono::microseconds expiry,\n+                          const uint256& rep_wtxid,\n+                          const std::vector<std::pair<uint256, bool>>& txdata_status) :\n+            m_pkginfo_provider{nodeid},\n+            m_expiry{expiry},\n+            m_rep_wtxid{rep_wtxid},\n+            m_txdata_status{txdata_status}\n+        {}\n+        bool HasTransactionIn(const std::set<uint256>& wtxidset) const {\n+            for (const auto& keyval : m_txdata_status) {\n+                if (wtxidset.count(keyval.first) > 0) return true;\n+            }\n+            return false;\n+        }\n+        /** Returns wtxid of representative transaction (i.e. the orphan in an ancestor package). */\n+        uint256 RepresentativeWtxid() const { return m_rep_wtxid; }\n+        /** Combined hash of all wtxids in package. */\n+        uint256 GetPackageHash() const {\n+            std::vector<uint256> all_wtxids;\n+            std::transform(m_txdata_status.cbegin(), m_txdata_status.cend(), std::back_inserter(all_wtxids),\n+                [](const auto& mappair) { return mappair.first; });\n+            return GetCombinedHash(all_wtxids);\n+        }\n+    };\n+\n+    using PackageInfoRequestId = uint256;\n+    PackageInfoRequestId GetPackageInfoRequestId(NodeId nodeid, const uint256& wtxid, uint32_t version) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << wtxid << version).GetHash();\n+    }\n+    using PackageTxnsRequestId = uint256;\n+    PackageTxnsRequestId GetPackageTxnsRequestId(NodeId nodeid, const std::vector<uint256>& wtxids) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << GetCombinedHash(wtxids)).GetHash();\n+    }\n+    PackageTxnsRequestId GetPackageTxnsRequestId(NodeId nodeid, const std::vector<CTransactionRef>& pkgtxns) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << GetPackageHash(pkgtxns)).GetHash();\n+    }\n+    PackageTxnsRequestId GetPackageTxnsRequestId(NodeId nodeid, const uint256& combinedhash) {\n+        return (CHashWriter(SER_GETHASH, 0) << nodeid << combinedhash).GetHash();\n+    }\n+    /** List of all ancestor package info we're currently requesting txdata for, indexed by the\n+     * nodeid and getpkgtxns request we would have sent them. */\n+    std::map<PackageTxnsRequestId, PackageToDownload> pending_package_info GUARDED_BY(m_mutex);\n+\n+    using PendingMap = decltype(pending_package_info);\n+    struct IteratorComparator {\n+        template<typename I>\n+        bool operator()(const I& a, const I& b) const { return &(*a) < &(*b); }\n+    };\n+\n+    struct PeerInfo {\n+        /** Whether this is an inbound peer. Affects how much of the orphanage we may protect for\n+         * this peer. */\n+        bool m_is_inbound;\n+        // What package versions we agreed to relay.\n+        PackageRelayVersions m_versions_supported;\n+        /** Amount of orphans protected for this peer, in bytes. */\n+        size_t m_protected_orphans_size{0};\n+        /** Maximum amount of orphans that can be protected for this peer, in bytes. */\n+        size_t m_max_orphans_to_protect{0};\n+        /** Wtxids and sizes of the orphans in the orphanage who are protected for this peer. */\n+        std::map<uint256, size_t> m_protected_orphan_map;\n+\n+        /** Iterators to items in pending_package_info originating from this peer. */\n+        std::set<PendingMap::iterator, IteratorComparator> m_package_info_provided;\n+\n+        PeerInfo(bool is_inbound, PackageRelayVersions versions) :\n+            m_is_inbound{is_inbound},\n+            m_versions_supported{versions},\n+            m_max_orphans_to_protect{is_inbound ? MAX_ORPHANAGE_PROTECTION_INBOUND : MAX_ORPHANAGE_PROTECTION_OUTBOUND}\n+        {}\n+        bool SupportsVersion(PackageRelayVersions version) { return m_versions_supported & version; }\n+        size_t AvailableProtectionTokens() {\n+            if (m_max_orphans_to_protect < m_protected_orphans_size) {\n+                Assume(false);\n+                return 0;\n+            }\n+            return m_max_orphans_to_protect - m_protected_orphans_size;\n+        }\n+    };\n+\n+    /** Stores relevant information about the peer prior to verack. Upon completion of version\n+     * handshake, we use this information to decide whether we relay packages with this peer. */\n+    std::map<NodeId, RegistrationState> registration_states GUARDED_BY(m_mutex);\n+\n+    /** Information for each peer we relay packages with. Membership in this map is equivalent to\n+     * whether or not we relay packages with a peer. */\n+    std::map<NodeId, PeerInfo> info_per_peer GUARDED_BY(m_mutex);\n+\n+    /** Tracks orphans for which we need to request ancestor information. All hashes stored are\n+     * wtxids, i.e., the wtxid of the orphan. However, the is_wtxid field is used to indicate\n+     * whether we would request the ancestor information by wtxid (via package relay) or by txid\n+     * (via prevouts of the missing inputs). */\n+    TxRequestTracker orphan_request_tracker GUARDED_BY(m_mutex);\n+\n+    /** Cache of package info requests sent. Used to identify unsolicited package info messages. */\n+    CRollingBloomFilter packageinfo_requested GUARDED_BY(m_mutex){50000, 0.000001};\n+\n+public:\n+    Impl() = default;\n+\n+    // Orphanage Wrapper Functions\n+    bool OrphanageHaveTx(const GenTxid& gtxid) { return m_orphanage.HaveTx(gtxid); }\n+    CTransactionRef GetTxToReconsider(NodeId peer) { return m_orphanage.GetTxToReconsider(peer); }\n+    int EraseOrphanTx(const uint256& txid) { return m_orphanage.EraseTx(txid); }\n+    void DisconnectedPeer(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        if (auto it{registration_states.find(nodeid)}; it != registration_states.end()) {\n+            registration_states.erase(it);\n+        }\n+        if (auto it{info_per_peer.find(nodeid)}; it != info_per_peer.end()) {\n+            std::set<uint256> pending_to_erase;\n+            for (const auto pkginfo_iter : it->second.m_package_info_provided) {\n+                if (pkginfo_iter != pending_package_info.end()) {\n+                    pending_to_erase.insert(GetPackageInfoRequestId(nodeid, pkginfo_iter->second.RepresentativeWtxid(), PKG_RELAY_ANCPKG));\n+                } else {\n+                    Assume(false);\n+                }\n+            }\n+            it->second.m_package_info_provided.clear();\n+            for (const auto& packageid : pending_to_erase) pending_package_info.erase(packageid);\n+            info_per_peer.erase(it);\n+        }\n+        orphan_request_tracker.DisconnectedPeer(nodeid);\n+        m_orphanage.EraseForPeer(nodeid);\n+    }\n+    void BlockConnected(const CBlock& block) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        const auto wtxids_erased{m_orphanage.EraseForBlock(block)};\n+        std::set<uint256> block_wtxids;\n+        std::set<uint256> conflicted_wtxids;\n+        for (const CTransactionRef& ptx : block.vtx) {\n+            block_wtxids.insert(ptx->GetWitnessHash());\n+        }\n+        for (const auto& wtxid : wtxids_erased) {\n+            if (block_wtxids.count(wtxid) == 0) {\n+                conflicted_wtxids.insert(wtxid);\n+            }\n+        }\n+        FinalizeTransactions(block_wtxids, conflicted_wtxids);\n+    }\n+    void LimitOrphans(unsigned int max_orphans) { m_orphanage.LimitOrphans(max_orphans); }\n+    void AddChildrenToWorkSet(const CTransaction& tx) { m_orphanage.AddChildrenToWorkSet(tx); }\n+    bool HaveTxToReconsider(NodeId peer) { return m_orphanage.HaveTxToReconsider(peer); }\n+    size_t OrphanageSize() { return m_orphanage.Size(); }\n+    PackageRelayVersions GetSupportedVersions() const\n+    {\n+        return PKG_RELAY_ANCPKG;\n+    }\n+\n+    void ReceivedVersion(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        if (registration_states.find(nodeid) != registration_states.end()) return;\n+        registration_states.insert(std::make_pair(nodeid, RegistrationState{}));\n+    }\n+    void ReceivedSendpackages(NodeId nodeid, PackageRelayVersions version) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        const auto it = registration_states.find(nodeid);\n+        if (it == registration_states.end()) return;\n+        it->second.m_sendpackages_received = true;\n+        // Ignore versions we don't understand. Relay packages of versions that we both suppport.\n+        it->second.m_versions_in_common = PackageRelayVersions(GetSupportedVersions() & version);\n+    }\n+\n+    bool ReceivedVerack(NodeId nodeid, bool inbound, bool txrelay, bool wtxidrelay) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        const auto& it = registration_states.find(nodeid);\n+        if (it == registration_states.end()) return false;\n+        it->second.m_txrelay = txrelay;\n+        it->second.m_wtxid_relay = wtxidrelay;\n+        const bool final_state = it->second.CanRelayPackages();\n+        if (final_state) {\n+            auto [peerinfo_it, success] = info_per_peer.insert(std::make_pair(nodeid, PeerInfo{inbound, it->second.m_versions_in_common}));\n+            Assume(success);\n+            // Should support at least one version of package relay.\n+            Assume(peerinfo_it->second.SupportsVersion(PKG_RELAY_ANCPKG));\n+        }\n+        registration_states.erase(it);\n+        return final_state;\n+    }\n+\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime)\n+        EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n+        if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n+        CTransactionRef ptx = tx ? tx : m_orphanage.GetTx(wtxid);\n+\n+        // Skip if already requested in the (recent-ish) past.\n+        if (packageinfo_requested.contains(GetPackageInfoRequestId(nodeid, wtxid, PKG_RELAY_ANCPKG))) return;\n+\n+        // Skip if this peer is already using a lot of space in the orphanage.\n+        if (m_orphanage.BytesFromPeer(nodeid) > MAX_ORPHANAGE_USAGE) return;\n+\n+        auto it_peer_info = info_per_peer.find(nodeid);\n+        if (it_peer_info != info_per_peer.end() && it_peer_info->second.SupportsVersion(PKG_RELAY_ANCPKG)) {\n+            // If we cannot protect this transaction, delay the request to use other peers'\n+            // protection tokens.\n+            Assume(it_peer_info->second.m_protected_orphan_map.count(wtxid) == 0);\n+            if (it_peer_info->second.AvailableProtectionTokens() < ptx->GetTotalSize()) {\n+                reqtime += ORPHANAGE_OVERLOAD_DELAY;\n+            }\n+            // Package relay peer: is_wtxid=true because we will be requesting via ancpkginfo.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from package relay peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Wtxid(wtxid), is_preferred, reqtime);\n+        } else {\n+            // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from legacy peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);\n+        }\n+\n+        m_orphanage.AddTx(ptx, nodeid);\n+        // Protection may or may not be possible. If the orphan is unprotected, it's possible it\n+        // will be evicted by the time we try to download ancestors. If we cannot protect now but\n+        // still have it later, we will attempt to protect it again.\n+        MaybeProtectOrphan(nodeid, wtxid);\n+    }\n+    void MaybeProtectOrphan(NodeId nodeid, const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(m_mutex)\n+    {\n+        AssertLockHeld(m_mutex);\n+        auto peer_info_it = info_per_peer.find(nodeid);\n+        // Skip if this isn't a package relay peer.\n+        if (peer_info_it == info_per_peer.end()) return;\n+        const auto orphan_tx = m_orphanage.GetTx(wtxid);\n+        // Skip if the orphanage doesn't have this transaction.\n+        if (!orphan_tx) return;\n+        const auto orphan_size{orphan_tx->GetTotalSize()};\n+        // Skip if this peer is already protecting this orphan.\n+        if (peer_info_it->second.m_protected_orphan_map.count(wtxid) > 0) return;\n+        // Skip if this peer is already protecting too many orphans.\n+        if (peer_info_it->second.AvailableProtectionTokens() < orphan_size) return;\n+\n+        // Protect this orphan.\n+        LogPrint(BCLog::TXPACKAGES, \"\\nProtecting orphan %s for peer=%d\\n\", wtxid.ToString(), nodeid);\n+        m_orphanage.ProtectOrphan(wtxid);\n+        peer_info_it->second.m_protected_orphans_size += orphan_tx->GetTotalSize();\n+        peer_info_it->second.m_protected_orphan_map.emplace(wtxid, orphan_size);\n+    }\n+    void MaybeUnprotectOrphan(NodeId nodeid, const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(m_mutex)\n+    {\n+        AssertLockHeld(m_mutex);\n+        auto peer_info_it = info_per_peer.find(nodeid);\n+        if (peer_info_it == info_per_peer.end()) return;\n+        auto orphan_map_it = peer_info_it->second.m_protected_orphan_map.find(wtxid);\n+        // Skip if this peer isn't protecting this orphan.\n+        if (orphan_map_it == peer_info_it->second.m_protected_orphan_map.end()) return;\n+        const auto orphan_size = orphan_map_it->second;\n+\n+        // Unprotect this orphan.\n+        LogPrint(BCLog::TXPACKAGES, \"\\nUndoing protection for orphan %s for peer=%d\\n\", wtxid.ToString(), nodeid);\n+        m_orphanage.UndoProtectOrphan(wtxid);\n+        Assume(peer_info_it->second.m_protected_orphans_size >= orphan_size);\n+        peer_info_it->second.m_protected_orphans_size -= orphan_size;\n+        peer_info_it->second.m_protected_orphan_map.erase(wtxid);\n+    }\n+    size_t CountInFlight(NodeId nodeid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        auto count{orphan_request_tracker.CountInFlight(nodeid)};\n+        if (auto it{info_per_peer.find(nodeid)}; it != info_per_peer.end()) {\n+            count += it->second.m_package_info_provided.size();\n+        }\n+        return count;\n+    }\n+    size_t Count(NodeId nodeid) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        auto count{orphan_request_tracker.Count(nodeid)};\n+        if (auto it{info_per_peer.find(nodeid)}; it != info_per_peer.end()) {\n+            count += it->second.m_package_info_provided.size();\n+        }\n+        return count;\n+    }\n+\n+    void ExpirePackageToDownload(NodeId nodeid, std::chrono::microseconds current_time)\n+        EXCLUSIVE_LOCKS_REQUIRED(m_mutex)\n+    {\n+        AssertLockHeld(m_mutex);\n+        auto peer_info_it = info_per_peer.find(nodeid);\n+        if (peer_info_it == info_per_peer.end()) return;\n+        std::set<PackageTxnsRequestId> to_expire;\n+        for (const auto& pkginfo_iter : peer_info_it->second.m_package_info_provided) {\n+            const auto& packageinfo = pkginfo_iter->second;\n+            if (packageinfo.m_expiry < current_time) {\n+                LogPrint(BCLog::TXPACKAGES, \"\\nExpiring package info for tx %s from peer=%d\\n\",\n+                         packageinfo.RepresentativeWtxid().ToString(), nodeid);\n+                to_expire.insert(pkginfo_iter->first);\n+            }\n+        }\n+        for (const auto& packageid : to_expire) {\n+            auto pending_iter = pending_package_info.find(packageid);\n+            Assume(pending_iter != pending_package_info.end());\n+            if (pending_iter != pending_package_info.end()) {\n+                for (const auto& [wtxid, missing] : pending_iter->second.m_txdata_status) {\n+                    if (!missing) MaybeUnprotectOrphan(nodeid, wtxid);\n+                }\n+                peer_info_it->second.m_package_info_provided.erase(pending_iter);\n+                pending_package_info.erase(pending_iter);\n+            }\n+        }\n+    }\n+    std::vector<GenTxid> GetOrphanRequests(NodeId nodeid, std::chrono::microseconds current_time)\n+        EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        // Expire packages we were trying to download tx data for\n+        ExpirePackageToDownload(nodeid, current_time);\n+        std::vector<std::pair<NodeId, GenTxid>> expired;\n+        auto tracker_requestable = orphan_request_tracker.GetRequestable(nodeid, current_time, &expired);\n+        for (const auto& entry : expired) {\n+            LogPrint(BCLog::TXPACKAGES, \"\\nTimeout of inflight %s %s from peer=%d\\n\", entry.second.IsWtxid() ? \"ancpkginfo\" : \"orphan parent\",\n+                entry.second.GetHash().ToString(), entry.first);\n+        }\n+        // Get getdata requests we should send\n+        std::vector<GenTxid> results;\n+        for (const auto& gtxid : tracker_requestable) {\n+            if (gtxid.IsWtxid()) {\n+                Assume(info_per_peer.find(nodeid) != info_per_peer.end());\n+                // Add the orphan's wtxid as-is.\n+                LogPrint(BCLog::TXPACKAGES, \"\\nResolving orphan %s, requesting by ancpkginfo from peer=%d\\n\", gtxid.GetHash().ToString(), nodeid);\n+                results.emplace_back(gtxid);\n+                packageinfo_requested.insert(GetPackageInfoRequestId(nodeid, gtxid.GetHash(), PKG_RELAY_ANCPKG));\n+                orphan_request_tracker.RequestedTx(nodeid, gtxid.GetHash(), current_time + ORPHAN_ANCESTOR_GETDATA_INTERVAL);\n+                MaybeProtectOrphan(nodeid, gtxid.GetHash());\n+            } else {\n+                LogPrint(BCLog::TXPACKAGES, \"\\nResolving orphan %s, requesting by txids of parents from peer=%d\\n\", gtxid.GetHash().ToString(), nodeid);\n+                const auto ptx = m_orphanage.GetTx(gtxid.GetHash());\n+                if (!ptx) {\n+                    // We can't request ancpkginfo and we have no way of knowing what the missing\n+                    // parents are (it could also be that the orphan has already been resolved).\n+                    // Give up.\n+                    orphan_request_tracker.ForgetTxHash(gtxid.GetHash());\n+                    LogPrint(BCLog::TXPACKAGES, \"\\nForgetting orphan %s from peer=%d\\n\", gtxid.GetHash().ToString(), nodeid);\n+                    continue;\n+                }\n+                // Add the orphan's parents. Net processing will filter out what we already have.\n+                // Deduplicate parent txids, so that we don't have to loop over\n+                // the same parent txid more than once down below.\n+                std::vector<uint256> unique_parents;\n+                unique_parents.reserve(ptx->vin.size());\n+                for (const auto& txin : ptx->vin) {\n+                    // We start with all parents, and then remove duplicates below.\n+                    unique_parents.push_back(txin.prevout.hash);\n+                }\n+                std::sort(unique_parents.begin(), unique_parents.end());\n+                unique_parents.erase(std::unique(unique_parents.begin(), unique_parents.end()), unique_parents.end());\n+                for (const auto& txid : unique_parents) {\n+                    results.emplace_back(GenTxid::Txid(txid));\n+                }\n+                // Mark the orphan as requested. Limitation: we aren't tracking these txids in\n+                // relation to the orphan's wtxid anywhere. If we get a NOTFOUND for the parent(s),\n+                // we won't automatically know that it corresponds to this orphan (i.e. won't be\n+                // able to call ReceivedResponse()). We will need to wait until it expires before\n+                // requesting from somebody else.\n+                orphan_request_tracker.RequestedTx(nodeid, gtxid.GetHash(), current_time + ORPHAN_ANCESTOR_GETDATA_INTERVAL);\n+            }\n+        }\n+        if (!results.empty()) LogPrint(BCLog::TXPACKAGES, \"\\nRequesting %u items from peer=%d\\n\", results.size(), nodeid);\n+        return results;\n+    }\n+    void FinalizeTransactions(const std::set<uint256>& valid, const std::set<uint256>& invalid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        // Do a linear search of all packages. This operation should not be expensive as we don't\n+        // expect to be relaying more than 1 package per peer. Nonetheless, process sets together\n+        // to be more efficient.\n+        std::set<PackageTxnsRequestId> to_erase;\n+        for (const auto& [packageid, packageinfo] : pending_package_info) {\n+            const auto& rep_wtxid = packageinfo.RepresentativeWtxid();\n+            if (valid.count(rep_wtxid) > 0 || invalid.count(rep_wtxid) > 0) {\n+                // We have already made a final decision on the transaction of interest.\n+                // There is no need to request more information from other peers.\n+                to_erase.insert(packageid);\n+                orphan_request_tracker.ForgetTxHash(rep_wtxid);\n+                MaybeUnprotectOrphan(packageinfo.m_pkginfo_provider, rep_wtxid);\n+            } else if (packageinfo.HasTransactionIn(invalid)) {\n+                // This package info is known to contain an invalid transaction; don't continue\n+                // trying to download or validate it.\n+                to_erase.insert(packageid);\n+                // However, as it's possible for this information to be incorrect (e.g. a peer\n+                // purposefully trying to get us to reject the orphan by providing package info\n+                // containing an invalid transaction), don't prevent further orphan resolution\n+                // attempts with other peers.\n+            } else {\n+                // FIXME: Some packages may need less txdata now.\n+                // It's fine not to do this *for now* since we always request all missing txdata\n+                // from the same peer.\n+            }\n+        }\n+        for (const auto& packageid : to_erase) {\n+            auto pending_iter = pending_package_info.find(packageid);\n+            Assume(pending_iter != pending_package_info.end());\n+            if (pending_iter != pending_package_info.end()) {\n+                auto peer_info_it = info_per_peer.find(pending_iter->second.m_pkginfo_provider);\n+                Assume(peer_info_it != info_per_peer.end());\n+                if (peer_info_it != info_per_peer.end()) {\n+                    for (const auto& [wtxid, missing] : pending_iter->second.m_txdata_status) {\n+                        if (!missing) MaybeUnprotectOrphan(pending_iter->second.m_pkginfo_provider, wtxid);\n+                    }\n+                    peer_info_it->second.m_package_info_provided.erase(pending_iter);\n+                }\n+                pending_package_info.erase(pending_iter);\n+            }\n+        }\n+    }\n+    bool PkgInfoAllowed(NodeId nodeid, const uint256& wtxid, PackageRelayVersions version) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        auto peerinfo_it = info_per_peer.find(nodeid);\n+        if (peerinfo_it == info_per_peer.end()) {\n+            return false;\n+        } else if (!peerinfo_it->second.SupportsVersion(version)) {\n+            return false;\n+        }\n+        auto peer_info = info_per_peer.find(nodeid)->second;\n+        const auto packageid{GetPackageInfoRequestId(nodeid, wtxid, version)};\n+        if (!packageinfo_requested.contains(packageid)) {",
      "path": "src/node/txpackagetracker.cpp",
      "position": 513,
      "original_position": 505,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "maybe too obvious to note, but bloom filters never have false-negatives, which means this wouldn't cause additional disconnects if someone was flooding this shared resource. I had it backwards and thought it would allow a peer to influence who you disconnect from, vs tricking you into thinking you asked for the package info",
      "created_at": "2023-06-14T15:56:38Z",
      "updated_at": "2023-06-14T16:15:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1229850076",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1229850076"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 513,
      "original_line": 513,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235554022",
      "pull_request_review_id": 1488606572,
      "id": 1235554022,
      "node_id": "PRRC_kwDOABII585JpQ7m",
      "diff_hunk": "@@ -3992,6 +4255,78 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (msg_type == NetMsgType::ANCPKGINFO) {\n+        std::vector<uint256> package_wtxids;\n+        vRecv >> package_wtxids;\n+        if (package_wtxids.empty()) return;\n+        if (!peer->m_package_relay) {\n+            LogPrint(BCLog::NET, \"ancpkginfo sent in violation of protocol, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+        if (!m_txpackagetracker->PkgInfoAllowed(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG)) {\n+            LogPrint(BCLog::NET, \"unsolicited ancpkginfo sent, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+\n+        // Note: Multiple ancestor packages can have the same representative (different ancestors for\n+        // honest or malicious reasons). But since we're only using this to resolve orphans, we\n+        // should never be in a situation where we have multiple ancpkginfos out for the same wtxid\n+        const auto& rep_wtxid{package_wtxids.back()};\n+        if (package_wtxids.size() > MAX_PACKAGE_COUNT) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, too many transactions\\n\", rep_wtxid.ToString());\n+            m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+            return;\n+        }\n+        LOCK(::cs_main);\n+        if (m_chainman.ActiveChainstate().IsInitialBlockDownload()) return;\n+        // We have already validated this exact set of transactions recently, so don't do it again.\n+        if (m_recent_rejects_reconsiderable.contains(GetCombinedHash(package_wtxids))) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, this package has already been rejected\\n\",\n+                     rep_wtxid.ToString());\n+            m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+            return;\n+        }\n+        for (const auto& wtxid : package_wtxids) {\n+            // If a transaction is in m_recent_rejects and not m_recent_rejects_reconsiderable, that\n+            // means it will not become valid by adding another transaction.\n+            if (m_recent_rejects.contains(wtxid)) {\n+                LogPrint(BCLog::NET, \"discarding package for tx %s, tx %s has already been rejected and is not eligible for reconsideration\\n\",\n+                         rep_wtxid.ToString(), wtxid.ToString());\n+                m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+                return;\n+            }\n+        }\n+        std::vector<std::pair<uint256, bool>> txdata_status;\n+        txdata_status.reserve(package_wtxids.size());\n+        std::vector<uint256> pkgtxns_to_request;",
      "path": "src/net_processing.cpp",
      "position": 649,
      "original_position": 637,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "this is never read from, just written to",
      "created_at": "2023-06-20T17:00:42Z",
      "updated_at": "2023-06-20T17:00:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1235554022",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235554022"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4424,
      "original_line": 4424,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235557779",
      "pull_request_review_id": 1488612374,
      "id": 1235557779,
      "node_id": "PRRC_kwDOABII585JpR2T",
      "diff_hunk": "@@ -3992,6 +4255,78 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    if (msg_type == NetMsgType::ANCPKGINFO) {\n+        std::vector<uint256> package_wtxids;\n+        vRecv >> package_wtxids;\n+        if (package_wtxids.empty()) return;\n+        if (!peer->m_package_relay) {\n+            LogPrint(BCLog::NET, \"ancpkginfo sent in violation of protocol, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+        if (!m_txpackagetracker->PkgInfoAllowed(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG)) {\n+            LogPrint(BCLog::NET, \"unsolicited ancpkginfo sent, disconnecting peer=%d\\n\", pfrom.GetId());\n+            pfrom.fDisconnect = true;\n+            return;\n+        }\n+\n+        // Note: Multiple ancestor packages can have the same representative (different ancestors for\n+        // honest or malicious reasons). But since we're only using this to resolve orphans, we\n+        // should never be in a situation where we have multiple ancpkginfos out for the same wtxid\n+        const auto& rep_wtxid{package_wtxids.back()};\n+        if (package_wtxids.size() > MAX_PACKAGE_COUNT) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, too many transactions\\n\", rep_wtxid.ToString());\n+            m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+            return;\n+        }\n+        LOCK(::cs_main);\n+        if (m_chainman.ActiveChainstate().IsInitialBlockDownload()) return;\n+        // We have already validated this exact set of transactions recently, so don't do it again.\n+        if (m_recent_rejects_reconsiderable.contains(GetCombinedHash(package_wtxids))) {\n+            LogPrint(BCLog::NET, \"discarding package info for tx %s, this package has already been rejected\\n\",\n+                     rep_wtxid.ToString());\n+            m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+            return;\n+        }\n+        for (const auto& wtxid : package_wtxids) {\n+            // If a transaction is in m_recent_rejects and not m_recent_rejects_reconsiderable, that\n+            // means it will not become valid by adding another transaction.\n+            if (m_recent_rejects.contains(wtxid)) {\n+                LogPrint(BCLog::NET, \"discarding package for tx %s, tx %s has already been rejected and is not eligible for reconsideration\\n\",\n+                         rep_wtxid.ToString(), wtxid.ToString());\n+                m_txpackagetracker->ForgetPkgInfo(pfrom.GetId(), package_wtxids.back(), node::PKG_RELAY_ANCPKG);\n+                return;\n+            }\n+        }\n+        std::vector<std::pair<uint256, bool>> txdata_status;\n+        txdata_status.reserve(package_wtxids.size());\n+        std::vector<uint256> pkgtxns_to_request;\n+        for (const auto& wtxid : package_wtxids) {\n+            AddKnownTx(*peer, wtxid);\n+            if (AlreadyHaveTx(GenTxid::Wtxid(wtxid), /*include_orphanage=*/false)) {",
      "path": "src/net_processing.cpp",
      "position": 652,
      "original_position": 640,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "what's the important of not checking orphanage here, then checking the orphanage inside `ReceivedAncPkgInfo`?",
      "created_at": "2023-06-20T17:04:22Z",
      "updated_at": "2023-06-20T17:04:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1235557779",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235557779"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4427,
      "original_line": 4427,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235698156",
      "pull_request_review_id": 1488822617,
      "id": 1235698156,
      "node_id": "PRRC_kwDOABII585Jp0Hs",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing\n+     * parents were requested), package info requests, tx data download, and packages in the\n+     * validation queue. */\n+    size_t Count(NodeId nodeid) const;\n+\n+    /** Number of packages we are currently working on with this peer (i.e. reserving memory for\n+     * storing orphan(s)). Includes in-flight package info requests, tx data download, and packages\n+     * in the validation queue. Excludes entries in the orphan tracker that are just candidates. */\n+    size_t CountInFlight(NodeId nodeid) const;\n+\n+    /** Get list of requests that should be sent to resolve orphans. These may be wtxids to send\n+     * getdata(ANCPKGINFO) or txids corresponding to parents. Automatically marks the orphans as\n+     * having outgoing requests. */\n+    std::vector<GenTxid> GetOrphanRequests(NodeId nodeid, std::chrono::microseconds current_time);\n+\n+    /** Update transactions for which we have made \"final\" decisions: transactions that have\n+     * confirmed in a block, conflicted due to a block, or added to the mempool already.\n+     * Should be called on new block: valid=block transactions, invalid=conflicts.\n+     * Should be called when tx is added to mempool.\n+     * Should not be called when a tx fails validation.\n+     * */\n+    void FinalizeTransactions(const std::set<uint256>& valid, const std::set<uint256>& invalid);",
      "path": "src/node/txpackagetracker.h",
      "position": 107,
      "original_position": 41,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": 1214728153,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Note that the rejection filters are cleared every time the chain tip changes, so I don't think we can get failures this way",
      "created_at": "2023-06-20T18:53:11Z",
      "updated_at": "2023-06-20T18:53:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1235698156",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235698156"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 107,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235700988",
      "pull_request_review_id": 1488828002,
      "id": 1235700988,
      "node_id": "PRRC_kwDOABII585Jp0z8",
      "diff_hunk": "@@ -3319,6 +3336,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (greatest_common_version >= WTXID_RELAY_VERSION) {\n             m_connman.PushMessage(&pfrom, msg_maker.Make(NetMsgType::WTXIDRELAY));\n+            if (m_enable_package_relay) {",
      "path": "src/net_processing.cpp",
      "position": 542,
      "original_position": 103,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "daa3802272fe4bb59eaba19b02ca2bb0288f8526",
      "in_reply_to_id": 1223451646,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think it's weird to set `-blocksonly=1 -packagerelay=1`, but also not the end of the world. In that case we'd want to not send \"sendpackages.\" Does that answer the question?",
      "created_at": "2023-06-20T18:55:37Z",
      "updated_at": "2023-06-20T18:55:37Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1235700988",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235700988"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3621,
      "original_line": 3621,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235703425",
      "pull_request_review_id": 1488830711,
      "id": 1235703425,
      "node_id": "PRRC_kwDOABII585Jp1aB",
      "diff_hunk": "@@ -223,6 +226,6 @@ std::vector<std::string> serviceFlagsToStr(uint64_t flags)\n \n GenTxid ToGenTxid(const CInv& inv)\n {\n-    assert(inv.IsGenTxMsg());\n+    assert(inv.IsGenTxMsg() || inv.IsMsgAncPkgInfo());\n     return inv.IsMsgWtx() ? GenTxid::Wtxid(inv.hash) : GenTxid::Txid(inv.hash);",
      "path": "src/protocol.cpp",
      "position": null,
      "original_position": 30,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "a988ba3fddfea58908b3dc7d68a70811022ff97f",
      "in_reply_to_id": 1224428421,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ooh good catch!",
      "created_at": "2023-06-20T18:57:28Z",
      "updated_at": "2023-06-20T18:57:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1235703425",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235703425"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 230,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235706750",
      "pull_request_review_id": 1488834909,
      "id": 1235706750,
      "node_id": "PRRC_kwDOABII585Jp2N-",
      "diff_hunk": "@@ -817,6 +847,33 @@ class PeerManagerImpl final : public PeerManager\n      * Memory used: 1.3 MB\n      */\n     CRollingBloomFilter m_recent_rejects GUARDED_BY(::cs_main){120'000, 0.000'001};\n+    /**\n+     * Filter for transactions or packages of transactions that were recently rejected by\n+     * the mempool but are eligible for reconsideration if submitted with other transactions.\n+     * This filter only contains wtxids of individual transactions and combined hashes of packages\n+     * (see GetCombinedHash and GetPackageHash).\n+     *\n+     * When a transaction's error is TX_LOW_FEE (in a package or by itself), add its wtxid to this\n+     * filter. If it was in a package, also add the combined hash of the transactions in its\n+     * subpackage to this filter. When a package fails for any reason, add the combined hash of all\n+     * transactions in the package info to this filter.\n+     *\n+     * Upon receiving an announcement for a transaction, if it exists in this filter, do not\n+     * download the txdata. Upon receiving a package info, if the combined hash of its transactions\n+     * are in this filter, do not download the txdata.\n+     *\n+     * Reset this filter when the chain tip changes.\n+     *\n+     * We will only add wtxids to this filter. Groups of multiple transactions are represented by\n+     * the hash of their wtxids, concatenated together in lexicographical order.\n+     *\n+     * Parameters are picked to be identical to that of m_recent_rejects, with the same rationale.\n+     * Memory used: 1.3 MB\n+     * FIXME: this filter can probably be smaller, but how much smaller?\n+     */\n+    CRollingBloomFilter m_recent_rejects_reconsiderable GUARDED_BY(::cs_main){120'000, 0.000'001};",
      "path": "src/net_processing.cpp",
      "position": 143,
      "original_position": 143,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": 1229835172,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Good catch 👍 ",
      "created_at": "2023-06-20T19:00:30Z",
      "updated_at": "2023-06-20T19:00:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1235706750",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1235706750"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 871,
      "original_line": 871,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237960671",
      "pull_request_review_id": 1492306150,
      "id": 1237960671,
      "node_id": "PRRC_kwDOABII585Jycff",
      "diff_hunk": "@@ -492,6 +493,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-i2psam=<ip:port>\", \"I2P SAM proxy to reach I2P peers and accept I2P connections (default: none)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-i2pacceptincoming\", strprintf(\"Whether to accept inbound I2P connections (default: %i). Ignored if -i2psam is not set. Listening for inbound I2P connections is done through the SAM proxy, not by binding to a local address and port.\", DEFAULT_I2P_ACCEPT_INCOMING), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-onlynet=<net>\", \"Make automatic outbound connections only to network <net> (\" + Join(GetNetworkNames(), \", \") + \"). Inbound and manual connections are not affected by this option. It can be specified multiple times to allow multiple networks.\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-packagerelay\", strprintf(\"[EXPERIMENTAL] Support relaying transaction packages (default: %u)\", node::DEFAULT_ENABLE_PACKAGE_RELAY), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "path": "src/init.cpp",
      "position": 12,
      "original_position": 12,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think the comment can indicate the type of p2p packages (ancestor package relay v1 BIP 331), and indicate this is enabling package relay at the p2p level only to dissociate from mempool-level policy like nVersion=3 (e.g any descendant of a an unconfirmed V3 transaction must also be V3 or any descendant of an unconfirmed V3 transaction must also be V3).\r\n\r\nIn the future, we might release multiple versions of packages *both* at the p2p level and policy rules at the mempool-level (e.g nversion=4 to accomodate the flow of more L2s or annex DoS limits).",
      "created_at": "2023-06-22T03:52:52Z",
      "updated_at": "2023-06-22T05:27:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1237960671",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237960671"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 500,
      "original_line": 500,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237982821",
      "pull_request_review_id": 1492306150,
      "id": 1237982821,
      "node_id": "PRRC_kwDOABII585Jyh5l",
      "diff_hunk": "@@ -134,7 +134,11 @@ class TxPackageTracker::Impl {\n             for (const auto& txid : unique_parents) {\n                 results.emplace_back(GenTxid::Txid(txid));\n             }\n-            // Mark the orphan as requested\n+            // Mark the orphan as requested. Limitation: we aren't tracking these txids in\n+            // relation to the orphan's wtxid anywhere. If we get a NOTFOUND for the parent(s),\n+            // we won't automatically know that it corresponds to this orphan (i.e. won't be\n+            // able to call ReceivedResponse()). We will need to wait until it expires before",
      "path": "src/node/txpackagetracker.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "26928b9c76ec65e8f8609dfe07eab4bcb8a455ea",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "If the waiting time is dependent on timers (e.g `TXID_RELAY_DELAY` or `NONPREF_PEER_TX_DELAY`) or iterating over the inbound/outbound slots (i.e our `CNode`), I think we should document what is this waiting to be able to estimate if we modify max network throughput. Note there is an opened PR modifying tx relay rate, i.e #27630.",
      "created_at": "2023-06-22T04:40:06Z",
      "updated_at": "2023-06-22T05:27:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1237982821",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1237982821"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 140,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238002292",
      "pull_request_review_id": 1492306150,
      "id": 1238002292,
      "node_id": "PRRC_kwDOABII585Jymp0",
      "diff_hunk": "@@ -50,7 +50,12 @@ class TxOrphanage {\n     /** Erase all orphans included in or invalidated by a new block. Returns wtxids of erased txns. */\n     std::vector<uint256> EraseForBlock(const CBlock& block) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Limit the orphanage to the given maximum */\n+    /** Limit the orphanage to the given maximum. Delete orphans whose expiry has been reached.",
      "path": "src/txorphanage.h",
      "position": 52,
      "original_position": 5,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think the expiry orphans could be announced at the protocol-level, as part of the “package-link”, i.e somewhere in `sendpackages` or in `ancpkinfo`. Those limits could be announced from the peer’s `PeerManagerImpl` with a push-interface (e.g the `ZMQNotificationInterface` ), that way a Lightning node could adapt its package broadcasting strategy accordingly.",
      "created_at": "2023-06-22T05:15:59Z",
      "updated_at": "2023-06-22T05:27:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238002292",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238002292"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 53,
      "original_line": 53,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238008859",
      "pull_request_review_id": 1492306150,
      "id": 1238008859,
      "node_id": "PRRC_kwDOABII585JyoQb",
      "diff_hunk": "@@ -65,6 +70,16 @@ class TxOrphanage {\n         LOCK(m_mutex);\n         return m_orphans.size();\n     }\n+    /** Protect an orphan from eviction from the orphanage getting full. The orphan may still be\n+     * removed due to expiry. If the orphan is already protected (by any peer), nothing happens.\n+     */\n+    void ProtectOrphan(const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 68,
      "original_position": 21,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Should we implement blessing of all the orphans of a peer with “relay” permissions ? I can definitely see Lightning deployment where you have an inner Bitcoin Core node and multiple external ones, where you load-balance your flows to avoid transaction-relay fingerprinting based on obvious patterns like HTLC-preimage linked to off-chain channel XYZ. ",
      "created_at": "2023-06-22T05:26:51Z",
      "updated_at": "2023-06-22T05:27:10Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238008859",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238008859"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 76,
      "original_line": 76,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238020235",
      "pull_request_review_id": 1492395170,
      "id": 1238020235,
      "node_id": "PRRC_kwDOABII585JyrCL",
      "diff_hunk": "@@ -72,6 +72,13 @@ class TxOrphanage {\n         LOCK(m_mutex);\n         return m_total_orphan_bytes;\n     }\n+    size_t BytesFromPeer(NodeId peer) const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)",
      "path": "src/txorphanage.h",
      "position": 83,
      "original_position": 4,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "986f7622dabd422d6dc21bfc3319a0d04d4c4ecc",
      "in_reply_to_id": 1214696267,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Just to be sure we’re in sync on `BytesFromPeer` and `MAX_ORPHANAGE_USAGE`, it’s correct this a per-peer limit on the space in vbytes occupied by received orphans ?\r\n\r\nIf yes, I think this still introduce an interdependency between the number of outgoing transactions bytes and the maximum flow of LN commitment transactions and this limit should be documented (a la `doc/policy/`), or even better announced as part of `sendpackages` info.",
      "created_at": "2023-06-22T05:43:23Z",
      "updated_at": "2023-06-22T05:43:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238020235",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238020235"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 91,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238025437",
      "pull_request_review_id": 1492402854,
      "id": 1238025437,
      "node_id": "PRRC_kwDOABII585JysTd",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing",
      "path": "src/node/txpackagetracker.h",
      "position": 86,
      "original_position": 20,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": 1214720397,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> So from a time-sensitive contract perspective, things should be strictly better than today?\r\n\r\nI think this is a different concern I’m aiming to underscore. It’s not related about “buckets”-capture by the attackers, rather than if you have a package of {A, B, C, D} with E as a CPFP and we have rate-limiting based on the way the parents are fetched (i.e individiually rather than in batch) the equivalent package of A+E will propagate better.\r\n\r\nSo if you would like A to confirm as soon as you can because it’s a 0-conf dual-funding, you wanna probably go for A+E. ",
      "created_at": "2023-06-22T05:51:42Z",
      "updated_at": "2023-06-22T05:51:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238025437",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238025437"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 86,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238028747",
      "pull_request_review_id": 1492407945,
      "id": 1238028747,
      "node_id": "PRRC_kwDOABII585JytHL",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing\n+     * parents were requested), package info requests, tx data download, and packages in the\n+     * validation queue. */\n+    size_t Count(NodeId nodeid) const;\n+\n+    /** Number of packages we are currently working on with this peer (i.e. reserving memory for\n+     * storing orphan(s)). Includes in-flight package info requests, tx data download, and packages\n+     * in the validation queue. Excludes entries in the orphan tracker that are just candidates. */\n+    size_t CountInFlight(NodeId nodeid) const;\n+\n+    /** Get list of requests that should be sent to resolve orphans. These may be wtxids to send\n+     * getdata(ANCPKGINFO) or txids corresponding to parents. Automatically marks the orphans as\n+     * having outgoing requests. */\n+    std::vector<GenTxid> GetOrphanRequests(NodeId nodeid, std::chrono::microseconds current_time);\n+\n+    /** Update transactions for which we have made \"final\" decisions: transactions that have\n+     * confirmed in a block, conflicted due to a block, or added to the mempool already.\n+     * Should be called on new block: valid=block transactions, invalid=conflicts.\n+     * Should be called when tx is added to mempool.\n+     * Should not be called when a tx fails validation.\n+     * */\n+    void FinalizeTransactions(const std::set<uint256>& valid, const std::set<uint256>& invalid);",
      "path": "src/node/txpackagetracker.h",
      "position": 107,
      "original_position": 41,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": 1214728153,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Note that the rejection filters are cleared every time the chain tip changes, so I don't think we can get failures this way\r\n\r\nYes, I think we should be careful to clean the whole package state in all filters at every block change to avoid “half” state interfering. `m_recent_rejects_reconsiderable_were_rejected` say “reset this filter when the chain tip changes”, of course it includes _backward_ change like re-orgs. ",
      "created_at": "2023-06-22T05:56:46Z",
      "updated_at": "2023-06-22T05:56:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238028747",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238028747"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 107,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238034201",
      "pull_request_review_id": 1492416463,
      "id": 1238034201,
      "node_id": "PRRC_kwDOABII585JyucZ",
      "diff_hunk": "@@ -43,7 +43,8 @@ class TxOrphanage {\n     /** Erase an orphan by wtxid */\n     int EraseTx(const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase all orphans announced by a peer (eg, after that peer disconnects) */\n+    /** Maybe erase all orphans announced by a peer (eg, after that peer disconnects). If an orphan",
      "path": "src/txorphanage.h",
      "position": 42,
      "original_position": 14,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": 1214732393,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Can you elaborate on this concern? The orphan that isn't received yet may still be in orphanage, and will be connected to its parents normally\r\n\r\nSo if you have 3 peers and they announce A, B, C all with different wtxids while they’re spending the same parent txid, do we have a concern of the parent being fetched from multiple peers, or download should be dedup when we receive the `ancpkginfo`s ?",
      "created_at": "2023-06-22T06:04:46Z",
      "updated_at": "2023-06-22T06:04:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238034201",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238034201"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 46,
      "original_line": 46,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238812791",
      "pull_request_review_id": 1493665162,
      "id": 1238812791,
      "node_id": "PRRC_kwDOABII585J1sh3",
      "diff_hunk": "@@ -6,13 +6,17 @@\n #define BITCOIN_TXORPHANAGE_H\n \n #include <net.h>\n+#include <policy/policy.h>\n #include <primitives/block.h>\n #include <primitives/transaction.h>\n #include <sync.h>\n \n #include <map>\n #include <set>\n \n+/** Maximum total size of orphan transactions stored, in bytes. */\n+static constexpr size_t MAX_ORPHAN_TOTAL_SIZE{100 * MAX_STANDARD_TX_WEIGHT};",
      "path": "src/txorphanage.h",
      "position": 13,
      "original_position": 13,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d178c0fb372fc50857438b1b82d344fed0634a10",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "commit d178c0fb372fc50857438b1b82d344fed0634a10, [txorphanage] impose a maximum total size of orphans]:\r\n\r\ncould this be `maxorphantx * MAX_STANDARD_TX_WEIGHT`, considering that the maximum number of orphans can be changed by the user? Seems a bit weird to just allow the user to change one of the two.",
      "created_at": "2023-06-22T17:08:05Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238812791",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238812791"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 18,
      "original_line": 18,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238826846",
      "pull_request_review_id": 1493665162,
      "id": 1238826846,
      "node_id": "PRRC_kwDOABII585J1v9e",
      "diff_hunk": "@@ -61,7 +65,16 @@ class TxOrphanage {\n         return m_orphans.size();\n     }\n \n+    /** Return total memory usage of the transactions stored. Does not include overhead of\n+     * m_orphans, m_peer_work_set, etc. */\n+    size_t TotalOrphanBytes() const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_total_orphan_bytes;\n+    }\n protected:\n+    size_t m_total_orphan_bytes{0};",
      "path": "src/txorphanage.h",
      "position": 95,
      "original_position": 30,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d178c0fb372fc50857438b1b82d344fed0634a10",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "commit d178c0fb372fc50857438b1b82d344fed0634a10, [txorphanage] impose a maximum total size of orphans]:\r\n\r\n`size_t` doesn't really make sense for a byte counter imo (there is no corresponding container like there is for the number of orphans).",
      "created_at": "2023-06-22T17:22:22Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238826846",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238826846"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 103,
      "original_line": 103,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238893041",
      "pull_request_review_id": 1493665162,
      "id": 1238893041,
      "node_id": "PRRC_kwDOABII585J2AHx",
      "diff_hunk": "@@ -106,16 +114,21 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n     m_peer_work_set.erase(peer);\n \n     int nErased = 0;\n+    size_t bytes_counted{m_peer_bytes_used.count(peer) ? m_peer_bytes_used.find(peer)->second : 0};\n     std::map<uint256, OrphanTx>::iterator iter = m_orphans.begin();\n     while (iter != m_orphans.end())\n     {\n         std::map<uint256, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n         if (maybeErase->second.fromPeer == peer)\n         {\n+            bytes_counted -= maybeErase->second.tx->GetTotalSize();\n             nErased += _EraseTx(maybeErase->second.tx->GetWitnessHash());\n         }\n     }\n     if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx from peer=%d\\n\", nErased, peer);\n+    // Either the peer didn't have any orphans, or the amount erased is equal to what the map was storing.\n+    Assume(bytes_counted == 0);\n+    m_peer_bytes_used.erase(peer);",
      "path": "src/txorphanage.cpp",
      "position": 173,
      "original_position": 40,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "986f7622dabd422d6dc21bfc3319a0d04d4c4ecc",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "commit 986f7622dabd422d6dc21bfc3319a0d04d4c4ecc, [txorphanage] track bytes provided per peer: \r\ncan we do without  this line and without `bytes_counted` and instead `Assume` that `m_peer_bytes_used` has no entry for the peer (because `_EraseTx` should have removed all entries for this peer and then also cleared its entry in `m_peer_bytes_used`).",
      "created_at": "2023-06-22T18:29:31Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238893041",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238893041"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 168,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238913973",
      "pull_request_review_id": 1493665162,
      "id": 1238913973,
      "node_id": "PRRC_kwDOABII585J2FO1",
      "diff_hunk": "@@ -4078,38 +4095,20 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         else if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS)\n         {\n             bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n-            // Deduplicate parent txids, so that we don't have to loop over\n-            // the same parent txid more than once down below.\n-            std::vector<uint256> unique_parents;\n-            unique_parents.reserve(tx.vin.size());\n-            for (const CTxIn& txin : tx.vin) {\n-                // We start with all parents, and then remove duplicates below.\n-                unique_parents.push_back(txin.prevout.hash);\n-            }\n-            std::sort(unique_parents.begin(), unique_parents.end());\n-            unique_parents.erase(std::unique(unique_parents.begin(), unique_parents.end()), unique_parents.end());\n-            for (const uint256& parent_txid : unique_parents) {\n+            for (const auto& input : tx.vin) {\n+                const auto& parent_txid = input.prevout.hash;\n+                AddKnownTx(*peer, parent_txid);",
      "path": "src/net_processing.cpp",
      "position": 717,
      "original_position": 83,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "498e343a4d767d5c62976d7f48dbac7b82d86157",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "commit 498e343a4d767d5c62976d7f48dbac7b82d86157, [refactor] use txpackagetracker for orphan resolution :\r\n\r\ncalling `AddKnownTx()` now even if `fRejectedParents` is `true` seems like a behavior change.",
      "created_at": "2023-06-22T18:51:35Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238913973",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238913973"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4551,
      "original_line": 4551,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238924470",
      "pull_request_review_id": 1493665162,
      "id": 1238924470,
      "node_id": "PRRC_kwDOABII585J2Hy2",
      "diff_hunk": "@@ -4078,38 +4095,20 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         else if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS)\n         {\n             bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n-            // Deduplicate parent txids, so that we don't have to loop over\n-            // the same parent txid more than once down below.\n-            std::vector<uint256> unique_parents;\n-            unique_parents.reserve(tx.vin.size());\n-            for (const CTxIn& txin : tx.vin) {\n-                // We start with all parents, and then remove duplicates below.\n-                unique_parents.push_back(txin.prevout.hash);\n-            }\n-            std::sort(unique_parents.begin(), unique_parents.end());\n-            unique_parents.erase(std::unique(unique_parents.begin(), unique_parents.end()), unique_parents.end());\n-            for (const uint256& parent_txid : unique_parents) {\n+            for (const auto& input : tx.vin) {\n+                const auto& parent_txid = input.prevout.hash;\n+                AddKnownTx(*peer, parent_txid);\n                 if (m_recent_rejects.contains(parent_txid)) {\n                     fRejectedParents = true;\n                     break;\n                 }\n             }\n             if (!fRejectedParents) {\n+                const bool had_before{m_txpackagetracker->OrphanageHaveTx(GenTxid::Wtxid(ptx->GetWitnessHash()))};\n                 const auto current_time{GetTime<std::chrono::microseconds>()};\n+                AddOrphanResolutionCandidate(pfrom.GetId(), ptx->GetWitnessHash(), ptx, current_time);\n \n-                for (const uint256& parent_txid : unique_parents) {\n-                    // Here, we only have the txid (and not wtxid) of the\n-                    // inputs, so we only request in txid mode, even for\n-                    // wtxidrelay peers.\n-                    // Eventually we should replace this with an improved\n-                    // protocol for getting all unconfirmed parents.\n-                    const auto gtxid{GenTxid::Txid(parent_txid)};\n-                    AddKnownTx(*peer, parent_txid);\n-                    if (!AlreadyHaveTx(gtxid)) AddTxAnnouncement(pfrom, gtxid, current_time);\n-                }\n-\n-                if (m_txpackagetracker->OrphanageAddTx(ptx, pfrom.GetId())) {\n+                if (!had_before && m_txpackagetracker->OrphanageHaveTx(GenTxid::Wtxid(ptx->GetWitnessHash()))) {",
      "path": "src/net_processing.cpp",
      "position": 740,
      "original_position": 106,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "498e343a4d767d5c62976d7f48dbac7b82d86157",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "commit 498e343a4d767d5c62976d7f48dbac7b82d86157, [refactor] use txpackagetracker for orphan resolution :\r\n\r\nthis looks unintended, with the definition of `had_before` it's `if (!x && x)`, so never true.",
      "created_at": "2023-06-22T19:03:39Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238924470",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238924470"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4560,
      "original_line": 4560,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238937107",
      "pull_request_review_id": 1493665162,
      "id": 1238937107,
      "node_id": "PRRC_kwDOABII585J2K4T",
      "diff_hunk": "@@ -5860,6 +5859,18 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             }\n         }\n \n+        auto requestable_orphans = m_txpackagetracker->GetOrphanRequests(pto->GetId(), current_time);",
      "path": "src/net_processing.cpp",
      "position": 896,
      "original_position": 114,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "bb5e0b21520e6deebcfe9576ae17f4db15c31421",
      "in_reply_to_id": 1210769183,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "My understanding is that instead of adding all parents of an orphan to the main txrequest tracker (`AddTxAnnouncement`), we now just add the orphan to the orphanage tracker. We then need to request its parents somewhere to preserve behavior, which is done here.\r\nBut I also found this commit hard to understand, would be good to expand the commit msg.",
      "created_at": "2023-06-22T19:18:52Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1238937107",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1238937107"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 6347,
      "original_line": 6347,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239016063",
      "pull_request_review_id": 1493665162,
      "id": 1239016063,
      "node_id": "PRRC_kwDOABII585J2eJ_",
      "diff_hunk": "@@ -5834,7 +5871,7 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n         }\n \n         //\n-        // Message: getdata (transactions)\n+        // Message: getdata (transactions and ancpkginfo)",
      "path": "src/net_processing.cpp",
      "position": 888,
      "original_position": 96,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "0671e1c178270350aadeba625da8b95d6ef2ff00",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "commit 0671e1c178270350aadeba625da8b95d6ef2ff00, [p2p] use all orphan announcers as potential parent sources\r\n\r\nthis line doesn't seem to belong here, ancpkginfo hasn't been introduced yet.",
      "created_at": "2023-06-22T20:47:19Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1239016063",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239016063"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 6322,
      "original_line": 6322,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239030012",
      "pull_request_review_id": 1493665162,
      "id": 1239030012,
      "node_id": "PRRC_kwDOABII585J2hj8",
      "diff_hunk": "@@ -79,6 +80,10 @@ class TxOrphanage {\n         return peer_bytes_it == m_peer_bytes_used.end() ? 0 : peer_bytes_it->second;\n     }\n \n+    /** Remove a peer from an orphan's announcers list, erasing the orphan if this is the only peer\n+     * who announced it. If the orphan doesn't exist or does not list this peer as an announcer, do nothing. */\n+    void EraseOrphanOfPeer(const uint256& wtxid, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 92,
      "original_position": 25,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "commit fecb522a3fa83e7b485f5d17f070ed56d47e3d90, [txorphanage] support multiple announcers\r\n\r\n`EraseOrphanOfPeer` is introduced but never used anywhere.",
      "created_at": "2023-06-22T21:04:37Z",
      "updated_at": "2023-06-22T22:58:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1239030012",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1239030012"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 100,
      "original_line": 100,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243535255",
      "pull_request_review_id": 1500536836,
      "id": 1243535255,
      "node_id": "PRRC_kwDOABII585KHteX",
      "diff_hunk": "@@ -492,6 +493,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-i2psam=<ip:port>\", \"I2P SAM proxy to reach I2P peers and accept I2P connections (default: none)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-i2pacceptincoming\", strprintf(\"Whether to accept inbound I2P connections (default: %i). Ignored if -i2psam is not set. Listening for inbound I2P connections is done through the SAM proxy, not by binding to a local address and port.\", DEFAULT_I2P_ACCEPT_INCOMING), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-onlynet=<net>\", \"Make automatic outbound connections only to network <net> (\" + Join(GetNetworkNames(), \", \") + \"). Inbound and manual connections are not affected by this option. It can be specified multiple times to allow multiple networks.\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-packagerelay\", strprintf(\"[EXPERIMENTAL] Support relaying transaction packages (default: %u)\", node::DEFAULT_ENABLE_PACKAGE_RELAY), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "path": "src/init.cpp",
      "position": 12,
      "original_position": 12,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": 1237960671,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think mentioning specific policy here would make things more confusing tbh. I can add a mention to BIP331?",
      "created_at": "2023-06-27T10:45:09Z",
      "updated_at": "2023-06-27T10:45:09Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1243535255",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1243535255"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 500,
      "original_line": 500,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1252120078",
      "pull_request_review_id": 1513038782,
      "id": 1252120078,
      "node_id": "PRRC_kwDOABII585KodYO",
      "diff_hunk": "@@ -43,7 +43,8 @@ class TxOrphanage {\n     /** Erase an orphan by wtxid */\n     int EraseTx(const uint256& wtxid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);\n \n-    /** Erase all orphans announced by a peer (eg, after that peer disconnects) */\n+    /** Maybe erase all orphans announced by a peer (eg, after that peer disconnects). If an orphan",
      "path": "src/txorphanage.h",
      "position": 42,
      "original_position": 14,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": 1214732393,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> download should be dedup when we receive the ancpkginfos ?\r\n\r\nIf it's in your orphanage it won't be fetched again, and will be marked as protected IIUC. See `ReceivedAncPkgInfo`",
      "created_at": "2023-07-04T14:42:27Z",
      "updated_at": "2023-07-04T14:42:46Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1252120078",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1252120078"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 46,
      "original_line": 46,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253060069",
      "pull_request_review_id": 1514439276,
      "id": 1253060069,
      "node_id": "PRRC_kwDOABII585KsC3l",
      "diff_hunk": "@@ -2932,7 +2932,7 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n             LogPrint(BCLog::MEMPOOL, \"   accepted orphan tx %s\\n\", orphanHash.ToString());\n             RelayTransaction(orphanHash, porphanTx->GetWitnessHash());\n             m_txpackagetracker->AddChildrenToWorkSet(*porphanTx);\n-            m_txpackagetracker->EraseOrphanTx(orphanHash);",
      "path": "src/net_processing.cpp",
      "position": null,
      "original_position": 4,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "22e93f08a50a206b54717b07682e73a751cc6755",
      "in_reply_to_id": 1210682865,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done (in other PR)",
      "created_at": "2023-07-05T12:48:51Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253060069",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253060069"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 2935,
      "side": "LEFT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253062718",
      "pull_request_review_id": 1514439276,
      "id": 1253062718,
      "node_id": "PRRC_kwDOABII585KsDg-",
      "diff_hunk": "@@ -61,7 +65,16 @@ class TxOrphanage {\n         return m_orphans.size();\n     }\n \n+    /** Return total memory usage of the transactions stored. Does not include overhead of\n+     * m_orphans, m_peer_work_set, etc. */\n+    size_t TotalOrphanBytes() const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_total_orphan_bytes;\n+    }\n protected:\n+    size_t m_total_orphan_bytes{0};",
      "path": "src/txorphanage.h",
      "position": 95,
      "original_position": 30,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d178c0fb372fc50857438b1b82d344fed0634a10",
      "in_reply_to_id": 1238826846,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "That's true - what type would you suggest?",
      "created_at": "2023-07-05T12:51:12Z",
      "updated_at": "2023-07-05T15:32:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253062718",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253062718"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 103,
      "original_line": 103,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253065030",
      "pull_request_review_id": 1514439276,
      "id": 1253065030,
      "node_id": "PRRC_kwDOABII585KsEFG",
      "diff_hunk": "@@ -106,16 +114,21 @@ void TxOrphanage::EraseForPeer(NodeId peer)\n     m_peer_work_set.erase(peer);\n \n     int nErased = 0;\n+    size_t bytes_counted{m_peer_bytes_used.count(peer) ? m_peer_bytes_used.find(peer)->second : 0};\n     std::map<uint256, OrphanTx>::iterator iter = m_orphans.begin();\n     while (iter != m_orphans.end())\n     {\n         std::map<uint256, OrphanTx>::iterator maybeErase = iter++; // increment to avoid iterator becoming invalid\n         if (maybeErase->second.fromPeer == peer)\n         {\n+            bytes_counted -= maybeErase->second.tx->GetTotalSize();\n             nErased += _EraseTx(maybeErase->second.tx->GetWitnessHash());\n         }\n     }\n     if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx from peer=%d\\n\", nErased, peer);\n+    // Either the peer didn't have any orphans, or the amount erased is equal to what the map was storing.\n+    Assume(bytes_counted == 0);\n+    m_peer_bytes_used.erase(peer);",
      "path": "src/txorphanage.cpp",
      "position": 173,
      "original_position": 40,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "986f7622dabd422d6dc21bfc3319a0d04d4c4ecc",
      "in_reply_to_id": 1238893041,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done (other PR)",
      "created_at": "2023-07-05T12:53:16Z",
      "updated_at": "2023-07-05T15:32:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253065030",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253065030"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 168,
      "original_line": 168,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253066804",
      "pull_request_review_id": 1514439276,
      "id": 1253066804,
      "node_id": "PRRC_kwDOABII585KsEg0",
      "diff_hunk": "@@ -18,14 +39,119 @@ class TxPackageTracker::Impl {\n     bool OrphanageHaveTx(const GenTxid& gtxid) { return m_orphanage.HaveTx(gtxid); }\n     CTransactionRef GetTxToReconsider(NodeId peer) { return m_orphanage.GetTxToReconsider(peer); }\n     int EraseOrphanTx(const uint256& txid) { return m_orphanage.EraseTx(txid); }\n-    void DisconnectedPeer(NodeId peer) {\n-        m_orphanage.EraseForPeer(peer);\n+    void DisconnectedPeer(NodeId nodeid) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        orphan_request_tracker.DisconnectedPeer(nodeid);\n+        m_orphanage.EraseForPeer(nodeid);\n+    }\n+    void BlockConnected(const CBlock& block) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        const auto wtxids_erased{m_orphanage.EraseForBlock(block)};\n+        std::set<uint256> block_wtxids;\n+        std::set<uint256> conflicted_wtxids;\n+        for (const CTransactionRef& ptx : block.vtx) {\n+            block_wtxids.insert(ptx->GetWitnessHash());\n+        }\n+        for (const auto& wtxid : wtxids_erased) {\n+            if (block_wtxids.count(wtxid) == 0) {\n+                conflicted_wtxids.insert(wtxid);\n+            }\n+        }\n+        FinalizeTransactions(block_wtxids, conflicted_wtxids);\n     }\n-    void BlockConnected(const CBlock& block) { m_orphanage.EraseForBlock(block); }\n     void LimitOrphans(unsigned int max_orphans) { m_orphanage.LimitOrphans(max_orphans); }\n     void AddChildrenToWorkSet(const CTransaction& tx) { m_orphanage.AddChildrenToWorkSet(tx); }\n     bool HaveTxToReconsider(NodeId peer) { return m_orphanage.HaveTxToReconsider(peer); }\n     size_t OrphanageSize() { return m_orphanage.Size(); }\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime)\n+        EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n+        if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n+\n+        // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.",
      "path": "src/node/txpackagetracker.cpp",
      "position": null,
      "original_position": 76,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": 1210729694,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ah I mean of the `GenTxid`. Clarified comment (in other PR), thanks.",
      "created_at": "2023-07-05T12:54:52Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253066804",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253066804"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 77,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253067629",
      "pull_request_review_id": 1514439276,
      "id": 1253067629,
      "node_id": "PRRC_kwDOABII585KsEtt",
      "diff_hunk": "@@ -4,12 +4,33 @@\n \n #include <node/txpackagetracker.h>\n \n+#include <common/bloom.h>\n+#include <logging.h>\n #include <txorphanage.h>\n+#include <txrequest.h>\n+#include <util/hasher.h>\n \n namespace node {\n+    /** How long to wait before requesting orphan ancpkginfo/parents from an additional peer.\n+     * Same as GETDATA_TX_INTERVAL. */\n+    static constexpr auto ORPHAN_ANCESTOR_GETDATA_INTERVAL{60s};\n+\n+    /** Delay to add if an orphan resolution candidate is already using a lot of memory in the\n+     * orphanage. */\n+    static constexpr auto ORPHANAGE_OVERLOAD_DELAY{2s};\n+\n class TxPackageTracker::Impl {\n     /** Manages unvalidated tx data (orphan transactions for which we are downloading ancestors). */\n     TxOrphanage m_orphanage;\n+\n+    mutable Mutex m_mutex;\n+\n+    /** Tracks orphans for which we need to request ancestor information. All hashes stored are\n+     * wtxids, i.e., the wtxid of the orphan. However, the is_wtxid field is used to indicate",
      "path": "src/node/txpackagetracker.cpp",
      "position": 163,
      "original_position": 26,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": 1210708748,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "As in `Announcement::m_is_wtxid`, sorry. Clarified (in other PR).",
      "created_at": "2023-07-05T12:55:33Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253067629",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253067629"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 163,
      "original_line": 163,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253068219",
      "pull_request_review_id": 1514439276,
      "id": 1253068219,
      "node_id": "PRRC_kwDOABII585KsE27",
      "diff_hunk": "@@ -4,12 +4,33 @@\n \n #include <node/txpackagetracker.h>\n \n+#include <common/bloom.h>\n+#include <logging.h>\n #include <txorphanage.h>\n+#include <txrequest.h>\n+#include <util/hasher.h>\n \n namespace node {\n+    /** How long to wait before requesting orphan ancpkginfo/parents from an additional peer.\n+     * Same as GETDATA_TX_INTERVAL. */",
      "path": "src/node/txpackagetracker.cpp",
      "position": 16,
      "original_position": 12,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": 1210707099,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Removed (in other PR)",
      "created_at": "2023-07-05T12:56:03Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253068219",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253068219"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 16,
      "original_line": 16,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253138929",
      "pull_request_review_id": 1514439276,
      "id": 1253138929,
      "node_id": "PRRC_kwDOABII585KsWHx",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);",
      "path": "src/node/txpackagetracker.h",
      "position": 83,
      "original_position": 17,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": 1210724340,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Changed/clarified (in other PR)",
      "created_at": "2023-07-05T13:48:45Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253138929",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253138929"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 83,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253139157",
      "pull_request_review_id": 1514439276,
      "id": 1253139157,
      "node_id": "PRRC_kwDOABII585KsWLV",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);",
      "path": "src/node/txpackagetracker.h",
      "position": 83,
      "original_position": 17,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": 1210734976,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Added param comment (in other PR)",
      "created_at": "2023-07-05T13:48:54Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253139157",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253139157"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 83,
      "original_line": 83,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253146225",
      "pull_request_review_id": 1514439276,
      "id": 1253146225,
      "node_id": "PRRC_kwDOABII585KsX5x",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing\n+     * parents were requested), package info requests, tx data download, and packages in the\n+     * validation queue. */\n+    size_t Count(NodeId nodeid) const;\n+\n+    /** Number of packages we are currently working on with this peer (i.e. reserving memory for\n+     * storing orphan(s)). Includes in-flight package info requests, tx data download, and packages\n+     * in the validation queue. Excludes entries in the orphan tracker that are just candidates. */",
      "path": "src/node/txpackagetracker.h",
      "position": 93,
      "original_position": 27,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "4c72113677bea9c722070c73471ca27087985a6b",
      "in_reply_to_id": 1210736698,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Clarified these comments (in other PR)",
      "created_at": "2023-07-05T13:53:57Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253146225",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253146225"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 93,
      "original_line": 93,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253148822",
      "pull_request_review_id": 1514439276,
      "id": 1253148822,
      "node_id": "PRRC_kwDOABII585KsYiW",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing\n+     * parents were requested), package info requests, tx data download, and packages in the\n+     * validation queue. */\n+    size_t Count(NodeId nodeid) const;\n+\n+    /** Number of packages we are currently working on with this peer (i.e. reserving memory for\n+     * storing orphan(s)). Includes in-flight package info requests, tx data download, and packages\n+     * in the validation queue. Excludes entries in the orphan tracker that are just candidates. */\n+    size_t CountInFlight(NodeId nodeid) const;\n+\n+    /** Get list of requests that should be sent to resolve orphans. These may be wtxids to send\n+     * getdata(ANCPKGINFO) or txids corresponding to parents. Automatically marks the orphans as\n+     * having outgoing requests. */\n+    std::vector<GenTxid> GetOrphanRequests(NodeId nodeid, std::chrono::microseconds current_time);\n+\n+    /** Update transactions for which we have made \"final\" decisions: transactions that have\n+     * confirmed in a block, conflicted due to a block, or added to the mempool already.\n+     * Should be called on new block: valid=block transactions, invalid=conflicts.\n+     * Should be called when tx is added to mempool.\n+     * Should not be called when a tx fails validation.\n+     * */\n+    void FinalizeTransactions(const std::set<uint256>& valid, const std::set<uint256>& invalid);",
      "path": "src/node/txpackagetracker.h",
      "position": 107,
      "original_position": 41,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": 1214728153,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I've deleted this function as it seems to be a confusing part of the interface. Replaced with separate functions that do similar things. (in other PR)",
      "created_at": "2023-07-05T13:55:48Z",
      "updated_at": "2023-07-05T15:32:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253148822",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253148822"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 107,
      "original_line": 107,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253151431",
      "pull_request_review_id": 1514439276,
      "id": 1253151431,
      "node_id": "PRRC_kwDOABII585KsZLH",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing",
      "path": "src/node/txpackagetracker.h",
      "position": 86,
      "original_position": 20,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": 1214720397,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We are not changing the limits, just accounting for orphan parent requests in the normal rate limits. One can argue there's a new restriction, but I'd just say this is simply more accurate enforcement of existing limits. I wouldn't be worried unless you're currently broadcasting descendants before ancestors on purpose to trigger orphan handling and send an extra transaction a few seconds earlier.",
      "created_at": "2023-07-05T13:57:39Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253151431",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253151431"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 86,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253163572",
      "pull_request_review_id": 1514439276,
      "id": 1253163572,
      "node_id": "PRRC_kwDOABII585KscI0",
      "diff_hunk": "@@ -4078,38 +4095,20 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         else if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS)\n         {\n             bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n-            // Deduplicate parent txids, so that we don't have to loop over\n-            // the same parent txid more than once down below.\n-            std::vector<uint256> unique_parents;\n-            unique_parents.reserve(tx.vin.size());\n-            for (const CTxIn& txin : tx.vin) {\n-                // We start with all parents, and then remove duplicates below.\n-                unique_parents.push_back(txin.prevout.hash);\n-            }\n-            std::sort(unique_parents.begin(), unique_parents.end());\n-            unique_parents.erase(std::unique(unique_parents.begin(), unique_parents.end()), unique_parents.end());\n-            for (const uint256& parent_txid : unique_parents) {\n+            for (const auto& input : tx.vin) {\n+                const auto& parent_txid = input.prevout.hash;\n+                AddKnownTx(*peer, parent_txid);\n                 if (m_recent_rejects.contains(parent_txid)) {\n                     fRejectedParents = true;\n                     break;\n                 }\n             }\n             if (!fRejectedParents) {\n+                const bool had_before{m_txpackagetracker->OrphanageHaveTx(GenTxid::Wtxid(ptx->GetWitnessHash()))};\n                 const auto current_time{GetTime<std::chrono::microseconds>()};\n+                AddOrphanResolutionCandidate(pfrom.GetId(), ptx->GetWitnessHash(), ptx, current_time);\n \n-                for (const uint256& parent_txid : unique_parents) {\n-                    // Here, we only have the txid (and not wtxid) of the\n-                    // inputs, so we only request in txid mode, even for\n-                    // wtxidrelay peers.\n-                    // Eventually we should replace this with an improved\n-                    // protocol for getting all unconfirmed parents.\n-                    const auto gtxid{GenTxid::Txid(parent_txid)};\n-                    AddKnownTx(*peer, parent_txid);\n-                    if (!AlreadyHaveTx(gtxid)) AddTxAnnouncement(pfrom, gtxid, current_time);\n-                }\n-\n-                if (m_txpackagetracker->OrphanageAddTx(ptx, pfrom.GetId())) {\n+                if (!had_before && m_txpackagetracker->OrphanageHaveTx(GenTxid::Wtxid(ptx->GetWitnessHash()))) {",
      "path": "src/net_processing.cpp",
      "position": 740,
      "original_position": 106,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "498e343a4d767d5c62976d7f48dbac7b82d86157",
      "in_reply_to_id": 1238924470,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The condition is supposed to be = orphanage didn't have it before, but does have it now (after we called `AddOrphanResolutionCandidate`). Maybe I'm misunderstanding what you mean, but it looks correct to me?\r\n\r\nI'm trying to catch the case where we add the new orphan to the orphanage, but it reaches capacity and happens to be the one evicted.",
      "created_at": "2023-07-05T14:06:12Z",
      "updated_at": "2023-07-05T15:32:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253163572",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253163572"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4560,
      "original_line": 4560,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253222853",
      "pull_request_review_id": 1514439276,
      "id": 1253222853,
      "node_id": "PRRC_kwDOABII585KsqnF",
      "diff_hunk": "@@ -4078,38 +4095,20 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         else if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS)\n         {\n             bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n-            // Deduplicate parent txids, so that we don't have to loop over\n-            // the same parent txid more than once down below.\n-            std::vector<uint256> unique_parents;\n-            unique_parents.reserve(tx.vin.size());\n-            for (const CTxIn& txin : tx.vin) {\n-                // We start with all parents, and then remove duplicates below.\n-                unique_parents.push_back(txin.prevout.hash);\n-            }\n-            std::sort(unique_parents.begin(), unique_parents.end());\n-            unique_parents.erase(std::unique(unique_parents.begin(), unique_parents.end()), unique_parents.end());\n-            for (const uint256& parent_txid : unique_parents) {\n+            for (const auto& input : tx.vin) {\n+                const auto& parent_txid = input.prevout.hash;\n+                AddKnownTx(*peer, parent_txid);",
      "path": "src/net_processing.cpp",
      "position": 717,
      "original_position": 83,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "498e343a4d767d5c62976d7f48dbac7b82d86157",
      "in_reply_to_id": 1238913973,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Good point! Changed so we mark `AddKnownTx` right before we send a parent tx request (in other PR).",
      "created_at": "2023-07-05T14:45:38Z",
      "updated_at": "2023-07-05T15:32:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253222853",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253222853"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4551,
      "original_line": 4551,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253243468",
      "pull_request_review_id": 1514439276,
      "id": 1253243468,
      "node_id": "PRRC_kwDOABII585KsvpM",
      "diff_hunk": "@@ -5860,6 +5859,18 @@ bool PeerManagerImpl::SendMessages(CNode* pto)\n             }\n         }\n \n+        auto requestable_orphans = m_txpackagetracker->GetOrphanRequests(pto->GetId(), current_time);",
      "path": "src/net_processing.cpp",
      "position": 896,
      "original_position": 114,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "bb5e0b21520e6deebcfe9576ae17f4db15c31421",
      "in_reply_to_id": 1210769183,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I've squashed the commits so that it's more clear that this was copied to TxPackageTracker (other PR)",
      "created_at": "2023-07-05T14:59:16Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253243468",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253243468"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 6347,
      "original_line": 6347,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253252501",
      "pull_request_review_id": 1514439276,
      "id": 1253252501,
      "node_id": "PRRC_kwDOABII585Ksx2V",
      "diff_hunk": "@@ -667,6 +678,21 @@ class TxRequestTracker::Impl {\n         });\n     }\n \n+    void ResetRequestTimeout(NodeId peer, const uint256& txhash, std::chrono::microseconds new_expiry)\n+    {\n+        auto it = m_index.get<ByPeer>().find(ByPeerView{peer, false, txhash});",
      "path": "src/txrequest.cpp",
      "position": 24,
      "original_position": 24,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "212a7010257b43eff9fa017bcf625acfc84f650f",
      "in_reply_to_id": 1211763570,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done (in other PR)",
      "created_at": "2023-07-05T15:06:07Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253252501",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253252501"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 687,
      "original_line": 687,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253253635",
      "pull_request_review_id": 1514439276,
      "id": 1253253635,
      "node_id": "PRRC_kwDOABII585KsyID",
      "diff_hunk": "@@ -21,8 +21,14 @@ bool TxOrphanage::AddTx(const CTransactionRef& tx, NodeId peer)\n     if (tx == nullptr) return false;\n \n     const uint256& hash = tx->GetHash();\n-    if (m_orphans.count(hash))\n+    if (m_orphans.count(hash)) {",
      "path": "src/txorphanage.cpp",
      "position": 16,
      "original_position": 5,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": 1211872666,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done (in other PR)",
      "created_at": "2023-07-05T15:06:58Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253253635",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253253635"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 24,
      "original_line": 24,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253262136",
      "pull_request_review_id": 1514439276,
      "id": 1253262136,
      "node_id": "PRRC_kwDOABII585Ks0M4",
      "diff_hunk": "@@ -79,6 +80,10 @@ class TxOrphanage {\n         return peer_bytes_it == m_peer_bytes_used.end() ? 0 : peer_bytes_it->second;\n     }\n \n+    /** Remove a peer from an orphan's announcers list, erasing the orphan if this is the only peer\n+     * who announced it. If the orphan doesn't exist or does not list this peer as an announcer, do nothing. */\n+    void EraseOrphanOfPeer(const uint256& wtxid, NodeId peer) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex);",
      "path": "src/txorphanage.h",
      "position": 92,
      "original_position": 25,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": 1239030012,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Removed, thanks (other PR)",
      "created_at": "2023-07-05T15:12:30Z",
      "updated_at": "2023-07-05T15:32:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253262136",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253262136"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 100,
      "original_line": 100,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253270809",
      "pull_request_review_id": 1514439276,
      "id": 1253270809,
      "node_id": "PRRC_kwDOABII585Ks2UZ",
      "diff_hunk": "@@ -3748,6 +3784,9 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                 if (!fAlreadyHave && !m_chainman.ActiveChainstate().IsInitialBlockDownload()) {\n                     AddTxAnnouncement(pfrom, gtxid, current_time);\n                 }\n+                if (inv.IsMsgWtx() && m_txpackagetracker->OrphanageHaveTx(gtxid) && !m_chainman.ActiveChainstate().IsInitialBlockDownload()) {",
      "path": "src/net_processing.cpp",
      "position": 594,
      "original_position": 74,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "0671e1c178270350aadeba625da8b95d6ef2ff00",
      "in_reply_to_id": 1212089989,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done in other PR",
      "created_at": "2023-07-05T15:18:57Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253270809",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253270809"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4117,
      "original_line": 4117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253271432",
      "pull_request_review_id": 1514439276,
      "id": 1253271432,
      "node_id": "PRRC_kwDOABII585Ks2eI",
      "diff_hunk": "@@ -1418,16 +1423,47 @@ void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n     }\n }\n \n-void PeerManagerImpl::AddOrphanResolutionCandidate(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& orphan, std::chrono::microseconds current_time)\n+void PeerManagerImpl::AddOrphanAnnouncer(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& tx, std::chrono::microseconds current_time)\n {\n-    AssertLockHeld(::cs_main);\n+    AssertLockHeld(::cs_main); // For m_txrequest\n+    const bool connected = m_connman.ForNode(nodeid, [](CNode* node) { return node->fSuccessfullyConnected && !node->fDisconnect; });\n+    if (!connected) return;\n+    if (m_txpackagetracker->Count(nodeid) + m_txrequest.Count(nodeid) >= MAX_PEER_TX_ANNOUNCEMENTS) {\n+        // Too many queued announcements. Request from a different peer.\n+        // TODO: Allow peers with Relay permissions to bypass this restriction.\n+        return;\n+    }\n     const CNodeState* state = State(nodeid);\n-    // Decide the TxRequestTracker parameters for this orphan resolution:\n+    // Decide the TxRequestTracker parameters for this orphan resolution.\n+    // TxPackageTracker may also increase the delay.\n     // - \"preferred\": if fPreferredDownload is set (= outbound, or NetPermissionFlags::NoBan permission)\n-    // - \"reqtime\": current time\n+    // - \"reqtime\": current time plus delays for:\n+    //   - NONPREF_PEER_TX_DELAY for announcements from non-preferred connections\n+    //   - OVERLOADED_PEER_TX_DELAY for announcements from peers which have at least\n+    //     MAX_PEER_TX_REQUEST_IN_FLIGHT requests in flight\n+    //     TODO: allow peers with Relay permissions to bypass this restiction\n     auto delay{0us};\n     const bool preferred = state->fPreferredDownload;\n-    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, orphan, preferred, current_time + delay);\n+    if (!preferred) delay += NONPREF_PEER_TX_DELAY;\n+    const bool overloaded = m_txrequest.CountInFlight(nodeid) >= MAX_PEER_TX_REQUEST_IN_FLIGHT;\n+    if (overloaded) delay += OVERLOADED_PEER_TX_DELAY;\n+    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, tx, preferred, current_time + delay);\n+}\n+void PeerManagerImpl::AddOrphanResolutionCandidates(const CTransactionRef& orphan, NodeId originator)\n+{\n+    const auto current_time{GetTime<std::chrono::microseconds>()};\n+\n+    // The originator will not show up in GetCandidatePeers() since we already requested from them.\n+    AddOrphanAnnouncer(originator, orphan->GetWitnessHash(), orphan, current_time);\n+    // We prefer to request the orphan's ancestors via package relay rather than txids\n+    // of missing inputs. Also, if the first request fails, we should try again.\n+    // Get all peers that announced this transaction and prioritize accordingly...\n+    for (const auto nodeid : m_txrequest.GetCandidatePeers(orphan->GetWitnessHash())) {\n+        AddOrphanAnnouncer(nodeid, orphan->GetWitnessHash(), orphan, current_time);",
      "path": "src/net_processing.cpp",
      "position": 215,
      "original_position": 62,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "0671e1c178270350aadeba625da8b95d6ef2ff00",
      "in_reply_to_id": 1212101478,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes. This is called in a big batch when we realize a tx is an orphan, and then for each inv of a tx that is present in our orphanage.",
      "created_at": "2023-07-05T15:19:29Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253271432",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253271432"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1536,
      "original_line": 1536,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253272447",
      "pull_request_review_id": 1514439276,
      "id": 1253272447,
      "node_id": "PRRC_kwDOABII585Ks2t_",
      "diff_hunk": "@@ -1418,16 +1423,47 @@ void PeerManagerImpl::PushNodeVersion(CNode& pnode, const Peer& peer)\n     }\n }\n \n-void PeerManagerImpl::AddOrphanResolutionCandidate(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& orphan, std::chrono::microseconds current_time)\n+void PeerManagerImpl::AddOrphanAnnouncer(NodeId nodeid, const uint256& orphan_wtxid, const CTransactionRef& tx, std::chrono::microseconds current_time)\n {\n-    AssertLockHeld(::cs_main);\n+    AssertLockHeld(::cs_main); // For m_txrequest\n+    const bool connected = m_connman.ForNode(nodeid, [](CNode* node) { return node->fSuccessfullyConnected && !node->fDisconnect; });\n+    if (!connected) return;\n+    if (m_txpackagetracker->Count(nodeid) + m_txrequest.Count(nodeid) >= MAX_PEER_TX_ANNOUNCEMENTS) {\n+        // Too many queued announcements. Request from a different peer.\n+        // TODO: Allow peers with Relay permissions to bypass this restriction.\n+        return;\n+    }\n     const CNodeState* state = State(nodeid);\n-    // Decide the TxRequestTracker parameters for this orphan resolution:\n+    // Decide the TxRequestTracker parameters for this orphan resolution.\n+    // TxPackageTracker may also increase the delay.\n     // - \"preferred\": if fPreferredDownload is set (= outbound, or NetPermissionFlags::NoBan permission)\n-    // - \"reqtime\": current time\n+    // - \"reqtime\": current time plus delays for:\n+    //   - NONPREF_PEER_TX_DELAY for announcements from non-preferred connections\n+    //   - OVERLOADED_PEER_TX_DELAY for announcements from peers which have at least\n+    //     MAX_PEER_TX_REQUEST_IN_FLIGHT requests in flight\n+    //     TODO: allow peers with Relay permissions to bypass this restiction\n     auto delay{0us};\n     const bool preferred = state->fPreferredDownload;\n-    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, orphan, preferred, current_time + delay);\n+    if (!preferred) delay += NONPREF_PEER_TX_DELAY;\n+    const bool overloaded = m_txrequest.CountInFlight(nodeid) >= MAX_PEER_TX_REQUEST_IN_FLIGHT;\n+    if (overloaded) delay += OVERLOADED_PEER_TX_DELAY;\n+    m_txpackagetracker->AddOrphanTx(nodeid, orphan_wtxid, tx, preferred, current_time + delay);\n+}\n+void PeerManagerImpl::AddOrphanResolutionCandidates(const CTransactionRef& orphan, NodeId originator)\n+{\n+    const auto current_time{GetTime<std::chrono::microseconds>()};\n+\n+    // The originator will not show up in GetCandidatePeers() since we already requested from them.\n+    AddOrphanAnnouncer(originator, orphan->GetWitnessHash(), orphan, current_time);\n+    // We prefer to request the orphan's ancestors via package relay rather than txids",
      "path": "src/net_processing.cpp",
      "position": 211,
      "original_position": 58,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "0671e1c178270350aadeba625da8b95d6ef2ff00",
      "in_reply_to_id": 1212076537,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Through delays. Clarified now in other PR I think.",
      "created_at": "2023-07-05T15:20:12Z",
      "updated_at": "2023-07-05T15:31:59Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253272447",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253272447"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1532,
      "original_line": 1532,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253290488",
      "pull_request_review_id": 1514811288,
      "id": 1253290488,
      "node_id": "PRRC_kwDOABII585Ks7H4",
      "diff_hunk": "@@ -188,7 +191,7 @@ void TxOrphanage::LimitOrphans(unsigned int max_orphans)\n         if (nErased > 0) LogPrint(BCLog::TXPACKAGES, \"Erased %d orphan tx due to expiration\\n\", nErased);\n     }\n     FastRandomContext rng;\n-    while (m_orphans.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)\n+    while (m_orphan_list.size() > max_orphans || m_total_orphan_bytes > MAX_ORPHAN_TOTAL_SIZE)",
      "path": "src/txorphanage.cpp",
      "position": null,
      "original_position": 43,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "76c564761687eca898060998d60d6084b4ce361d",
      "in_reply_to_id": 1213639103,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Fixed here",
      "created_at": "2023-07-05T15:33:29Z",
      "updated_at": "2023-07-05T15:33:29Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253290488",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253290488"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 194,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253291132",
      "pull_request_review_id": 1514812329,
      "id": 1253291132,
      "node_id": "PRRC_kwDOABII585Ks7R8",
      "diff_hunk": "@@ -24,7 +24,7 @@ static constexpr size_t MAX_ORPHAN_TOTAL_SIZE{100 * MAX_STANDARD_TX_WEIGHT};\n  */\n class TxOrphanage {\n public:\n-    /** Add a new orphan transaction */\n+    /** Add a new orphan transaction. If the tx already exists, add this peer to its list of announcers. */",
      "path": "src/txorphanage.h",
      "position": 23,
      "original_position": 5,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "fecb522a3fa83e7b485f5d17f070ed56d47e3d90",
      "in_reply_to_id": 1211869199,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done (in other PR)",
      "created_at": "2023-07-05T15:34:00Z",
      "updated_at": "2023-07-05T15:34:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253291132",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253291132"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 27,
      "original_line": 27,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253333443",
      "pull_request_review_id": 1514879811,
      "id": 1253333443,
      "node_id": "PRRC_kwDOABII585KtFnD",
      "diff_hunk": "@@ -4078,38 +4095,20 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         else if (state.GetResult() == TxValidationResult::TX_MISSING_INPUTS)\n         {\n             bool fRejectedParents = false; // It may be the case that the orphans parents have all been rejected\n-\n-            // Deduplicate parent txids, so that we don't have to loop over\n-            // the same parent txid more than once down below.\n-            std::vector<uint256> unique_parents;\n-            unique_parents.reserve(tx.vin.size());\n-            for (const CTxIn& txin : tx.vin) {\n-                // We start with all parents, and then remove duplicates below.\n-                unique_parents.push_back(txin.prevout.hash);\n-            }\n-            std::sort(unique_parents.begin(), unique_parents.end());\n-            unique_parents.erase(std::unique(unique_parents.begin(), unique_parents.end()), unique_parents.end());\n-            for (const uint256& parent_txid : unique_parents) {\n+            for (const auto& input : tx.vin) {\n+                const auto& parent_txid = input.prevout.hash;\n+                AddKnownTx(*peer, parent_txid);\n                 if (m_recent_rejects.contains(parent_txid)) {\n                     fRejectedParents = true;\n                     break;\n                 }\n             }\n             if (!fRejectedParents) {\n+                const bool had_before{m_txpackagetracker->OrphanageHaveTx(GenTxid::Wtxid(ptx->GetWitnessHash()))};\n                 const auto current_time{GetTime<std::chrono::microseconds>()};\n+                AddOrphanResolutionCandidate(pfrom.GetId(), ptx->GetWitnessHash(), ptx, current_time);\n \n-                for (const uint256& parent_txid : unique_parents) {\n-                    // Here, we only have the txid (and not wtxid) of the\n-                    // inputs, so we only request in txid mode, even for\n-                    // wtxidrelay peers.\n-                    // Eventually we should replace this with an improved\n-                    // protocol for getting all unconfirmed parents.\n-                    const auto gtxid{GenTxid::Txid(parent_txid)};\n-                    AddKnownTx(*peer, parent_txid);\n-                    if (!AlreadyHaveTx(gtxid)) AddTxAnnouncement(pfrom, gtxid, current_time);\n-                }\n-\n-                if (m_txpackagetracker->OrphanageAddTx(ptx, pfrom.GetId())) {\n+                if (!had_before && m_txpackagetracker->OrphanageHaveTx(GenTxid::Wtxid(ptx->GetWitnessHash()))) {",
      "path": "src/net_processing.cpp",
      "position": 740,
      "original_position": 106,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "498e343a4d767d5c62976d7f48dbac7b82d86157",
      "in_reply_to_id": 1238924470,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Thanks for the explanation, makes sense. I got confused there somehow.",
      "created_at": "2023-07-05T16:06:07Z",
      "updated_at": "2023-07-05T16:06:08Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253333443",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253333443"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4560,
      "original_line": 4560,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253401345",
      "pull_request_review_id": 1514983401,
      "id": 1253401345,
      "node_id": "PRRC_kwDOABII585KtWMB",
      "diff_hunk": "@@ -61,7 +65,16 @@ class TxOrphanage {\n         return m_orphans.size();\n     }\n \n+    /** Return total memory usage of the transactions stored. Does not include overhead of\n+     * m_orphans, m_peer_work_set, etc. */\n+    size_t TotalOrphanBytes() const EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        LOCK(m_mutex);\n+        return m_total_orphan_bytes;\n+    }\n protected:\n+    size_t m_total_orphan_bytes{0};",
      "path": "src/txorphanage.h",
      "position": 95,
      "original_position": 30,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "d178c0fb372fc50857438b1b82d344fed0634a10",
      "in_reply_to_id": 1238826846,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Hmm, I think the maximum possible value is currently `101 * MAX_STANDARD_TX_WEIGHT` (after that, `LimitOrphans()` would kick in), so an `unsigned int` should suffice in theory? Maybe use a `uint64_t` if this was to be made configurable by users (see comment above, but not sure if that makes sense).",
      "created_at": "2023-07-05T17:07:41Z",
      "updated_at": "2023-07-05T17:07:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1253401345",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1253401345"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 103,
      "original_line": 103,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255193877",
      "pull_request_review_id": 1517694056,
      "id": 1255193877,
      "node_id": "PRRC_kwDOABII585K0L0V",
      "diff_hunk": "@@ -58,6 +59,36 @@ class TxPackageTracker {\n     /** Return how many entries exist in the orphange */\n     size_t OrphanageSize();\n \n+    /** Received an announcement from this peer for a tx we already know is an orphan; should be\n+     * called for every peer that announces the tx, even if they are not a package relay peer.\n+     * The orphan request tracker will decide when to request what from which peer - use\n+     * GetOrphanRequests().\n+     */\n+    void AddOrphanTx(NodeId nodeid, const uint256& wtxid, const CTransactionRef& tx, bool is_preferred, std::chrono::microseconds reqtime);\n+\n+    /** Number of packages we are working on with this peer. Includes any entries in the orphan\n+     * tracker, in-flight orphan parent requests (1 per orphan regardless of how many missing",
      "path": "src/node/txpackagetracker.h",
      "position": 86,
      "original_position": 20,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "1c13f6465c170639465990e38a188193c036648c",
      "in_reply_to_id": 1214720397,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Okay so I’ve been looking into the code, and yes to my understanding there is _no_ processing penalty at `GETPKGTXNS` reception in `ProcessMessage` than our child has 1 or N parents, we’re calling `FindTxForGetdata` to compose the response `PKGTXNS`. This invalidate this specific source of concern.\r\n\r\n> we have rate-limiting based on the way the parents are fetched (i.e individiually rather than in batch) the equivalent package of A+E will propagate better.\r\n\r\nI’ll maintain there is still an interpedency between package rate-limits and package compositions, though telling what to do a LN node is unclear and can be deferred to ulterior documentation.",
      "created_at": "2023-07-07T03:15:13Z",
      "updated_at": "2023-07-07T03:15:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1255193877",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255193877"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 86,
      "original_line": 86,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255197289",
      "pull_request_review_id": 1517697867,
      "id": 1255197289,
      "node_id": "PRRC_kwDOABII585K0Mpp",
      "diff_hunk": "@@ -492,6 +493,7 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-i2psam=<ip:port>\", \"I2P SAM proxy to reach I2P peers and accept I2P connections (default: none)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-i2pacceptincoming\", strprintf(\"Whether to accept inbound I2P connections (default: %i). Ignored if -i2psam is not set. Listening for inbound I2P connections is done through the SAM proxy, not by binding to a local address and port.\", DEFAULT_I2P_ACCEPT_INCOMING), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-onlynet=<net>\", \"Make automatic outbound connections only to network <net> (\" + Join(GetNetworkNames(), \", \") + \"). Inbound and manual connections are not affected by this option. It can be specified multiple times to allow multiple networks.\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-packagerelay\", strprintf(\"[EXPERIMENTAL] Support relaying transaction packages (default: %u)\", node::DEFAULT_ENABLE_PACKAGE_RELAY), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);",
      "path": "src/init.cpp",
      "position": 12,
      "original_position": 12,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "cdb5b163d623db802ed7f8a3394b2674362f409b",
      "in_reply_to_id": 1237960671,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes adding a mention in BIP331 than a p2p packages can support multiple versions of policy regimes e.g nversion=3. \r\n\r\nFor flexibility towards the node operators in their resource management (especially for DoS protection on low-performance hosts), I think we should have a `acceptnversion=3`setting, that way a node operator can opted in package relay though not in the most computationally expensive type of policy regimes. The utility of such setting is theoretical as long as we have one policy regime for p2p packages, like right now.",
      "created_at": "2023-07-07T03:22:56Z",
      "updated_at": "2023-07-07T03:22:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1255197289",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1255197289"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 500,
      "original_line": 500,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259064139",
      "pull_request_review_id": 1523258231,
      "id": 1259064139,
      "node_id": "PRRC_kwDOABII585LC8tL",
      "diff_hunk": "@@ -3012,14 +3170,86 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n                     m_recent_rejects.insert(porphanTx->GetHash());\n                 }\n             }\n-            m_orphanage.EraseTx(orphanHash);\n+            m_txpackagetracker->EraseOrphanTx(porphanTx->GetWitnessHash());\n             return true;\n         }\n     }\n \n     return false;\n }\n \n+void PeerManagerImpl::ProcessPackage(CNode& node, const node::TxPackageTracker::PackageToValidate& package)\n+{\n+    AssertLockHeld(g_msgproc_mutex);\n+    LOCK(cs_main);\n+    // We won't re-validate the exact same transaction or package again.\n+    if (m_recent_rejects_reconsiderable.contains(GetPackageHash(package.m_unvalidated_txns))) {\n+        // Should we do anything else here?",
      "path": "src/net_processing.cpp",
      "position": 469,
      "original_position": 469,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "So `m_recent_rejects_reconsiderable` logs transaction on its wtxid (which is good to avoid witness inflation changing the result) however isn’t that two restrictive if you have PKG1 submitted with A+B, A is too low with B and then you have A+B’ where A is good enough ? Or is that `TX_LOW_FEE` when the transaction isn’t good enough to meet “mempool min fee not meet” / “min relay fee not met” ?\r\n\r\nIf it’s correct, I would still favor to exempt package transaction from min relay fee checks as it’s some awful interdependency for pre-signed lightning transaction :)",
      "created_at": "2023-07-11T01:15:06Z",
      "updated_at": "2023-07-11T01:15:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1259064139",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259064139"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3187,
      "original_line": 3187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259525623",
      "pull_request_review_id": 1523934951,
      "id": 1259525623,
      "node_id": "PRRC_kwDOABII585LEtX3",
      "diff_hunk": "@@ -3012,14 +3170,86 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n                     m_recent_rejects.insert(porphanTx->GetHash());\n                 }\n             }\n-            m_orphanage.EraseTx(orphanHash);\n+            m_txpackagetracker->EraseOrphanTx(porphanTx->GetWitnessHash());\n             return true;\n         }\n     }\n \n     return false;\n }\n \n+void PeerManagerImpl::ProcessPackage(CNode& node, const node::TxPackageTracker::PackageToValidate& package)\n+{\n+    AssertLockHeld(g_msgproc_mutex);\n+    LOCK(cs_main);\n+    // We won't re-validate the exact same transaction or package again.\n+    if (m_recent_rejects_reconsiderable.contains(GetPackageHash(package.m_unvalidated_txns))) {\n+        // Should we do anything else here?",
      "path": "src/net_processing.cpp",
      "position": 469,
      "original_position": 469,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "in_reply_to_id": 1259064139,
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yes, that's the idea of \"reconsiderable.\" If you get A again with a different package, you reconsider it. If you get A+B again, you don't. In this set of changes, `TX_LOW_FEE` is used to decide to put something in the reconsiderable cache.",
      "created_at": "2023-07-11T10:15:30Z",
      "updated_at": "2023-07-11T10:15:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1259525623",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1259525623"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3187,
      "original_line": 3187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264308888",
      "pull_request_review_id": 1531249782,
      "id": 1264308888,
      "node_id": "PRRC_kwDOABII585LW9KY",
      "diff_hunk": "@@ -3012,14 +3170,86 @@ bool PeerManagerImpl::ProcessOrphanTx(Peer& peer)\n                     m_recent_rejects.insert(porphanTx->GetHash());\n                 }\n             }\n-            m_orphanage.EraseTx(orphanHash);\n+            m_txpackagetracker->EraseOrphanTx(porphanTx->GetWitnessHash());\n             return true;\n         }\n     }\n \n     return false;\n }\n \n+void PeerManagerImpl::ProcessPackage(CNode& node, const node::TxPackageTracker::PackageToValidate& package)\n+{\n+    AssertLockHeld(g_msgproc_mutex);\n+    LOCK(cs_main);\n+    // We won't re-validate the exact same transaction or package again.\n+    if (m_recent_rejects_reconsiderable.contains(GetPackageHash(package.m_unvalidated_txns))) {\n+        // Should we do anything else here?",
      "path": "src/net_processing.cpp",
      "position": 469,
      "original_position": 469,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "in_reply_to_id": 1259064139,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Okay “reconsiderable” makes sense to me, still have to review it’s correctly implemented. \r\n\r\n> If it’s correct, I would still favor to exempt package transaction from min relay fee checks as it’s some awful interdependency for pre-signed lightning transaction :)\r\n\r\nFor this concern, in fact it’s already addressed by the latest state of bip 331 code and nversion=3 documentation, confusion is mine, I thought mempool min fee checks on parent was still present from previous package / acceptance relay reviews. ",
      "created_at": "2023-07-15T03:46:33Z",
      "updated_at": "2023-07-15T03:46:56Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1264308888",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264308888"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3187,
      "original_line": 3187,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264309536",
      "pull_request_review_id": 1531250506,
      "id": 1264309536,
      "node_id": "PRRC_kwDOABII585LW9Ug",
      "diff_hunk": "@@ -1423,39 +1438,74 @@ PackageMempoolAcceptResult MemPoolAccept::AcceptPackage(const Package& package,\n             assert(iter != std::nullopt);\n             // Provide the wtxid of the mempool tx so that the caller can look it up in the mempool.\n             results_final.emplace(wtxid, MempoolAcceptResult::MempoolTxDifferentWitness(iter.value()->GetTx().GetWitnessHash()));\n+            packageified.Exclude(tx);\n         } else {\n             // Transaction does not already exist in the mempool.\n-            // Try submitting the transaction on its own.\n-            const auto single_res = AcceptSingleTransaction(tx, single_args);\n-            if (single_res.m_result_type == MempoolAcceptResult::ResultType::VALID) {\n-                // The transaction succeeded on its own and is now in the mempool. Don't include it\n-                // in package validation, because its fees should only be \"used\" once.\n-                assert(m_pool.exists(GenTxid::Wtxid(wtxid)));\n-                results_final.emplace(wtxid, single_res);\n-            } else if (single_res.m_state.GetResult() != TxValidationResult::TX_MEMPOOL_POLICY &&\n-                       single_res.m_state.GetResult() != TxValidationResult::TX_MISSING_INPUTS) {\n-                // Package validation policy only differs from individual policy in its evaluation\n-                // of feerate. For example, if a transaction fails here due to violation of a\n-                // consensus rule, the result will not change when it is submitted as part of a\n-                // package. To minimize the amount of repeated work, unless the transaction fails\n-                // due to feerate or missing inputs (its parent is a previous transaction in the\n-                // package that failed due to feerate), don't run package validation. Note that this\n-                // decision might not make sense if different types of packages are allowed in the\n-                // future.  Continue individually validating the rest of the transactions, because\n-                // some of them may still be valid.\n-                quit_early = true;\n-                package_state_quit_early.Invalid(PackageValidationResult::PCKG_TX, \"transaction failed\");\n-                individual_results_nonfinal.emplace(wtxid, single_res);\n-            } else {\n-                individual_results_nonfinal.emplace(wtxid, single_res);\n-                txns_package_eval.push_back(tx);\n+            const auto subpackage = packageified.GetAncestorSet(tx);\n+            if (!subpackage) {\n+                // This transaction depends on a tx we will definitely not accept (failed for a\n+                // non-policy and non-missing-inputs reason). We already know that this transaction\n+                // will be invalid for at least one reason, i.e. a missing input. To minimize the\n+                // amount of repeated work, don't validate this tx. Just return missing inputs.\n+                TxValidationState tx_state_quit_early;\n+                tx_state_quit_early.Invalid(TxValidationResult::TX_MISSING_INPUTS, \"invalid-tx-dependency\");\n+                results_final.emplace(wtxid, MempoolAcceptResult::Failure(tx_state_quit_early));\n+                // Don't quit too early. Other transactions may not necessarily depend on the same\n+                // parent, and should still be considered.\n+                continue;\n+            }\n+            if (wtxid == child->GetWitnessHash()) {\n+                Assume(tx == package.back());\n+                // Validate the child outside of this loop. We will consolidate results_final,\n+                // individual_results_nonfinal, and the result of validating the last transaction's\n+                // subpackage into a single PackageMempoolAcceptResult.\n+                break;\n+            }\n+            // This transaction does not already exist in the mempool and is not the child.\n+            // Try submitting the transaction with its in-package ancestor set.\n+            const auto subpackage_result = AcceptPackageWrappingSingle(subpackage.value(), args);\n+            // Look for \"final\" answers: once a tx is successfully submitted, we can add its\n+            // MempoolAcceptResult to the results map. Note that it's possible for transactions to\n+            // have been submitted to the mempool even if subpackage_result.m_state.IsInvalid().\n+            for (const auto& subpackage_tx : subpackage.value()) {\n+                const auto subpackage_wtxid{subpackage_tx->GetWitnessHash()};\n+                if (m_pool.exists(GenTxid::Wtxid(subpackage_wtxid))) {\n+                    const auto subpackage_it{subpackage_result.m_tx_results.find(subpackage_wtxid)};\n+                    results_final.emplace(subpackage_wtxid, subpackage_it->second);\n+                    // Erase any previous invalid results for this transaction. For example, this\n+                    // could be a low-feerate tx that has just been bumped.\n+                    individual_results_nonfinal.erase(subpackage_wtxid);\n+                    packageified.Exclude(subpackage_tx);\n+                }\n+            }\n+            // If m_state is valid, we already processed each tx in the loop above.\n+            if (subpackage_result.m_state.IsValid()) continue;\n+\n+            const auto single_res_it = subpackage_result.m_tx_results.find(wtxid);\n+            if (single_res_it != subpackage_result.m_tx_results.end()) {\n+                const auto single_res = single_res_it->second;\n+                if (single_res.m_state.GetResult() != TxValidationResult::TX_MEMPOOL_POLICY &&\n+                    single_res.m_state.GetResult() != TxValidationResult::TX_LOW_FEE &&",
      "path": "src/validation.cpp",
      "position": 298,
      "original_position": 298,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "98046599812a4aa1e5c43d92969a7cd2a5526b1e",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think this check is correct in what it aims to achieve, i.e not apply the two mempool min fee checks on ancestor package transaction, if it received as such from `AcceptAncestorPackage` / `ProcessNewPackage`, however this is unclear if this exemption apply for all BIP331 package, indifferently of their transactions versions, or only for nversion=3 ones.\r\n\r\nFor context, see https://github.com/lightningdevkit/rust-lightning/pull/2415#discussion_r1263189013",
      "created_at": "2023-07-15T03:53:45Z",
      "updated_at": "2023-07-15T03:53:49Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1264309536",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264309536"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 1488,
      "original_line": 1488,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264747557",
      "pull_request_review_id": 1531801228,
      "id": 1264747557,
      "node_id": "PRRC_kwDOABII585LYoQl",
      "diff_hunk": "@@ -180,3 +180,17 @@ void AncestorPackage::Ban(const CTransactionRef& transaction)\n     if (ancestor_subsets.count(transaction->GetHash()) == 0) return;\n     banned_txns.insert(transaction->GetHash());\n }\n+\n+uint256 GetCombinedHash(const std::vector<uint256>& wtxids)\n+{\n+    std::vector<uint256> wtxids_copy(wtxids.cbegin(), wtxids.cend());\n+    std::sort(wtxids_copy.begin(), wtxids_copy.end());\n+    return (HashWriter() << wtxids_copy).GetHash();\n+}\n+uint256 GetPackageHash(const std::vector<CTransactionRef>& transactions)\n+{\n+    std::vector<uint256> wtxids_copy;",
      "path": "src/policy/packages.cpp",
      "position": 197,
      "original_position": 13,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "e7cfd56cdb9078e1fd0701638754c05d9991bac1",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: `wtxids`, this one is not a copy.",
      "created_at": "2023-07-16T21:05:13Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1264747557",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264747557"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 192,
      "original_line": 192,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264748895",
      "pull_request_review_id": 1531801228,
      "id": 1264748895,
      "node_id": "PRRC_kwDOABII585LYolf",
      "diff_hunk": "@@ -54,6 +54,7 @@ enum class TxValidationResult {\n     TX_CONFLICT,\n     TX_MEMPOOL_POLICY,        //!< violated mempool's fee/size/descendant/RBF/etc limits",
      "path": "src/consensus/validation.h",
      "position": 2,
      "original_position": 2,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "3494f96ebacf53cbd5fd09f6421d9dabec87361e",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "3494f96ebacf53cbd5fd09f6421d9dabec87361e:\r\nshould update this line too because fee is no longer included in it",
      "created_at": "2023-07-16T21:17:46Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1264748895",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1264748895"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 55,
      "original_line": 55,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265523786",
      "pull_request_review_id": 1531801228,
      "id": 1265523786,
      "node_id": "PRRC_kwDOABII585LblxK",
      "diff_hunk": "@@ -835,6 +840,33 @@ class PeerManagerImpl final : public PeerManager\n      * Memory used: 1.3 MB\n      */\n     CRollingBloomFilter m_recent_rejects GUARDED_BY(::cs_main){120'000, 0.000'001};\n+    /**\n+     * Filter for transactions or packages of transactions that were recently rejected by\n+     * the mempool but are eligible for reconsideration if submitted with other transactions.\n+     * This filter only contains wtxids of individual transactions and combined hashes of packages\n+     * (see GetCombinedHash and GetPackageHash).\n+     *\n+     * When a transaction's error is TX_LOW_FEE (in a package or by itself), add its wtxid to this\n+     * filter. If it was in a package, also add the combined hash of the transactions in its\n+     * subpackage to this filter. When a package fails for any reason, add the combined hash of all\n+     * transactions in the package info to this filter.\n+     *\n+     * Upon receiving an announcement for a transaction, if it exists in this filter, do not\n+     * download the txdata. Upon receiving a package info, if the combined hash of its transactions\n+     * are in this filter, do not download the txdata.\n+     *\n+     * Reset this filter when the chain tip changes.\n+     *\n+     * We will only add wtxids to this filter. Groups of multiple transactions are represented by\n+     * the hash of their wtxids, concatenated together in lexicographical order.\n+     *\n+     * Parameters are picked to be identical to that of m_recent_rejects, with the same rationale.\n+     * Memory used: 1.3 MB\n+     * FIXME: this filter can probably be smaller, but how much smaller?\n+     */\n+    CRollingBloomFilter m_recent_rejects_reconsiderable GUARDED_BY(::cs_main){120'000, 0.000'001};",
      "path": "src/net_processing.cpp",
      "position": 143,
      "original_position": 46,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "3494f96ebacf53cbd5fd09f6421d9dabec87361e",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "3494f96ebacf53cbd5fd09f6421d9dabec87361e:\r\nDo we need to adjust the logic in `ProcessOrphanTx()` too, by inserting there into `m_recent_rejects_reconsiderable` instead of `m_recent_rejects` if the reason was low-fee? It currently adds the wtxid of a reconsidered orphan to `m_recent_rejects` if it fails for policy/fee-related reasons. But if that resolved orphan is itself one of the parent of another orphan we wouldn't consider that (possibly high-fee) child because a parent was rejected.",
      "created_at": "2023-07-17T15:15:08Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265523786",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265523786"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 871,
      "original_line": 867,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265739284",
      "pull_request_review_id": 1531801228,
      "id": 1265739284,
      "node_id": "PRRC_kwDOABII585LcaYU",
      "diff_hunk": "@@ -158,14 +164,26 @@ class TxPackageTracker::Impl {\n         // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n         if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n \n-        // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n-        orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);\n+        // Skip if already requested in the (recent-ish) past.\n+        if (packageinfo_requested.contains(GetPackageInfoRequestId(nodeid, wtxid, PKG_RELAY_ANCPKG))) return;\n+\n+        auto it_peer_info = info_per_peer.find(nodeid);\n+        if (it_peer_info != info_per_peer.end() && it_peer_info->second.SupportsVersion(PKG_RELAY_ANCPKG)) {\n+            // Package relay peer: is_wtxid=true because we will be requesting via ancpkginfo.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from package relay peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Wtxid(wtxid), is_preferred, reqtime);\n+        } else {\n+            // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from legacy peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);",
      "path": "src/node/txpackagetracker.cpp",
      "position": 300,
      "original_position": 45,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "The approach to add a wtxid disguised as a txid to distinguish between legacy orphan processing and package relay seems a bit like a hack to me. \r\nI'm not strictly against it, but I guess I don't completely understand yet why it's necessary - the information whether a peer supports package relay does not change, so why can't we just always use `GenTxid::Wtxid(wtxid)` and check again in `GetOrphanRequests()` and elsewhere whether we do  package relay with the peer instead of checking whether it's a txid / wtxid?",
      "created_at": "2023-07-17T18:15:13Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265739284",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265739284"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 300,
      "original_line": 178,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265806240",
      "pull_request_review_id": 1531801228,
      "id": 1265806240,
      "node_id": "PRRC_kwDOABII585Lcqug",
      "diff_hunk": "@@ -5077,6 +5131,13 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n                     // If we receive a NOTFOUND message for a tx we requested, mark the announcement for it as\n                     // completed in TxRequestTracker.\n                     m_txrequest.ReceivedResponse(pfrom.GetId(), inv.hash);\n+                } else if (inv.IsMsgAncPkgInfo() && m_enable_package_relay) {\n+                    if (!m_txpackagetracker->PkgInfoAllowed(pfrom.GetId(), inv.hash, node::PKG_RELAY_ANCPKG)) {\n+                        LogPrint(BCLog::NET, \"\\nUnsolicited ancpkginfo sent, disconnecting peer=%d\\n\", pfrom.GetId());",
      "path": "src/net_processing.cpp",
      "position": 850,
      "original_position": 81,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It's an unsolicited `NOTFOUND` of type `MSG_ANCPKGINFO`, would be good to distinguish between the inv type and the actual `ANCPKGINFO` message.",
      "created_at": "2023-07-17T19:24:05Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265806240",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265806240"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 5316,
      "original_line": 5136,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265811166",
      "pull_request_review_id": 1531801228,
      "id": 1265811166,
      "node_id": "PRRC_kwDOABII585Lcr7e",
      "diff_hunk": "@@ -240,6 +267,31 @@ class TxPackageTracker::Impl {\n             orphan_request_tracker.ForgetTxHash(wtxid);\n         }\n     }\n+    bool PkgInfoAllowed(NodeId nodeid, const uint256& wtxid, PackageRelayVersions version) EXCLUSIVE_LOCKS_REQUIRED(!m_mutex)\n+    {\n+        AssertLockNotHeld(m_mutex);\n+        LOCK(m_mutex);\n+        auto peerinfo_it = info_per_peer.find(nodeid);\n+        if (peerinfo_it == info_per_peer.end()) {\n+            return false;\n+        } else if (!peerinfo_it->second.SupportsVersion(version)) {\n+            return false;\n+        }\n+        if (!packageinfo_requested.contains(GetPackageInfoRequestId(nodeid, wtxid, version))) {\n+            return false;\n+        }\n+        orphan_request_tracker.ReceivedResponse(nodeid, wtxid);",
      "path": "src/node/txpackagetracker.cpp",
      "position": null,
      "original_position": 149,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": " `PkgInfoAllowed()` calling `ReceivedResponse()` as a side effect is surprising to me. Wouldn't it be better if the caller would also have to explicitly call `ForgetPkgInfo()` if they want to forget about the package? This is also not mentioned in its doc.",
      "created_at": "2023-07-17T19:30:00Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265811166",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265811166"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 283,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265838609",
      "pull_request_review_id": 1531801228,
      "id": 1265838609,
      "node_id": "PRRC_kwDOABII585LcyoR",
      "diff_hunk": "@@ -195,36 +213,45 @@ class TxPackageTracker::Impl {\n         }\n         std::vector<GenTxid> results;\n         for (const auto& gtxid : tracker_requestable) {\n-            LogPrint(BCLog::TXPACKAGES, \"\\nResolving orphan %s, requesting by txids of parents from peer=%d\\n\", gtxid.GetHash().ToString(), nodeid);\n-            const auto ptx = m_orphanage.GetTx(gtxid.GetHash());\n-            if (!ptx) {\n-                // We can't request ancpkginfo and we have no way of knowing what the missing\n-                // parents are (it could also be that the orphan has already been resolved).\n-                // Give up.\n-                orphan_request_tracker.ForgetTxHash(gtxid.GetHash());\n-                LogPrint(BCLog::TXPACKAGES, \"\\nForgetting orphan %s from peer=%d\\n\", gtxid.GetHash().ToString(), nodeid);\n-                continue;\n+            if (gtxid.IsWtxid()) {\n+                Assume(info_per_peer.find(nodeid) != info_per_peer.end());\n+                // Add the orphan's wtxid as-is.\n+                LogPrint(BCLog::TXPACKAGES, \"\\nResolving orphan %s, requesting by ancpkginfo from peer=%d\\n\", gtxid.GetHash().ToString(), nodeid);\n+                results.emplace_back(gtxid);",
      "path": "src/node/txpackagetracker.cpp",
      "position": 415,
      "original_position": 74,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think that the splitting into commits is not ideal here: In ae2664793b1d0d86bfa32c3e635d83b1ee083e60, we add logic to return the wtxid, expecting it to be requested by `MSG_ANCPKGINFO`. But the net_processing code to actually do this is only added in dd6fb139b8887f3400a65dc0d4c4ee54cf53d0bc, so that at ae2664793b1d0d86bfa32c3e635d83b1ee083e60, we'd send out a `MSG_TX` getdata, thus re-requesting a TX we already know. These two things should go together into one commit.",
      "created_at": "2023-07-17T20:00:27Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265838609",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265838609"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 415,
      "original_line": 220,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265856298",
      "pull_request_review_id": 1531801228,
      "id": 1265856298,
      "node_id": "PRRC_kwDOABII585Lc28q",
      "diff_hunk": "@@ -3440,6 +3457,16 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n \n         if (greatest_common_version >= WTXID_RELAY_VERSION) {\n             m_connman.PushMessage(&pfrom, msg_maker.Make(NetMsgType::WTXIDRELAY));\n+            if (m_enable_package_relay) {\n+                m_txpackagetracker->ReceivedVersion(peer->m_id);\n+                if (!m_ignore_incoming_txs) {",
      "path": "src/net_processing.cpp",
      "position": 544,
      "original_position": 105,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "e32dd99e42474ec8b3a996797e1a4f911a8e65a4",
      "in_reply_to_id": null,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We should also disable sending \"sendpackages\" for outgoing block-relay-only connections and probably also feelers, would suggest to just use `RejectIncomingTxs()`.\r\nAlso, I think this should be moved up and combined with the `m_enable_package_relay` check two lines above, because I see no reason to call `m_txpackagetracker->ReceivedVersion()` in these scenarios.",
      "created_at": "2023-07-17T20:18:41Z",
      "updated_at": "2023-07-17T20:27:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265856298",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265856298"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 3623,
      "original_line": 3462,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265868269",
      "pull_request_review_id": 1533637663,
      "id": 1265868269,
      "node_id": "PRRC_kwDOABII585Lc53t",
      "diff_hunk": "@@ -158,14 +164,26 @@ class TxPackageTracker::Impl {\n         // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n         if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n \n-        // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n-        orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);\n+        // Skip if already requested in the (recent-ish) past.\n+        if (packageinfo_requested.contains(GetPackageInfoRequestId(nodeid, wtxid, PKG_RELAY_ANCPKG))) return;\n+\n+        auto it_peer_info = info_per_peer.find(nodeid);\n+        if (it_peer_info != info_per_peer.end() && it_peer_info->second.SupportsVersion(PKG_RELAY_ANCPKG)) {\n+            // Package relay peer: is_wtxid=true because we will be requesting via ancpkginfo.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from package relay peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Wtxid(wtxid), is_preferred, reqtime);\n+        } else {\n+            // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from legacy peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);",
      "path": "src/node/txpackagetracker.cpp",
      "position": 300,
      "original_position": 45,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
      "in_reply_to_id": 1265739284,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It makes it very difficult to read, imo, and lilkely introduces bugs going forward, if not now.\r\n\r\nNote @mzumsande that this logic lives in the orphan relay PR IIRC",
      "created_at": "2023-07-17T20:30:46Z",
      "updated_at": "2023-07-17T20:30:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265868269",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265868269"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 300,
      "original_line": 178,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265915386",
      "pull_request_review_id": 1533717256,
      "id": 1265915386,
      "node_id": "PRRC_kwDOABII585LdFX6",
      "diff_hunk": "@@ -158,14 +164,26 @@ class TxPackageTracker::Impl {\n         // Skip if we weren't provided the tx and can't find the wtxid in the orphanage.\n         if (tx == nullptr && !m_orphanage.HaveTx(GenTxid::Wtxid(wtxid))) return;\n \n-        // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n-        orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);\n+        // Skip if already requested in the (recent-ish) past.\n+        if (packageinfo_requested.contains(GetPackageInfoRequestId(nodeid, wtxid, PKG_RELAY_ANCPKG))) return;\n+\n+        auto it_peer_info = info_per_peer.find(nodeid);\n+        if (it_peer_info != info_per_peer.end() && it_peer_info->second.SupportsVersion(PKG_RELAY_ANCPKG)) {\n+            // Package relay peer: is_wtxid=true because we will be requesting via ancpkginfo.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from package relay peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Wtxid(wtxid), is_preferred, reqtime);\n+        } else {\n+            // Even though this stores the orphan wtxid, is_wtxid=false because we will be requesting the parents via txid.\n+            LogPrint(BCLog::TXPACKAGES, \"\\nPotential orphan resolution for %s from legacy peer=%d\\n\", wtxid.ToString(), nodeid);\n+            orphan_request_tracker.ReceivedInv(nodeid, GenTxid::Txid(wtxid), is_preferred, reqtime);",
      "path": "src/node/txpackagetracker.cpp",
      "position": 300,
      "original_position": 45,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "ae2664793b1d0d86bfa32c3e635d83b1ee083e60",
      "in_reply_to_id": 1265739284,
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "right - I'll copy the comment so that we can discuss there - this one can be resolved.",
      "created_at": "2023-07-17T21:20:13Z",
      "updated_at": "2023-07-17T21:20:13Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1265915386",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1265915386"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 300,
      "original_line": 178,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1329033501",
      "pull_request_review_id": 1631576047,
      "id": 1329033501,
      "node_id": "PRRC_kwDOABII585PN3Ed",
      "diff_hunk": "@@ -776,13 +801,18 @@ class PeerManagerImpl final : public PeerManager\n     /** Stalling timeout for blocks in IBD */\n     std::atomic<std::chrono::seconds> m_block_stalling_timeout{BLOCK_STALLING_TIMEOUT_DEFAULT};\n \n-    bool AlreadyHaveTx(const GenTxid& gtxid)\n+    bool AlreadyHaveTx(const GenTxid& gtxid, bool include_orphanage = true)\n         EXCLUSIVE_LOCKS_REQUIRED(cs_main, !m_recent_confirmed_transactions_mutex);\n \n     /**\n-     * Filter for transactions that were recently rejected by the mempool.\n-     * These are not rerequested until the chain tip changes, at which point\n-     * the entire filter is reset.\n+     * Filter for transactions that were recently rejected by the mempool for reasons other than too\n+     * low fee. This filter only contains wtxids and txids of individual transactions.\n+     *\n+     * Upon receiving an announcement for a transaction, if it exists in this filter, do not\n+     * download the txdata. Upon receiving a package info, if it contains a transaction in this\n+     * filter, do not download the tx data.",
      "path": "src/net_processing.cpp",
      "position": 109,
      "original_position": 109,
      "commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "original_commit_id": "2614777aa14f232f74cad18af44f7c6509a61528",
      "in_reply_to_id": null,
      "user": {
        "login": "ariard",
        "id": 23310655,
        "node_id": "MDQ6VXNlcjIzMzEwNjU1",
        "avatar_url": "https://avatars.githubusercontent.com/u/23310655?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ariard",
        "html_url": "https://github.com/ariard",
        "followers_url": "https://api.github.com/users/ariard/followers",
        "following_url": "https://api.github.com/users/ariard/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ariard/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ariard/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ariard/subscriptions",
        "organizations_url": "https://api.github.com/users/ariard/orgs",
        "repos_url": "https://api.github.com/users/ariard/repos",
        "events_url": "https://api.github.com/users/ariard/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ariard/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think it can say do not download \"the whole package data\", if this is referencing to the check L4415 in `src/net_processing.cpp` as pkg info itself is discarded.",
      "created_at": "2023-09-18T16:56:34Z",
      "updated_at": "2023-09-18T16:58:12Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/27742#discussion_r1329033501",
      "author_association": "NONE",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1329033501"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/27742"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 813,
      "original_line": 813,
      "side": "RIGHT"
    }
  ]
}