{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118",
    "id": 1872042659,
    "node_id": "PR_kwDOABII585vlRqj",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/30118",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/30118.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/30118.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30118",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30118/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/6629d1d0f8285d1bf2d87341a856abe903f26c13",
    "number": 30118,
    "state": "closed",
    "locked": true,
    "maintainer_can_modify": false,
    "title": "test: improve robustness of connect_nodes()",
    "user": {
      "login": "furszy",
      "id": 5377650,
      "node_id": "MDQ6VXNlcjUzNzc2NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/furszy",
      "html_url": "https://github.com/furszy",
      "followers_url": "https://api.github.com/users/furszy/followers",
      "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
      "organizations_url": "https://api.github.com/users/furszy/orgs",
      "repos_url": "https://api.github.com/users/furszy/repos",
      "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/furszy/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Decoupled from #27837 because this can help other too, found it investigating a CI failure https://cirrus-ci.com/task/5805115213348864?logs=ci#L3200.\r\n\r\nThe `connect_nodes` function in the test framework relies on a stable number of peer\r\nconnections to verify that the new connection between the nodes is successfully established.\r\nThis approach is fragile, as any of the peers involved in the process can drop, lose, or\r\ncreate a connection at any step, causing subsequent `wait_until` checks to stall indefinitely\r\neven when the peers in question were connected successfully.\r\n\r\nThis commit improves the situation by using the nodes' subversion and the connection\r\ndirection (inbound/outbound) to identify the exact peer connection and perform the\r\nchecks exclusively on it.",
    "labels": [
      {
        "id": 62963516,
        "node_id": "MDU6TGFiZWw2Mjk2MzUxNg==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/Tests",
        "name": "Tests",
        "color": "d4c5f9",
        "default": false
      }
    ],
    "created_at": "2024-05-15T20:58:22Z",
    "updated_at": "2025-06-09T06:15:03Z",
    "closed_at": "2024-05-23T14:00:52Z",
    "mergeable_state": "unknown",
    "merged": true,
    "merged_at": "2024-05-23T14:00:52Z",
    "merged_by": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "merge_commit_sha": "e163d864d380956a4c0f89a4d80a76f5aefc9a08",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "head": {
      "label": "furszy:2024_test_improve_connect_nodes",
      "ref": "2024_test_improve_connect_nodes",
      "sha": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 143624913,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNDM2MjQ5MTM=",
        "name": "bitcoin-core",
        "full_name": "furszy/bitcoin-core",
        "owner": {
          "login": "furszy",
          "id": 5377650,
          "node_id": "MDQ6VXNlcjUzNzc2NTA=",
          "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/furszy",
          "html_url": "https://github.com/furszy",
          "followers_url": "https://api.github.com/users/furszy/followers",
          "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
          "organizations_url": "https://api.github.com/users/furszy/orgs",
          "repos_url": "https://api.github.com/users/furszy/repos",
          "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/furszy/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/furszy/bitcoin-core",
        "description": "Bitcoin-Core",
        "fork": true,
        "url": "https://api.github.com/repos/furszy/bitcoin-core",
        "archive_url": "https://api.github.com/repos/furszy/bitcoin-core/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/furszy/bitcoin-core/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/furszy/bitcoin-core/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/furszy/bitcoin-core/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/furszy/bitcoin-core/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/furszy/bitcoin-core/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/furszy/bitcoin-core/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/furszy/bitcoin-core/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/furszy/bitcoin-core/contributors",
        "deployments_url": "https://api.github.com/repos/furszy/bitcoin-core/deployments",
        "downloads_url": "https://api.github.com/repos/furszy/bitcoin-core/downloads",
        "events_url": "https://api.github.com/repos/furszy/bitcoin-core/events",
        "forks_url": "https://api.github.com/repos/furszy/bitcoin-core/forks",
        "git_commits_url": "https://api.github.com/repos/furszy/bitcoin-core/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/furszy/bitcoin-core/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/furszy/bitcoin-core/git/tags%7B/sha%7D",
        "git_url": "git://github.com/furszy/bitcoin-core.git",
        "issue_comment_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/furszy/bitcoin-core/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/furszy/bitcoin-core/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/furszy/bitcoin-core/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/furszy/bitcoin-core/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/furszy/bitcoin-core/languages",
        "merges_url": "https://api.github.com/repos/furszy/bitcoin-core/merges",
        "milestones_url": "https://api.github.com/repos/furszy/bitcoin-core/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/furszy/bitcoin-core/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/furszy/bitcoin-core/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/furszy/bitcoin-core/releases%7B/id%7D",
        "ssh_url": "git@github.com:furszy/bitcoin-core.git",
        "stargazers_url": "https://api.github.com/repos/furszy/bitcoin-core/stargazers",
        "statuses_url": "https://api.github.com/repos/furszy/bitcoin-core/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/furszy/bitcoin-core/subscribers",
        "subscription_url": "https://api.github.com/repos/furszy/bitcoin-core/subscription",
        "tags_url": "https://api.github.com/repos/furszy/bitcoin-core/tags",
        "teams_url": "https://api.github.com/repos/furszy/bitcoin-core/teams",
        "trees_url": "https://api.github.com/repos/furszy/bitcoin-core/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/furszy/bitcoin-core.git",
        "hooks_url": "https://api.github.com/repos/furszy/bitcoin-core/hooks",
        "svn_url": "https://github.com/furszy/bitcoin-core",
        "homepage": "",
        "language": "C++",
        "forks_count": 3,
        "stargazers_count": 6,
        "watchers_count": 6,
        "size": 427322,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-06T20:33:00Z",
        "created_at": "2018-08-05T15:28:43Z",
        "updated_at": "2025-05-21T08:37:58Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "a786fd2041913d82ca90b561de309421bd24e41b",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37327,
        "stargazers_count": 84041,
        "watchers_count": 84041,
        "size": 283350,
        "default_branch": "master",
        "open_issues_count": 750,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-06-06T22:31:56Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-06-09T06:53:32Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 20,
    "deletions": 9,
    "changed_files": 2,
    "commits": 1,
    "review_comments": 35,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2113445276,
      "node_id": "IC_kwDOABII5859-J2c",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2113445276",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-15T20:58:25Z",
      "updated_at": "2024-05-23T13:56:01Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage\nFor detailed information about the code coverage, see the [test coverage report](https://corecheck.dev/bitcoin/bitcoin/pulls/30118).\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [maflcko](https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2068926018), [AngusP](https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2069197384), [stratospher](https://github.com/bitcoin/bitcoin/pull/30118#issuecomment-2124125832), [achow101](https://github.com/bitcoin/bitcoin/pull/30118#issuecomment-2125651180) |\n| Stale ACK | [rkrux](https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2060988698) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#27837](https://github.com/bitcoin/bitcoin/pull/27837) (net: introduce block tracker to retry to download blocks after failure by furszy)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#issuecomment-2113445276",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30118"
    },
    {
      "event": "labeled",
      "id": 12823651321,
      "node_id": "LE_lADOABII586JBWMhzwAAAAL8WWP5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12823651321",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-15T20:58:28Z",
      "label": {
        "name": "Tests",
        "color": "d4c5f9"
      }
    },
    {
      "event": "reviewed",
      "id": 2060988698,
      "node_id": "PRR_kwDOABII58562DEa",
      "url": null,
      "actor": null,
      "commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK [59ba873](https://github.com/bitcoin/bitcoin/pull/30118/commits/59ba8735102aebd456bb9dc831759c82e95763c0)\r\n\r\nMake successful, so are all the functional tests.\r\n\r\nOverall I agree with this change because it makes the nodes connection verification dependent more on `connect_nodes()` arguments `a, b` instead of the earlier approach that relied more on the state of the whole response of `getpeerinfo()`, which seemed brittle as mentioned in the PR description.\r\n\r\nI can see `connect_nodes()` being used in numerous functional tests, thereby increasing robustness for all of them!\r\n\r\n@furszy Were you able to identify few connections that were dropped in logs of this CI run? https://cirrus-ci.com/task/5805115213348864?logs=ci#L3200",
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2060988698",
      "submitted_at": "2024-05-16T14:37:54Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "reviewed",
      "id": 2061247415,
      "node_id": "PRR_kwDOABII58563CO3",
      "url": null,
      "actor": null,
      "commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "> @furszy Were you able to identify few connections that were dropped in logs of this CI run? https://cirrus-ci.com/task/5805115213348864?logs=ci#L3200\r\n\r\nJust one. One of the `P2PInterface` connections I create on the test side gets disconnected after advancing the node time prior to connecting the test nodes again. Need to expand the complete CI logs to find it.\r\nBut the fragility is easy to reproduce. Just launch a thread that disconnects a node before calling `connect_nodes()`. ",
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2061247415",
      "submitted_at": "2024-05-16T16:19:53Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "reviewed",
      "id": 2063691972,
      "node_id": "PRR_kwDOABII5857AXDE",
      "url": null,
      "actor": null,
      "commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2063691972",
      "submitted_at": "2024-05-17T15:09:36Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12855984709,
      "node_id": "HRFPE_lADOABII586JBWMhzwAAAAL-RsJF",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12855984709",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e9cb1168d144e4f49025b16f472827a9b4e02ca1",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/e9cb1168d144e4f49025b16f472827a9b4e02ca1",
      "created_at": "2024-05-18T14:02:32Z"
    },
    {
      "event": "reviewed",
      "id": 2064946909,
      "node_id": "PRR_kwDOABII5857FJbd",
      "url": null,
      "actor": null,
      "commit_id": "e9cb1168d144e4f49025b16f472827a9b4e02ca1",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Approach ACK, some nits/questions\r\n\r\nTested, functional tests all pass",
      "user": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2064946909",
      "submitted_at": "2024-05-18T20:35:32Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12857036528,
      "node_id": "HRFPE_lADOABII586JBWMhzwAAAAL-Vs7w",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12857036528",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "created_at": "2024-05-18T22:07:12Z"
    },
    {
      "event": "reviewed",
      "id": 2065044318,
      "node_id": "PRR_kwDOABII5857FhNe",
      "url": null,
      "actor": null,
      "commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tACK f4c588c98f163e9fa9083821ba36e1053f8c1496\r\n\r\nTested, functional tests all pass",
      "user": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2065044318",
      "submitted_at": "2024-05-19T10:28:31Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "review_requested",
      "id": 12858094849,
      "node_id": "RRE_lADOABII586JBWMhzwAAAAL-ZvUB",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12858094849",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-19T10:28:34Z",
      "requested_reviewer": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2065078997,
      "node_id": "PRR_kwDOABII5857FprV",
      "url": null,
      "actor": null,
      "commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "tested ACK f4c588c9.\r\n\r\nvery cool! i like how the logic depends only on the node we're connecting to.\r\nreproduced the intermittent failure using this patch and verified that the new logic fixes it!\r\n\r\n        self.nodes[0].add_p2p_connection(P2PInterface(), send_version=False, wait_for_verack=False)\r\n        self.connect_nodes(0, 2)\r\n\r\nalso didn't observe that much of a time increase (only around 70 s) when running all the functional tests in my local config (without wallets).",
      "user": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2065078997",
      "submitted_at": "2024-05-19T13:35:45Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "reviewed",
      "id": 2067648103,
      "node_id": "PRR_kwDOABII5857Pc5n",
      "url": null,
      "actor": null,
      "commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2067648103",
      "submitted_at": "2024-05-21T06:28:00Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "reviewed",
      "id": 2067649776,
      "node_id": "PRR_kwDOABII5857PdTw",
      "url": null,
      "actor": null,
      "commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2067649776",
      "submitted_at": "2024-05-21T06:29:04Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "commented",
      "id": 2121847793,
      "node_id": "IC_kwDOABII585-eNPx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2121847793",
      "actor": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-21T06:30:31Z",
      "updated_at": "2024-05-21T06:30:31Z",
      "author_association": "MEMBER",
      "body": "> This approach is fragile, as any of the peers involved in the process can drop, lose, or\r\n> create a connection at any step, causing subsequent `wait_until` checks to stall indefinitely\r\n> even when the peers in question were connected successfully.\r\n\r\nI'd say the tests should avoid racy code and deterministically execute the test code line-by-line, but enforcing this in `connect_nodes` is the wrong approach. So Concept ACK.",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#issuecomment-2121847793",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30118"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDY2MjlkMWQwZjgyODVkMWJmMmQ4NzM0MWE4NTZhYmU5MDNmMjZjMTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "tree": {
        "sha": "184cfd6d8ff787e041e4e8ce604251a7948779a8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/184cfd6d8ff787e041e4e8ce604251a7948779a8"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 184cfd6d8ff787e041e4e8ce604251a7948779a8\nparent 71f0f2273f6258e466c7b299c11982b4a04ae0d7\nauthor furszy <matiasfurszyfer@protonmail.com> 1715805181 -0300\ncommitter furszy <matiasfurszyfer@protonmail.com> 1716299924 -0300\n\ntest: improve robustness of connect_nodes()\n\nThe 'connect_nodes' function in the test framework relies\non a stable number of peer connections to verify the new\nconnection between the nodes is successfully established.\nThis approach is fragile, as any of the peers involved in\nthe process can drop, lose, or create a connection at any\nstep, causing subsequent 'wait_until' checks to stall\nindefinitely even when the peers in question are connected\nsuccessfully.\n\nThis commit improves the situation by using the nodes' subversion\nand the connection direction (inbound/outbound) to identify the\nexact peer connection and perform the checks exclusively on it.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEA++0fqwRHQpmlZfQXdI8zGhqpiMFAmZMqJQACgkQXdI8zGhq\npiNGaA/5AcXWutp8y5nYlIRBOVJNgA/n3zZZRRRNsTSz/XFKiYZkGuNcMyuy9nsd\nGKV0/jy/HvlAbUOOZ4L5EQO82HecYRQ+VenWrE9g4m6RNUffU8Ej1SAfKq32B8SL\nhguoY887EiUfwhM8+m/vrKdjQ4nB5NCzggc6zi7rSTqYGO/VSGFYoFwdEItHwyRW\nrd7v8BSTeJQz7WClJ4vTIKi3ByG/7oUPDkNof7j++QRhexQdLhZsmnkItm9qHKok\n3KvUZoRNPTc92DgVI8GH+8QYSoRK95LNjuVWBvST+eR5XmUbkUuS3DVnrb41Wt1X\nVG1MJuW0rgSZMV44fETfdegv93qJFxjlJz2v8z1xDxM54FkufdEhGgulrZNyM16h\nQ3jXDo6qItCNOKgc1cIVBvQtOJB65VPi0HLS2gvJKZEaQKGqH5s5l5jsQ5BgfWmV\nd3Pt76QImWJbk4vojUhEXi+To1bk0QIGAP+aVC3ICASE5NvkKzOxGng4eVpuN3gw\nD8lC4nn5nzgECzJW5/zylG7Y79l2BKO9Ut6ezTJl++VT+p/6IFapEXKEFfIc43YB\nHSjX+tA5NLyVhZolmMAPWC01dre/plR+6MxT9cyMdEz03fqkVB4+h1wKuDh0du+5\nTzIvVcPwgfWErVGifiw9+Y12rnf/EzAEre/x+h/0H6QmzEU7EAk=\n=AOak\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/71f0f2273f6258e466c7b299c11982b4a04ae0d7",
          "sha": "71f0f2273f6258e466c7b299c11982b4a04ae0d7",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/71f0f2273f6258e466c7b299c11982b4a04ae0d7"
        }
      ],
      "message": "test: improve robustness of connect_nodes()\n\nThe 'connect_nodes' function in the test framework relies\non a stable number of peer connections to verify the new\nconnection between the nodes is successfully established.\nThis approach is fragile, as any of the peers involved in\nthe process can drop, lose, or create a connection at any\nstep, causing subsequent 'wait_until' checks to stall\nindefinitely even when the peers in question are connected\nsuccessfully.\n\nThis commit improves the situation by using the nodes' subversion\nand the connection direction (inbound/outbound) to identify the\nexact peer connection and perform the checks exclusively on it.",
      "committer": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-05-21T13:58:44Z"
      },
      "author": {
        "name": "furszy",
        "email": "matiasfurszyfer@protonmail.com",
        "date": "2024-05-15T20:33:01Z"
      },
      "sha": "6629d1d0f8285d1bf2d87341a856abe903f26c13"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 12880709689,
      "node_id": "HRFPE_lADOABII586JBWMhzwAAAAL_wAg5",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12880709689",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "commit_url": "https://api.github.com/repos/furszy/bitcoin-core/commits/6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "created_at": "2024-05-21T13:59:12Z"
    },
    {
      "event": "reviewed",
      "id": 2068926018,
      "node_id": "PRR_kwDOABII5857UU5C",
      "url": null,
      "actor": null,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "commit_url": null,
      "created_at": null,
      "author_association": "MEMBER",
      "body": "utACK 6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2068926018",
      "submitted_at": "2024-05-21T15:21:28Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "review_requested",
      "id": 12881819275,
      "node_id": "RRE_lADOABII586JBWMhzwAAAAL_0PaL",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12881819275",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-21T15:21:31Z",
      "requested_reviewer": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 12881819429,
      "node_id": "RRE_lADOABII586JBWMhzwAAAAL_0Pcl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12881819429",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-21T15:21:32Z",
      "requested_reviewer": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "reviewed",
      "id": 2069197384,
      "node_id": "PRR_kwDOABII5857VXJI",
      "url": null,
      "actor": null,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "re-ACK 6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "user": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#pullrequestreview-2069197384",
      "submitted_at": "2024-05-21T17:59:57Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
    },
    {
      "event": "commented",
      "id": 2124125832,
      "node_id": "IC_kwDOABII585-m5aI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2124125832",
      "actor": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-22T08:01:31Z",
      "updated_at": "2024-05-22T08:01:31Z",
      "author_association": "CONTRIBUTOR",
      "body": "reACK 6629d1d.",
      "user": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#issuecomment-2124125832",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30118"
    },
    {
      "event": "commented",
      "id": 2125651180,
      "node_id": "IC_kwDOABII585-stzs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2125651180",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-22T20:02:42Z",
      "updated_at": "2024-05-22T20:02:42Z",
      "author_association": "MEMBER",
      "body": "ACK 6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#issuecomment-2125651180",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/30118"
    },
    {
      "event": "merged",
      "id": 12910055840,
      "node_id": "ME_lADOABII586JBWMhzwAAAAMBf9Gg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12910055840",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e163d864d380956a4c0f89a4d80a76f5aefc9a08",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e163d864d380956a4c0f89a4d80a76f5aefc9a08",
      "created_at": "2024-05-23T14:00:52Z"
    },
    {
      "event": "closed",
      "id": 12910055902,
      "node_id": "CE_lADOABII586JBWMhzwAAAAMBf9He",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12910055902",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T14:00:52Z"
    },
    {
      "event": "head_ref_deleted",
      "id": 12910199424,
      "node_id": "HRDE_lADOABII586JBWMhzwAAAAMBggKA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/12910199424",
      "actor": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-05-23T14:10:24Z"
    },
    {
      "event": "referenced",
      "id": 14502661654,
      "node_id": "REFE_lADOABII586JBWMhzwAAAANgbQ4W",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14502661654",
      "actor": {
        "login": "UdjinM6",
        "id": 1935069,
        "node_id": "MDQ6VXNlcjE5MzUwNjk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1935069?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/UdjinM6",
        "html_url": "https://github.com/UdjinM6",
        "followers_url": "https://api.github.com/users/UdjinM6/followers",
        "following_url": "https://api.github.com/users/UdjinM6/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/UdjinM6/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/UdjinM6/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/UdjinM6/subscriptions",
        "organizations_url": "https://api.github.com/users/UdjinM6/orgs",
        "repos_url": "https://api.github.com/users/UdjinM6/repos",
        "events_url": "https://api.github.com/users/UdjinM6/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/UdjinM6/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "2c825b4b4a21d8d7d8f4be09c678761352313b37",
      "commit_url": "https://api.github.com/repos/UdjinM6/dash/commits/2c825b4b4a21d8d7d8f4be09c678761352313b37",
      "created_at": "2024-10-03T11:04:51Z"
    },
    {
      "event": "referenced",
      "id": 14510658970,
      "node_id": "REFE_lADOABII586JBWMhzwAAAANg5xWa",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14510658970",
      "actor": {
        "login": "kwvg",
        "id": 63189531,
        "node_id": "MDQ6VXNlcjYzMTg5NTMx",
        "avatar_url": "https://avatars.githubusercontent.com/u/63189531?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/kwvg",
        "html_url": "https://github.com/kwvg",
        "followers_url": "https://api.github.com/users/kwvg/followers",
        "following_url": "https://api.github.com/users/kwvg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/kwvg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/kwvg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/kwvg/subscriptions",
        "organizations_url": "https://api.github.com/users/kwvg/orgs",
        "repos_url": "https://api.github.com/users/kwvg/repos",
        "events_url": "https://api.github.com/users/kwvg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/kwvg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e458adb61ce4ca557f45bc5b713f976676ee4f78",
      "commit_url": "https://api.github.com/repos/kwvg/dash/commits/e458adb61ce4ca557f45bc5b713f976676ee4f78",
      "created_at": "2024-10-03T21:40:52Z"
    },
    {
      "event": "referenced",
      "id": 14523707984,
      "node_id": "REFE_lADOABII586JBWMhzwAAAANhrjJQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/14523707984",
      "actor": {
        "login": "PastaPastaPasta",
        "id": 6443210,
        "node_id": "MDQ6VXNlcjY0NDMyMTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6443210?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/PastaPastaPasta",
        "html_url": "https://github.com/PastaPastaPasta",
        "followers_url": "https://api.github.com/users/PastaPastaPasta/followers",
        "following_url": "https://api.github.com/users/PastaPastaPasta/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/PastaPastaPasta/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/PastaPastaPasta/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/PastaPastaPasta/subscriptions",
        "organizations_url": "https://api.github.com/users/PastaPastaPasta/orgs",
        "repos_url": "https://api.github.com/users/PastaPastaPasta/repos",
        "events_url": "https://api.github.com/users/PastaPastaPasta/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/PastaPastaPasta/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "8cef87d81dc6b066f4330884e64daf22ea6adc97",
      "commit_url": "https://api.github.com/repos/dashpay/dash/commits/8cef87d81dc6b066f4330884e64daf22ea6adc97",
      "created_at": "2024-10-04T19:09:18Z"
    },
    {
      "event": "referenced",
      "id": 15247362570,
      "node_id": "REFE_lADOABII586JBWMhzwAAAAOM0EoK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15247362570",
      "actor": {
        "login": "panleone",
        "id": 22001825,
        "node_id": "MDQ6VXNlcjIyMDAxODI1",
        "avatar_url": "https://avatars.githubusercontent.com/u/22001825?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/panleone",
        "html_url": "https://github.com/panleone",
        "followers_url": "https://api.github.com/users/panleone/followers",
        "following_url": "https://api.github.com/users/panleone/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/panleone/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/panleone/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/panleone/subscriptions",
        "organizations_url": "https://api.github.com/users/panleone/orgs",
        "repos_url": "https://api.github.com/users/panleone/repos",
        "events_url": "https://api.github.com/users/panleone/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/panleone/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "e7c21c7e583280fae31dd562db6351030b4fd35b",
      "commit_url": "https://api.github.com/repos/panleone/PIVX/commits/e7c21c7e583280fae31dd562db6351030b4fd35b",
      "created_at": "2024-11-11T10:04:19Z"
    },
    {
      "event": "referenced",
      "id": 15309593162,
      "node_id": "REFE_lADOABII586JBWMhzwAAAAOQhdpK",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/15309593162",
      "actor": {
        "login": "Fuzzbawls",
        "id": 7393257,
        "node_id": "MDQ6VXNlcjczOTMyNTc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/7393257?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fuzzbawls",
        "html_url": "https://github.com/Fuzzbawls",
        "followers_url": "https://api.github.com/users/Fuzzbawls/followers",
        "following_url": "https://api.github.com/users/Fuzzbawls/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fuzzbawls/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fuzzbawls/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fuzzbawls/subscriptions",
        "organizations_url": "https://api.github.com/users/Fuzzbawls/orgs",
        "repos_url": "https://api.github.com/users/Fuzzbawls/repos",
        "events_url": "https://api.github.com/users/Fuzzbawls/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fuzzbawls/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "bf9617c2e27de972ecf435332d8946b752fbc0de",
      "commit_url": "https://api.github.com/repos/PIVX-Project/PIVX/commits/bf9617c2e27de972ecf435332d8946b752fbc0de",
      "created_at": "2024-11-15T09:11:54Z"
    },
    {
      "event": "referenced",
      "id": 16262886065,
      "node_id": "REFE_lADOABII586JBWMhzwAAAAPJV_Kx",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16262886065",
      "actor": {
        "login": "Fabcien",
        "id": 44533924,
        "node_id": "MDQ6VXNlcjQ0NTMzOTI0",
        "avatar_url": "https://avatars.githubusercontent.com/u/44533924?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Fabcien",
        "html_url": "https://github.com/Fabcien",
        "followers_url": "https://api.github.com/users/Fabcien/followers",
        "following_url": "https://api.github.com/users/Fabcien/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Fabcien/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Fabcien/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Fabcien/subscriptions",
        "organizations_url": "https://api.github.com/users/Fabcien/orgs",
        "repos_url": "https://api.github.com/users/Fabcien/repos",
        "events_url": "https://api.github.com/users/Fabcien/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Fabcien/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b8637fc6645baff8559fbf7abeaef495a3cc671f",
      "commit_url": "https://api.github.com/repos/Bitcoin-ABC/bitcoin-abc/commits/b8637fc6645baff8559fbf7abeaef495a3cc671f",
      "created_at": "2025-02-11T11:12:51Z"
    },
    {
      "event": "referenced",
      "id": 17502502431,
      "node_id": "REFE_lADOABII586JBWMhzwAAAAQTOv4f",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/17502502431",
      "actor": {
        "login": "roqqit",
        "id": 172419468,
        "node_id": "U_kgDOCkbpjA",
        "avatar_url": "https://avatars.githubusercontent.com/u/172419468?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/roqqit",
        "html_url": "https://github.com/roqqit",
        "followers_url": "https://api.github.com/users/roqqit/followers",
        "following_url": "https://api.github.com/users/roqqit/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/roqqit/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/roqqit/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/roqqit/subscriptions",
        "organizations_url": "https://api.github.com/users/roqqit/orgs",
        "repos_url": "https://api.github.com/users/roqqit/repos",
        "events_url": "https://api.github.com/users/roqqit/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/roqqit/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "adea33234e67e968c3d0e8a1a19664fce39e7c76",
      "commit_url": "https://api.github.com/repos/doged-io/doged/commits/adea33234e67e968c3d0e8a1a19664fce39e7c76",
      "created_at": "2025-05-02T16:53:28Z"
    },
    {
      "event": "locked",
      "id": 18049607235,
      "node_id": "LOE_lADOABII586JBWMhzwAAAAQz1yZD",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/18049607235",
      "actor": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-06-09T06:15:03Z"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603491415",
      "pull_request_review_id": 2060988698,
      "id": 1603491415,
      "node_id": "PRRC_kwDOABII585fk1ZX",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 15,
      "original_position": 15,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Looking at the sample output of `subversion` - `\"subversion\": \"\\/Satoshi:25.1.0\\/\"`, it doesn't seem unique enough because multiple nodes can be running the same version. Won't this cause issues in `find_conn` later?\r\n\r\nhttps://chainquery.com/bitcoin-cli/getnetworkinfo",
      "created_at": "2024-05-16T14:31:16Z",
      "updated_at": "2024-05-16T14:37:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1603491415",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603491415"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 629,
      "original_start_line": 629,
      "start_side": "RIGHT",
      "line": 630,
      "original_line": 630,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603498152",
      "pull_request_review_id": 2060988698,
      "id": 1603498152,
      "node_id": "PRRC_kwDOABII585fk3Co",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)\n+        self.wait_until(lambda: (peer := find_conn(to_connection, from_connection_subver, inbound=True)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29)\n+        self.wait_until(lambda: (peer := find_conn(to_connection, from_connection_subver, inbound=True)) is not None and peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": null,
      "original_position": 40,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": null,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`find_conn(from_connection, to_connection_subver, inbound=False)`\r\n\r\nMight as well make these calls once and store in variable instead of finding 3 times? Unless I'm missing something that requires these calls to be made every time. \r\n",
      "created_at": "2024-05-16T14:35:23Z",
      "updated_at": "2024-05-16T14:37:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1603498152",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603498152"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603654247",
      "pull_request_review_id": 2061247415,
      "id": 1603654247,
      "node_id": "PRRC_kwDOABII585fldJn",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 15,
      "original_position": 15,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1603491415,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Looking at the sample output of `subversion` - `\"subversion\": \"\\/Satoshi:25.1.0\\/\"`, it doesn't seem unique enough because multiple nodes can be running the same version. Won't this cause issues in `find_conn` later?\r\n\r\nThe test framework appends the node number to the user agent string. See [test_node](https://github.com/bitcoin/bitcoin/blob/2f53f2273da020d7fabd7c65a1bc7e69a31249b2/test/functional/test_framework/test_node.py#L109).",
      "created_at": "2024-05-16T16:02:53Z",
      "updated_at": "2024-05-16T16:19:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1603654247",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603654247"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 629,
      "original_start_line": 629,
      "start_side": "RIGHT",
      "line": 630,
      "original_line": 630,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603657305",
      "pull_request_review_id": 2061247415,
      "id": 1603657305,
      "node_id": "PRRC_kwDOABII585fld5Z",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)\n+        self.wait_until(lambda: (peer := find_conn(to_connection, from_connection_subver, inbound=True)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29)\n+        self.wait_until(lambda: (peer := find_conn(to_connection, from_connection_subver, inbound=True)) is not None and peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": null,
      "original_position": 40,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1603498152,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Might as well make these calls once and store in variable instead of finding 3 times? Unless I'm missing something that requires these calls to be made every time.\r\n\r\nThe code waits until the data arrives. These requires polling for updates.\r\nWe could couple the checks in this way:\r\n```python3\r\n self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None\r\n                                and peer['version'] != 0\r\n                                and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)\r\n```\r\n\r\nBut I'm a ~0 here because it would make debugging harder.",
      "created_at": "2024-05-16T16:05:19Z",
      "updated_at": "2024-05-16T16:19:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1603657305",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1603657305"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605161357",
      "pull_request_review_id": 2063691972,
      "id": 1605161357,
      "node_id": "PRRC_kwDOABII585frNGN",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": null,
      "original_position": 32,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Any reason to have a duplicate `None` check for `peer` at this point? Shouldn't it be enough to have the assert in the second-to-previous line?",
      "created_at": "2024-05-17T15:09:36Z",
      "updated_at": "2024-05-17T15:09:36Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605161357",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605161357"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 643,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605249634",
      "pull_request_review_id": 2063847531,
      "id": 1605249634,
      "node_id": "PRRC_kwDOABII585fripi",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": null,
      "original_position": 32,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1605161357,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Any reason to have a duplicate None check for peer at this point? Shouldn't it be enough to have the assert in the second-to-previous line?\r\n\r\nNot sure if I fully grasped the question but if the peer gets disconnected for some reason in-between these two checks, this wait_until call would throw an exception as the code would be trying to use the brackets operator on a `None` value to access the \"bytesrecv_per_msg\" value.",
      "created_at": "2024-05-17T16:09:27Z",
      "updated_at": "2024-05-17T16:09:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605249634",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605249634"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 643,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605724296",
      "pull_request_review_id": 2064660139,
      "id": 1605724296,
      "node_id": "PRRC_kwDOABII585ftWiI",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)\n+        self.wait_until(lambda: (peer := find_conn(to_connection, from_connection_subver, inbound=True)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29)\n+        self.wait_until(lambda: (peer := find_conn(to_connection, from_connection_subver, inbound=True)) is not None and peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": null,
      "original_position": 40,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1603498152,
      "user": {
        "login": "rkrux",
        "id": 5960750,
        "node_id": "MDQ6VXNlcjU5NjA3NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5960750?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/rkrux",
        "html_url": "https://github.com/rkrux",
        "followers_url": "https://api.github.com/users/rkrux/followers",
        "following_url": "https://api.github.com/users/rkrux/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/rkrux/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/rkrux/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/rkrux/subscriptions",
        "organizations_url": "https://api.github.com/users/rkrux/orgs",
        "repos_url": "https://api.github.com/users/rkrux/repos",
        "events_url": "https://api.github.com/users/rkrux/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/rkrux/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Hmm I see now what you mean.",
      "created_at": "2024-05-18T09:06:44Z",
      "updated_at": "2024-05-18T09:06:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605724296",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605724296"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": 648,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 649,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605724571",
      "pull_request_review_id": 2064660412,
      "id": 1605724571,
      "node_id": "PRRC_kwDOABII585ftWmb",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": null,
      "original_position": 32,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1605161357,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Sure, but then the test will fail regardless. Might as well fail early, if the peer disconnects again, no?",
      "created_at": "2024-05-18T09:09:20Z",
      "updated_at": "2024-05-18T09:09:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605724571",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605724571"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 643,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605795010",
      "pull_request_review_id": 2064765506,
      "id": 1605795010,
      "node_id": "PRRC_kwDOABII585ftnzC",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        self.wait_until(lambda: (peer := find_conn(from_connection, to_connection_subver, inbound=False)) is not None and peer['bytesrecv_per_msg'].pop('verack', 0) >= 21)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": null,
      "original_position": 32,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1605161357,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "ah ok, yeah. Now we are sync. Pushed. Thanks.",
      "created_at": "2024-05-18T14:03:53Z",
      "updated_at": "2024-05-18T14:03:53Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605795010",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605795010"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 643,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605892564",
      "pull_request_review_id": 2064946909,
      "id": 1605892564,
      "node_id": "PRRC_kwDOABII585ft_nU",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 15,
      "original_position": 15,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1603491415,
      "user": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Worth adding a note to the comment?\r\n\r\n```python\r\n        # Use subversion as peer id. Test nodes have their node number appended to the UA\r\n```",
      "created_at": "2024-05-18T20:26:07Z",
      "updated_at": "2024-05-18T20:35:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605892564",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605892564"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 629,
      "original_start_line": 629,
      "start_side": "RIGHT",
      "line": 630,
      "original_line": 630,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605893483",
      "pull_request_review_id": 2064946909,
      "id": 1605893483,
      "node_id": "PRRC_kwDOABII585ft_1r",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 21,
      "original_position": 21,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "e9cb1168d144e4f49025b16f472827a9b4e02ca1",
      "in_reply_to_id": null,
      "user": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This comment now doesn't really make sense to me?\r\n\r\nMaybe\r\n```suggestion\r\n        # wait until peers have completed a version handshake and so match the\r\n        # expected connection subversion\r\n```",
      "created_at": "2024-05-18T20:33:35Z",
      "updated_at": "2024-05-18T20:35:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605893483",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605893483"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 635,
      "original_start_line": 635,
      "start_side": "RIGHT",
      "line": 636,
      "original_line": 636,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605903225",
      "pull_request_review_id": 2064954523,
      "id": 1605903225,
      "node_id": "PRRC_kwDOABII585fuCN5",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 21,
      "original_position": 21,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "e9cb1168d144e4f49025b16f472827a9b4e02ca1",
      "in_reply_to_id": 1605893483,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> This comment now doesn't really make sense to me?\r\n\r\nWhy? the procedure behavior didn't change.\r\n",
      "created_at": "2024-05-18T22:06:13Z",
      "updated_at": "2024-05-18T22:07:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605903225",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605903225"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 635,
      "original_start_line": 635,
      "start_side": "RIGHT",
      "line": 636,
      "original_line": 636,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605903301",
      "pull_request_review_id": 2064954603,
      "id": 1605903301,
      "node_id": "PRRC_kwDOABII585fuCPF",
      "diff_hunk": "@@ -627,19 +625,28 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 15,
      "original_position": 15,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "59ba8735102aebd456bb9dc831759c82e95763c0",
      "in_reply_to_id": 1603491415,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Worth adding a note to the comment?\r\n> \r\n> ```python\r\n>         # Use subversion as peer id. Test nodes have their node number appended to the UA\r\n> ```\r\n\r\nsure. Pushed.",
      "created_at": "2024-05-18T22:07:19Z",
      "updated_at": "2024-05-18T22:07:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1605903301",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1605903301"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 629,
      "original_start_line": 629,
      "start_side": "RIGHT",
      "line": 630,
      "original_line": 630,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606000057",
      "pull_request_review_id": 2065045089,
      "id": 1606000057,
      "node_id": "PRRC_kwDOABII585fuZ25",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 21,
      "original_position": 21,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "e9cb1168d144e4f49025b16f472827a9b4e02ca1",
      "in_reply_to_id": 1605893483,
      "user": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think just the way it read with the old impl vs the new, \"waiting until we find a peer connection matching some predicate\" rather than \"wait until the peer has a non-zero version\" . But on second thoughts you're right it's not functionally different so disregard my suggestion",
      "created_at": "2024-05-19T10:33:02Z",
      "updated_at": "2024-05-19T10:33:02Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1606000057",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606000057"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 635,
      "original_start_line": 635,
      "start_side": "RIGHT",
      "line": 636,
      "original_line": 636,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606032360",
      "pull_request_review_id": 2065078997,
      "id": 1606032360,
      "node_id": "PRRC_kwDOABII585fuhvo",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 18,
      "original_position": 18,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": null,
      "user": {
        "login": "stratospher",
        "id": 44024636,
        "node_id": "MDQ6VXNlcjQ0MDI0NjM2",
        "avatar_url": "https://avatars.githubusercontent.com/u/44024636?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stratospher",
        "html_url": "https://github.com/stratospher",
        "followers_url": "https://api.github.com/users/stratospher/followers",
        "following_url": "https://api.github.com/users/stratospher/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stratospher/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stratospher/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stratospher/subscriptions",
        "organizations_url": "https://api.github.com/users/stratospher/orgs",
        "repos_url": "https://api.github.com/users/stratospher/repos",
        "events_url": "https://api.github.com/users/stratospher/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stratospher/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "wondering if we need the inbound check because an inbound and an outbound connection to the same `TestNode` isn't done. or did you keep it for assurance about the connection direction?",
      "created_at": "2024-05-19T13:26:03Z",
      "updated_at": "2024-05-19T13:35:45Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1606032360",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606032360"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 633,
      "original_line": 633,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606038839",
      "pull_request_review_id": 2065084248,
      "id": 1606038839,
      "node_id": "PRRC_kwDOABII585fujU3",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 18,
      "original_position": 18,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": 1606032360,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> wondering if we need the inbound check because an inbound and an outbound connection to the same `TestNode` isn't done. or did you keep it for assurance about the connection direction?\r\n\r\nBidirectional connections are allowed and quite common. E.g. in [p2p_disconnect_ban.py](https://github.com/bitcoin/bitcoin/blob/058af75874ffa2b4064e3d6d30cc50f0ec754ba8/test/functional/p2p_disconnect_ban.py#L117) or in [rpc_net.py](https://github.com/bitcoin/bitcoin/blob/058af75874ffa2b4064e3d6d30cc50f0ec754ba8/test/functional/rpc_net.py#L220).",
      "created_at": "2024-05-19T14:00:08Z",
      "updated_at": "2024-05-19T14:05:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1606038839",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606038839"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 633,
      "original_line": 633,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606039710",
      "pull_request_review_id": 2065084248,
      "id": 1606039710,
      "node_id": "PRRC_kwDOABII585fujie",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 21,
      "original_position": 21,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "e9cb1168d144e4f49025b16f472827a9b4e02ca1",
      "in_reply_to_id": 1605893483,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Ok. The \"version handshake\" wording refers to the complete initial negotiation round.\r\n(1) outbound send version, (2) inbound send version, (3) inbound send verack, (4) outbound send verack.",
      "created_at": "2024-05-19T14:05:24Z",
      "updated_at": "2024-05-19T14:05:52Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1606039710",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1606039710"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 635,
      "original_start_line": 635,
      "start_side": "RIGHT",
      "line": 636,
      "original_line": 636,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607712689",
      "pull_request_review_id": 2067648103,
      "id": 1607712689,
      "node_id": "PRRC_kwDOABII585f07-x",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'pong', 29))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'pong', 29))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 44,
      "original_position": 44,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "style-wise, I wonder if it makes sense to call wait_until and find_conn 6 times, when all logic could be put into a single function, which will be passed as a `lambda` to wait_until once.\r\n\r\nI guess this would mean slightly cleaner code, but would make it harder to see which part of the single function returned `False` when a failure happens. Though, debug logs could be added to help with that, if needed.\r\n\r\nWhat do you think?",
      "created_at": "2024-05-21T06:28:00Z",
      "updated_at": "2024-05-21T06:28:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1607712689",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607712689"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 653,
      "original_line": 653,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607713755",
      "pull_request_review_id": 2067649776,
      "id": 1607713755,
      "node_id": "PRRC_kwDOABII585f08Pb",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 13,
      "original_position": 13,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: Could add a comment to where the ID is set, to clarify that it is now required for `connect_nodes` to work?",
      "created_at": "2024-05-21T06:29:04Z",
      "updated_at": "2024-05-21T06:29:04Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1607713755",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1607713755"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 628,
      "original_line": 628,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608374619",
      "pull_request_review_id": 2068710919,
      "id": 1608374619,
      "node_id": "PRRC_kwDOABII585f3dlb",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'pong', 29))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'pong', 29))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 44,
      "original_position": 44,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": 1607712689,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> I guess this would mean slightly cleaner code, but would make it harder to see which part of the single function returned False when a failure happens. Though, debug logs could be added to help with that, if needed.\r\n>\r\n> What do you think?\r\n\r\nI don't think that the slightly cleaner code worth the extra debug logs noise we will get. These will be outputted even when peers connect successfully, so we would see some \"connect_nodes(): veracity msg hasn't arrived yet\" or \".. pong msg hasn't arrived yet\" lines regardless of the outcome. And this will be worst when peers take a bit of time to connect if we run valgrind or run it on a slow device.\r\n\r\nMaybe we could expand `wait_until` so that the provided function returns a message instead of a bool. This way, `wait_until` can print the detailed message at the end if the timeout is reached.",
      "created_at": "2024-05-21T13:51:18Z",
      "updated_at": "2024-05-21T13:51:19Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1608374619",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608374619"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 653,
      "original_line": 653,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608389058",
      "pull_request_review_id": 2068734302,
      "id": 1608389058,
      "node_id": "PRRC_kwDOABII585f3hHC",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 13,
      "original_position": 13,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": 1607713755,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "sure. Pushed.",
      "created_at": "2024-05-21T13:59:29Z",
      "updated_at": "2024-05-21T13:59:33Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1608389058",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608389058"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 628,
      "original_line": 628,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608506110",
      "pull_request_review_id": 2068920296,
      "id": 1608506110,
      "node_id": "PRRC_kwDOABII585f39r-",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'pong', 29))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'pong', 29))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 44,
      "original_position": 44,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": 1607712689,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> extra debug logs noise we will get.\r\n\r\nThe debug logs could be added when needed. There are already two log lines, so a third (when added) shouldn't matter too much, I'd say.\r\n\r\nFor example:\r\n\r\n```\r\n node1 2024-05-01T17:15:16.401946Z (mocktime: 2024-05-01T16:46:25Z) [httpworker.0] [rpc/request.cpp:187] [parse] [rpc] ThreadRPCServer method=getpeerinfo user=__cookie__ \r\n node1 2024-05-01T17:15:16.453092Z (mocktime: 2024-05-01T16:46:25Z) [http] [httpserver.cpp:306] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:47742 ",
      "created_at": "2024-05-21T15:11:31Z",
      "updated_at": "2024-05-21T15:11:31Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1608506110",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608506110"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 653,
      "original_line": 653,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608509648",
      "pull_request_review_id": 2068926018,
      "id": 1608509648,
      "node_id": "PRRC_kwDOABII585f3-jQ",
      "diff_hunk": "@@ -106,7 +106,7 @@ def __init__(self, i, datadir_path, *, chain, rpchost, timewait, timeout_factor,\n             \"-debugexclude=libevent\",\n             \"-debugexclude=leveldb\",\n             \"-debugexclude=rand\",\n-            \"-uacomment=testnode%d\" % i,\n+            \"-uacomment=testnode%d\" % i,  # required for subversion uniqueness across peers",
      "path": "test/functional/test_framework/test_node.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```suggestion\r\n            f\"-uacomment=testnode{i}\",  # required for subversion uniqueness across peers\r\n```\r\n\r\nstyle-nit, if you retouch",
      "created_at": "2024-05-21T15:13:59Z",
      "updated_at": "2024-05-21T15:21:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1608509648",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608509648"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 109,
      "original_line": 109,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608520104",
      "pull_request_review_id": 2068926018,
      "id": 1608520104,
      "node_id": "PRRC_kwDOABII585f4BGo",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": null,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: As you remove the `version` check, I wonder if this one can be removed as well for the same reason? The final `pong` test should be necessary and sufficient already. ",
      "created_at": "2024-05-21T15:20:50Z",
      "updated_at": "2024-05-21T15:21:28Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1608520104",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608520104"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608680140",
      "pull_request_review_id": 2069197384,
      "id": 1608680140,
      "node_id": "PRRC_kwDOABII585f4oLM",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 34,
      "original_position": 34,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": null,
      "user": {
        "login": "AngusP",
        "id": 1328814,
        "node_id": "MDQ6VXNlcjEzMjg4MTQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1328814?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/AngusP",
        "html_url": "https://github.com/AngusP",
        "followers_url": "https://api.github.com/users/AngusP/followers",
        "following_url": "https://api.github.com/users/AngusP/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/AngusP/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/AngusP/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/AngusP/subscriptions",
        "organizations_url": "https://api.github.com/users/AngusP/orgs",
        "repos_url": "https://api.github.com/users/AngusP/repos",
        "events_url": "https://api.github.com/users/AngusP/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/AngusP/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Style nit: Mixture of `'` and `\"` strings here and in a few places, though it was already mixed before -- `\"` seems to be the style in this file",
      "created_at": "2024-05-21T17:16:37Z",
      "updated_at": "2024-05-21T17:59:57Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1608680140",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1608680140"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": 644,
      "original_start_line": 644,
      "start_side": "RIGHT",
      "line": 645,
      "original_line": 645,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610019226",
      "pull_request_review_id": 2071309606,
      "id": 1610019226,
      "node_id": "PRRC_kwDOABII585f9vGa",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> nit: As you remove the `version` check, I wonder if this one can be removed as well for the same reason? The final `pong` test should be necessary and sufficient already.\r\n\r\nI removed the `version` check because `verack`s are direct responses to `version` messages at the protocol level. I'm not sure we should rely on the `pong` alone because that might change over time?",
      "created_at": "2024-05-22T13:58:59Z",
      "updated_at": "2024-05-22T13:59:00Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1610019226",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610019226"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610031890",
      "pull_request_review_id": 2071330587,
      "id": 1610031890,
      "node_id": "PRRC_kwDOABII585f9yMS",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'pong', 29))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'pong', 29))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 44,
      "original_position": 44,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": 1607712689,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> The debug logs could be added when needed. There are already two log lines, so a third (when added) shouldn't matter too much, I'd say.\r\n> \r\n> For example:\r\n> \r\n> ```\r\n>  node1 2024-05-01T17:15:16.401946Z (mocktime: 2024-05-01T16:46:25Z) [httpworker.0] [rpc/request.cpp:187] [parse] [rpc] ThreadRPCServer method=getpeerinfo user=__cookie__ \r\n>  node1 2024-05-01T17:15:16.453092Z (mocktime: 2024-05-01T16:46:25Z) [http] [httpserver.cpp:306] [http_request_cb] [http] Received a POST request for / from 127.0.0.1:47742 \r\n> ```\r\n\r\nHmm ok, a \"connect_nodes(), waiting for <xxxx>\" line could be useful then.\r\nIf we wrap all checks for both peers inside a single function, then on every failure, the function will re-execute some already passed checks once more. And to overcome this, we should keep a state of the connection. Which means more code (which is not bad, just the diff will be bigger).\r\nWill leave it for a follow-up just so we can move forward here. Maybe someone wants to tackle it later.",
      "created_at": "2024-05-22T14:05:20Z",
      "updated_at": "2024-05-22T14:05:20Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1610031890",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610031890"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 653,
      "original_line": 653,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610033578",
      "pull_request_review_id": 2071333493,
      "id": 1610033578,
      "node_id": "PRRC_kwDOABII585f9ymq",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> I'm not sure we should rely on the `pong` alone because that might change over time?\r\n\r\nIf it changes (for example the ping is sent before the verack), the test will already start to fail intermittently and will need to be adjusted anyway.\r\n\r\nSee the next line comment:\r\n\r\n```\r\n        # The message bytes are counted before processing the message, so make\r\n        # sure it was fully processed by waiting for a ping.",
      "created_at": "2024-05-22T14:06:15Z",
      "updated_at": "2024-05-22T14:06:16Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1610033578",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610033578"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610039510",
      "pull_request_review_id": 2071343383,
      "id": 1610039510,
      "node_id": "PRRC_kwDOABII585f90DW",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))\n+\n         # The message bytes are counted before processing the message, so make\n         # sure it was fully processed by waiting for a ping.\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer[\"bytesrecv_per_msg\"].pop(\"pong\", 0) >= 29 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'pong', 29))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'pong', 29))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 44,
      "original_position": 44,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "f4c588c98f163e9fa9083821ba36e1053f8c1496",
      "in_reply_to_id": 1607712689,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Yeah, sounds good to close this thread for now. ",
      "created_at": "2024-05-22T14:07:24Z",
      "updated_at": "2024-05-22T14:07:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1610039510",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610039510"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 653,
      "original_line": 653,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610554624",
      "pull_request_review_id": 2072208205,
      "id": 1610554624,
      "node_id": "PRRC_kwDOABII585f_x0A",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> > I'm not sure we should rely on the `pong` alone because that might change over time?\r\n> \r\n> If it changes (for example the ping is sent before the verack), the test will already start to fail intermittently and will need to be adjusted anyway.\r\n\r\nI don't think thats applicable here. We cannot freely change the initial negotiation phase (the version-verack window) without a BIP for the p2p protocol change. At the protocol level, only features negotiation messages are allowed in this phase. Any other received message will be ignored and it is a reason for banning the other party.\r\n\r\n> \r\n> See the next line comment:\r\n> \r\n> ```\r\n>         # The message bytes are counted before processing the message, so make\r\n>         # sure it was fully processed by waiting for a ping.\r\n> ```\r\n\r\nWhat about including the flag indicating that the connection is ready (`fSuccessfullyConnected`) in the `getpeerinfo` response? It seems generally useful and would clean up all this code.",
      "created_at": "2024-05-22T19:41:29Z",
      "updated_at": "2024-05-22T19:41:30Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1610554624",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610554624"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610572476",
      "pull_request_review_id": 2072237349,
      "id": 1610572476,
      "node_id": "PRRC_kwDOABII585f_2K8",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> > > I'm not sure we should rely on the `pong` alone because that might change over time?\r\n> > \r\n> > \r\n> > If it changes (for example the ping is sent before the verack), the test will already start to fail intermittently and will need to be adjusted anyway.\r\n> \r\n> I don't think thats applicable here. We cannot freely change the initial negotiation phase (the version-verack window) without a BIP for the p2p protocol change. At the protocol level, only features negotiation messages are allowed in this phase. Any other received message will be ignored and it is a reason for banning the other party.\r\n\r\nYes, that is what I am trying to say. The `pong` alone should be necessary and sufficient.",
      "created_at": "2024-05-22T19:58:31Z",
      "updated_at": "2024-05-22T19:58:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1610572476",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610572476"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610622809",
      "pull_request_review_id": 2072323979,
      "id": 1610622809,
      "node_id": "PRRC_kwDOABII585gACdZ",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> Yes, that is what I am trying to say. The pong alone should be necessary and sufficient.\r\n\r\nAh ok. \"goto the first message\".. now we are sync. Nice bikeshedding from my end.\r\n\r\nSo yeah, we could wait only for the `pong` or introduce a new field on the `getpeerinfo` output (`fSuccessfullyConnected` with another name like \"handshake_completed\").",
      "created_at": "2024-05-22T20:41:35Z",
      "updated_at": "2024-05-22T20:41:35Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1610622809",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1610622809"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611238787",
      "pull_request_review_id": 2073234568,
      "id": 1611238787,
      "node_id": "PRRC_kwDOABII585gCY2D",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think you'll have to tell maintainers if you want to address this nit, or leave it for a follow-up, otherwise they won't know whether it is fine to merge this from your side or not.",
      "created_at": "2024-05-23T08:26:02Z",
      "updated_at": "2024-05-23T08:26:03Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1611238787",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611238787"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611669887",
      "pull_request_review_id": 2073931453,
      "id": 1611669887,
      "node_id": "PRRC_kwDOABII585gECF_",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "furszy",
        "id": 5377650,
        "node_id": "MDQ6VXNlcjUzNzc2NTA=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5377650?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/furszy",
        "html_url": "https://github.com/furszy",
        "followers_url": "https://api.github.com/users/furszy/followers",
        "following_url": "https://api.github.com/users/furszy/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/furszy/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/furszy/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/furszy/subscriptions",
        "organizations_url": "https://api.github.com/users/furszy/orgs",
        "repos_url": "https://api.github.com/users/furszy/repos",
        "events_url": "https://api.github.com/users/furszy/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/furszy/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "> I think you'll have to tell maintainers if you want to address this nit, or leave it for a follow-up, otherwise they won't know whether it is fine to merge this from your side or not.\r\n\r\nok, yes. I was thinking on the second approach, but let's move forward. This will let me un-draft #27837. Happy to review any follow-up doing this.\r\nThanks Marko for the ping and this discussion.",
      "created_at": "2024-05-23T13:12:25Z",
      "updated_at": "2024-05-23T13:12:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1611669887",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1611669887"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1632236142",
      "pull_request_review_id": 2106143629,
      "id": 1632236142,
      "node_id": "PRRC_kwDOABII585hSfJu",
      "diff_hunk": "@@ -627,19 +625,32 @@ def connect_nodes(self, a, b, *, peer_advertises_v2=None, wait_for_connect: bool\n         if not wait_for_connect:\n             return\n \n+        # Use subversion as peer id. Test nodes have their node number appended to the user agent string\n+        from_connection_subver = from_connection.getnetworkinfo()['subversion']\n+        to_connection_subver = to_connection.getnetworkinfo()['subversion']\n+\n+        def find_conn(node, peer_subversion, inbound):\n+            return next(filter(lambda peer: peer['subver'] == peer_subversion and peer['inbound'] == inbound, node.getpeerinfo()), None)\n+\n         # poll until version handshake complete to avoid race conditions\n         # with transaction relaying\n         # See comments in net_processing:\n         # * Must have a version message before anything else\n         # * Must have a verack message before anything else\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['version'] != 0 for peer in to_connection.getpeerinfo()) == to_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in from_connection.getpeerinfo()) == from_num_peers)\n-        self.wait_until(lambda: sum(peer['bytesrecv_per_msg'].pop('verack', 0) >= 21 for peer in to_connection.getpeerinfo()) == to_num_peers)\n+        self.wait_until(lambda: find_conn(from_connection, to_connection_subver, inbound=False) is not None)\n+        self.wait_until(lambda: find_conn(to_connection, from_connection_subver, inbound=True) is not None)\n+\n+        def check_bytesrecv(peer, msg_type, min_bytes_recv):\n+            assert peer is not None, \"Error: peer disconnected\"\n+            return peer['bytesrecv_per_msg'].pop(msg_type, 0) >= min_bytes_recv\n+\n+        self.wait_until(lambda: check_bytesrecv(find_conn(from_connection, to_connection_subver, inbound=False), 'verack', 21))\n+        self.wait_until(lambda: check_bytesrecv(find_conn(to_connection, from_connection_subver, inbound=True), 'verack', 21))",
      "path": "test/functional/test_framework/test_framework.py",
      "position": 37,
      "original_position": 37,
      "commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "original_commit_id": "6629d1d0f8285d1bf2d87341a856abe903f26c13",
      "in_reply_to_id": 1608520104,
      "user": {
        "login": "maflcko",
        "id": 6399679,
        "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/maflcko",
        "html_url": "https://github.com/maflcko",
        "followers_url": "https://api.github.com/users/maflcko/followers",
        "following_url": "https://api.github.com/users/maflcko/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/maflcko/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/maflcko/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/maflcko/subscriptions",
        "organizations_url": "https://api.github.com/users/maflcko/orgs",
        "repos_url": "https://api.github.com/users/maflcko/repos",
        "events_url": "https://api.github.com/users/maflcko/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/maflcko/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done in https://github.com/bitcoin/bitcoin/pull/30252, also mentioning `fSuccessfullyConnected`. Feel free to NACK/ACK/nit.",
      "created_at": "2024-06-09T11:03:48Z",
      "updated_at": "2024-06-09T11:03:48Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/30118#discussion_r1632236142",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1632236142"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/30118"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 648,
      "original_line": 648,
      "side": "RIGHT"
    }
  ]
}