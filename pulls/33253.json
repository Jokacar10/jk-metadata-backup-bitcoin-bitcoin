{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253",
    "id": 2771272268,
    "node_id": "PR_kwDOABII586lLkJM",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/33253",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/33253.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/33253.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/b7b249d3adfbd3c7b0c4d0499a86300f57982972",
    "number": 33253,
    "state": "closed",
    "locked": false,
    "maintainer_can_modify": false,
    "title": "Revert compact block cache inefficiencies",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Reconstructing compact blocks is on the hot path for block relay, so revert changes from #28391 and #29752 that made it slower. Also add a benchmark to validate reconstruction performance, and a comment giving some background as to the approach.",
    "labels": [],
    "milestone": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/72",
      "html_url": "https://github.com/bitcoin/bitcoin/milestone/72",
      "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones/72/labels",
      "id": 12172984,
      "node_id": "MI_kwDOABII584Aub64",
      "number": 72,
      "state": "open",
      "title": "30.0",
      "description": "",
      "creator": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "open_issues": 13,
      "closed_issues": 73,
      "created_at": "2025-01-15T19:21:36Z",
      "updated_at": "2025-09-03T13:48:59Z"
    },
    "created_at": "2025-08-25T10:03:37Z",
    "updated_at": "2025-09-03T13:42:13Z",
    "closed_at": "2025-08-28T23:10:57Z",
    "mergeable_state": "unknown",
    "merged": true,
    "merged_at": "2025-08-28T23:10:57Z",
    "merged_by": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "merge_commit_sha": "7cc9a087069bfcdb79a08ce77eb3a60adf9483af",
    "assignees": [],
    "requested_reviewers": [
      {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      {
        "login": "polespinasa",
        "id": 57642229,
        "node_id": "MDQ6VXNlcjU3NjQyMjI5",
        "avatar_url": "https://avatars.githubusercontent.com/u/57642229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/polespinasa",
        "html_url": "https://github.com/polespinasa",
        "followers_url": "https://api.github.com/users/polespinasa/followers",
        "following_url": "https://api.github.com/users/polespinasa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/polespinasa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/polespinasa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/polespinasa/subscriptions",
        "organizations_url": "https://api.github.com/users/polespinasa/orgs",
        "repos_url": "https://api.github.com/users/polespinasa/repos",
        "events_url": "https://api.github.com/users/polespinasa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/polespinasa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    ],
    "requested_teams": [],
    "head": {
      "label": "ajtowns:202508-cache-friendly-compactblock",
      "ref": "202508-cache-friendly-compactblock",
      "sha": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 53941525,
        "node_id": "MDEwOlJlcG9zaXRvcnk1Mzk0MTUyNQ==",
        "name": "bitcoin",
        "full_name": "ajtowns/bitcoin",
        "owner": {
          "login": "ajtowns",
          "id": 127186,
          "node_id": "MDQ6VXNlcjEyNzE4Ng==",
          "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/ajtowns",
          "html_url": "https://github.com/ajtowns",
          "followers_url": "https://api.github.com/users/ajtowns/followers",
          "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
          "organizations_url": "https://api.github.com/users/ajtowns/orgs",
          "repos_url": "https://api.github.com/users/ajtowns/repos",
          "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/ajtowns/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/ajtowns/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/ajtowns/bitcoin",
        "archive_url": "https://api.github.com/repos/ajtowns/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/ajtowns/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/ajtowns/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/ajtowns/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/ajtowns/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/ajtowns/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/ajtowns/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/ajtowns/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/ajtowns/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/ajtowns/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/ajtowns/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/ajtowns/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/ajtowns/bitcoin/events",
        "forks_url": "https://api.github.com/repos/ajtowns/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/ajtowns/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/ajtowns/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/ajtowns/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/ajtowns/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/ajtowns/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/ajtowns/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/ajtowns/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/ajtowns/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/ajtowns/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/ajtowns/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/ajtowns/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/ajtowns/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/ajtowns/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/ajtowns/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/ajtowns/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:ajtowns/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/ajtowns/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/ajtowns/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/ajtowns/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/ajtowns/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/ajtowns/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/ajtowns/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/ajtowns/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/ajtowns/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/ajtowns/bitcoin/hooks",
        "svn_url": "https://github.com/ajtowns/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 3,
        "stargazers_count": 8,
        "watchers_count": 8,
        "size": 322245,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-09-01T07:26:27Z",
        "created_at": "2016-03-15T12:11:24Z",
        "updated_at": "2025-07-16T22:11:43Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "6ca6f3b37b992591726bd13b494369bee3bd6468",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 37699,
        "stargazers_count": 85327,
        "watchers_count": 85327,
        "size": 291847,
        "default_branch": "master",
        "open_issues_count": 763,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-09-03T10:19:34Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-09-03T13:35:45Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 166,
    "deletions": 28,
    "changed_files": 9,
    "commits": 3,
    "review_comments": 29,
    "comments": 15
  },
  "events": [
    {
      "event": "commented",
      "id": 3219628428,
      "node_id": "IC_kwDOABII586_56GM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3219628428",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:03:43Z",
      "updated_at": "2025-08-28T13:32:26Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/33253.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| ACK | [achow101](https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3225121798), [polespinasa](https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3225288108), [davidgumberg](https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3157177236), [cedwies](https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3233243613), [instagibbs](https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3164846536) |\n| Concept ACK | [l0rinc](https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3152574449) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#33191](https://github.com/bitcoin/bitcoin/pull/33191) (net: Provide block templates to peers on request by ajtowns)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n<!--5faf32d7da4f0f540f40219e4f7537a3-->",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3219628428",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "commented",
      "id": 3219632528,
      "node_id": "IC_kwDOABII586_57GQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3219632528",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:05:06Z",
      "updated_at": "2025-08-25T10:05:06Z",
      "author_association": "CONTRIBUTOR",
      "body": "On my dev machine with a release build, I see a 64% performance gain on the benchmark after the reversion patches are applied.\r\n\r\ncc @sipa @gmaxwell ",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3219632528",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "mentioned",
      "id": 19319104642,
      "node_id": "MEE_lADOABII587Hv5MWzwAAAAR_giSC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19319104642",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:05:08Z"
    },
    {
      "event": "subscribed",
      "id": 19319104687,
      "node_id": "SE_lADOABII587Hv5MWzwAAAAR_giSv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19319104687",
      "actor": {
        "login": "sipa",
        "id": 548488,
        "node_id": "MDQ6VXNlcjU0ODQ4OA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/sipa",
        "html_url": "https://github.com/sipa",
        "followers_url": "https://api.github.com/users/sipa/followers",
        "following_url": "https://api.github.com/users/sipa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/sipa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/sipa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
        "organizations_url": "https://api.github.com/users/sipa/orgs",
        "repos_url": "https://api.github.com/users/sipa/repos",
        "events_url": "https://api.github.com/users/sipa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/sipa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:05:08Z"
    },
    {
      "event": "mentioned",
      "id": 19319104716,
      "node_id": "MEE_lADOABII587Hv5MWzwAAAAR_giTM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19319104716",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:05:09Z"
    },
    {
      "event": "subscribed",
      "id": 19319104736,
      "node_id": "SE_lADOABII587Hv5MWzwAAAAR_giTg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19319104736",
      "actor": {
        "login": "gmaxwell",
        "id": 858454,
        "node_id": "MDQ6VXNlcjg1ODQ1NA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/gmaxwell",
        "html_url": "https://github.com/gmaxwell",
        "followers_url": "https://api.github.com/users/gmaxwell/followers",
        "following_url": "https://api.github.com/users/gmaxwell/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/gmaxwell/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/gmaxwell/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
        "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
        "repos_url": "https://api.github.com/users/gmaxwell/repos",
        "events_url": "https://api.github.com/users/gmaxwell/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:05:09Z"
    },
    {
      "event": "labeled",
      "id": 19319531989,
      "node_id": "LE_lADOABII587Hv5MWzwAAAAR_iKnV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19319531989",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:29:13Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "commented",
      "id": 3219706102,
      "node_id": "IC_kwDOABII586_6ND2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3219706102",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T10:29:16Z",
      "updated_at": "2025-08-25T10:29:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Task `ARM, unit tests, no functional tests`: https://github.com/bitcoin/bitcoin/runs/48805674537</sub>\n<sub>LLM reason (✨ experimental): The CI failure is caused by a segmentation fault in the bench_sanity_check test.</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3219706102",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19319704175,
      "node_id": "HRFPE_lADOABII587Hv5MWzwAAAAR_i0pv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19319704175",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "65af9be307d89a5e668e0c1a82d6f80cd7ea5ece",
      "commit_url": "https://api.github.com/repos/ajtowns/bitcoin/commits/65af9be307d89a5e668e0c1a82d6f80cd7ea5ece",
      "created_at": "2025-08-25T10:40:09Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19320773018,
      "node_id": "HRFPE_lADOABII587Hv5MWzwAAAAR_m5ma",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19320773018",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "0d474c5fb0878f4612655e3879609c78fc87157d",
      "commit_url": "https://api.github.com/repos/ajtowns/bitcoin/commits/0d474c5fb0878f4612655e3879609c78fc87157d",
      "created_at": "2025-08-25T11:47:59Z"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19321464676,
      "node_id": "HRFPE_lADOABII587Hv5MWzwAAAAR_pidk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19321464676",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "commit_url": "https://api.github.com/repos/ajtowns/bitcoin/commits/decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "created_at": "2025-08-25T12:27:06Z"
    },
    {
      "event": "unlabeled",
      "id": 19323554426,
      "node_id": "UNLE_lADOABII587Hv5MWzwAAAAR_xgp6",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19323554426",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T14:14:04Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "review_requested",
      "id": 19323884243,
      "node_id": "RRE_lADOABII587Hv5MWzwAAAAR_yxLT",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19323884243",
      "actor": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T14:30:08Z",
      "requested_reviewer": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "fanquake",
        "id": 863730,
        "node_id": "MDQ6VXNlcjg2MzczMA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/fanquake",
        "html_url": "https://github.com/fanquake",
        "followers_url": "https://api.github.com/users/fanquake/followers",
        "following_url": "https://api.github.com/users/fanquake/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/fanquake/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/fanquake/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
        "organizations_url": "https://api.github.com/users/fanquake/orgs",
        "repos_url": "https://api.github.com/users/fanquake/repos",
        "events_url": "https://api.github.com/users/fanquake/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/fanquake/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3220576303,
      "node_id": "IC_kwDOABII586_9hgv",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3220576303",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T14:41:28Z",
      "updated_at": "2025-08-25T14:41:28Z",
      "author_association": "MEMBER",
      "body": "related comment: https://github.com/bitcoin/bitcoin/pull/29752#issuecomment-3216827263\r\n",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3220576303",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "commented",
      "id": 3220639788,
      "node_id": "IC_kwDOABII586_9xAs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3220639788",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T14:59:00Z",
      "updated_at": "2025-08-25T15:28:50Z",
      "author_association": "MEMBER",
      "body": "Seems like a03aef9cec35b0d03aa63d7e8093f0420cd4b40b is the problematic commit for my machine? Doubles the runtime.\r\n\r\nBoth reverted:\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,955,234.00 |              511.45 |    2.1% |      0.02 | `BlockEncoding`\r\n\r\nNo reversions:\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        3,945,310.00 |              253.47 |    3.0% |      0.05 | `BlockEncoding`\r\n\r\na8203e94123b6ea6e4f4a6320e3ad20457f44a28 reverted only:\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        3,929,789.00 |              254.47 |    3.6% |      0.05 | `BlockEncoding`\r\n\r\na03aef9cec35b0d03aa63d7e8093f0420cd4b40b reverted only:\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,964,505.00 |              509.03 |    2.8% |      0.02 | `BlockEncoding`\r\n\r\nedit:\r\n\r\n> _aj_> instagibbs: re: 33253, the benchmark doesn't exercise a8203e9 -- it just passes an empty vector of extra transactions",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3220639788",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "reviewed",
      "id": 3152074460,
      "node_id": "PRR_kwDOABII58674Nbc",
      "url": null,
      "actor": null,
      "commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-25T15:55:38Z",
      "author_association": "MEMBER",
      "body": "ARM64 M1 Max (2022), macOS 15.6.1\r\n\r\nbenchmark only\r\n\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        2,643,000.00 |              378.36 |    1.5% |      0.03 | `BlockEncoding`\r\n```\r\n\r\nbenchmark with reversions (the difference is from the last commit, `Revert \"[refactor] rewrite vTxHashes as a vector of CTransactionRef`)\r\n\r\n```\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        2,268,791.00 |              440.76 |    1.1% |      0.03 | `BlockEncoding`\r\n```\r\n\r\n",
      "user": {
        "login": "jonatack",
        "id": 2415484,
        "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/jonatack",
        "html_url": "https://github.com/jonatack",
        "followers_url": "https://api.github.com/users/jonatack/followers",
        "following_url": "https://api.github.com/users/jonatack/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/jonatack/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/jonatack/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
        "organizations_url": "https://api.github.com/users/jonatack/orgs",
        "repos_url": "https://api.github.com/users/jonatack/repos",
        "events_url": "https://api.github.com/users/jonatack/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/jonatack/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3152074460",
      "submitted_at": "2025-08-25T15:53:42Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
    },
    {
      "event": "commented",
      "id": 3221526194,
      "node_id": "IC_kwDOABII587ABJay",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3221526194",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-25T19:44:39Z",
      "updated_at": "2025-08-25T20:01:54Z",
      "author_association": "MEMBER",
      "body": "> _aj_> instagibbs: re: 33253, the benchmark doesn't exercise [a8203e9](https://github.com/bitcoin/bitcoin/commit/a8203e94123b6ea6e4f4a6320e3ad20457f44a28) -- it just passes an empty vector of extra transactions\r\n\r\nCan we bench that? Maybe as a separate benchmark instead of having this one benchmark include both.",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3221526194",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "reviewed",
      "id": 3152574449,
      "node_id": "PRR_kwDOABII58676Hfx",
      "url": null,
      "actor": null,
      "commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-25T21:24:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK, excellent find.\r\n\r\nI redid the benchmarks, got more modest changes with GCC and Clang:\r\n\r\n<details>\r\n<summary>C++ compiler .......................... GNU 14.2.0</summary>\r\n\r\n```bash\r\necho \">  C++ compiler .......................... GNU $(gcc -dumpfullversion)\" && rm -rf build && cmake -B build -DBUILD_BENCH=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ >/dev/null 2>&1 && cmake --build build -j$(nproc) >/dev/null 2>&1 && build/bin/bench_bitcoin -filter='BlockEncoding' -min-time=5000 && build/bin/bench_bitcoin -filter='BlockEncoding' -min-time=5000 && build/bin/bench_bitcoin -filter='BlockEncoding' -min-time=5000\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>228.64 ops/s before</summary>\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        4,386,276.06 |              227.98 |    0.2% |   17,156,885.24 |   15,741,370.59 |  1.090 |   1,287,419.20 |    3.2% |      5.40 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        4,373,623.58 |              228.64 |    0.2% |   17,156,871.09 |   15,696,695.56 |  1.093 |   1,287,418.38 |    3.2% |      5.41 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        4,380,919.51 |              228.26 |    0.2% |   17,156,870.18 |   15,719,209.66 |  1.091 |   1,287,418.17 |    3.2% |      5.40 | `BlockEncoding`\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>315.60 ops/s after</summary>\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,168,586.91 |              315.60 |    0.1% |   17,156,847.31 |   11,378,141.35 |  1.508 |   1,287,390.88 |    3.2% |      5.29 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,241,851.00 |              308.47 |    0.2% |   17,156,842.43 |   11,640,138.08 |  1.474 |   1,287,385.26 |    3.2% |      5.29 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,173,445.04 |              315.11 |    0.1% |   17,156,847.31 |   11,394,621.15 |  1.506 |   1,287,390.88 |    3.2% |      5.28 | `BlockEncoding`\r\n\r\n</details>\r\n\r\ni.e. 38% improvement with gcc\r\n\r\n------\r\n\r\n<details>\r\n<summary>C++ compiler .......................... clang 20.1.7</summary>\r\n\r\n```C++\r\necho \">  C++ compiler .......................... clang $(clang -dumpversion)\" && rm -rf build && cmake -B build -DBUILD_BENCH=ON -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ >/dev/null 2>&1 && cmake --build build -j$(nproc) >/dev/null 2>&1 && build/bin/bench_bitcoin -filter='BlockEncoding' -min-time=5000 && build/bin/bench_bitcoin -filter='BlockEncoding' -min-time=5000 && build/bin/bench_bitcoin -filter='BlockEncoding' -min-time=5000\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>252.05 ops/s before</summary>\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,967,492.38 |              252.05 |    0.1% |   15,494,632.58 |   14,241,688.80 |  1.088 |   1,070,986.04 |    4.0% |      5.37 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,984,996.65 |              250.94 |    0.1% |   15,494,608.15 |   14,303,936.25 |  1.083 |   1,070,973.80 |    4.0% |      5.38 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        4,078,221.50 |              245.20 |    0.1% |   15,494,616.62 |   14,638,662.82 |  1.058 |   1,070,976.86 |    4.0% |      5.37 | `BlockEncoding`\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>326.06 ops/s after</summary>\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,066,879.10 |              326.06 |    0.0% |   15,497,664.10 |   11,011,637.17 |  1.407 |   1,070,979.09 |    4.0% |      5.28 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,135,228.99 |              318.96 |    0.1% |   15,497,665.21 |   11,253,673.49 |  1.377 |   1,070,979.81 |    4.0% |      5.29 | `BlockEncoding`\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        3,127,079.54 |              319.79 |    0.1% |   15,497,665.71 |   11,223,561.21 |  1.381 |   1,070,979.87 |    4.0% |      5.30 | `BlockEncoding`\r\n\r\n</details>\r\n\r\ni.e. 29% improvement for clang\r\n\r\n----\r\n\r\nSimilarly to other people before me, I think we could include a few more scenarios in the benchmark. I left a few suggestions explaining my suggestions, but it's probably easier if I post the final benchmark code here as well:\r\n\r\n<details>\r\n<summary>blockencodings.cpp</summary>\r\n\r\n```C++\r\n// Copyright (c) 2025-present The Bitcoin Core developers\r\n// Distributed under the MIT software license, see the accompanying\r\n// file COPYING or http://www.opensource.org/licenses/mit-license.php.\r\n\r\n#include <bench/bench.h>\r\n#include <blockencodings.h>\r\n#include <consensus/amount.h>\r\n#include <kernel/cs_main.h>\r\n#include <primitives/transaction.h>\r\n#include <script/script.h>\r\n#include <sync.h>\r\n#include <test/util/setup_common.h>\r\n#include <test/util/txmempool.h>\r\n#include <txmempool.h>\r\n#include <util/check.h>\r\n\r\n#include <memory>\r\n#include <unordered_set>\r\n#include <vector>\r\n#include <algorithm>\r\n\r\nstatic void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\r\n{\r\n    LockPoints lp;\r\n    AddToMempool(pool, CTxMemPoolEntry{tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp});\r\n}\r\n\r\nnamespace {\r\nCTransactionRef CreateTestTransaction(std::span<const std::byte> sigspam, size_t index)\r\n{\r\n    CMutableTransaction tx;\r\n    tx.vin.resize(1);\r\n    tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\r\n    tx.vin[0].scriptWitness.stack.push_back({1});\r\n    tx.vout.resize(1);\r\n    tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\r\n    tx.vout[0].nValue = index;\r\n    return MakeTransactionRef(tx);\r\n}\r\n\r\nCBlock DummyBlock()\r\n{\r\n    CBlock block;\r\n    block.nVersion = 5;\r\n    block.hashPrevBlock.SetNull();\r\n    block.hashMerkleRoot.SetNull();\r\n    block.nTime = 1231006505;\r\n    block.nBits = 0x1d00ffff;\r\n    block.nNonce = 2083236893;\r\n    block.fChecked = false;\r\n    CMutableTransaction tx;\r\n    tx.vin.resize(1);\r\n    tx.vout.resize(1);\r\n    block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\r\n    return block;\r\n}\r\n\r\nstruct BenchCBHAST : CBlockHeaderAndShortTxIDs\r\n{\r\n    BenchCBHAST(FastRandomContext& rng, int txs, bool duplicates) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\r\n    {\r\n        std::unordered_set<uint64_t> seen;\r\n        shorttxids.reserve(txs);\r\n        while (txs-- > 0) {\r\n            uint64_t id{rng.randbits<SHORTTXIDS_LENGTH * 8>()};\r\n            assert(seen.insert(id).second);\r\n            shorttxids.push_back(id);\r\n        }\r\n        if (duplicates) shorttxids.at(shorttxids.size() - 1) = shorttxids.at(0);\r\n    }\r\n};\r\n} // anon namespace\r\n\r\nstatic void BlockEncoding(benchmark::Bench& bench)\r\n{\r\n    constexpr size_t mempool_size{50'000}, sigspam_size{200}, extra_tx_count{10}, shortid_count{3'000};\r\n\r\n    const auto testing_setup{MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN)};\r\n    auto& pool{*Assert(testing_setup->m_node.mempool)};\r\n\r\n    FastRandomContext rng{/*fDeterministic=*/true};\r\n    const auto sigspam{rng.randbytes<sigspam_size>()};\r\n\r\n    LOCK2(cs_main, pool.cs);\r\n    std::vector<std::pair<Wtxid, CTransactionRef>> extra_txn;\r\n\r\n    {\r\n        // a reasonably large mempool of 50k txs, ~10MB total\r\n        std::vector<CTransactionRef> refs;\r\n        refs.reserve(mempool_size);\r\n        for (size_t i{0}; i < mempool_size; ++i) {\r\n            refs.emplace_back(CreateTestTransaction(sigspam, i));\r\n        }\r\n\r\n        // ensure mempool ordering is different to memory ordering of transactions,\r\n        // to simulate a mempool that has changed over time\r\n        std::ranges::shuffle(refs, rng);\r\n\r\n        extra_txn.reserve(extra_tx_count);\r\n        for (size_t i{0}; i < extra_tx_count; ++i) {\r\n            size_t index{i < (extra_tx_count / 2) ? mempool_size + i : mempool_size - i}; // some overlap with mempool\r\n            auto tx{CreateTestTransaction(sigspam, index)};\r\n            extra_txn.emplace_back(tx->GetWitnessHash(), tx);\r\n        }\r\n\r\n        for (const auto& tx : refs) {\r\n            AddTx(tx, /*fee=*/tx->vout[0].nValue, pool);\r\n        }\r\n    }\r\n\r\n    for (const auto duplicates : {false, true}) {\r\n        BenchCBHAST cmpctblock{rng, /*txs=*/shortid_count, duplicates};\r\n        for (const auto& extra : {extra_txn, std::vector<std::pair<Wtxid, CTransactionRef>>{}}) {\r\n            bench.name(strprintf(\"reconstructions %s%s\", extra.empty() ? \"without extra\" : \"with extra\", duplicates ? \" (dup)\" : \"\"))\r\n                 .run([&] {\r\n                     PartiallyDownloadedBlock pdb{&pool};\r\n                     const auto status{pdb.InitData(cmpctblock, extra)};\r\n                     assert(status == (duplicates ? READ_STATUS_FAILED : READ_STATUS_OK));\r\n                 });\r\n        }\r\n    }\r\n}\r\n\r\nBENCHMARK(BlockEncoding, benchmark::PriorityLevel::HIGH);\r\n\r\n```\r\n\r\n</details>\r\n\r\nEdit: what is the expected memory increase because of the change?\r\n",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3152574449",
      "submitted_at": "2025-08-25T21:15:24Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
    },
    {
      "event": "reviewed",
      "id": 3153218666,
      "node_id": "PRR_kwDOABII58678kxq",
      "url": null,
      "actor": null,
      "commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-25T23:10:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK\r\n\r\nNice catch\r\nNo reversions eb1920a82ffa2086c3e8e3e8946b9f43053455aa:\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        2,163,341.00 |              462.25 |    7.4% |      0.03 | `BlockEncoding`\r\n\r\n\r\nOnly f2b9cbed7196617880d177c089332e4fd48f28ca reverted\r\n\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        2,097,861.00 |              476.68 |    5.3% |      0.03 | `BlockEncoding`\r\n\r\n\r\nOnly decb48a607fb3911a25e5e8b37628a5e15b3ce17 reverted\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,727,394.00 |              578.91 |    2.4% |      0.02 | `BlockEncoding`\r\n\r\nBoth reverted\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,697,419.00 |              589.13 |    2.2% |      0.02 | `BlockEncoding`\r\n\r\n",
      "user": {
        "login": "polespinasa",
        "id": 57642229,
        "node_id": "MDQ6VXNlcjU3NjQyMjI5",
        "avatar_url": "https://avatars.githubusercontent.com/u/57642229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/polespinasa",
        "html_url": "https://github.com/polespinasa",
        "followers_url": "https://api.github.com/users/polespinasa/followers",
        "following_url": "https://api.github.com/users/polespinasa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/polespinasa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/polespinasa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/polespinasa/subscriptions",
        "organizations_url": "https://api.github.com/users/polespinasa/orgs",
        "repos_url": "https://api.github.com/users/polespinasa/repos",
        "events_url": "https://api.github.com/users/polespinasa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/polespinasa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3153218666",
      "submitted_at": "2025-08-25T23:10:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19334605616,
      "node_id": "HRFPE_lADOABII587Hv5MWzwAAAASAbqsw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19334605616",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "3aa3fc83e4d1edcf42c79872336842ff337402b6",
      "commit_url": "https://api.github.com/repos/ajtowns/bitcoin/commits/3aa3fc83e4d1edcf42c79872336842ff337402b6",
      "created_at": "2025-08-26T03:44:05Z"
    },
    {
      "event": "commented",
      "id": 3222540332,
      "node_id": "IC_kwDOABII587AFBAs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3222540332",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T04:06:15Z",
      "updated_at": "2025-08-26T04:06:15Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Can we bench that? Maybe as a separate benchmark instead of having this one benchmark include both.\r\n\r\nAdded benchmarks with 50k txs in mempool and 0, 100 (default), and 5000 entries in extra pool. For reference [datum](https://github.com/OCEAN-xyz/datum_gateway) recommends setting the value to 1M.",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3222540332",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "commented",
      "id": 3224827005,
      "node_id": "IC_kwDOABII587ANvR9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3224827005",
      "actor": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T16:05:24Z",
      "updated_at": "2025-08-26T16:05:24Z",
      "author_association": "MEMBER",
      "body": "Benchmarks now match expectation: each commit separately improves the benchmarks :heavy_check_mark: ",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3224827005",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "milestoned",
      "id": 19352271664,
      "node_id": "MIE_lADOABII587Hv5MWzwAAAASBfDsw",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19352271664",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T17:28:19Z",
      "milestone": {
        "title": "30.0"
      }
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRmNWE1MGU1ZGUyMDQwMTNiYTU2ZTFjNDk2N2EyNDljYTA3YmEwODY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/df5a50e5de204013ba56e1c4967a249ca07ba086",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/df5a50e5de204013ba56e1c4967a249ca07ba086",
      "tree": {
        "sha": "3d3aa56bcd08096bcc0031f513bc229047c80802",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3d3aa56bcd08096bcc0031f513bc229047c80802"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9703b7e6d563ea58f83a6eca819562365404f4ab",
          "sha": "9703b7e6d563ea58f83a6eca819562365404f4ab",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/9703b7e6d563ea58f83a6eca819562365404f4ab"
        }
      ],
      "message": "bench/blockencodings: add compact block reconstruction benchmark",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2025-08-26T17:33:32Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2025-08-25T07:32:45Z"
      },
      "sha": "df5a50e5de204013ba56e1c4967a249ca07ba086"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI5MzAwZDhkMGE3NGIxNWEyMjBhMmNlNTI5ZDUxNTdkMTA5YzdlZDM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9300d8d0a74b15a220a2ce529d5157d109c7ed3",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b9300d8d0a74b15a220a2ce529d5157d109c7ed3",
      "tree": {
        "sha": "43f465cfcfb2a6c8a8224204b273a7326ddc858b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/43f465cfcfb2a6c8a8224204b273a7326ddc858b"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/df5a50e5de204013ba56e1c4967a249ca07ba086",
          "sha": "df5a50e5de204013ba56e1c4967a249ca07ba086",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/df5a50e5de204013ba56e1c4967a249ca07ba086"
        }
      ],
      "message": "Revert \"refactor: Simplify `extra_txn` to be a vec of CTransactionRef instead of a vec of pair<Wtxid, CTransactionRef>\"\n\nThis reverts commit a8203e94123b6ea6e4f4a6320e3ad20457f44a28.",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2025-08-26T17:33:32Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2025-08-25T05:58:59Z"
      },
      "sha": "b9300d8d0a74b15a220a2ce529d5157d109c7ed3"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGI3YjI0OWQzYWRmYmQzYzdiMGM0ZDA0OTlhODYzMDBmNTc5ODI5NzI",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "tree": {
        "sha": "083003c988978f5a6b9d06d52dd7ff3ee9c41c49",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/083003c988978f5a6b9d06d52dd7ff3ee9c41c49"
      },
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "payload": null,
        "signature": null
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b9300d8d0a74b15a220a2ce529d5157d109c7ed3",
          "sha": "b9300d8d0a74b15a220a2ce529d5157d109c7ed3",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/b9300d8d0a74b15a220a2ce529d5157d109c7ed3"
        }
      ],
      "message": "Revert \"[refactor] rewrite vTxHashes as a vector of CTransactionRef\"\n\nThis reverts commit a03aef9cec35b0d03aa63d7e8093f0420cd4b40b.",
      "committer": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2025-08-26T17:33:32Z"
      },
      "author": {
        "name": "Anthony Towns",
        "email": "aj@erisian.com.au",
        "date": "2025-08-25T06:17:05Z"
      },
      "sha": "b7b249d3adfbd3c7b0c4d0499a86300f57982972"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 19352365499,
      "node_id": "HRFPE_lADOABII587Hv5MWzwAAAASBfam7",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19352365499",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "commit_url": "https://api.github.com/repos/ajtowns/bitcoin/commits/b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "created_at": "2025-08-26T17:33:47Z"
    },
    {
      "event": "commented",
      "id": 3225121798,
      "node_id": "IC_kwDOABII587AO3QG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3225121798",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T17:41:09Z",
      "updated_at": "2025-08-26T17:41:09Z",
      "author_association": "MEMBER",
      "body": "ACK b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "user": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3225121798",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "review_requested",
      "id": 19352486161,
      "node_id": "RRE_lADOABII587Hv5MWzwAAAASBf4ER",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19352486161",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T17:41:15Z",
      "requested_reviewer": {
        "login": "polespinasa",
        "id": 57642229,
        "node_id": "MDQ6VXNlcjU3NjQyMjI5",
        "avatar_url": "https://avatars.githubusercontent.com/u/57642229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/polespinasa",
        "html_url": "https://github.com/polespinasa",
        "followers_url": "https://api.github.com/users/polespinasa/followers",
        "following_url": "https://api.github.com/users/polespinasa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/polespinasa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/polespinasa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/polespinasa/subscriptions",
        "organizations_url": "https://api.github.com/users/polespinasa/orgs",
        "repos_url": "https://api.github.com/users/polespinasa/repos",
        "events_url": "https://api.github.com/users/polespinasa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/polespinasa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "review_requested",
      "id": 19352486524,
      "node_id": "RRE_lADOABII587Hv5MWzwAAAASBf4J8",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19352486524",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T17:41:17Z",
      "requested_reviewer": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "review_requester": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      }
    },
    {
      "event": "commented",
      "id": 3225128619,
      "node_id": "IC_kwDOABII587AO46r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3225128619",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T17:43:41Z",
      "updated_at": "2025-08-26T17:43:41Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Edit: what is the expected memory increase because of the change?\r\n\r\n32 bytes per mempool transaction and per extra txn (of which there are 100 by default).\r\n\r\nA 300MB mempool might fill up with about ~100k txs (at about 440vb each on average), which would be 3.2MB total. (The 3.2MB would not be an increase overall, but would rather cause earlier eviction from the mempool, ie a ~1% reduction in capacity)",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3225128619",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "commented",
      "id": 3225229760,
      "node_id": "IC_kwDOABII587APRnA",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3225229760",
      "actor": {
        "login": "janb84",
        "id": 608446,
        "node_id": "MDQ6VXNlcjYwODQ0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/608446?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janb84",
        "html_url": "https://github.com/janb84",
        "followers_url": "https://api.github.com/users/janb84/followers",
        "following_url": "https://api.github.com/users/janb84/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janb84/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janb84/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janb84/subscriptions",
        "organizations_url": "https://api.github.com/users/janb84/orgs",
        "repos_url": "https://api.github.com/users/janb84/repos",
        "events_url": "https://api.github.com/users/janb84/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janb84/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T18:16:11Z",
      "updated_at": "2025-08-26T18:16:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "I have done a review on the code and tried to understand what to look for, to improve my PR reviewing in the future. \r\nI'm missing some experience to give \"judgement\" on this PR.\r\n\r\nThe PR restores code to undo some \"optimisations\" that had a negative impact on the performance (restores caching ) and adds some extra benchmarks.\r\n\r\nresults of benchmarking this PR (both reverted):\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        2,546,375.00 |              392.72 |    1.9% |      0.03 | `BlockEncodingLargeExtra`\r\n|        2,414,458.00 |              414.17 |    4.1% |      0.03 | `BlockEncodingNoExtra`\r\n|        2,466,416.00 |              405.45 |    2.2% |      0.03 | `BlockEncodingStdExtra`",
      "user": {
        "login": "janb84",
        "id": 608446,
        "node_id": "MDQ6VXNlcjYwODQ0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/608446?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/janb84",
        "html_url": "https://github.com/janb84",
        "followers_url": "https://api.github.com/users/janb84/followers",
        "following_url": "https://api.github.com/users/janb84/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/janb84/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/janb84/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/janb84/subscriptions",
        "organizations_url": "https://api.github.com/users/janb84/orgs",
        "repos_url": "https://api.github.com/users/janb84/repos",
        "events_url": "https://api.github.com/users/janb84/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/janb84/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3225229760",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "commented",
      "id": 3225288108,
      "node_id": "IC_kwDOABII587APf2s",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3225288108",
      "actor": {
        "login": "polespinasa",
        "id": 57642229,
        "node_id": "MDQ6VXNlcjU3NjQyMjI5",
        "avatar_url": "https://avatars.githubusercontent.com/u/57642229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/polespinasa",
        "html_url": "https://github.com/polespinasa",
        "followers_url": "https://api.github.com/users/polespinasa/followers",
        "following_url": "https://api.github.com/users/polespinasa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/polespinasa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/polespinasa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/polespinasa/subscriptions",
        "organizations_url": "https://api.github.com/users/polespinasa/orgs",
        "repos_url": "https://api.github.com/users/polespinasa/repos",
        "events_url": "https://api.github.com/users/polespinasa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/polespinasa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-26T18:35:38Z",
      "updated_at": "2025-08-26T18:35:38Z",
      "author_association": "CONTRIBUTOR",
      "body": "lgtm code review and tested ACK b7b249d3adfbd3c7b0c4d0499a86300f57982972\r\nnothing to add that has not already been said in other comments",
      "user": {
        "login": "polespinasa",
        "id": 57642229,
        "node_id": "MDQ6VXNlcjU3NjQyMjI5",
        "avatar_url": "https://avatars.githubusercontent.com/u/57642229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/polespinasa",
        "html_url": "https://github.com/polespinasa",
        "followers_url": "https://api.github.com/users/polespinasa/followers",
        "following_url": "https://api.github.com/users/polespinasa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/polespinasa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/polespinasa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/polespinasa/subscriptions",
        "organizations_url": "https://api.github.com/users/polespinasa/orgs",
        "repos_url": "https://api.github.com/users/polespinasa/repos",
        "events_url": "https://api.github.com/users/polespinasa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/polespinasa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3225288108",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "referenced",
      "id": 19356052873,
      "node_id": "REFE_lADOABII587Hv5MWzwAAAASBte2J",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19356052873",
      "actor": {
        "login": "w0xlt",
        "id": 94266259,
        "node_id": "U_kgDOBZ5jkw",
        "avatar_url": "https://avatars.githubusercontent.com/u/94266259?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/w0xlt",
        "html_url": "https://github.com/w0xlt",
        "followers_url": "https://api.github.com/users/w0xlt/followers",
        "following_url": "https://api.github.com/users/w0xlt/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/w0xlt/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/w0xlt/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/w0xlt/subscriptions",
        "organizations_url": "https://api.github.com/users/w0xlt/orgs",
        "repos_url": "https://api.github.com/users/w0xlt/repos",
        "events_url": "https://api.github.com/users/w0xlt/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/w0xlt/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b5488017b33e1e9104cb44611ddf6422f73d771f",
      "commit_url": "https://api.github.com/repos/w0xlt/bitcoin/commits/b5488017b33e1e9104cb44611ddf6422f73d771f",
      "created_at": "2025-08-26T21:25:59Z"
    },
    {
      "event": "reviewed",
      "id": 3157177236,
      "node_id": "PRR_kwDOABII5868LrOU",
      "url": null,
      "actor": null,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-27T00:20:50Z",
      "author_association": "CONTRIBUTOR",
      "body": "crACK b7b249d3adfbd3c\r\n\r\nThis PR reverts two performance regressions that broke cache locality of the wtxid's we need to hash during compact block reconstruction and it adds a nice benchmark that demonstrates the regressions and might have caught them before they were merged.\r\n\r\nFor more context: https://bitcoin-irc.chaincode.com/bitcoin-core-dev/2025-08-23#1755938803-1755950270;\r\n\r\nI reviewed the code changes here directly, and I also compared them to the commits they claimed to be reverting, and the only differences I found were comment changes, small refactor-y changes, and changes related to new code.\r\n\r\n<details>\r\n\r\n<summary>b9300d8 vs  revert of a8203e9</summary>\r\n\r\n```bash\r\nDIFF_NOISE=\"^(diff --git|index|@@)\"\r\nREVERTING=\"b9300d8\"\r\nREVERTED=\"a8203e9\"\r\n\r\ndiff --color -u\\\r\n  <(git diff -U1 \"$REVERTED^..$REVERTED\" | grep -Ev \"${DIFF_NOISE}\") \\\r\n  <(git diff -U1 \"$REVERTING..$REVERTING^\" | grep -Ev \"${DIFF_NOISE}\")\r\n```\r\n\r\n```diff\r\n@@ -1,9 +1,27 @@\r\n+--- a/src/bench/blockencodings.cpp\r\n++++ b/src/bench/blockencodings.cpp\r\n+ \r\n+-    std::vector<std::pair<Wtxid, CTransactionRef>> extratxn;\r\n++    std::vector<CTransactionRef> extratxn;\r\n+     extratxn.reserve(n_extra);\r\n+     for (size_t i = n_pool; i < n_pool + n_extra; ++i) {\r\n+-        extratxn.emplace_back(refs[i]->GetWitnessHash(), refs[i]);\r\n++        extratxn.push_back(refs[i]);\r\n+     }\r\n --- a/src/blockencodings.cpp\r\n +++ b/src/blockencodings.cpp\r\n  \r\n--ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<std::pair<Wtxid, CTransactionRef>>& extra_txn) {\r\n+-/* Reconstructing a compact block is in the hot-path for block relay,\r\n+- * so we want to do it as quickly as possible. Because this often\r\n+- * involves iterating over the entire mempool, we put all the data we\r\n+- * need (ie the wtxid and a reference to the actual transaction data)\r\n+- * in a vector and iterate over the vector directly. This allows optimal\r\n+- * CPU caching behaviour, at a cost of only 40 bytes per transaction.\r\n+- */\r\n+-ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<std::pair<Wtxid, CTransactionRef>>& extra_txn)\r\n+-{\r\n +ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<CTransactionRef>& extra_txn) {\r\n-     if (cmpctblock.header.IsNull() || (cmpctblock.shorttxids.empty() && cmpctblock.prefilledtxn.empty()))\r\n+     LogDebug(BCLog::CMPCTBLOCK, \"Initializing PartiallyDownloadedBlock for block %s using a cmpctblock of %u bytes\\n\", cmpctblock.header.GetHash().ToString(), GetSerializeSize(cmpctblock));\r\n      for (size_t i = 0; i < extra_txn.size(); i++) {\r\n -        uint64_t shortid = cmpctblock.GetShortID(extra_txn[i].first);\r\n +        if (extra_txn[i] == nullptr) {\r\n@@ -21,8 +39,10 @@\r\n                      txn_available[idit->second].reset();\r\n --- a/src/blockencodings.h\r\n +++ b/src/blockencodings.h\r\n-     // extra_txn is a list of extra transactions to look at, in <witness hash, reference> form\r\n+ \r\n+-    // extra_txn is a list of extra transactions to look at, in <witness hash, reference> form\r\n -    ReadStatus InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<std::pair<Wtxid, CTransactionRef>>& extra_txn);\r\n++    // extra_txn is a list of extra orphan/conflicted/etc transactions to look at\r\n +    ReadStatus InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<CTransactionRef>& extra_txn);\r\n      bool IsTxAvailable(size_t index) const;\r\n --- a/src/net_processing.cpp\r\n@@ -38,8 +58,19 @@\r\n --- a/src/test/blockencodings_tests.cpp\r\n +++ b/src/test/blockencodings_tests.cpp\r\n  \r\n--std::vector<std::pair<Wtxid, CTransactionRef>> extra_txn;\r\n-+std::vector<CTransactionRef> extra_txn;\r\n+-const std::vector<std::pair<Wtxid, CTransactionRef>> empty_extra_txn;\r\n++const std::vector<CTransactionRef> empty_extra_txn;\r\n+ \r\n+     CBlock block(BuildBlockTestCase(rand_ctx));\r\n+-    std::vector<std::pair<Wtxid, CTransactionRef>> extra_txn;\r\n++    std::vector<CTransactionRef> extra_txn;\r\n+     extra_txn.resize(10);\r\n+         // Add an unrelated tx to extra_txn:\r\n+-        extra_txn[0] = {non_block_tx->GetWitnessHash(), non_block_tx};\r\n++        extra_txn[0] = non_block_tx;\r\n+         // and a tx from the block that's not in the mempool:\r\n+-        extra_txn[1] = {block.vtx[1]->GetWitnessHash(), block.vtx[1]};\r\n++        extra_txn[1] = block.vtx[1];\r\n  \r\n --- a/src/test/fuzz/partially_downloaded_block.cpp\r\n +++ b/src/test/fuzz/partially_downloaded_block.cpp\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n\r\n<summary>b7b249d vs revert of a03aef9</summary>\r\n\r\n```bash\r\nDIFF_NOISE=\"^(diff --git|index|@@)\"\r\nREVERTING=\"b7b249d\"\r\nREVERTED=\"a03aef9\"\r\n\r\ndiff --color -u\\\r\n  <(git diff -U1 \"$REVERTED^..$REVERTED\" | grep -Ev \"${DIFF_NOISE}\") \\\r\n  <(git diff -U1 \"$REVERTING..$REVERTING^\" | grep -Ev \"${DIFF_NOISE}\")\r\n```\r\n\r\n```diff\r\n@@ -1,39 +1,48 @@\r\n --- a/src/blockencodings.cpp\r\n +++ b/src/blockencodings.cpp\r\n      LOCK(pool->cs);\r\n--    for (size_t i = 0; i < pool->vTxHashes.size(); i++) {\r\n--        uint64_t shortid = cmpctblock.GetShortID(pool->vTxHashes[i].first);\r\n-+    for (const auto& tx : pool->vTxHashes) {\r\n+-    for (const auto& [wtxid, txit] : pool->txns_randomized) {\r\n+-        uint64_t shortid = cmpctblock.GetShortID(wtxid);\r\n++    for (const auto& tx : pool->txns_randomized) {\r\n +        uint64_t shortid = cmpctblock.GetShortID(tx->GetWitnessHash());\r\n          std::unordered_map<uint64_t, uint16_t>::iterator idit = shorttxids.find(shortid);\r\n              if (!have_txn[idit->second]) {\r\n--                txn_available[idit->second] = pool->vTxHashes[i].second->GetSharedTx();\r\n+-                txn_available[idit->second] = txit->GetSharedTx();\r\n +                txn_available[idit->second] = tx;\r\n                  have_txn[idit->second]  = true;\r\n --- a/src/test/blockencodings_tests.cpp\r\n +++ b/src/test/blockencodings_tests.cpp\r\n  // Number of shared use_counts we expect for a tx we haven't touched\r\n--// (block + mempool + our copy from the GetSharedTx call)\r\n+-// (block + mempool entry + our copy from the GetSharedTx call)\r\n -constexpr long SHARED_TX_OFFSET{3};\r\n-+// (block + mempool entry + mempool vTxHashes + our copy from the GetSharedTx call)\r\n++// (block + mempool entry + mempool txns_randomized + our copy from the GetSharedTx call)\r\n +constexpr long SHARED_TX_OFFSET{4};\r\n  \r\n --- a/src/txmempool.cpp\r\n +++ b/src/txmempool.cpp\r\n  \r\n--    vTxHashes.emplace_back(tx.GetWitnessHash(), newit);\r\n-+    vTxHashes.emplace_back(newit->GetSharedTx());\r\n-     newit->vTxHashesIdx = vTxHashes.size() - 1;\r\n-     if (vTxHashes.size() > 1) {\r\n-+        // Update vTxHashesIdx of the to-be-moved entry.\r\n-+        Assert(GetEntry(vTxHashes.back()->GetHash()))->vTxHashesIdx = it->vTxHashesIdx;\r\n-+        // Remove entry from vTxHashes by replacing it with the back and deleting the back.\r\n-         vTxHashes[it->vTxHashesIdx] = std::move(vTxHashes.back());\r\n--        vTxHashes[it->vTxHashesIdx].second->vTxHashesIdx = it->vTxHashesIdx;\r\n-         vTxHashes.pop_back();\r\n+-    txns_randomized.emplace_back(tx.GetWitnessHash(), newit);\r\n++    txns_randomized.emplace_back(newit->GetSharedTx());\r\n+     newit->idx_randomized = txns_randomized.size() - 1;\r\n+     if (txns_randomized.size() > 1) {\r\n++        // Update idx_randomized of the to-be-moved entry.\r\n++        Assert(GetEntry(txns_randomized.back()->GetHash()))->idx_randomized = it->idx_randomized;\r\n+         // Remove entry from txns_randomized by replacing it with the back and deleting the back.\r\n+         txns_randomized[it->idx_randomized] = std::move(txns_randomized.back());\r\n+-        txns_randomized[it->idx_randomized].second->idx_randomized = it->idx_randomized;\r\n+         txns_randomized.pop_back();\r\n+-        if (txns_randomized.size() * 2 < txns_randomized.capacity()) {\r\n++        if (txns_randomized.size() * 2 < txns_randomized.capacity())\r\n+             txns_randomized.shrink_to_fit();\r\n+-        }\r\n+-    } else {\r\n++    } else\r\n+         txns_randomized.clear();\r\n+-    }\r\n+ \r\n --- a/src/txmempool.h\r\n +++ b/src/txmempool.h\r\n      using txiter = indexed_transaction_set::nth_index<0>::type::const_iterator;\r\n--    std::vector<std::pair<uint256, txiter>> vTxHashes GUARDED_BY(cs); //!< All tx witness hashes/entries in mapTx, in random order\r\n-+    std::vector<CTransactionRef> vTxHashes GUARDED_BY(cs); //!< All transactions in mapTx, in random order\r\n+-    std::vector<std::pair<Wtxid, txiter>> txns_randomized GUARDED_BY(cs); //!< All transactions in mapTx with their wtxids, in arbitrary order\r\n++    std::vector<CTransactionRef> txns_randomized GUARDED_BY(cs); //!< All transactions in mapTx, in random order\r\n ```\r\n\r\n</details>\r\n\r\n|   benchmark | % faster\r\n|--------------------:|--------------------:|\r\n|        `BlockEncodingLargeExtra`  | 19.9% |\r\n|    `BlockEncodingNoExtra` | 18.5% |\r\n|    `BlockEncodingStdExtra` | 18.6% |\r\n\r\n> % faster calculated as: $`1 - \\frac{\\text{time}_\\text{branch}}{\\text{time}_\\text{master}}`$\r\n\r\n<details> \r\n\r\n<summary>Full benchmark results</summary>\r\n\r\n```console\r\n$  ./build/bin/bench_bitcoin --filter=\"BlockEncoding.*\" -min-time=5000\r\n```\r\n\r\ndf5a50e5de (master + benchmark added)\r\n\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,644,722.24 |              608.01 |    0.3% |   17,098,172.55 |    7,050,895.83 |  2.425 |   1,138,993.60 |    3.8% |      5.47 | `BlockEncodingLargeExtra`\r\n|        1,461,528.56 |              684.22 |    0.2% |   15,650,495.41 |    6,266,693.24 |  2.497 |   1,064,736.70 |    3.5% |      5.49 | `BlockEncodingNoExtra`\r\n|        1,476,456.22 |              677.30 |    0.9% |   15,680,631.05 |    6,328,282.73 |  2.478 |   1,066,421.94 |    3.5% |      5.55 | `BlockEncodingStdExtra`\r\n\r\n---\r\n\r\nb9300d8d0a74b15a220a2ce529d5157d109c7ed3 (extratxn better data locality)\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,566,821.01 |              638.23 |    0.2% |   17,099,295.07 |    6,718,281.29 |  2.545 |   1,134,042.47 |    3.9% |      5.53 | `BlockEncodingLargeExtra`\r\n|        1,467,993.68 |              681.20 |    0.1% |   15,656,135.06 |    6,294,675.71 |  2.487 |   1,064,516.33 |    3.6% |      5.47 | `BlockEncodingNoExtra`\r\n|        1,454,058.97 |              687.73 |    0.5% |   15,687,165.75 |    6,234,731.73 |  2.516 |   1,066,490.20 |    3.5% |      5.48 | `BlockEncodingStdExtra`\r\n\r\n---\r\n\r\nb7b249d3ad (mempool better data locality)\r\n\r\n|               ns/op |                op/s |    err% |          ins/op |          cyc/op |    IPC |         bra/op |   miss% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------------:|----------------:|-------:|---------------:|--------:|----------:|:----------\r\n|        1,316,987.01 |              759.31 |    0.1% |   17,049,029.82 |    5,652,300.18 |  3.016 |   1,133,975.24 |    3.8% |      5.50 | `BlockEncodingLargeExtra`\r\n|        1,190,773.91 |              839.79 |    0.3% |   15,606,374.31 |    5,102,241.10 |  3.059 |   1,064,614.44 |    3.5% |      5.48 | `BlockEncodingNoExtra`\r\n|        1,201,347.37 |              832.40 |    0.2% |   15,637,600.08 |    5,147,161.34 |  3.038 |   1,066,621.86 |    3.5% |      5.43 | `BlockEncodingStdExtra`\r\n\r\n\r\n</details>\r\n\r\n",
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3157177236",
      "submitted_at": "2025-08-27T00:20:49Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
    },
    {
      "event": "commented",
      "id": 3233243613,
      "node_id": "IC_kwDOABII587At2Hd",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3233243613",
      "actor": {
        "login": "cedwies",
        "id": 141683552,
        "node_id": "U_kgDOCHHrYA",
        "avatar_url": "https://avatars.githubusercontent.com/u/141683552?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/cedwies",
        "html_url": "https://github.com/cedwies",
        "followers_url": "https://api.github.com/users/cedwies/followers",
        "following_url": "https://api.github.com/users/cedwies/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/cedwies/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/cedwies/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/cedwies/subscriptions",
        "organizations_url": "https://api.github.com/users/cedwies/orgs",
        "repos_url": "https://api.github.com/users/cedwies/repos",
        "events_url": "https://api.github.com/users/cedwies/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/cedwies/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T12:09:10Z",
      "updated_at": "2025-08-28T12:09:10Z",
      "author_association": "NONE",
      "body": "code-review ACK b7b249d \r\n\r\nRead-through + local bench; results match others which I have seen. This PR restores cache locality in the compact-block reconstruction hot path and adds a well focused benchmark.\r\n\r\n* Reverts the “vector of `CTransactionRef`” refactors and restores a cache-friendly layout for reconstruction.\r\n* `InitData` again takes `std::vector<std::pair<Wtxid, CTransactionRef>> extra_txn`, causing the wtxid to be available without dereferencing in the hot loop.\r\n* Early-exit and collision behavior are preserved.\r\n* Bench design is scoped to the hot path we care about and does not mix in network or dup-resolution behavior.\r\n\r\nStrong improvement. The memory overhead is small and well justified by the speedup.\r\n",
      "user": {
        "login": "cedwies",
        "id": 141683552,
        "node_id": "U_kgDOCHHrYA",
        "avatar_url": "https://avatars.githubusercontent.com/u/141683552?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/cedwies",
        "html_url": "https://github.com/cedwies",
        "followers_url": "https://api.github.com/users/cedwies/followers",
        "following_url": "https://api.github.com/users/cedwies/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/cedwies/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/cedwies/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/cedwies/subscriptions",
        "organizations_url": "https://api.github.com/users/cedwies/orgs",
        "repos_url": "https://api.github.com/users/cedwies/repos",
        "events_url": "https://api.github.com/users/cedwies/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/cedwies/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3233243613",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "reviewed",
      "id": 3164846536,
      "node_id": "PRR_kwDOABII5868o7nI",
      "url": null,
      "actor": null,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "commit_url": null,
      "created_at": null,
      "updated_at": "2025-08-28T13:32:23Z",
      "author_association": "MEMBER",
      "body": "ACK b7b249d3adfbd3c7b0c4d0499a86300f57982972\r\n\r\nnon-blocking nits only",
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#pullrequestreview-3164846536",
      "submitted_at": "2025-08-28T13:32:23Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
    },
    {
      "event": "merged",
      "id": 19401047236,
      "node_id": "ME_lADOABII587Hv5MWzwAAAASEZHzE",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19401047236",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "7cc9a087069bfcdb79a08ce77eb3a60adf9483af",
      "commit_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7cc9a087069bfcdb79a08ce77eb3a60adf9483af",
      "created_at": "2025-08-28T23:10:57Z"
    },
    {
      "event": "closed",
      "id": 19401047268,
      "node_id": "CE_lADOABII587Hv5MWzwAAAASEZHzk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/19401047268",
      "actor": {
        "login": "achow101",
        "id": 3782274,
        "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/achow101",
        "html_url": "https://github.com/achow101",
        "followers_url": "https://api.github.com/users/achow101/followers",
        "following_url": "https://api.github.com/users/achow101/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/achow101/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/achow101/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
        "organizations_url": "https://api.github.com/users/achow101/orgs",
        "repos_url": "https://api.github.com/users/achow101/repos",
        "events_url": "https://api.github.com/users/achow101/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/achow101/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-28T23:10:57Z"
    },
    {
      "event": "commented",
      "id": 3235300290,
      "node_id": "IC_kwDOABII587A1sPC",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3235300290",
      "actor": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-08-29T00:04:24Z",
      "updated_at": "2025-08-29T00:04:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "post-merge ACK",
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3235300290",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    },
    {
      "event": "commented",
      "id": 3249315224,
      "node_id": "IC_kwDOABII587BrJ2Y",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/3249315224",
      "actor": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-09-03T13:42:13Z",
      "updated_at": "2025-09-03T13:42:13Z",
      "author_association": "MEMBER",
      "body": "Should this be backported?",
      "user": {
        "login": "glozow",
        "id": 25183001,
        "node_id": "MDQ6VXNlcjI1MTgzMDAx",
        "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/glozow",
        "html_url": "https://github.com/glozow",
        "followers_url": "https://api.github.com/users/glozow/followers",
        "following_url": "https://api.github.com/users/glozow/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/glozow/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/glozow/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
        "organizations_url": "https://api.github.com/users/glozow/orgs",
        "repos_url": "https://api.github.com/users/glozow/repos",
        "events_url": "https://api.github.com/users/glozow/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/glozow/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#issuecomment-3249315224",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/33253"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298807140",
      "pull_request_review_id": 3152574449,
      "id": 2298807140,
      "node_id": "PRRC_kwDOABII586JBQNk",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 74,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: we might as well reserve `50'000` here",
      "created_at": "2025-08-25T18:25:41Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298807140",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298807140"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 74,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298808174",
      "pull_request_review_id": 3152574449,
      "id": 2298808174,
      "node_id": "PRRC_kwDOABII586JBQdu",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {\n+            CMutableTransaction tx = CMutableTransaction();\n+            tx.vin.resize(1);\n+            tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\n+            tx.vin[0].scriptWitness.stack.push_back({1});\n+            tx.vout.resize(1);\n+            tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+            tx.vout[0].nValue = i;\n+            refs.push_back(MakeTransactionRef(tx));\n+        }\n+\n+        // ensure mempool ordering is different to memory ordering of transactions,\n+        // to simulate a mempool that has changed over time\n+        std::shuffle(refs.begin(), refs.end(), rng);",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 87,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: `std::ranges::shuffle` might be simpler:\r\n```suggestion\r\n        std::ranges::shuffle(refs, rng);\r\n```",
      "created_at": "2025-08-25T18:26:13Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298808174",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298808174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 87,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298810753",
      "pull_request_review_id": 3152574449,
      "id": 2298810753,
      "node_id": "PRRC_kwDOABII586JBRGB",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {\n+            CMutableTransaction tx = CMutableTransaction();\n+            tx.vin.resize(1);\n+            tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\n+            tx.vin[0].scriptWitness.stack.push_back({1});\n+            tx.vout.resize(1);\n+            tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+            tx.vout[0].nValue = i;\n+            refs.push_back(MakeTransactionRef(tx));\n+        }\n+\n+        // ensure mempool ordering is different to memory ordering of transactions,\n+        // to simulate a mempool that has changed over time\n+        std::shuffle(refs.begin(), refs.end(), rng);\n+\n+        for (size_t i = 0; i < refs.size(); ++i) {\n+            AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+        }\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};\n+\n+    bench.run([&] {\n+        PartiallyDownloadedBlock pdb{&pool};\n+        (void)pdb.InitData(cmpctblock, {});",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 98,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "we could consume the result to make sure the benchmark isn't optimized away and that we're measuring the success/failure scenario correctly",
      "created_at": "2025-08-25T18:27:33Z",
      "updated_at": "2025-08-25T21:18:17Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298810753",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298810753"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 98,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298811715",
      "pull_request_review_id": 3152574449,
      "id": 2298811715,
      "node_id": "PRRC_kwDOABII586JBRVD",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {\n+            CMutableTransaction tx = CMutableTransaction();\n+            tx.vin.resize(1);\n+            tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\n+            tx.vin[0].scriptWitness.stack.push_back({1});\n+            tx.vout.resize(1);\n+            tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+            tx.vout[0].nValue = i;\n+            refs.push_back(MakeTransactionRef(tx));\n+        }\n+\n+        // ensure mempool ordering is different to memory ordering of transactions,\n+        // to simulate a mempool that has changed over time\n+        std::shuffle(refs.begin(), refs.end(), rng);\n+\n+        for (size_t i = 0; i < refs.size(); ++i) {\n+            AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+        }\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};\n+\n+    bench.run([&] {\n+        PartiallyDownloadedBlock pdb{&pool};\n+        (void)pdb.InitData(cmpctblock, {});\n+    });\n+}\n+\n+BENCHMARK(BlockEncoding, benchmark::PriorityLevel::HIGH);",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 102,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: newline at the very end is customary for the linter and formatter to not complain",
      "created_at": "2025-08-25T18:28:01Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298811715",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298811715"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298820059",
      "pull_request_review_id": 3152574449,
      "id": 2298820059,
      "node_id": "PRRC_kwDOABII586JBTXb",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 67,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "alternatively this may be slightly more descriptive than `11` and it could even be used to init the `sigspam`:\n```suggestion\n    FastRandomContext rng{/*fDeterministic=*/true};\n    auto sigspam{rng.randbytes<200>()};\n```",
      "created_at": "2025-08-25T18:32:39Z",
      "updated_at": "2025-08-26T03:02:38Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298820059",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298820059"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": 65,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 64,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298827191",
      "pull_request_review_id": 3152574449,
      "id": 2298827191,
      "node_id": "PRRC_kwDOABII586JBVG3",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {\n+            CMutableTransaction tx = CMutableTransaction();\n+            tx.vin.resize(1);\n+            tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\n+            tx.vin[0].scriptWitness.stack.push_back({1});\n+            tx.vout.resize(1);\n+            tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+            tx.vout[0].nValue = i;\n+            refs.push_back(MakeTransactionRef(tx));\n+        }\n+\n+        // ensure mempool ordering is different to memory ordering of transactions,\n+        // to simulate a mempool that has changed over time\n+        std::shuffle(refs.begin(), refs.end(), rng);\n+\n+        for (size_t i = 0; i < refs.size(); ++i) {\n+            AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+        }",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 91,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: direct iteration would be slightly simpler:\r\n```suggestion\r\n        for (auto& tx : refs) {\r\n            AddTx(tx, /*fee=*/tx->vout[0].nValue, pool);\r\n        }\r\n```",
      "created_at": "2025-08-25T18:36:10Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298827191",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298827191"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": 89,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 91,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298835726",
      "pull_request_review_id": 3152574449,
      "id": 2298835726,
      "node_id": "PRRC_kwDOABII586JBXMO",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {\n+            CMutableTransaction tx = CMutableTransaction();\n+            tx.vin.resize(1);\n+            tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\n+            tx.vin[0].scriptWitness.stack.push_back({1});\n+            tx.vout.resize(1);\n+            tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+            tx.vout[0].nValue = i;\n+            refs.push_back(MakeTransactionRef(tx));",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 82,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit: for consistency we might as well use `emplace_back` like we do in `DummyBlock`",
      "created_at": "2025-08-25T18:40:38Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298835726",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298835726"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 82,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298873346",
      "pull_request_review_id": 3152574449,
      "id": 2298873346,
      "node_id": "PRRC_kwDOABII586JBgYC",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {\n+            CMutableTransaction tx = CMutableTransaction();\n+            tx.vin.resize(1);\n+            tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\n+            tx.vin[0].scriptWitness.stack.push_back({1});\n+            tx.vout.resize(1);\n+            tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+            tx.vout[0].nValue = i;\n+            refs.push_back(MakeTransactionRef(tx));\n+        }\n+\n+        // ensure mempool ordering is different to memory ordering of transactions,\n+        // to simulate a mempool that has changed over time\n+        std::shuffle(refs.begin(), refs.end(), rng);\n+\n+        for (size_t i = 0; i < refs.size(); ++i) {\n+            AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+        }\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};",
      "path": "src/bench/blockencodings.cpp",
      "position": 100,
      "original_position": 94,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit:\r\n```suggestion\r\n    BenchCBHAST cmpctblock{rng, /*txs=*/3'000};\r\n```",
      "created_at": "2025-08-25T18:59:43Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298873346",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298873346"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 100,
      "original_line": 100,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298886174",
      "pull_request_review_id": 3152574449,
      "id": 2298886174,
      "node_id": "PRRC_kwDOABII586JBjge",
      "diff_hunk": "@@ -144,8 +144,8 @@ class PartiallyDownloadedBlock {\n \n     explicit PartiallyDownloadedBlock(CTxMemPool* poolIn) : pool(poolIn) {}\n \n-    // extra_txn is a list of extra orphan/conflicted/etc transactions to look at\n-    ReadStatus InitData(const CBlockHeaderAndShortTxIDs& cmpctblock, const std::vector<CTransactionRef>& extra_txn);\n+    // extra_txn is a list of extra transactions to look at, in <witness hash, reference> form",
      "path": "src/blockencodings.h",
      "position": 6,
      "original_position": 6,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "f2b9cbed7196617880d177c089332e4fd48f28ca",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I redid the a8203e94123b6ea6e4f4a6320e3ad20457f44a28 cherry-pick, this line and the top comment are new additions (+ some conflicts were resolved slightly differently to how I have, but the result seems correct to me)",
      "created_at": "2025-08-25T19:06:38Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298886174",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298886174"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 147,
      "original_line": 147,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298907638",
      "pull_request_review_id": 3152574449,
      "id": 2298907638,
      "node_id": "PRRC_kwDOABII586JBov2",
      "diff_hunk": "@@ -114,12 +114,12 @@ ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& c\n     std::vector<bool> have_txn(txn_available.size());\n     {\n     LOCK(pool->cs);\n-    for (const auto& tx : pool->txns_randomized) {\n-        uint64_t shortid = cmpctblock.GetShortID(tx->GetWitnessHash());\n+    for (const auto& [wtxid, txit] : pool->txns_randomized) {",
      "path": "src/blockencodings.cpp",
      "position": 23,
      "original_position": 6,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "redid the a03aef9cec35b0d03aa63d7e8093f0420cd4b40b revert, after resolving the conflicts I ended up with a very similar change - except for some comments, some `vTxHashes` vs `txns_randomized` changes which weren't reverted",
      "created_at": "2025-08-25T19:16:06Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2298907638",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2298907638"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 117,
      "original_line": 117,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299068765",
      "pull_request_review_id": 3152574449,
      "id": 2299068765,
      "node_id": "PRRC_kwDOABII586JCQFd",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    {\n+        // a reasonably large mempool of 50k txs, ~10MB total\n+        std::vector<CTransactionRef> refs;\n+        for (size_t i = 0; i < 50000; ++i) {\n+            CMutableTransaction tx = CMutableTransaction();\n+            tx.vin.resize(1);\n+            tx.vin[0].scriptSig = CScript() << sigspam << OP_1;\n+            tx.vin[0].scriptWitness.stack.push_back({1});\n+            tx.vout.resize(1);\n+            tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+            tx.vout[0].nValue = i;\n+            refs.push_back(MakeTransactionRef(tx));\n+        }\n+\n+        // ensure mempool ordering is different to memory ordering of transactions,\n+        // to simulate a mempool that has changed over time\n+        std::shuffle(refs.begin(), refs.end(), rng);\n+\n+        for (size_t i = 0; i < refs.size(); ++i) {\n+            AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+        }\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};\n+\n+    bench.run([&] {\n+        PartiallyDownloadedBlock pdb{&pool};\n+        (void)pdb.InitData(cmpctblock, {});",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 98,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "as mentioned by @instagibbs and @achow101, we could add two benches here, for empty extra and with some (partially overlapping) one, something like:\r\n```C++\r\n    std::vector<std::pair<Wtxid, CTransactionRef>> extra_txn;\r\n    // ...\r\n        extra_txn.reserve(extra_tx_count);\r\n        for (size_t i{0}; i < extra_tx_count; ++i) {\r\n            size_t index{i < (extra_tx_count / 2) ? mempool_size + i : mempool_size - i}; // some overlap with mempool\r\n            auto tx{CreateTestTransaction(sigspam, index)};\r\n            extra_txn.emplace_back(tx->GetWitnessHash(), tx);\r\n        }\r\n```\r\n",
      "created_at": "2025-08-25T20:32:00Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299068765",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299068765"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 98,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299070778",
      "pull_request_review_id": 3152574449,
      "id": 2299070778,
      "node_id": "PRRC_kwDOABII586JCQk6",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 65,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "We could extract the constant used here to the front, like:\r\n```C++\r\n    constexpr size_t mempool_size{50'000}, sigspam_size{200}, extra_tx_count{10}, shortid_count{3'000};\r\n```",
      "created_at": "2025-08-25T20:32:48Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299070778",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299070778"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 65,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299112890",
      "pull_request_review_id": 3152574449,
      "id": 2299112890,
      "node_id": "PRRC_kwDOABII586JCa26",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());",
      "path": "src/bench/blockencodings.cpp",
      "position": 54,
      "original_position": 55,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "we're lucky that this doesn't generate any duplicates, but we could test those cases as well:\r\n```C++\r\nstruct BenchCBHAST : CBlockHeaderAndShortTxIDs\r\n{\r\n    BenchCBHAST(FastRandomContext& rng, int txs, bool duplicates) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\r\n    {\r\n        std::unordered_set<uint64_t> seen;\r\n        shorttxids.reserve(txs);\r\n        while (txs-- > 0) {\r\n            uint64_t id{rng.randbits<SHORTTXIDS_LENGTH * 8>()};\r\n            assert(seen.insert(id).second);\r\n            shorttxids.push_back(id);\r\n        }\r\n        if (duplicates) shorttxids.at(shorttxids.size() - 1) = shorttxids.at(0);\r\n    }\r\n};\r\n```\r\nand we could bench all 4 possibilities:\r\n```C++\r\nfor (const auto duplicates : {false, true}) {\r\n    BenchCBHAST cmpctblock{rng, /*txs=*/shortid_count, duplicates};\r\n    for (const auto& extra : {extra_txn, std::vector<std::pair<Wtxid, CTransactionRef>>{}}) {\r\n        bench.name(strprintf(\"reconstructions %s%s\", extra.empty() ? \"without extra\" : \"with extra\", duplicates ? \" (dup)\" : \"\"))\r\n             .run([&] {\r\n                 PartiallyDownloadedBlock pdb{&pool};\r\n                 const auto status{pdb.InitData(cmpctblock, extra)};\r\n                 assert(status == (duplicates ? READ_STATUS_FAILED : READ_STATUS_OK));\r\n             });\r\n    }\r\n}\r\n```\r\nresulting in something like:\r\n|               ns/op |                op/s |    err% |     total | benchmark\r\n|--------------------:|--------------------:|--------:|----------:|:----------\r\n|        1,371,045.12 |              729.37 |    1.3% |      5.36 | `reconstructions without extra`\r\n|        1,309,789.19 |              763.48 |    2.8% |      5.35 | `reconstructions with extra`\r\n|           71,741.96 |           13,938.84 |    2.3% |      5.42 | `reconstructions without extra (dup)`\r\n|           70,113.89 |           14,262.51 |    1.2% |      5.50 | `reconstructions with extra (dup)`",
      "created_at": "2025-08-25T20:52:01Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299112890",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299112890"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299138683",
      "pull_request_review_id": 3152574449,
      "id": 2299138683,
      "node_id": "PRRC_kwDOABII586JChJ7",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 1,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit:\r\n```suggestion\r\n// Copyright (c) 2025-present The Bitcoin Core developers\r\n```",
      "created_at": "2025-08-25T21:07:00Z",
      "updated_at": "2025-08-25T21:15:24Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299138683",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299138683"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 1,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299139614",
      "pull_request_review_id": 3152574449,
      "id": 2299139614,
      "node_id": "PRRC_kwDOABII586JChYe",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 16,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`#include <univalue.h>` and `#include <rpc/mempool.h>` don't seem to be needed",
      "created_at": "2025-08-25T21:07:35Z",
      "updated_at": "2025-08-25T21:15:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299139614",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299139614"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 16,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299140521",
      "pull_request_review_id": 3152574449,
      "id": 2299140521,
      "node_id": "PRRC_kwDOABII586JChmp",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));",
      "path": "src/bench/blockencodings.cpp",
      "position": 25,
      "original_position": 26,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": null,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "`CTxMemPoolEntry{}` would indicate slightly better that it's a constructor",
      "created_at": "2025-08-25T21:08:03Z",
      "updated_at": "2025-08-25T21:15:25Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299140521",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299140521"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 25,
      "original_line": 25,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299271743",
      "pull_request_review_id": 3153218666,
      "id": 2299271743,
      "node_id": "PRRC_kwDOABII586JDBo_",
      "diff_hunk": "@@ -152,7 +157,7 @@ ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& c\n                 // Note that we don't want duplication between extra_txn and mempool to\n                 // trigger this case, so we compare witness hashes first\n                 if (txn_available[idit->second] &&\n-                        txn_available[idit->second]->GetWitnessHash() != extra_txn[i]->GetWitnessHash()) {\n+                        txn_available[idit->second]->GetWitnessHash() != extra_txn[i].second->GetWitnessHash()) {",
      "path": "src/blockencodings.cpp",
      "position": 55,
      "original_position": 39,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "f2b9cbed7196617880d177c089332e4fd48f28ca",
      "in_reply_to_id": null,
      "user": {
        "login": "polespinasa",
        "id": 57642229,
        "node_id": "MDQ6VXNlcjU3NjQyMjI5",
        "avatar_url": "https://avatars.githubusercontent.com/u/57642229?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/polespinasa",
        "html_url": "https://github.com/polespinasa",
        "followers_url": "https://api.github.com/users/polespinasa/followers",
        "following_url": "https://api.github.com/users/polespinasa/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/polespinasa/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/polespinasa/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/polespinasa/subscriptions",
        "organizations_url": "https://api.github.com/users/polespinasa/orgs",
        "repos_url": "https://api.github.com/users/polespinasa/repos",
        "events_url": "https://api.github.com/users/polespinasa/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/polespinasa/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I think this should be:\r\n```c++\r\nif (txn_available[idit->second] && \r\n    txn_available[idit->second]->GetWitnessHash() != extra_txn[i].first) { ...\r\n```",
      "created_at": "2025-08-25T22:21:28Z",
      "updated_at": "2025-08-25T23:10:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299271743",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299271743"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299685034",
      "pull_request_review_id": 3153790157,
      "id": 2299685034,
      "node_id": "PRRC_kwDOABII586JEmiq",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());",
      "path": "src/bench/blockencodings.cpp",
      "position": 54,
      "original_position": 55,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": 2299112890,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "This is just testing how quickly we can iterate through all the txs in the mempool when looking at a compact block -- which is the worst case scenario that can still be fast (if we finish solving the block with transactions from the extra pool, and don't need to go back to the network). Hitting duplicates automatically puts us in the slow resolve-via-network path, so benching that shouldn't be terribly interesting.",
      "created_at": "2025-08-26T03:56:42Z",
      "updated_at": "2025-08-26T03:56:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299685034",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299685034"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299690928",
      "pull_request_review_id": 3153797521,
      "id": 2299690928,
      "node_id": "PRRC_kwDOABII586JEn-w",
      "diff_hunk": "@@ -152,7 +157,7 @@ ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& c\n                 // Note that we don't want duplication between extra_txn and mempool to\n                 // trigger this case, so we compare witness hashes first\n                 if (txn_available[idit->second] &&\n-                        txn_available[idit->second]->GetWitnessHash() != extra_txn[i]->GetWitnessHash()) {\n+                        txn_available[idit->second]->GetWitnessHash() != extra_txn[i].second->GetWitnessHash()) {",
      "path": "src/blockencodings.cpp",
      "position": 55,
      "original_position": 39,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "f2b9cbed7196617880d177c089332e4fd48f28ca",
      "in_reply_to_id": 2299271743,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Once we've found a shortid match, looking up the actual tx is fine, so I don't think this warrants changing.",
      "created_at": "2025-08-26T04:02:20Z",
      "updated_at": "2025-08-26T04:02:21Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299690928",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299690928"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299706227",
      "pull_request_review_id": 3153816123,
      "id": 2299706227,
      "node_id": "PRRC_kwDOABII586JErtz",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());",
      "path": "src/bench/blockencodings.cpp",
      "position": 54,
      "original_position": 55,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": 2299112890,
      "user": {
        "login": "l0rinc",
        "id": 1841944,
        "node_id": "MDQ6VXNlcjE4NDE5NDQ=",
        "avatar_url": "https://avatars.githubusercontent.com/u/1841944?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/l0rinc",
        "html_url": "https://github.com/l0rinc",
        "followers_url": "https://api.github.com/users/l0rinc/followers",
        "following_url": "https://api.github.com/users/l0rinc/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/l0rinc/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/l0rinc/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/l0rinc/subscriptions",
        "organizations_url": "https://api.github.com/users/l0rinc/orgs",
        "repos_url": "https://api.github.com/users/l0rinc/repos",
        "events_url": "https://api.github.com/users/l0rinc/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/l0rinc/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "To make sure that's what we're testing, we should still assert the outcome of `InitData` was `READ_STATUS_OK` - otherwise it would be possible that we accidentally generated duplicates here.",
      "created_at": "2025-08-26T04:17:53Z",
      "updated_at": "2025-08-26T04:17:54Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2299706227",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2299706227"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2301680659",
      "pull_request_review_id": 3156657862,
      "id": 2301680659,
      "node_id": "PRRC_kwDOABII586JMNwT",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());",
      "path": "src/bench/blockencodings.cpp",
      "position": 54,
      "original_position": 55,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "decb48a607fb3911a25e5e8b37628a5e15b3ce17",
      "in_reply_to_id": 2299112890,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Added an assert and comment.",
      "created_at": "2025-08-26T17:37:14Z",
      "updated_at": "2025-08-26T17:37:14Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2301680659",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2301680659"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 54,
      "original_line": 54,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2302045141",
      "pull_request_review_id": 3157177236,
      "id": 2302045141,
      "node_id": "PRRC_kwDOABII586JNmvV",
      "diff_hunk": "@@ -152,7 +157,7 @@ ReadStatus PartiallyDownloadedBlock::InitData(const CBlockHeaderAndShortTxIDs& c\n                 // Note that we don't want duplication between extra_txn and mempool to\n                 // trigger this case, so we compare witness hashes first\n                 if (txn_available[idit->second] &&\n-                        txn_available[idit->second]->GetWitnessHash() != extra_txn[i]->GetWitnessHash()) {\n+                        txn_available[idit->second]->GetWitnessHash() != extra_txn[i].second->GetWitnessHash()) {",
      "path": "src/blockencodings.cpp",
      "position": 55,
      "original_position": 39,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "f2b9cbed7196617880d177c089332e4fd48f28ca",
      "in_reply_to_id": 2299271743,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "What makes this section not performance critical, is that we're likely going to have to do a full round-trip anyways to get the collided transactions, but I still think the suggestion is more correct/consistent, so might be nice to do if retouching. Out of scope, but we can also remove the first clause of the `if` check entirely, since it's checking the inverse of the `if` block above.",
      "created_at": "2025-08-26T20:16:22Z",
      "updated_at": "2025-08-27T00:20:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2302045141",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2302045141"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 160,
      "original_line": 160,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2302199451",
      "pull_request_review_id": 3157177236,
      "id": 2302199451,
      "node_id": "PRRC_kwDOABII586JOMab",
      "diff_hunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2011-2022 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <primitives/transaction.h>\n+#include <rpc/mempool.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <univalue.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncoding(benchmark::Bench& bench)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+    InsecureRandomContext rng(11);",
      "path": "src/bench/blockencodings.cpp",
      "position": 1,
      "original_position": 67,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "eb1920a82ffa2086c3e8e3e8946b9f43053455aa",
      "in_reply_to_id": 2298820059,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "+1",
      "created_at": "2025-08-26T21:38:04Z",
      "updated_at": "2025-08-27T00:20:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2302199451",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2302199451"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": 65,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 64,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2302369266",
      "pull_request_review_id": 3157177236,
      "id": 2302369266,
      "node_id": "PRRC_kwDOABII586JO13y",
      "diff_hunk": "@@ -0,0 +1,131 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <net_processing.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncodingBench(benchmark::Bench& bench, size_t n_pool, size_t n_extra)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    std::vector<CTransactionRef> extratxn;\n+    extratxn.reserve(n_extra);\n+\n+    // bump up the size of txs\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+\n+    // a reasonably large mempool of 50k txs, ~10MB total\n+    std::vector<CTransactionRef> refs;\n+    refs.reserve(n_pool + n_extra);\n+    for (size_t i = 0; i < n_pool + n_extra; ++i) {\n+        CMutableTransaction tx = CMutableTransaction();\n+        tx.vin.resize(1);\n+        tx.vin[0].scriptSig = CScript() << sigspam;\n+        tx.vin[0].scriptWitness.stack.push_back({1});\n+        tx.vout.resize(1);\n+        tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+        tx.vout[0].nValue = i;\n+        refs.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    // ensure mempool ordering is different to memory ordering of transactions,\n+    // to simulate a mempool that has changed over time\n+    std::shuffle(refs.begin(), refs.end(), rng);\n+\n+    for (size_t i = 0; i < n_pool; ++i) {\n+        AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+    }\n+    for (size_t i = n_pool; i < n_pool + n_extra; ++i) {\n+        extratxn.push_back(refs[i]);\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};\n+\n+    bench.run([&] {",
      "path": "src/bench/blockencodings.cpp",
      "position": 102,
      "original_position": 102,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "df5a50e5de204013ba56e1c4967a249ca07ba086",
      "in_reply_to_id": null,
      "user": {
        "login": "davidgumberg",
        "id": 2257631,
        "node_id": "MDQ6VXNlcjIyNTc2MzE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2257631?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/davidgumberg",
        "html_url": "https://github.com/davidgumberg",
        "followers_url": "https://api.github.com/users/davidgumberg/followers",
        "following_url": "https://api.github.com/users/davidgumberg/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/davidgumberg/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/davidgumberg/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/davidgumberg/subscriptions",
        "organizations_url": "https://api.github.com/users/davidgumberg/orgs",
        "repos_url": "https://api.github.com/users/davidgumberg/repos",
        "events_url": "https://api.github.com/users/davidgumberg/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/davidgumberg/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "nit:\r\n\r\n```suggestion\r\n    bench.unit(\"block\").run([&] {\r\n```\r\n\r\nand maybe:\r\n\r\n```suggestion\r\n    bench.unit(\"block\").timeUnit(1ms, \"ms\").run([&] {\r\n```\r\n",
      "created_at": "2025-08-26T23:24:43Z",
      "updated_at": "2025-08-27T00:20:50Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2302369266",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2302369266"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 102,
      "original_line": 102,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307403366",
      "pull_request_review_id": 3164846536,
      "id": 2307403366,
      "node_id": "PRRC_kwDOABII586JiC5m",
      "diff_hunk": "@@ -0,0 +1,131 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <net_processing.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncodingBench(benchmark::Bench& bench, size_t n_pool, size_t n_extra)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    std::vector<CTransactionRef> extratxn;\n+    extratxn.reserve(n_extra);\n+\n+    // bump up the size of txs\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+\n+    // a reasonably large mempool of 50k txs, ~10MB total\n+    std::vector<CTransactionRef> refs;\n+    refs.reserve(n_pool + n_extra);\n+    for (size_t i = 0; i < n_pool + n_extra; ++i) {\n+        CMutableTransaction tx = CMutableTransaction();\n+        tx.vin.resize(1);\n+        tx.vin[0].scriptSig = CScript() << sigspam;\n+        tx.vin[0].scriptWitness.stack.push_back({1});\n+        tx.vout.resize(1);\n+        tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+        tx.vout[0].nValue = i;\n+        refs.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    // ensure mempool ordering is different to memory ordering of transactions,\n+    // to simulate a mempool that has changed over time\n+    std::shuffle(refs.begin(), refs.end(), rng);\n+\n+    for (size_t i = 0; i < n_pool; ++i) {\n+        AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+    }\n+    for (size_t i = n_pool; i < n_pool + n_extra; ++i) {\n+        extratxn.push_back(refs[i]);\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};\n+\n+    bench.run([&] {\n+        PartiallyDownloadedBlock pdb{&pool};\n+        auto res = pdb.InitData(cmpctblock, extratxn);\n+\n+        // if there were duplicates the benchmark will be invalid\n+        // (eg, extra txns will be skipped) and we will receive\n+        // READ_STATUS_FAILED\n+        assert(res == READ_STATUS_OK);\n+    });\n+}\n+\n+static void BlockEncodingNoExtra(benchmark::Bench& bench)\n+{\n+    BlockEncodingBench(bench, 50000, 0);\n+}\n+\n+static void BlockEncodingStdExtra(benchmark::Bench& bench)\n+{\n+    static_assert(DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN == 100);\n+    BlockEncodingBench(bench, 50000, 100);\n+}\n+\n+static void BlockEncodingLargeExtra(benchmark::Bench& bench)\n+{\n+    BlockEncodingBench(bench, 50000, 5000);",
      "path": "src/bench/blockencodings.cpp",
      "position": 126,
      "original_position": 126,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "df5a50e5de204013ba56e1c4967a249ca07ba086",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "micro-nit: annotate numbered args",
      "created_at": "2025-08-28T13:21:29Z",
      "updated_at": "2025-08-28T13:32:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2307403366",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307403366"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 126,
      "original_line": 126,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307403680",
      "pull_request_review_id": 3164846536,
      "id": 2307403680,
      "node_id": "PRRC_kwDOABII586JiC-g",
      "diff_hunk": "@@ -0,0 +1,131 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <net_processing.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncodingBench(benchmark::Bench& bench, size_t n_pool, size_t n_extra)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    std::vector<CTransactionRef> extratxn;\n+    extratxn.reserve(n_extra);\n+\n+    // bump up the size of txs\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+\n+    // a reasonably large mempool of 50k txs, ~10MB total\n+    std::vector<CTransactionRef> refs;\n+    refs.reserve(n_pool + n_extra);\n+    for (size_t i = 0; i < n_pool + n_extra; ++i) {\n+        CMutableTransaction tx = CMutableTransaction();\n+        tx.vin.resize(1);\n+        tx.vin[0].scriptSig = CScript() << sigspam;\n+        tx.vin[0].scriptWitness.stack.push_back({1});\n+        tx.vout.resize(1);\n+        tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+        tx.vout[0].nValue = i;\n+        refs.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    // ensure mempool ordering is different to memory ordering of transactions,\n+    // to simulate a mempool that has changed over time\n+    std::shuffle(refs.begin(), refs.end(), rng);\n+\n+    for (size_t i = 0; i < n_pool; ++i) {\n+        AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+    }\n+    for (size_t i = n_pool; i < n_pool + n_extra; ++i) {\n+        extratxn.push_back(refs[i]);\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};\n+\n+    bench.run([&] {\n+        PartiallyDownloadedBlock pdb{&pool};\n+        auto res = pdb.InitData(cmpctblock, extratxn);\n+\n+        // if there were duplicates the benchmark will be invalid\n+        // (eg, extra txns will be skipped) and we will receive\n+        // READ_STATUS_FAILED\n+        assert(res == READ_STATUS_OK);\n+    });\n+}\n+\n+static void BlockEncodingNoExtra(benchmark::Bench& bench)\n+{\n+    BlockEncodingBench(bench, 50000, 0);\n+}\n+\n+static void BlockEncodingStdExtra(benchmark::Bench& bench)\n+{\n+    static_assert(DEFAULT_BLOCK_RECONSTRUCTION_EXTRA_TXN == 100);\n+    BlockEncodingBench(bench, 50000, 100);",
      "path": "src/bench/blockencodings.cpp",
      "position": 121,
      "original_position": 121,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "df5a50e5de204013ba56e1c4967a249ca07ba086",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "micro-nit: annotate numbered args",
      "created_at": "2025-08-28T13:21:34Z",
      "updated_at": "2025-08-28T13:32:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2307403680",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307403680"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 121,
      "original_line": 121,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307403840",
      "pull_request_review_id": 3164846536,
      "id": 2307403840,
      "node_id": "PRRC_kwDOABII586JiDBA",
      "diff_hunk": "@@ -0,0 +1,131 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <net_processing.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncodingBench(benchmark::Bench& bench, size_t n_pool, size_t n_extra)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    std::vector<CTransactionRef> extratxn;\n+    extratxn.reserve(n_extra);\n+\n+    // bump up the size of txs\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+\n+    // a reasonably large mempool of 50k txs, ~10MB total\n+    std::vector<CTransactionRef> refs;\n+    refs.reserve(n_pool + n_extra);\n+    for (size_t i = 0; i < n_pool + n_extra; ++i) {\n+        CMutableTransaction tx = CMutableTransaction();\n+        tx.vin.resize(1);\n+        tx.vin[0].scriptSig = CScript() << sigspam;\n+        tx.vin[0].scriptWitness.stack.push_back({1});\n+        tx.vout.resize(1);\n+        tx.vout[0].scriptPubKey = CScript() << OP_1 << OP_EQUAL;\n+        tx.vout[0].nValue = i;\n+        refs.push_back(MakeTransactionRef(tx));\n+    }\n+\n+    // ensure mempool ordering is different to memory ordering of transactions,\n+    // to simulate a mempool that has changed over time\n+    std::shuffle(refs.begin(), refs.end(), rng);\n+\n+    for (size_t i = 0; i < n_pool; ++i) {\n+        AddTx(refs[i], /*fee=*/refs[i]->vout[0].nValue, pool);\n+    }\n+    for (size_t i = n_pool; i < n_pool + n_extra; ++i) {\n+        extratxn.push_back(refs[i]);\n+    }\n+\n+    BenchCBHAST cmpctblock{rng, 3000};\n+\n+    bench.run([&] {\n+        PartiallyDownloadedBlock pdb{&pool};\n+        auto res = pdb.InitData(cmpctblock, extratxn);\n+\n+        // if there were duplicates the benchmark will be invalid\n+        // (eg, extra txns will be skipped) and we will receive\n+        // READ_STATUS_FAILED\n+        assert(res == READ_STATUS_OK);\n+    });\n+}\n+\n+static void BlockEncodingNoExtra(benchmark::Bench& bench)\n+{\n+    BlockEncodingBench(bench, 50000, 0);",
      "path": "src/bench/blockencodings.cpp",
      "position": 115,
      "original_position": 115,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "df5a50e5de204013ba56e1c4967a249ca07ba086",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "micro-nit: annotate numbered args",
      "created_at": "2025-08-28T13:21:37Z",
      "updated_at": "2025-08-28T13:32:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2307403840",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307403840"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 115,
      "original_line": 115,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307415897",
      "pull_request_review_id": 3164846536,
      "id": 2307415897,
      "node_id": "PRRC_kwDOABII586JiF9Z",
      "diff_hunk": "@@ -0,0 +1,131 @@\n+// Copyright (c) 2025-present The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <bench/bench.h>\n+#include <blockencodings.h>\n+#include <consensus/amount.h>\n+#include <kernel/cs_main.h>\n+#include <net_processing.h>\n+#include <primitives/transaction.h>\n+#include <script/script.h>\n+#include <sync.h>\n+#include <test/util/setup_common.h>\n+#include <test/util/txmempool.h>\n+#include <txmempool.h>\n+#include <util/check.h>\n+\n+#include <memory>\n+#include <vector>\n+\n+\n+static void AddTx(const CTransactionRef& tx, const CAmount& fee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n+{\n+    LockPoints lp;\n+    AddToMempool(pool, CTxMemPoolEntry(tx, fee, /*time=*/0, /*entry_height=*/1, /*entry_sequence=*/0, /*spends_coinbase=*/false, /*sigops_cost=*/4, lp));\n+}\n+\n+namespace {\n+class BenchCBHAST : public CBlockHeaderAndShortTxIDs\n+{\n+private:\n+    static CBlock DummyBlock()\n+    {\n+        CBlock block;\n+        block.nVersion = 5;\n+        block.hashPrevBlock.SetNull();\n+        block.hashMerkleRoot.SetNull();\n+        block.nTime = 1231006505;\n+        block.nBits = 0x1d00ffff;\n+        block.nNonce = 2083236893;\n+        block.fChecked = false;\n+        CMutableTransaction tx;\n+        tx.vin.resize(1);\n+        tx.vout.resize(1);\n+        block.vtx.emplace_back(MakeTransactionRef(tx)); // dummy coinbase\n+        return block;\n+    }\n+\n+public:\n+    BenchCBHAST(InsecureRandomContext& rng, int txs) : CBlockHeaderAndShortTxIDs(DummyBlock(), rng.rand64())\n+    {\n+        shorttxids.reserve(txs);\n+        while (txs-- > 0) {\n+            shorttxids.push_back(rng.randbits<SHORTTXIDS_LENGTH*8>());\n+        }\n+    }\n+};\n+} // anon namespace\n+\n+static void BlockEncodingBench(benchmark::Bench& bench, size_t n_pool, size_t n_extra)\n+{\n+    const auto testing_setup = MakeNoLogFileContext<const ChainTestingSetup>(ChainType::MAIN);\n+    CTxMemPool& pool = *Assert(testing_setup->m_node.mempool);\n+    InsecureRandomContext rng(11);\n+\n+    LOCK2(cs_main, pool.cs);\n+\n+    std::vector<CTransactionRef> extratxn;\n+    extratxn.reserve(n_extra);\n+\n+    // bump up the size of txs\n+    std::array<std::byte,200> sigspam;\n+    sigspam.fill(std::byte(42));\n+\n+    // a reasonably large mempool of 50k txs, ~10MB total",
      "path": "src/bench/blockencodings.cpp",
      "position": 75,
      "original_position": 75,
      "commit_id": "b7b249d3adfbd3c7b0c4d0499a86300f57982972",
      "original_commit_id": "df5a50e5de204013ba56e1c4967a249ca07ba086",
      "in_reply_to_id": null,
      "user": {
        "login": "instagibbs",
        "id": 5767891,
        "node_id": "MDQ6VXNlcjU3Njc4OTE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/instagibbs",
        "html_url": "https://github.com/instagibbs",
        "followers_url": "https://api.github.com/users/instagibbs/followers",
        "following_url": "https://api.github.com/users/instagibbs/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/instagibbs/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/instagibbs/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
        "organizations_url": "https://api.github.com/users/instagibbs/orgs",
        "repos_url": "https://api.github.com/users/instagibbs/repos",
        "events_url": "https://api.github.com/users/instagibbs/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/instagibbs/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "```Suggestion\r\n    // a reasonably large mempool of 50k txs, ~10MB total plus variable extra txns\r\n```",
      "created_at": "2025-08-28T13:25:51Z",
      "updated_at": "2025-08-28T13:32:23Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/33253#discussion_r2307415897",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/2307415897"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/33253"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 75,
      "original_line": 75,
      "side": "RIGHT"
    }
  ]
}