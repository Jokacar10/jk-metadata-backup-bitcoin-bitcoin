{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792",
    "id": 2313554406,
    "node_id": "PR_kwDOABII586J5gnm",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31792",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31792.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31792.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/dd2714ed13eea3591162dbade8132ff517ca5509",
    "number": 31792,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "Double check all block rules in `ConnectBlock`, not only `CheckBlock`",
    "user": {
      "login": "darosior",
      "id": 22457751,
      "node_id": "MDQ6VXNlcjIyNDU3NzUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/darosior",
      "html_url": "https://github.com/darosior",
      "followers_url": "https://api.github.com/users/darosior/followers",
      "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
      "organizations_url": "https://api.github.com/users/darosior/orgs",
      "repos_url": "https://api.github.com/users/darosior/repos",
      "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/darosior/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "We currently only sanity check `CheckBlock()` in `ConnectBlock()`. Not running the rest of the block\r\nchecks makes it hard to reason about upgrade edge cases if we were to introduce new consensus rules\r\n(which would necessarily be context-dependent checks). For instance a timewarp fix or a BIP34\r\nsupplementation.\r\n\r\nThis is fine to do as the expensive check in `ContextualCheckBlock()` is cached since\r\n1ec6bbeb8d27d31647d1433ccb87b362f6d81f90 and the future-timestamp check is split out of\r\n`ContextualCheckBlockHeader()` beforehand.",
    "labels": [
      {
        "id": 5334691551,
        "node_id": "LA_kwDOABII588AAAABPfju3w",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/CI%20failed",
        "name": "CI failed",
        "description": "",
        "color": "cccccc",
        "default": false
      }
    ],
    "created_at": "2025-02-03T20:12:44Z",
    "updated_at": "2025-02-04T23:05:11Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merge_commit_sha": "b6a0d1b130cac0f6ffb77ea63a4d22219885b64a",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "darosior:2502_ctx_checks_in_connectblock",
      "ref": "2502_ctx_checks_in_connectblock",
      "sha": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 168868367,
        "node_id": "MDEwOlJlcG9zaXRvcnkxNjg4NjgzNjc=",
        "name": "bitcoin",
        "full_name": "darosior/bitcoin",
        "owner": {
          "login": "darosior",
          "id": 22457751,
          "node_id": "MDQ6VXNlcjIyNDU3NzUx",
          "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/darosior",
          "html_url": "https://github.com/darosior",
          "followers_url": "https://api.github.com/users/darosior/followers",
          "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
          "organizations_url": "https://api.github.com/users/darosior/orgs",
          "repos_url": "https://api.github.com/users/darosior/repos",
          "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/darosior/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/darosior/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/darosior/bitcoin",
        "archive_url": "https://api.github.com/repos/darosior/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/darosior/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/darosior/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/darosior/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/darosior/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/darosior/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/darosior/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/darosior/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/darosior/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/darosior/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/darosior/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/darosior/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/darosior/bitcoin/events",
        "forks_url": "https://api.github.com/repos/darosior/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/darosior/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/darosior/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/darosior/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/darosior/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/darosior/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/darosior/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/darosior/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/darosior/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/darosior/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/darosior/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/darosior/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/darosior/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/darosior/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/darosior/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/darosior/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:darosior/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/darosior/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/darosior/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/darosior/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/darosior/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/darosior/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/darosior/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/darosior/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/darosior/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/darosior/bitcoin/hooks",
        "svn_url": "https://github.com/darosior/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 2,
        "watchers_count": 2,
        "size": 256617,
        "default_branch": "master",
        "open_issues_count": 0,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-02-04T15:54:06Z",
        "created_at": "2019-02-02T19:20:27Z",
        "updated_at": "2024-11-20T13:45:57Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "94ca99ac51dddbee79d6409ebcc43b1119b0aca9",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36661,
        "stargazers_count": 81813,
        "watchers_count": 81813,
        "size": 275076,
        "default_branch": "master",
        "open_issues_count": 701,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-02-04T10:10:33Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-02-04T23:05:40Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
      }
    },
    "author_association": "MEMBER",
    "draft": false,
    "additions": 194,
    "deletions": 184,
    "changed_files": 3,
    "commits": 4,
    "review_comments": 6,
    "comments": 4
  },
  "events": [
    {
      "event": "commented",
      "id": 2631973272,
      "node_id": "IC_kwDOABII586c4LmY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2631973272",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-03T20:12:47Z",
      "updated_at": "2025-02-04T11:17:44Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31792.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [TheCharlatan](https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592504179) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31714](https://github.com/bitcoin/bitcoin/pull/31714) (validation: Do less work in NeedsRedownload by mzumsande)\n* [#31649](https://github.com/bitcoin/bitcoin/pull/31649) (consensus: Remove checkpoints (take 2) by marcofleon)\n* [#31564](https://github.com/bitcoin/bitcoin/pull/31564) (Add checkblock RPC and checkBlock() to Mining interface by Sjors)\n* [#31250](https://github.com/bitcoin/bitcoin/pull/31250) (wallet: Disable creating and loading legacy wallets by achow101)\n* [#29641](https://github.com/bitcoin/bitcoin/pull/29641) (scripted-diff: Use LogInfo over LogPrintf [WIP, NOMERGE, DRAFT] by maflcko)\n* [#28710](https://github.com/bitcoin/bitcoin/pull/28710) (Remove the legacy wallet and BDB dependency by achow101)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2631973272",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "labeled",
      "id": 16168614308,
      "node_id": "LE_lADOABII586olmcWzwAAAAPDuXmk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16168614308",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-03T21:19:50Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "reviewed",
      "id": 2592216351,
      "node_id": "PRR_kwDOABII586aghUf",
      "url": null,
      "actor": null,
      "commit_id": "9b1c7e24175d142e1fcc2b64a9d3ba842f0ae9f9",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "Armss9936",
        "id": 193652958,
        "node_id": "U_kgDOC4ro3g",
        "avatar_url": "https://avatars.githubusercontent.com/u/193652958?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Armss9936",
        "html_url": "https://github.com/Armss9936",
        "followers_url": "https://api.github.com/users/Armss9936/followers",
        "following_url": "https://api.github.com/users/Armss9936/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Armss9936/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Armss9936/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Armss9936/subscriptions",
        "organizations_url": "https://api.github.com/users/Armss9936/orgs",
        "repos_url": "https://api.github.com/users/Armss9936/repos",
        "events_url": "https://api.github.com/users/Armss9936/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Armss9936/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592216351",
      "submitted_at": "2025-02-04T09:24:39Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "reviewed",
      "id": 2592270272,
      "node_id": "PRR_kwDOABII586agufA",
      "url": null,
      "actor": null,
      "commit_id": "9b1c7e24175d142e1fcc2b64a9d3ba842f0ae9f9",
      "commit_url": null,
      "created_at": null,
      "author_association": "NONE",
      "body": "",
      "user": {
        "login": "Armss9936",
        "id": 193652958,
        "node_id": "U_kgDOC4ro3g",
        "avatar_url": "https://avatars.githubusercontent.com/u/193652958?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/Armss9936",
        "html_url": "https://github.com/Armss9936",
        "followers_url": "https://api.github.com/users/Armss9936/followers",
        "following_url": "https://api.github.com/users/Armss9936/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/Armss9936/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/Armss9936/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/Armss9936/subscriptions",
        "organizations_url": "https://api.github.com/users/Armss9936/orgs",
        "repos_url": "https://api.github.com/users/Armss9936/repos",
        "events_url": "https://api.github.com/users/Armss9936/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/Armss9936/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592270272",
      "submitted_at": "2025-02-04T09:43:15Z",
      "state": "APPROVED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "reviewed",
      "id": 2592504179,
      "node_id": "PRR_kwDOABII586ahnlz",
      "url": null,
      "actor": null,
      "commit_id": "9b1c7e24175d142e1fcc2b64a9d3ba842f0ae9f9",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2592504179",
      "submitted_at": "2025-02-04T11:17:41Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "reviewed",
      "id": 2593082094,
      "node_id": "PRR_kwDOABII586aj0ru",
      "url": null,
      "actor": null,
      "commit_id": "1cf2721d2fcc6000611f790dcebf7d8850214de0",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2593082094",
      "submitted_at": "2025-02-04T14:40:02Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "commented",
      "id": 2634312015,
      "node_id": "IC_kwDOABII586dBGlP",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2634312015",
      "actor": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-04T15:27:16Z",
      "updated_at": "2025-02-04T15:27:16Z",
      "author_association": "CONTRIBUTOR",
      "body": "I think what you're doing here is:\r\n\r\n * redoing the contextual checks in ConnectBlock\r\n * currently, this could result in errors on startup if we accepted a block with timestamp T, but then our clock went backwards and is now set to a time prior to T-2 hours\r\n * so to avoid that, we move the T+2h check out of the contextual checks into its own special function, and call that from the appropriate places\r\n * once we redo contextual checks in ConnectBlock, `verifychain` rpc can detect contexual errors, so check that it does (should also check `-reindex-chainstate` sees them too?)\r\n\r\nI think it would be better to just add declarations for the functions rather than shuffling the code around, and I would have separated the commits a bit differently, more like https://github.com/ajtowns/bitcoin/commits/202502-pr31792/ (except with explanations in the commit messages)\r\n\r\nI'm not sure what the behaviour is now vs with this patch in the situation where you're node has followed a high work chain that is no longer valid under a newer version's rules. I think so long as the block that violates the rule is more than 6 blocks behind the tip, that both will just continue following the invalid chain until you manually -reindex. Will running verifychain with this PR just cause your node to crash rather than to reorg? It might be good to replace this comment:\r\n\r\n```c++\r\n    // NOTE: We don't currently (re-)invoke ContextualCheckBlock() or\r\n    // ContextualCheckBlockHeader() here. This means that if we add a new\r\n    // consensus rule that is enforced in one of those two functions, then we\r\n    // may have let in a block that violates the rule prior to updating the\r\n    // software, and we would NOT be enforcing the rule here. Fully solving\r\n    // upgrade from one software version to the next after a consensus rule\r\n    // change is potentially tricky and issue-specific (see NeedsRedownload()\r\n    // for one approach that was used for BIP 141 deployment).\r\n```\r\n\r\nwith the actual post-this-PR upgrade-behaviour, rather than just deleting it?",
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2634312015",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16181298348,
      "node_id": "HRFPE_lADOABII586olmcWzwAAAAPEewSs",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16181298348",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b4a3cd6855fd0f6b9129cfc32a84cdef735710e9",
      "commit_url": "https://api.github.com/repos/darosior/bitcoin/commits/b4a3cd6855fd0f6b9129cfc32a84cdef735710e9",
      "created_at": "2025-02-04T15:51:41Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFlMjA5MmE5NzllZGFlMjQwMjdlY2FiMDY2YjNiMjRlZTk4N2EwMjM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e2092a979edae24027ecab066b3b24ee987a023",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1e2092a979edae24027ecab066b3b24ee987a023",
      "tree": {
        "sha": "cbc051c45247c1f22a291332b4a031ff8d59c158",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cbc051c45247c1f22a291332b4a031ff8d59c158"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree cbc051c45247c1f22a291332b4a031ff8d59c158\nparent 1172bc4157eefe80d1aaf0b56459857ec651e535\nauthor Antoine Poinsot <darosior@protonmail.com> 1738606061 -0500\ncommitter Antoine Poinsot <darosior@protonmail.com> 1738684432 +0100\n\nvalidation: split future timestamp check out of CtxCheckBlockHeader\n\nA call to ContextualCheckBlockHeader is added to ConnectBlock in the\nfollowing commits, but it should not re-check the timestamp of the\nheader there. Move the timestamp check into a separate function to avoid\nthis.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEWQtykmla/6W2csuy4T/BRc0/QwQFAmeiOBAACgkQ4T/BRc0/\nQwT+mAv8DlQZa0EicMSPXUzy+/JhucuPnSFZZoYEFMuOB8EYYfP2yIFhsry06Pxf\ncSGLBOEzORtPu+kqhCbc3V8+f+6OmXlthmMPoMEiAzhe3sVL2iNEC6MZIJkg88hX\njAmXlw3+JK6TQ0EhAGY1JRY/sgR9/p3sIKAAiXqHnz/YEmJeMKK+hdHnMohfKFF7\nz/vpqLb3WSskW5tjunYsgCv504kTlMZrR9ERoawtDbhh7iPKBIigShxMqapU0iZT\nWp8R5mdlJXzN+V8W+j+Dwg0JzNODEMBCzBV7VtuwldO53cKG82RCyD09ASDiqNQj\ngNJpIMSexcBprRxA1jZM0ObO5HFnDjqt9RkzSVgFzJe9D7ci/addm8vTwzV75wXf\n64/HKqt1PLldBO6ggJ3+ZufyxbfVew+DRYtznPgmSIgyDq+YAf7W1FLqtIi8vx9s\nk9hfEdFPFL7EudO/BJMaVWMvJ2H5MC/aJ3+7GUNil4NaNBdD2sJISxJPZvZo/eI8\nP3e+Mlrg\n=kEqH\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1172bc4157eefe80d1aaf0b56459857ec651e535",
          "sha": "1172bc4157eefe80d1aaf0b56459857ec651e535",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1172bc4157eefe80d1aaf0b56459857ec651e535"
        }
      ],
      "message": "validation: split future timestamp check out of CtxCheckBlockHeader\n\nA call to ContextualCheckBlockHeader is added to ConnectBlock in the\nfollowing commits, but it should not re-check the timestamp of the\nheader there. Move the timestamp check into a separate function to avoid\nthis.",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-04T15:53:52Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-03T18:07:41Z"
      },
      "sha": "1e2092a979edae24027ecab066b3b24ee987a023"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGMwMjI5M2E5NDZjODFmNzJiYzBlMzZjMWQ3YmY0OTVlOTI2NTIwZGU",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c02293a946c81f72bc0e36c1d7bf495e926520de",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/c02293a946c81f72bc0e36c1d7bf495e926520de",
      "tree": {
        "sha": "c0ed380d59b739341c93bdc6e30b0b1f472c33c0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c0ed380d59b739341c93bdc6e30b0b1f472c33c0"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree c0ed380d59b739341c93bdc6e30b0b1f472c33c0\nparent 1e2092a979edae24027ecab066b3b24ee987a023\nauthor Antoine Poinsot <darosior@protonmail.com> 1738608355 -0500\ncommitter Antoine Poinsot <darosior@protonmail.com> 1738684433 +0100\n\n[MOVEONLY] validation: move CtxCheck{Block, Header} above ConnectBlock\n\nIn the next commit we'll call them from there.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEWQtykmla/6W2csuy4T/BRc0/QwQFAmeiOBEACgkQ4T/BRc0/\nQwT4gQwAvndHpGcO0gTx4aSq/iwooFVhXxCHMkFlVrVlsFI+n+aBk6+vct89mYNR\nuBURMWXAr3mdao57UQa5+cUrNDKYMz238dJXG6QtNrieevOBcHeKlegqPxm6rpNm\nc3bMRreclP4R7o8P9oYg/Zziy5u9w9GD0ARkZs7jWLIvF8kSKYwgPDDUQj7UwJmW\n3Ch87Gb2bl14wLGTH7Uhb/iARRZFt2nWz8dR5ZzZZu7dSPE3Hf0n0z69vniWR2ZR\nzMidB+FIqvSbGPW4zmAI1Xc0tAecxzhxs7tkC4B/gOfpVpdxbqgDJNxlhwTRyY4r\nTu8MjDi/DKBqv6HFs0qxePj5LiVXL54aiI25TLV/Dwt4O5aJvWCD0E+JXOEsiR7X\n0luLeYuZ3blUXyxtsg/LrEsZ5mqx4L5MQOZrXgCoj4QO9o0s19CquMm5a+ZHgQcR\nDniNKTX5/EclETkbjtmbDRnSOVkorhr/o2CaoVUz/gzMegIN5/MAGA+TkEoFyeTz\ncDnB/4sD\n=dqBY\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1e2092a979edae24027ecab066b3b24ee987a023",
          "sha": "1e2092a979edae24027ecab066b3b24ee987a023",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1e2092a979edae24027ecab066b3b24ee987a023"
        }
      ],
      "message": "[MOVEONLY] validation: move CtxCheck{Block, Header} above ConnectBlock\n\nIn the next commit we'll call them from there.",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-04T15:53:53Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-03T18:45:55Z"
      },
      "sha": "c02293a946c81f72bc0e36c1d7bf495e926520de"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDFjZmQ1YzI0OTM2YjQ4NDEzYjc2ZjU4ODU5ZDMwMmI2NGZiNWZlN2Q",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cfd5c24936b48413b76f58859d302b64fb5fe7d",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/1cfd5c24936b48413b76f58859d302b64fb5fe7d",
      "tree": {
        "sha": "116f21480499e9f529a9007bb81322b1dbb58b15",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/116f21480499e9f529a9007bb81322b1dbb58b15"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 116f21480499e9f529a9007bb81322b1dbb58b15\nparent c02293a946c81f72bc0e36c1d7bf495e926520de\nauthor Antoine Poinsot <darosior@protonmail.com> 1738608968 -0500\ncommitter Antoine Poinsot <darosior@protonmail.com> 1738684434 +0100\n\nvalidation: check for bad block against CtxCheckBlock(Header) in ConnectBlock\n\nWe currently only sanity check CheckBlock() in ConnectBlock(). Not running the rest of the block\nchecks makes it hard to reason about upgrade edge cases if we were to introduce new consensus rules\n(which would necessarily be context-dependent checks). For instance a timewarp fix or a BIP34\nsupplementation.\n\nThis is fine to do as the expensive check in ContextualCheckBlock() is checked since\n1ec6bbeb8d27d31647d1433ccb87b362f6d81f90 and the future-timestamp check was split out of\nContextualCheckBlockHeader() beforehand.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEWQtykmla/6W2csuy4T/BRc0/QwQFAmeiOBIACgkQ4T/BRc0/\nQwR5TQv/WeFW4lKeuGOvl5JMnP/ayTFLWtb7cdpq5M3+CgiJDmY05a9pIv1YkFsP\nDimVCquJGi65gOa9khABeat5yFjtQM9tppDbABlLcEuy877hoga4wWm/x4l7GDsw\nDtCzsY1tMi7svZBhO7GIimrIHvz1me7l0g3GSsWSH/yv4DUyvK3cDhbUlfnZa1zX\n8gKERGrXcKNALLLjtJJUxvACZXPYg03v4dm62iXRuqzBEDWaznITpyN+oKyoBc77\nMIXsSg6gjmo2dGwE4jADGDdpp8RHlY0VhrX0Cm7qtLGQvzTjDTIq5o9XOTUVho9s\npEmuhGgmHdiPBGSyEOYg2SSaqbxYGFbnXbjrMaGGpyX75NOCvKOsKF8sahIg8mWZ\nGpV557Jn9fo7RmScztPaG41dcSTxYZc1caLybxx/QxM+mTQj1KkkLhHFQW9Uvx/p\nqYEHwKa74XENV/AyhjjUENfZFp/UCDklPglTOYY/SdCebKZlug3pfhzP0aJY8Q14\n/MoHyNsi\n=W5je\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c02293a946c81f72bc0e36c1d7bf495e926520de",
          "sha": "c02293a946c81f72bc0e36c1d7bf495e926520de",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/c02293a946c81f72bc0e36c1d7bf495e926520de"
        }
      ],
      "message": "validation: check for bad block against CtxCheckBlock(Header) in ConnectBlock\n\nWe currently only sanity check CheckBlock() in ConnectBlock(). Not running the rest of the block\nchecks makes it hard to reason about upgrade edge cases if we were to introduce new consensus rules\n(which would necessarily be context-dependent checks). For instance a timewarp fix or a BIP34\nsupplementation.\n\nThis is fine to do as the expensive check in ContextualCheckBlock() is checked since\n1ec6bbeb8d27d31647d1433ccb87b362f6d81f90 and the future-timestamp check was split out of\nContextualCheckBlockHeader() beforehand.",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-04T15:53:54Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-03T18:56:08Z"
      },
      "sha": "1cfd5c24936b48413b76f58859d302b64fb5fe7d"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRkMjcxNGVkMTNlZWEzNTkxMTYyZGJhZGU4MTMyZmY1MTdjYTU1MDk",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/dd2714ed13eea3591162dbade8132ff517ca5509",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/dd2714ed13eea3591162dbade8132ff517ca5509",
      "tree": {
        "sha": "54041b09222f4a744e87fdfd5ec9780e7ab7f412",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/54041b09222f4a744e87fdfd5ec9780e7ab7f412"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 54041b09222f4a744e87fdfd5ec9780e7ab7f412\nparent 1cfd5c24936b48413b76f58859d302b64fb5fe7d\nauthor Antoine Poinsot <darosior@protonmail.com> 1738613072 -0500\ncommitter Antoine Poinsot <darosior@protonmail.com> 1738684434 +0100\n\nqa: sanity check ConnectBlock now checks all rules\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEEWQtykmla/6W2csuy4T/BRc0/QwQFAmeiOBIACgkQ4T/BRc0/\nQwRqkQwAgL1+cwkBp8FLr3QPpRLf+wW5hbbdSaM0KFivCGFyuLXexAxd7wnFPGJw\nRyB6sVUs9kP2GIGrOLWWxuhQc8kLcdxeG+XU8e3jS7AQAwuyC6i3kIyb+HqF/SVM\nT3J686XJiUaZciKHjL7oyDhAz50udDdotasmNHpuHM6dSNZNxLZgOTliaQ/9fGRW\n/H5vzMnTXFYrZ/IIJ0mdei9YcaJN9vhbz1vaVgMXtxNvoxKG4fyabtj03joPt8o8\nykL2RtBFgRcTqkEUR7SZTJEEEpmp9LxT8fq+JXEBbsLLk7ipPHGN9/FT1sNtbn2m\ndvOKjX/YNTza9C881+xGtLYmbHHrEvaq+QLdBdsLxsYah0UVxJq4PeEAlUOzjz89\noOTRvfdZbyjs6Z/wZxyDjfJKUa+BNRly77sfRrzHaOlpl5A32bFtpfPSZfPGZrxA\n+fB+sMaACrOH8fioCXgsQXq5cb0ziMvN/NK2tPrqVKvtlawGxrPo5ghvTMmQoA7Q\nCdOGP2yJ\n=IDuL\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1cfd5c24936b48413b76f58859d302b64fb5fe7d",
          "sha": "1cfd5c24936b48413b76f58859d302b64fb5fe7d",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/1cfd5c24936b48413b76f58859d302b64fb5fe7d"
        }
      ],
      "message": "qa: sanity check ConnectBlock now checks all rules",
      "committer": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-04T15:53:54Z"
      },
      "author": {
        "name": "Antoine Poinsot",
        "email": "darosior@protonmail.com",
        "date": "2025-02-03T20:04:32Z"
      },
      "sha": "dd2714ed13eea3591162dbade8132ff517ca5509"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16181334672,
      "node_id": "HRFPE_lADOABII586olmcWzwAAAAPEe5KQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16181334672",
      "actor": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "commit_url": "https://api.github.com/repos/darosior/bitcoin/commits/dd2714ed13eea3591162dbade8132ff517ca5509",
      "created_at": "2025-02-04T15:54:08Z"
    },
    {
      "event": "reviewed",
      "id": 2593464262,
      "node_id": "PRR_kwDOABII586alR_G",
      "url": null,
      "actor": null,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "> This is fine to do as the expensive check in ContextualCheckBlock() is cached since\r\nhttps://github.com/bitcoin/bitcoin/commit/1ec6bbeb8d27d31647d1433ccb87b362f6d81f90\r\n\r\nAs discussed out of band, only the most recent block will be cached in memory and passed to `ActivateBestChain` / `ConnectTip`. During IBD when blocks arrive out of order ABC will frequently connect multiple blocks, which then need to be reloaded from disk during `ConnectTip()` . For these, the `CheckWitnessMalleation` check will be done twice after this PR, so there is a possible performance impact on IBD.",
      "user": {
        "login": "mzumsande",
        "id": 48763452,
        "node_id": "MDQ6VXNlcjQ4NzYzNDUy",
        "avatar_url": "https://avatars.githubusercontent.com/u/48763452?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/mzumsande",
        "html_url": "https://github.com/mzumsande",
        "followers_url": "https://api.github.com/users/mzumsande/followers",
        "following_url": "https://api.github.com/users/mzumsande/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/mzumsande/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/mzumsande/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/mzumsande/subscriptions",
        "organizations_url": "https://api.github.com/users/mzumsande/orgs",
        "repos_url": "https://api.github.com/users/mzumsande/repos",
        "events_url": "https://api.github.com/users/mzumsande/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/mzumsande/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#pullrequestreview-2593464262",
      "submitted_at": "2025-02-04T16:45:27Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
    },
    {
      "event": "commented",
      "id": 2634905893,
      "node_id": "IC_kwDOABII586dDXkl",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2634905893",
      "actor": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-04T19:42:16Z",
      "updated_at": "2025-02-04T19:42:16Z",
      "author_association": "MEMBER",
      "body": "I seem to have a problem running IBD with this change @ dd2714ed13eea3591162dbade8132ff517ca5509, which I have not investigated yet:\r\n\r\n<details>\r\n<summary>tail debug.log</summary>\r\n\r\n```log\r\n<snip>\r\n2025-02-04T19:38:24Z init message: Verifying blocks…\r\n2025-02-04T19:38:24Z Block index and chainstate loaded\r\n2025-02-04T19:38:24Z Setting NODE_NETWORK on non-prune mode\r\n2025-02-04T19:38:24Z initload thread start\r\n2025-02-04T19:38:24Z [bench]   - Load block from disk: 0.05ms\r\n2025-02-04T19:38:24Z [validation] BlockChecked: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f state=Valid\r\n2025-02-04T19:38:24Z [bench]   - Connect total: 0.05ms [0.00s (0.05ms/blk)]\r\n2025-02-04T19:38:24Z [bench]   - Flush: 0.02ms [0.00s (0.02ms/blk)]\r\n2025-02-04T19:38:24Z [bench]   - Writing chainstate: 0.01ms [0.00s (0.01ms/blk)]\r\n2025-02-04T19:38:24Z [validation] Enqueuing MempoolTransactionsRemovedForBlock: block height=0 txs removed=0\r\n2025-02-04T19:38:24Z UpdateTip: new best=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f height=0 version=0x00000001 log2_work=32.000022 tx=1 date='2009-01-03T18:15:05Z' progress=0.000000 cache=0.3MiB(0txo)\r\n2025-02-04T19:38:24Z [bench]   - Connect postprocess: 0.06ms [0.00s (0.06ms/blk)]\r\n2025-02-04T19:38:24Z [bench] - Connect block: 0.19ms [0.00s (0.19ms/blk)]\r\n2025-02-04T19:38:24Z [validation] Enqueuing BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:38:24Z [validation] Enqueuing UpdatedBlockTip: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f fork block hash=null (in IBD=true)\r\n2025-02-04T19:38:24Z [validation] ActiveTipChange: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:38:24Z [validation] MempoolTransactionsRemovedForBlock: block height=0 txs removed=0\r\n2025-02-04T19:38:24Z block tree size = 1\r\n2025-02-04T19:38:24Z nBestHeight = 0\r\n2025-02-04T19:38:24Z [validation] BlockConnected: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:38:24Z init message: Starting network threads…\r\n2025-02-04T19:38:24Z Failed to open mempool file. Continuing anyway.\r\n2025-02-04T19:38:24Z initload thread exit\r\n2025-02-04T19:38:24Z DNS seeding disabled\r\n2025-02-04T19:38:24Z net thread start\r\n2025-02-04T19:38:24Z init message: Done loading\r\n2025-02-04T19:38:24Z addcon thread start\r\n2025-02-04T19:38:24Z msghand thread start\r\n2025-02-04T19:38:24Z opencon thread start\r\n2025-02-04T19:38:24Z [validation] UpdatedBlockTip: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f fork block hash=null (in IBD=true)\r\n2025-02-04T19:38:24Z New manual v2 peer connected: version: 70016, blocks=882316, peer=0\r\n2025-02-04T19:38:24Z Pre-synchronizing blockheaders, height: 2000 (~0.24%)\r\n2025-02-04T19:38:25Z Pre-synchronizing blockheaders, height: 18000 (~2.14%)\r\n\r\n<snip>\r\n\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000002f0aba7c60667df80ee657873bfa22e5dba80f13fafcb height=859992\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000002e66a5fe60350d7a5900c797dde1ac989e36de05e2cf3 height=859993\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000220ed045522462a2a96bc3e3898364f19dad67fe842a8 height=859994\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000124d178d6056cf493873ba3a865eb2a4fc64e2e9b2ccb height=859995\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000000bc91fb6007041636f724770df4d16184af479102c69e height=859996\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=000000000000000000028c2e4e0e6e83da708aabf189b252e5f8f62cbd090053 height=859997\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=00000000000000000000de531aab72aa763d8f1dea92efdb47c96ea5d209b8ef height=859998\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000196a7111c7aa3368af5a803a81c7bfb32860100dfd9c7 height=859999\r\n2025-02-04T19:38:43Z [validation] Saw new header hash=0000000000000000000095dd5c0c8e176a6498eb335c491b96df1a1ae178bfbd height=860000\r\n2025-02-04T19:38:43Z Synchronizing blockheaders, height: 860000 (~97.51%)\r\n2025-02-04T19:31:58Z [bench]   - Using cached block\r\n2025-02-04T19:31:58Z [bench]   - Load block from disk: 0.01ms\r\n2025-02-04T19:31:58Z ERROR: ContextualCheckBlockHeader: forked chain older than last checkpoint (height 1)\r\n2025-02-04T19:31:58Z [error] ConnectBlock: Consensus::ContextualCheckBlockHeader: bad-fork-prior-to-checkpoint\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048 state=bad-fork-prior-to-checkpoint\r\n2025-02-04T19:31:58Z InvalidChainFound: invalid block=00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048  height=1  log2_work=33.000022  date=2009-01-09T02:54:25Z\r\n2025-02-04T19:31:58Z InvalidChainFound:  current best=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f  height=0  log2_work=32.000022  date=2009-01-03T18:15:05Z\r\n2025-02-04T19:31:58Z [error] ConnectTip: ConnectBlock 00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048 failed, bad-fork-prior-to-checkpoint\r\n2025-02-04T19:31:58Z InvalidChainFound: invalid block=00000000839a8e6886ab5951d76f411475428afc90947ee320161bbf18eb6048  height=1  log2_work=33.000022  date=2009-01-09T02:54:25Z\r\n2025-02-04T19:31:58Z InvalidChainFound:  current best=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f  height=0  log2_work=32.000022  date=2009-01-03T18:15:05Z\r\n2025-02-04T19:31:58Z [validation] ActiveTipChange: new block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f block height=0\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000006a625f06636b8bb6ac7b960a8d03705d1ace08b1a19da3fdcc99ddbd is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000006a625f06636b8bb6ac7b960a8d03705d1ace08b1a19da3fdcc99ddbd state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000082b5015589a3fdf2d4baff403e6f0be035a5d9742c1cae6295464449 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000082b5015589a3fdf2d4baff403e6f0be035a5d9742c1cae6295464449 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000004ebadb55ee9096c9a2f8880e09da59c0d68b1c228da88e48844a1485 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000004ebadb55ee9096c9a2f8880e09da59c0d68b1c228da88e48844a1485 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000009b7262315dbf071787ad3656097b892abffd1f95a1a022f896f533fc is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000009b7262315dbf071787ad3656097b892abffd1f95a1a022f896f533fc state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000003031a0e73735690c5a1ff2a4be82553b2a12b776fbd3a215dc8f778d is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000003031a0e73735690c5a1ff2a4be82553b2a12b776fbd3a215dc8f778d state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000071966c2b1d065fd446b1e485b2c9d9594acd2007ccbd5441cfc89444 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000071966c2b1d065fd446b1e485b2c9d9594acd2007ccbd5441cfc89444 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 00000000408c48f847aa786c2268fc3e6ec2af68e8468a34a28c61b7f1de0dc6 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000408c48f847aa786c2268fc3e6ec2af68e8468a34a28c61b7f1de0dc6 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000008d9dc510f23c2657fc4f67bea30078cc05a90eb89e84cc475c080805 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000008d9dc510f23c2657fc4f67bea30078cc05a90eb89e84cc475c080805 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000002c05cc2e78923c34df87fd108b22221ac6076c18f3ade378a4d915e9 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000002c05cc2e78923c34df87fd108b22221ac6076c18f3ade378a4d915e9 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000097be56d606cdd9c54b04d4747e957d3608abe69198c661f2add73073 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000097be56d606cdd9c54b04d4747e957d3608abe69198c661f2add73073 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000027c2488e2510d1acf4369787784fa20ee084c258b58d9fbd43802b5e is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000027c2488e2510d1acf4369787784fa20ee084c258b58d9fbd43802b5e state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 000000005c51de2031a895adc145ee2242e919a01c6d61fb222a54a54b4d3089 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=000000005c51de2031a895adc145ee2242e919a01c6d61fb222a54a54b4d3089 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 0000000080f17a0c5a67f663a9bc9969eb37e81666d9321125f0e293656f8a37 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=0000000080f17a0c5a67f663a9bc9969eb37e81666d9321125f0e293656f8a37 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 00000000b3322c8c3ef7d2cf6da009a776e6a99ee65ec5a32f3f345712238473 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000b3322c8c3ef7d2cf6da009a776e6a99ee65ec5a32f3f345712238473 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] AcceptBlockHeader: block 00000000174a25bb399b009cc8deff1c4b3ea84df7e93affaaf60dc3416cc4f5 is marked invalid\r\n2025-02-04T19:31:58Z [validation] BlockChecked: block hash=00000000174a25bb399b009cc8deff1c4b3ea84df7e93affaaf60dc3416cc4f5 state=duplicate-invalid\r\n2025-02-04T19:31:58Z [error] ProcessNewBlock: AcceptBlock FAILED (duplicate-invalid)\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n2025-02-04T19:31:58Z [validation] header 00000000000000000001b3fc0c62b55c57a0d46b4069100ab041af9c345a1059 has prev block invalid: 0000000000000000000095dd5c0c8e176a6498eb335c491b96df1a1ae178bfbd\r\n2025-02-04T19:31:58Z Warning: not punishing manually connected peer 0!\r\n^C2025-02-04T19:32:03Z Shutdown: In progress...\r\n2025-02-04T19:32:03Z opencon thread exit\r\n2025-02-04T19:32:03Z addcon thread exit\r\n2025-02-04T19:32:03Z net thread exit\r\n2025-02-04T19:32:03Z msghand thread exit\r\n2025-02-04T19:32:03Z scheduler thread exit\r\n2025-02-04T19:32:03Z Writing 0 mempool transactions to file...\r\n2025-02-04T19:32:03Z Writing 0 unbroadcast transactions to file.\r\n2025-02-04T19:32:03Z Dumped mempool: 0.000s to copy, 0.006s to dump, 27 bytes dumped to file\r\n2025-02-04T19:32:03Z Flushed fee estimates to fee_estimates.dat.\r\n2025-02-04T19:32:03Z [bench] FlushStateToDisk: write block and undo data to disk started\r\n2025-02-04T19:32:03Z [bench] FlushStateToDisk: write block and undo data to disk completed (16.65ms)\r\n2025-02-04T19:32:03Z [bench] FlushStateToDisk: write block index to disk started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block index to disk completed (1348.48ms)\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) completed (0.03ms)\r\n2025-02-04T19:32:05Z [validation] Enqueuing ChainStateFlushed: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\r\n2025-02-04T19:32:05Z [validation] ChainStateFlushed: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block and undo data to disk started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block and undo data to disk completed (27.61ms)\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block index to disk started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write block index to disk completed (5.74ms)\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) started\r\n2025-02-04T19:32:05Z [bench] FlushStateToDisk: write coins cache to disk (0 coins, 256KiB) completed (0.03ms)\r\n2025-02-04T19:32:05Z [validation] Enqueuing ChainStateFlushed: block hash=000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f\r\n2025-02-04T19:32:05Z Shutdown: done\r\n```\r\n\r\n</details>\r\n\r\nI connected to a single manual peer which is why `Warning: not punishing manually connected peer 0!` appears. With a selection of network peers I observed an endless header presync->sync->presync loop.",
      "user": {
        "login": "willcl-ark",
        "id": 6606587,
        "node_id": "MDQ6VXNlcjY2MDY1ODc=",
        "avatar_url": "https://avatars.githubusercontent.com/u/6606587?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/willcl-ark",
        "html_url": "https://github.com/willcl-ark",
        "followers_url": "https://api.github.com/users/willcl-ark/followers",
        "following_url": "https://api.github.com/users/willcl-ark/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/willcl-ark/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/willcl-ark/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/willcl-ark/subscriptions",
        "organizations_url": "https://api.github.com/users/willcl-ark/orgs",
        "repos_url": "https://api.github.com/users/willcl-ark/repos",
        "events_url": "https://api.github.com/users/willcl-ark/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/willcl-ark/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2634905893",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    },
    {
      "event": "commented",
      "id": 2635261821,
      "node_id": "IC_kwDOABII586dEud9",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2635261821",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-04T23:05:11Z",
      "updated_at": "2025-02-04T23:05:11Z",
      "author_association": "CONTRIBUTOR",
      "body": "`feature_unsupported_utxo_db.py` fails (times out)",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#issuecomment-2635261821",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31792"
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940976853",
      "pull_request_review_id": 2592504179,
      "id": 1940976853,
      "node_id": "PRRC_kwDOABII585zsPTV",
      "diff_hunk": "@@ -4194,6 +4194,15 @@ arith_uint256 CalculateClaimedHeadersWork(std::span<const CBlockHeader> headers)\n     return total_work;\n }\n \n+/** Check the timestamp of the block header is not too far in the future. **/\n+static bool CheckHeaderNotFuture(const CBlockHeader& block, BlockValidationState& state)",
      "path": "src/validation.cpp",
      "position": 282,
      "original_position": 5,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "In commit cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62:\r\nCan you add some context to the commit message for why this move is being done? Maybe:\r\n\"A call to ContextualCheckBlockHeader is added to ConnectBlock in the following commits, but it should not re-check the timestamp of the header there. Move the timestamp check into a separate function to avoid this.\"",
      "created_at": "2025-02-04T11:15:21Z",
      "updated_at": "2025-02-04T11:17:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1940976853",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940976853"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4309,
      "original_line": 4309,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940977644",
      "pull_request_review_id": 2592504179,
      "id": 1940977644,
      "node_id": "PRRC_kwDOABII585zsPfs",
      "diff_hunk": "@@ -4345,6 +4349,10 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n             LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckBlockHeader: %s, %s\\n\", __func__, hash.ToString(), state.ToString());\n             return false;\n         }\n+        if (!CheckHeaderNotFuture(block, state)) {\n+            LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckHeaderNotFuture: %s, %s\\n\", __func__, hash.ToString(), state.ToString());",
      "path": "src/validation.cpp",
      "position": 405,
      "original_position": 33,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": null,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Why is this not `LogError`?",
      "created_at": "2025-02-04T11:15:56Z",
      "updated_at": "2025-02-04T11:17:42Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1940977644",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1940977644"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4342,
      "original_line": 4342,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941306874",
      "pull_request_review_id": 2593082094,
      "id": 1941306874,
      "node_id": "PRRC_kwDOABII585ztf36",
      "diff_hunk": "@@ -277,6 +277,9 @@ def _test_getdeploymentinfo(self):\n         # calling with an explicit hash works\n         self.check_signalling_deploymentinfo_result(self.nodes[0].getdeploymentinfo(gbci207[\"bestblockhash\"]), gbci207[\"blocks\"], gbci207[\"bestblockhash\"], \"started\")\n \n+        # restart clean with default activation heights\n+        self.restart_node(0)",
      "path": "test/functional/rpc_blockchain.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "original_commit_id": "1cf2721d2fcc6000611f790dcebf7d8850214de0",
      "in_reply_to_id": null,
      "user": {
        "login": "ajtowns",
        "id": 127186,
        "node_id": "MDQ6VXNlcjEyNzE4Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ajtowns",
        "html_url": "https://github.com/ajtowns",
        "followers_url": "https://api.github.com/users/ajtowns/followers",
        "following_url": "https://api.github.com/users/ajtowns/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/ajtowns/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/ajtowns/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
        "organizations_url": "https://api.github.com/users/ajtowns/orgs",
        "repos_url": "https://api.github.com/users/ajtowns/repos",
        "events_url": "https://api.github.com/users/ajtowns/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/ajtowns/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "~~Should this line be in the following commit?~~\r\n\r\nNo, it shouldn't.",
      "created_at": "2025-02-04T14:40:02Z",
      "updated_at": "2025-02-04T15:27:41Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941306874",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941306874"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941355885",
      "pull_request_review_id": 2593165345,
      "id": 1941355885,
      "node_id": "PRRC_kwDOABII585ztr1t",
      "diff_hunk": "@@ -4194,6 +4194,15 @@ arith_uint256 CalculateClaimedHeadersWork(std::span<const CBlockHeader> headers)\n     return total_work;\n }\n \n+/** Check the timestamp of the block header is not too far in the future. **/\n+static bool CheckHeaderNotFuture(const CBlockHeader& block, BlockValidationState& state)",
      "path": "src/validation.cpp",
      "position": 282,
      "original_position": 5,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": 1940976853,
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Done.",
      "created_at": "2025-02-04T15:05:22Z",
      "updated_at": "2025-02-04T15:05:22Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941355885",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941355885"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4309,
      "original_line": 4309,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941384261",
      "pull_request_review_id": 2593213711,
      "id": 1941384261,
      "node_id": "PRRC_kwDOABII585ztyxF",
      "diff_hunk": "@@ -4345,6 +4349,10 @@ bool ChainstateManager::AcceptBlockHeader(const CBlockHeader& block, BlockValida\n             LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckBlockHeader: %s, %s\\n\", __func__, hash.ToString(), state.ToString());\n             return false;\n         }\n+        if (!CheckHeaderNotFuture(block, state)) {\n+            LogDebug(BCLog::VALIDATION, \"%s: Consensus::CheckHeaderNotFuture: %s, %s\\n\", __func__, hash.ToString(), state.ToString());",
      "path": "src/validation.cpp",
      "position": 405,
      "original_position": 33,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "original_commit_id": "cddc0e2a0f2b8f19ef243edc8a85e206c31f9e62",
      "in_reply_to_id": 1940977644,
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "To keep the existing level for this error. I suppose the existing level is debug due to log-filling concerns, maybe with very-low-difficulty headers?\r\n\r\nThanks for pointing this out though, i double checked the other log line in `TestBlockValidity` and there it should have been `LogError`. Fixed.",
      "created_at": "2025-02-04T15:21:39Z",
      "updated_at": "2025-02-04T15:21:39Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941384261",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941384261"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 4342,
      "original_line": 4342,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941394003",
      "pull_request_review_id": 2593229959,
      "id": 1941394003,
      "node_id": "PRRC_kwDOABII585zt1JT",
      "diff_hunk": "@@ -277,6 +277,9 @@ def _test_getdeploymentinfo(self):\n         # calling with an explicit hash works\n         self.check_signalling_deploymentinfo_result(self.nodes[0].getdeploymentinfo(gbci207[\"bestblockhash\"]), gbci207[\"blocks\"], gbci207[\"bestblockhash\"], \"started\")\n \n+        # restart clean with default activation heights\n+        self.restart_node(0)",
      "path": "test/functional/rpc_blockchain.py",
      "position": 5,
      "original_position": 5,
      "commit_id": "dd2714ed13eea3591162dbade8132ff517ca5509",
      "original_commit_id": "1cf2721d2fcc6000611f790dcebf7d8850214de0",
      "in_reply_to_id": 1941306874,
      "user": {
        "login": "darosior",
        "id": 22457751,
        "node_id": "MDQ6VXNlcjIyNDU3NzUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/22457751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/darosior",
        "html_url": "https://github.com/darosior",
        "followers_url": "https://api.github.com/users/darosior/followers",
        "following_url": "https://api.github.com/users/darosior/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/darosior/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/darosior/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/darosior/subscriptions",
        "organizations_url": "https://api.github.com/users/darosior/orgs",
        "repos_url": "https://api.github.com/users/darosior/repos",
        "events_url": "https://api.github.com/users/darosior/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/darosior/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "No, it's to make this commit pass the test on its own. This is because this sub-test restart the node with a different deployment height for Segwit, and its caller then calls `verifychain`. This would fail if we don't restart the node with the default deployment height because `ConnectBlock` would detect unexpected witnesses before activation height. This is essentially what the next commit checks explicitly.",
      "created_at": "2025-02-04T15:27:17Z",
      "updated_at": "2025-02-04T15:27:18Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31792#discussion_r1941394003",
      "author_association": "MEMBER",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1941394003"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31792"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": 281,
      "original_line": 281,
      "side": "RIGHT"
    }
  ]
}