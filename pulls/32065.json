{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32065",
    "id": 2393065673,
    "node_id": "PR_kwDOABII586Oo0jJ",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/32065",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/32065.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/32065.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32065",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32065/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32065/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32065/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/42f98c9dfab03a4423038884df4f74a7954a3bb6",
    "number": 32065,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "i2p: make a time gap between creating transient sessions and using them",
    "user": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "Connecting to an I2P peer consists of creating a session (the\r\n`SESSION CREATE` command) and then connecting to the peer using that\r\nsession (`STREAM CONNECT ID=session_id ...`).\r\n\r\nThis change is only relevant for transient sessions because when a\r\npersistent session is used it is created once and used for all\r\nconnections.\r\n\r\nBefore this change Bitcoin Core would create the session and use it in\r\nquick succession. That is, the `SESSION CREATE` command would be\r\nimmediately followed by `STREAM CONNECT`. This could ease network\r\nactivity monitoring by an adversary.\r\n\r\nTo mitigate that, this change creates sessions upfront without an\r\nimmediate demand for new sessions and later uses them. This creates a\r\ntime gap between `SESSION CREATE` and `STREAM CONNECT`. Note that there\r\nis always some demand for new I2P connections due to disconnects.\r\n\r\n---\r\n\r\nSummary of the changes in the code:\r\n\r\n* Create the session from the `Session` constructor (send `SESSION CREATE`\r\n  to the I2P SAM proxy). This constructor was only called when transient\r\n  sessions were needed and was immediately followed by `Connect()` which\r\n  would have created the session. So this is a noop change if viewed\r\n  in isolation.\r\n\r\n* Every time we try to connect to any peer (not just I2P) create a new\r\n  I2P session, up to a limit (currently 10). This way a bunch of\r\n  sessions are created (`SESSION CREATE`) at times that are decoupled\r\n  from the time when sessions will be used (`STREAM CONNECT`).\r\n\r\n* Tweak the code in `CConnman::ConnectNode()` to avoid creating session\r\n  objects while holding `m_unused_i2p_sessions_mutex` because now\r\n  creating `i2p::sam::Session` involves network activity and could take\r\n  a few seconds.\r\n\r\n---\r\n\r\nBefore (note the timestamps):\r\n\r\n2025-03-13T09:23:40Z [opencon] [i2p:info] Transient SAM session cd7ea49a7e created\r\n2025-03-13T09:23:43Z [opencon] [i2p] -> STREAM CONNECT ID=cd7ea49a7e DESTINATION=...\r\n\r\n2025-03-13T09:23:51Z [opencon] [i2p:info] Transient SAM session cb0956207e created\r\n2025-03-13T09:23:52Z [opencon] [i2p] -> STREAM CONNECT ID=cb0956207e DESTINATION=...\r\n\r\n2025-03-13T09:24:04Z [opencon] [i2p:info] Transient SAM session 35ad67f343 created\r\n2025-03-13T09:24:04Z [opencon] [i2p] -> STREAM CONNECT ID=35ad67f343 DESTINATION=...\r\n\r\nAfter:\r\n\r\n2025-03-13T17:08:58Z [opencon] [i2p:info] Transient SAM session 16098cd4ea created\r\n2025-03-13T17:09:34Z [opencon] [i2p] -> STREAM CONNECT ID=16098cd4ea DESTINATION=...\r\n\r\n2025-03-13T17:09:38Z [opencon] [i2p:info] Transient SAM session 5d209bf1bc created\r\n2025-03-13T17:09:59Z [opencon] [i2p] -> STREAM CONNECT ID=5d209bf1bc DESTINATION=...\r\n\r\n2025-03-13T17:09:50Z [opencon] [i2p:info] Transient SAM session e78aa6d2e7 created\r\n2025-03-13T17:12:09Z [opencon] [i2p] -> STREAM CONNECT ID=e78aa6d2e7 DESTINATION=...\r\n\r\n---\r\n\r\nThis was suggested by @eyedeekay some time ago (in 2023 actually) and has been lingering in my TODO since then :eyes:. A further suggestion is to also add a time gap between the activity cease and the closing of the session. For this, when `CNode` is destroyed `CNode::m_i2p_sam_session` would have to be moved elsewhere and destroyed at a later time. cc @zzzi2p",
    "labels": [
      {
        "id": 98298007,
        "node_id": "MDU6TGFiZWw5ODI5ODAwNw==",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/labels/P2P",
        "name": "P2P",
        "color": "006b75",
        "default": false
      }
    ],
    "created_at": "2025-03-14T08:29:59Z",
    "updated_at": "2025-03-14T09:17:11Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "bdc9af1512a653b6ac95574dbfc37ba4184c5f34",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "vasild:i2p_early_create_session",
      "ref": "i2p_early_create_session",
      "sha": "42f98c9dfab03a4423038884df4f74a7954a3bb6",
      "user": {
        "login": "vasild",
        "id": 266751,
        "node_id": "MDQ6VXNlcjI2Njc1MQ==",
        "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/vasild",
        "html_url": "https://github.com/vasild",
        "followers_url": "https://api.github.com/users/vasild/followers",
        "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
        "organizations_url": "https://api.github.com/users/vasild/orgs",
        "repos_url": "https://api.github.com/users/vasild/repos",
        "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/vasild/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 120608826,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMjA2MDg4MjY=",
        "name": "bitcoin",
        "full_name": "vasild/bitcoin",
        "owner": {
          "login": "vasild",
          "id": 266751,
          "node_id": "MDQ6VXNlcjI2Njc1MQ==",
          "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/vasild",
          "html_url": "https://github.com/vasild",
          "followers_url": "https://api.github.com/users/vasild/followers",
          "following_url": "https://api.github.com/users/vasild/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/vasild/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/vasild/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
          "organizations_url": "https://api.github.com/users/vasild/orgs",
          "repos_url": "https://api.github.com/users/vasild/repos",
          "events_url": "https://api.github.com/users/vasild/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/vasild/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/vasild/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/vasild/bitcoin",
        "archive_url": "https://api.github.com/repos/vasild/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/vasild/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/vasild/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/vasild/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/vasild/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/vasild/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/vasild/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/vasild/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/vasild/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/vasild/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/vasild/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/vasild/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/vasild/bitcoin/events",
        "forks_url": "https://api.github.com/repos/vasild/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/vasild/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/vasild/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/vasild/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/vasild/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/vasild/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/vasild/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/vasild/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/vasild/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/vasild/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/vasild/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/vasild/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/vasild/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/vasild/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/vasild/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/vasild/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:vasild/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/vasild/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/vasild/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/vasild/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/vasild/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/vasild/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/vasild/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/vasild/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/vasild/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/vasild/bitcoin/hooks",
        "svn_url": "https://github.com/vasild/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 1,
        "stargazers_count": 7,
        "watchers_count": 7,
        "size": 253732,
        "default_branch": "master",
        "open_issues_count": 2,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": true,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-03-14T08:09:37Z",
        "created_at": "2018-02-07T11:52:47Z",
        "updated_at": "2025-03-14T08:09:20Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "698f86964c68041d938aaf54fdd39466266c371c",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36930,
        "stargazers_count": 82465,
        "watchers_count": 82465,
        "size": 278049,
        "default_branch": "master",
        "open_issues_count": 687,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-03-14T03:23:42Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-03-14T09:10:09Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/32065"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": false,
    "additions": 42,
    "deletions": 4,
    "changed_files": 3,
    "commits": 1,
    "review_comments": 0,
    "comments": 1
  },
  "events": [
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDQyZjk4YzlkZmFiMDNhNDQyMzAzODg4NGRmNGY3NGE3OTU0YTNiYjY",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/42f98c9dfab03a4423038884df4f74a7954a3bb6",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/42f98c9dfab03a4423038884df4f74a7954a3bb6",
      "tree": {
        "sha": "5c8dd1c980ad9676a56bb37473b74aa3d6f6827a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5c8dd1c980ad9676a56bb37473b74aa3d6f6827a"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5c8dd1c980ad9676a56bb37473b74aa3d6f6827a\nparent 698f86964c68041d938aaf54fdd39466266c371c\nauthor Vasil Dimov <vd@FreeBSD.org> 1741854559 +0100\ncommitter Vasil Dimov <vd@FreeBSD.org> 1741939768 +0100\n\ni2p: make a time gap between creating transient sessions and using them\n\nConnecting to an I2P peer consists of creating a session (the\n`SESSION CREATE` command) and then connecting to the peer using that\nsession (`STREAM CONNECT ID=session_id ...`).\n\nThis change is only relevant for transient sessions because when a\npersistent session is used it is created once and used for all\nconnections.\n\nBefore this change Bitcoin Core would create the session and use it in\nquick succession. That is, the `SESSION CREATE` command would be\nimmediately followed by `STREAM CONNECT`. This could ease network\nactivity monitoring by an adversary.\n\nTo mitigate that, this change creates sessions upfront without an\nimmediate demand for new sessions and later uses them. This creates a\ntime gap between `SESSION CREATE` and `STREAM CONNECT`. Note that there\nis always some demand for new I2P connections due to disconnects.\n\n---\n\nSummary of the changes in the code:\n\n* Create the session from the `Session` constructor (send `SESSION CREATE`\n  to the I2P SAM proxy). This constructor was only called when transient\n  sessions were needed and was immediately followed by `Connect()` which\n  would have created the session. So this is a noop change if viewed\n  in isolation.\n\n* Every time we try to connect to any peer (not just I2P) create a new\n  I2P session, up to a limit (currently 10). This way a bunch of\n  sessions are created (`SESSION CREATE`) at times that are decoupled\n  from the time when sessions will be used (`STREAM CONNECT`).\n\n* Tweak the code in `CConnman::ConnectNode()` to avoid creating session\n  objects while holding `m_unused_i2p_sessions_mutex` because now\n  creating `i2p::sam::Session` involves network activity and could take\n  a few seconds.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmfT5DgACgkQVN8G9ktV\ny7+XpR/+Ne/nB1Ql8cxJT25eUF5ZOVCh7LeAs+82lBASVj7/V/RErCDM4HJPPeyW\n3nFWHl/dwbJXS92iFoSZQDCRZCe8aRAgOlPYaq+v7r+XPEIVamWflZcD946Ca+w9\nKHAt7yJHJpgHEuCZ6tC1e8qCBVs8hO0rCNwu8pJGc00DxCz24V4IEUe5tAW3bSjx\nUHhP+C7UKaCQbhbDpWizEPBouI2jtvBI+RTMps0EXpDbtWcNGj7YeYIQd7EhmrZv\n7h/lLvkiQD5tpAWMQl+SWKYW/LiHsgoQj/fZVfDLfOyjf4fNoxHcv+qJywSGKiMu\nyx2UYtsDRjMYw4S93ROBCKF6Ink/53yd1wi6IDvBQ3BqJT9W0w22rp3PLC0rGkmo\ng3mygFYi+oq0IsLtVcyFxTYjmtLeZ0PIty4auZc2AlFTwuCAqRLWBoSqmU5pt1uj\nKseus4RBdLVQMBQN15oq6ln5BTJfgmZXu/XlQODWtonZnIIzk35UqchN5LVy2xYa\n2ikKkIxOqIbLBTKgQzeoGR4RlrvUCIum/JvQ7+ToHbJktb8vAKGrloYXG1bx8gw9\neutMPDAuqzaO/1NHtsl6Rn117izmU1bveQkiNjgVr+wMgV9+6E4Vb6dtFZ/giCJ4\npiLRFzbmpK84NxZOrDE9A8VWFIV11ZPM8yw81/DMNkTzSjngq8NxfQNHWME7ih7F\nPHzxDy10xoW39u5lBauHKWqLMxUioUJwJ4bPCqSGFT9Ktc+323nAridNqL/21Uwo\nedHOuEkWl7GXTrzUagxmT8gMnOca8CjIxFw24M1aGQZWKIY7kzR7DHKTgCGJ7cuQ\nrFLPeRBXdhZgQXHRMSFsHzVzXGvjVupQVUDrLuRGx1IWk7rC++/RUG83ZRlpHcRC\nyIQaN8CO6eesiJOUttZs+aTMQFZkQnWLVQuqzPIjW8Bya7y8swyDxGnVHnN9EgVu\nCEp4YyG/Txtn5+eDSlnYJNkz5IRx9wwvU11oIilWpIpC3+QDLn5eXYEjRTQpSw+C\n9zsDbhNIZpC/GzpA0qJtf0JKpmvJVmrlZGA8gWFyUXjjh40wIdpOKK9Xl/4ap9Ai\nt6gK0d14jncZZC0t4N5cHY3/ulg1NVrWArtg72Hx3+vqlEY3okSZm9hY/15BCt4/\ni7z0Vk4w2kfIjs5TL8Oy+mXN9q87RqJ+zRUC+QRUzQIPpg7HWWm/PUSCdSCrhYGI\nOfM6VA+IB1oRLH/DyiBYlxHVWLKNT7CK7ICw+9tWQxPNQNgUiAio4ErqzTxvzLa7\n8E/8tBSePEZsOZ13/pJzqdnX3yzukMk/1MI4UG4dp4FCREWpM7YbGYZoIFv0nTtB\nR5PpHifaHtXnGxh1PHarjp/O7VugTw==\n=pIox\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/698f86964c68041d938aaf54fdd39466266c371c",
          "sha": "698f86964c68041d938aaf54fdd39466266c371c",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/698f86964c68041d938aaf54fdd39466266c371c"
        }
      ],
      "message": "i2p: make a time gap between creating transient sessions and using them\n\nConnecting to an I2P peer consists of creating a session (the\n`SESSION CREATE` command) and then connecting to the peer using that\nsession (`STREAM CONNECT ID=session_id ...`).\n\nThis change is only relevant for transient sessions because when a\npersistent session is used it is created once and used for all\nconnections.\n\nBefore this change Bitcoin Core would create the session and use it in\nquick succession. That is, the `SESSION CREATE` command would be\nimmediately followed by `STREAM CONNECT`. This could ease network\nactivity monitoring by an adversary.\n\nTo mitigate that, this change creates sessions upfront without an\nimmediate demand for new sessions and later uses them. This creates a\ntime gap between `SESSION CREATE` and `STREAM CONNECT`. Note that there\nis always some demand for new I2P connections due to disconnects.\n\n---\n\nSummary of the changes in the code:\n\n* Create the session from the `Session` constructor (send `SESSION CREATE`\n  to the I2P SAM proxy). This constructor was only called when transient\n  sessions were needed and was immediately followed by `Connect()` which\n  would have created the session. So this is a noop change if viewed\n  in isolation.\n\n* Every time we try to connect to any peer (not just I2P) create a new\n  I2P session, up to a limit (currently 10). This way a bunch of\n  sessions are created (`SESSION CREATE`) at times that are decoupled\n  from the time when sessions will be used (`STREAM CONNECT`).\n\n* Tweak the code in `CConnman::ConnectNode()` to avoid creating session\n  objects while holding `m_unused_i2p_sessions_mutex` because now\n  creating `i2p::sam::Session` involves network activity and could take\n  a few seconds.",
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2025-03-14T08:09:28Z"
      },
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2025-03-13T08:29:19Z"
      },
      "sha": "42f98c9dfab03a4423038884df4f74a7954a3bb6"
    },
    {
      "event": "mentioned",
      "id": 16763530954,
      "node_id": "MEE_lADOABII586uBQTTzwAAAAPnLy7K",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16763530954",
      "actor": {
        "login": "eyedeekay",
        "id": 8733713,
        "node_id": "MDQ6VXNlcjg3MzM3MTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8733713?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eyedeekay",
        "html_url": "https://github.com/eyedeekay",
        "followers_url": "https://api.github.com/users/eyedeekay/followers",
        "following_url": "https://api.github.com/users/eyedeekay/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eyedeekay/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eyedeekay/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eyedeekay/subscriptions",
        "organizations_url": "https://api.github.com/users/eyedeekay/orgs",
        "repos_url": "https://api.github.com/users/eyedeekay/repos",
        "events_url": "https://api.github.com/users/eyedeekay/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eyedeekay/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T08:30:00Z"
    },
    {
      "event": "subscribed",
      "id": 16763530970,
      "node_id": "SE_lADOABII586uBQTTzwAAAAPnLy7a",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16763530970",
      "actor": {
        "login": "eyedeekay",
        "id": 8733713,
        "node_id": "MDQ6VXNlcjg3MzM3MTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8733713?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/eyedeekay",
        "html_url": "https://github.com/eyedeekay",
        "followers_url": "https://api.github.com/users/eyedeekay/followers",
        "following_url": "https://api.github.com/users/eyedeekay/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/eyedeekay/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/eyedeekay/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/eyedeekay/subscriptions",
        "organizations_url": "https://api.github.com/users/eyedeekay/orgs",
        "repos_url": "https://api.github.com/users/eyedeekay/repos",
        "events_url": "https://api.github.com/users/eyedeekay/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/eyedeekay/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T08:30:00Z"
    },
    {
      "event": "mentioned",
      "id": 16763530991,
      "node_id": "MEE_lADOABII586uBQTTzwAAAAPnLy7v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16763530991",
      "actor": {
        "login": "zzzi2p",
        "id": 62618568,
        "node_id": "MDQ6VXNlcjYyNjE4NTY4",
        "avatar_url": "https://avatars.githubusercontent.com/u/62618568?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zzzi2p",
        "html_url": "https://github.com/zzzi2p",
        "followers_url": "https://api.github.com/users/zzzi2p/followers",
        "following_url": "https://api.github.com/users/zzzi2p/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/zzzi2p/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/zzzi2p/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/zzzi2p/subscriptions",
        "organizations_url": "https://api.github.com/users/zzzi2p/orgs",
        "repos_url": "https://api.github.com/users/zzzi2p/repos",
        "events_url": "https://api.github.com/users/zzzi2p/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/zzzi2p/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T08:30:00Z"
    },
    {
      "event": "subscribed",
      "id": 16763531009,
      "node_id": "SE_lADOABII586uBQTTzwAAAAPnLy8B",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16763531009",
      "actor": {
        "login": "zzzi2p",
        "id": 62618568,
        "node_id": "MDQ6VXNlcjYyNjE4NTY4",
        "avatar_url": "https://avatars.githubusercontent.com/u/62618568?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/zzzi2p",
        "html_url": "https://github.com/zzzi2p",
        "followers_url": "https://api.github.com/users/zzzi2p/followers",
        "following_url": "https://api.github.com/users/zzzi2p/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/zzzi2p/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/zzzi2p/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/zzzi2p/subscriptions",
        "organizations_url": "https://api.github.com/users/zzzi2p/orgs",
        "repos_url": "https://api.github.com/users/zzzi2p/repos",
        "events_url": "https://api.github.com/users/zzzi2p/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/zzzi2p/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T08:30:00Z"
    },
    {
      "event": "commented",
      "id": 2723985205,
      "node_id": "IC_kwDOABII586iXLc1",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2723985205",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T08:30:03Z",
      "updated_at": "2025-03-14T08:30:04Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/32065.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\nA summary of reviews will appear here.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/32065#issuecomment-2723985205",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/32065"
    },
    {
      "event": "labeled",
      "id": 16768764038,
      "node_id": "LE_lADOABII586uBQTTzwAAAAPnfwiG",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16768764038",
      "actor": {
        "login": "laanwj",
        "id": 126646,
        "node_id": "MDQ6VXNlcjEyNjY0Ng==",
        "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/laanwj",
        "html_url": "https://github.com/laanwj",
        "followers_url": "https://api.github.com/users/laanwj/followers",
        "following_url": "https://api.github.com/users/laanwj/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/laanwj/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/laanwj/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
        "organizations_url": "https://api.github.com/users/laanwj/orgs",
        "repos_url": "https://api.github.com/users/laanwj/repos",
        "events_url": "https://api.github.com/users/laanwj/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/laanwj/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-03-14T09:17:11Z",
      "label": {
        "name": "P2P",
        "color": "006b75"
      }
    }
  ],
  "comments": []
}