{
  "type": "pull",
  "pull": {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860",
    "id": 2334713712,
    "node_id": "PR_kwDOABII586LKOdw",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/31860",
    "diff_url": "https://github.com/bitcoin/bitcoin/pull/31860.diff",
    "patch_url": "https://github.com/bitcoin/bitcoin/pull/31860.patch",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860",
    "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860/commits",
    "review_comments_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860/comments",
    "review_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments%7B/number%7D",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860/comments",
    "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/62ad1d69dc016244811fd2ebf9c6356add1d5e43",
    "number": 31860,
    "state": "open",
    "locked": false,
    "maintainer_can_modify": true,
    "title": "init: Take lock on blocks directory in BlockManager ctor",
    "user": {
      "login": "TheCharlatan",
      "id": 8421793,
      "node_id": "MDQ6VXNlcjg0MjE3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheCharlatan",
      "html_url": "https://github.com/TheCharlatan",
      "followers_url": "https://api.github.com/users/TheCharlatan/followers",
      "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
      "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
      "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
      "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
      "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
      "repos_url": "https://api.github.com/users/TheCharlatan/repos",
      "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
      "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
      "type": "User",
      "site_admin": false,
      "patch_url": null
    },
    "body": "This ensures consistent directory locking for users of the kernel library by disallowing mistakenly creating multiple BlockManagers that might write into the same block or undo files.\r\n\r\nThe change here makes `LockDirectory` more strict: It now returns an error even if it is called again on the same directory from the same process. However from the description in https://github.com/bitcoin/bitcoin/pull/12422 , where this feature was introduced, it is not immediately clear what its usage was at the time. Supporting multiple wallets in the same directory is mentioned there, but it is not said why that might be a desirable feature.",
    "labels": [],
    "created_at": "2025-02-13T20:49:22Z",
    "updated_at": "2025-02-15T03:51:24Z",
    "mergeable": true,
    "mergeable_state": "blocked",
    "merged": false,
    "merge_commit_sha": "7fccb23b58ef4349cfcec4a4d1bf9af8fb1fb112",
    "assignees": [],
    "requested_reviewers": [],
    "requested_teams": [],
    "rebaseable": true,
    "head": {
      "label": "TheCharlatan:blockmanLock",
      "ref": "blockmanLock",
      "sha": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 94456368,
        "node_id": "MDEwOlJlcG9zaXRvcnk5NDQ1NjM2OA==",
        "name": "bitcoin",
        "full_name": "TheCharlatan/bitcoin",
        "owner": {
          "login": "TheCharlatan",
          "id": 8421793,
          "node_id": "MDQ6VXNlcjg0MjE3OTM=",
          "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/TheCharlatan",
          "html_url": "https://github.com/TheCharlatan",
          "followers_url": "https://api.github.com/users/TheCharlatan/followers",
          "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
          "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
          "repos_url": "https://api.github.com/users/TheCharlatan/repos",
          "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
          "type": "User",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/TheCharlatan/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": true,
        "url": "https://api.github.com/repos/TheCharlatan/bitcoin",
        "archive_url": "https://api.github.com/repos/TheCharlatan/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/TheCharlatan/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/TheCharlatan/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/TheCharlatan/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/TheCharlatan/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/TheCharlatan/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/TheCharlatan/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/events",
        "forks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/TheCharlatan/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/TheCharlatan/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/TheCharlatan/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/TheCharlatan/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/TheCharlatan/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/TheCharlatan/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/TheCharlatan/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/TheCharlatan/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/TheCharlatan/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/TheCharlatan/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:TheCharlatan/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/TheCharlatan/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/TheCharlatan/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/TheCharlatan/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/TheCharlatan/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/TheCharlatan/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/TheCharlatan/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/TheCharlatan/bitcoin/hooks",
        "svn_url": "https://github.com/TheCharlatan/bitcoin",
        "homepage": "https://bitcoin.org/en/download",
        "language": "C++",
        "forks_count": 0,
        "stargazers_count": 5,
        "watchers_count": 5,
        "size": 255308,
        "default_branch": "master",
        "open_issues_count": 4,
        "is_template": false,
        "topics": [],
        "has_issues": false,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-02-14T21:31:51Z",
        "created_at": "2017-06-15T16:03:35Z",
        "updated_at": "2025-02-14T15:10:05Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "base": {
      "label": "bitcoin:master",
      "ref": "master",
      "sha": "0b48f77e101f93e35fd24f852b247b9daeed37a4",
      "user": {
        "login": "bitcoin",
        "id": 528860,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/bitcoin",
        "html_url": "https://github.com/bitcoin",
        "followers_url": "https://api.github.com/users/bitcoin/followers",
        "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
        "organizations_url": "https://api.github.com/users/bitcoin/orgs",
        "repos_url": "https://api.github.com/users/bitcoin/repos",
        "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/bitcoin/received_events",
        "type": "Organization",
        "site_admin": false,
        "patch_url": null
      },
      "repo": {
        "id": 1181927,
        "node_id": "MDEwOlJlcG9zaXRvcnkxMTgxOTI3",
        "name": "bitcoin",
        "full_name": "bitcoin/bitcoin",
        "owner": {
          "login": "bitcoin",
          "id": 528860,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjUyODg2MA==",
          "avatar_url": "https://avatars.githubusercontent.com/u/528860?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/bitcoin",
          "html_url": "https://github.com/bitcoin",
          "followers_url": "https://api.github.com/users/bitcoin/followers",
          "following_url": "https://api.github.com/users/bitcoin/following%7B/other_user%7D",
          "gists_url": "https://api.github.com/users/bitcoin/gists%7B/gist_id%7D",
          "starred_url": "https://api.github.com/users/bitcoin/starred%7B/owner%7D%7B/repo%7D",
          "subscriptions_url": "https://api.github.com/users/bitcoin/subscriptions",
          "organizations_url": "https://api.github.com/users/bitcoin/orgs",
          "repos_url": "https://api.github.com/users/bitcoin/repos",
          "events_url": "https://api.github.com/users/bitcoin/events%7B/privacy%7D",
          "received_events_url": "https://api.github.com/users/bitcoin/received_events",
          "type": "Organization",
          "site_admin": false,
          "patch_url": null
        },
        "private": false,
        "html_url": "https://github.com/bitcoin/bitcoin",
        "description": "Bitcoin Core integration/staging tree",
        "fork": false,
        "url": "https://api.github.com/repos/bitcoin/bitcoin",
        "archive_url": "https://api.github.com/repos/bitcoin/bitcoin/%7Barchive_format%7D%7B/ref%7D",
        "assignees_url": "https://api.github.com/repos/bitcoin/bitcoin/assignees%7B/user%7D",
        "blobs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/blobs%7B/sha%7D",
        "branches_url": "https://api.github.com/repos/bitcoin/bitcoin/branches%7B/branch%7D",
        "collaborators_url": "https://api.github.com/repos/bitcoin/bitcoin/collaborators%7B/collaborator%7D",
        "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/comments%7B/number%7D",
        "commits_url": "https://api.github.com/repos/bitcoin/bitcoin/commits%7B/sha%7D",
        "compare_url": "https://api.github.com/repos/bitcoin/bitcoin/compare/%7Bbase%7D...%7Bhead%7D",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/%7B+path%7D",
        "contributors_url": "https://api.github.com/repos/bitcoin/bitcoin/contributors",
        "deployments_url": "https://api.github.com/repos/bitcoin/bitcoin/deployments",
        "downloads_url": "https://api.github.com/repos/bitcoin/bitcoin/downloads",
        "events_url": "https://api.github.com/repos/bitcoin/bitcoin/events",
        "forks_url": "https://api.github.com/repos/bitcoin/bitcoin/forks",
        "git_commits_url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits%7B/sha%7D",
        "git_refs_url": "https://api.github.com/repos/bitcoin/bitcoin/git/refs%7B/sha%7D",
        "git_tags_url": "https://api.github.com/repos/bitcoin/bitcoin/git/tags%7B/sha%7D",
        "git_url": "git://github.com/bitcoin/bitcoin.git",
        "issue_comment_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments%7B/number%7D",
        "issue_events_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events%7B/number%7D",
        "issues_url": "https://api.github.com/repos/bitcoin/bitcoin/issues%7B/number%7D",
        "keys_url": "https://api.github.com/repos/bitcoin/bitcoin/keys%7B/key_id%7D",
        "labels_url": "https://api.github.com/repos/bitcoin/bitcoin/labels%7B/name%7D",
        "languages_url": "https://api.github.com/repos/bitcoin/bitcoin/languages",
        "merges_url": "https://api.github.com/repos/bitcoin/bitcoin/merges",
        "milestones_url": "https://api.github.com/repos/bitcoin/bitcoin/milestones%7B/number%7D",
        "notifications_url": "https://api.github.com/repos/bitcoin/bitcoin/notifications%7B?since,all,participating}",
        "pulls_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls%7B/number%7D",
        "releases_url": "https://api.github.com/repos/bitcoin/bitcoin/releases%7B/id%7D",
        "ssh_url": "git@github.com:bitcoin/bitcoin.git",
        "stargazers_url": "https://api.github.com/repos/bitcoin/bitcoin/stargazers",
        "statuses_url": "https://api.github.com/repos/bitcoin/bitcoin/statuses/%7Bsha%7D",
        "subscribers_url": "https://api.github.com/repos/bitcoin/bitcoin/subscribers",
        "subscription_url": "https://api.github.com/repos/bitcoin/bitcoin/subscription",
        "tags_url": "https://api.github.com/repos/bitcoin/bitcoin/tags",
        "teams_url": "https://api.github.com/repos/bitcoin/bitcoin/teams",
        "trees_url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees%7B/sha%7D",
        "clone_url": "https://github.com/bitcoin/bitcoin.git",
        "hooks_url": "https://api.github.com/repos/bitcoin/bitcoin/hooks",
        "svn_url": "https://github.com/bitcoin/bitcoin",
        "homepage": "https://bitcoincore.org/en/download",
        "language": "C++",
        "forks_count": 36723,
        "stargazers_count": 82002,
        "watchers_count": 82002,
        "size": 275624,
        "default_branch": "master",
        "open_issues_count": 679,
        "is_template": false,
        "topics": [
          "bitcoin",
          "c-plus-plus",
          "cryptocurrency",
          "cryptography",
          "p2p"
        ],
        "has_issues": true,
        "has_projects": true,
        "has_wiki": false,
        "has_pages": false,
        "has_downloads": false,
        "archived": false,
        "disabled": false,
        "visibility": "public",
        "pushed_at": "2025-02-14T23:22:17Z",
        "created_at": "2010-12-19T15:16:43Z",
        "updated_at": "2025-02-15T09:53:37Z",
        "allow_forking": true,
        "license": {
          "key": "mit",
          "name": "MIT License",
          "node_id": "MDc6TGljZW5zZTEz",
          "spdx_id": "MIT",
          "url": "https://api.github.com/licenses/mit",
          "html_url": null,
          "description": null,
          "implementation": null,
          "permissions": null,
          "conditions": null,
          "limitations": null,
          "body": null,
          "featured": null
        }
      }
    },
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
      }
    },
    "author_association": "CONTRIBUTOR",
    "draft": true,
    "additions": 60,
    "deletions": 19,
    "changed_files": 7,
    "commits": 3,
    "review_comments": 5,
    "comments": 2
  },
  "events": [
    {
      "event": "commented",
      "id": 2657680687,
      "node_id": "IC_kwDOABII586eaP0v",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2657680687",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-13T20:49:26Z",
      "updated_at": "2025-02-15T03:51:24Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--006a51241073e994b41acfe9ec718e94-->\n### Code Coverage & Benchmarks\nFor details see: https://corecheck.dev/bitcoin/bitcoin/pulls/31860.\n<!--021abf342d371248e50ceaed478a90ca-->\n### Reviews\nSee [the guideline](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#code-review) for information on the review process.\n| Type | Reviewers |\n| ---- | --------- |\n| Concept ACK | [stickies-v](https://github.com/bitcoin/bitcoin/pull/31860#pullrequestreview-2617967456) |\n\nIf your review is incorrectly listed, please react with 👎 to this comment and the bot will ignore it on the next update.\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#31144](https://github.com/bitcoin/bitcoin/pull/31144) (optimization: batch XOR operations 12% faster IBD by l0rinc)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#issuecomment-2657680687",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860"
    },
    {
      "event": "reviewed",
      "id": 2617967456,
      "node_id": "PRR_kwDOABII586cCwNg",
      "url": null,
      "actor": null,
      "commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "commit_url": null,
      "created_at": null,
      "author_association": "CONTRIBUTOR",
      "body": "Concept ACK on:\r\n- making LockDirectory more strict, it confused me recently that I was able to acquire a lock multiple times (within the same process)\r\n- making BlockManager manage the lock instead of init\r\n\r\nAs per https://github.com/TheCharlatan/bitcoin/pull/25, I would be a fan of going further and making the `BlockManagerOptions` ctor take a `BlockDirLock` (or, as per my comment a `DirectoryLock`) to allow more granular error feedback, but this is already a step in the right direction regardless.\r\n\r\nIn the future, this approach would also make it more straightforward to e.g. let `BlockManager` give other threads read-only access to the blocksdir via something like:\r\n\r\n```\r\nclass DirectoryLock {\r\nprivate:\r\n    std::shared_mutex m_mutex;\r\npublic:\r\n    const fs::path m_path;\r\n\r\n    DirectoryLock(const fs::path& path)\r\n        : m_path(path)\r\n    {\r\n        assert(util::LockDirectory(m_path, \".lock\", false) == util::LockResult::Success);\r\n    }\r\n    ~DirectoryLock() { UnlockDirectory(m_path, \".lock\"); }\r\n\r\n    DirectoryLock(const DirectoryLock&) = delete;\r\n    DirectoryLock& operator=(const DirectoryLock&) = delete;\r\n\r\n    std::unique_lock<std::shared_mutex> lock_exclusive()\r\n    {\r\n        return std::unique_lock<std::shared_mutex>(m_mutex);\r\n    }\r\n    std::shared_lock<std::shared_mutex> lock_shared()\r\n    {\r\n        return std::shared_lock<std::shared_mutex>(m_mutex);\r\n    }\r\n};\r\n```",
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#pullrequestreview-2617967456",
      "submitted_at": "2025-02-14T18:03:47Z",
      "state": "COMMENTED",
      "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGRlODQ0Yzc5ZDRkZjdhMTM0OWQ3MTIyNDk0YWU1ZTFkZTc2NWMwZDg",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/de844c79d4df7a1349d7122494ae5e1de765c0d8",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/de844c79d4df7a1349d7122494ae5e1de765c0d8",
      "tree": {
        "sha": "3d46c5246fcdb680e2458205e62e198a8c4e2598",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3d46c5246fcdb680e2458205e62e198a8c4e2598"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 3d46c5246fcdb680e2458205e62e198a8c4e2598\nparent 73e2ec13737ea497fec2545aab23564e1b8c4adb\nauthor TheCharlatan <seb.kung@gmail.com> 1739475875 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1739564614 +0100\n\nutil: Prevent multiple LockDirectory calls within the same process\n\nPreviously LockDirectory only prevented concurrent locks across\ndifferent processes, but allowed the same process to re-lock on the same\ndirectory.\n\nThis change is not immediately relevant for its current use, where the\nlock is only supposed to protect against a different process writing on\nthe same resources.\n\nThis change is relevant for future use by the kernel library, where\nusers of the library might mistakenly create multiple instances of an\nobject that seek to write to a common resource.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmevpkYACgkQm3m0VpHb\nQXO9cQ//Z3GhhXJ9m2zQ88xYphmta03UwRSxky1UeOwz15Bdax1YgeX+IgoBfAWr\ncgnOMBI7thSF8er52Pzos9zv4PKISIUv8yXPlUDK48pwoYUhNt3FpVBji60X9qov\naC7ZyqroOniyDLXxr8rh9l4I3e7tVY1sERwnKJuvzWY+fKwNIxFuI7T0s7ZfaA2l\ncpl3dqwAo+eFe8LNqdT/8DhM3VraVVqKj+JzfKpVIsVcya9UBJYgfwmclYfJHt9M\nOxyCa7gh4vOkXYHw9u94qVSdewtPZFegq/jEQV12LkozbkPggVzZRY0eRynFdyNo\nEICl2H73sjWMxHyMhO2yc/q5WdgIt6oueNeQRC61Yvox1zzp0mct5T+b6THu8aYM\nSVCeHJmz8u3CDrKnfjf+650OWOsHmZhDvJwBaTt/mF/aRJZxrkyQmLxFvzLaS8mF\nC1GImNjLeB4mmb2wFwJv944IURZlQc9KVeAk+MG3tDI9WULUFBQwggM8ZZwmvOhI\nthYrlFL4tJvs9Lo3hQBgcdwHDYD4/n1O6NNxl6BbRyXAGhVg2X9N2wwjG0SHQQqI\nFv+krsJ9KzKesHosKL4efIMLD/cbJ0UhRrSer7UNQJ0CDvxozP+8eVYGAgLaMhtt\nhrFdzbaYM14bOaJHmJVBMM44QCNaBzIu4kH+4ANpq+VsbYSeJtg=\n=vCHF\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/73e2ec13737ea497fec2545aab23564e1b8c4adb",
          "sha": "73e2ec13737ea497fec2545aab23564e1b8c4adb",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/73e2ec13737ea497fec2545aab23564e1b8c4adb"
        }
      ],
      "message": "util: Prevent multiple LockDirectory calls within the same process\n\nPreviously LockDirectory only prevented concurrent locks across\ndifferent processes, but allowed the same process to re-lock on the same\ndirectory.\n\nThis change is not immediately relevant for its current use, where the\nlock is only supposed to protect against a different process writing on\nthe same resources.\n\nThis change is relevant for future use by the kernel library, where\nusers of the library might mistakenly create multiple instances of an\nobject that seek to write to a common resource.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-14T20:23:34Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-13T19:44:35Z"
      },
      "sha": "de844c79d4df7a1349d7122494ae5e1de765c0d8"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16317600934,
      "node_id": "HRFPE_lADOABII586p_zNxzwAAAAPMmtSm",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16317600934",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "b1f16d3ce13b6ddd6535608b7b4b99b68f56fcbb",
      "commit_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits/b1f16d3ce13b6ddd6535608b7b4b99b68f56fcbb",
      "created_at": "2025-02-14T21:26:51Z"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKGYxNDc4NDI4NzQ4ZDQ3YTg1Y2E4YTFiNzM0ZDk2NmFmM2JjMDdjNDQ",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f1478428748d47a85ca8a1b734d966af3bc07c44",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/f1478428748d47a85ca8a1b734d966af3bc07c44",
      "tree": {
        "sha": "5c9523817b560d80094174fbbf814e2e840e260f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5c9523817b560d80094174fbbf814e2e840e260f"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree 5c9523817b560d80094174fbbf814e2e840e260f\nparent de844c79d4df7a1349d7122494ae5e1de765c0d8\nauthor TheCharlatan <seb.kung@gmail.com> 1739568005 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1739568671 +0100\n\nutil: Add RAII directory lock\n\nThis makes it easier for a class or a struct to own a lock on a\ndirectory for the duration of its lifetime. It is used in the next\ncommit.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmevth8ACgkQm3m0VpHb\nQXMkQw/6ApXVk38JYVD7TYXF72c5HlRPP4/kuZ/edisk0igo+EbpLHf2NLYY/d9S\nNNzlpRPqoHkYF6FBhdIIf5hRaMCbTB7nOscpx7qUjzq2wfXGXEgmVNr1dSjXg6vV\nG80qbCNVKsRJwpgo8X3QjM8jx0rcxGvA35X3+cJ1BFtGBlvj4f6p5ZtLEY2NEd4i\nblDe+GqCP1JRZEzF6sNAsj/qRdX3SXBZ0NYjZ68jr0vu9FFlhCZ8tpLC5l8TtwXt\nFOHglcZ6sx/9n2AakPV3bU/naTqRaWflMpD8seOWp9xlV+xTa2yDx5GFOZZjAuRc\nrF42zFHAMpAsrRG2kyHnq4TsxLrHg7In5TD0iZnNsGbCeHRC/IBOsnZhRtEptY+8\nmrJiEuOh+fSUTTW64lGip8YoTP1lFiGzFfXkW0Y3O5an0qvojnoK8f7v3s1GKZ8o\n0ZBYO+ZkbDm3yYibYrBBt9FkkOLRg6Tzzf40o2xdQwozgbk4uVe4vszcXEWnoHe4\nxlibST1yie4CK9cGjrajsumNfEMZKvFdtLtsZaLDF4Pmbnkf4MsHs8EzZgwrFkCH\n+sdSfHkWsJ45AIgVfTuHJH9aAYwmyfg3H66WyQeZDjI/Xd3Nl44tCxxDpOCuXTd/\n6qgIU+Wv95oDc5ZVdYr05D2AUU7LogGq1ip2KxyNcbAdbbYQ8bY=\n=11KB\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/de844c79d4df7a1349d7122494ae5e1de765c0d8",
          "sha": "de844c79d4df7a1349d7122494ae5e1de765c0d8",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/de844c79d4df7a1349d7122494ae5e1de765c0d8"
        }
      ],
      "message": "util: Add RAII directory lock\n\nThis makes it easier for a class or a struct to own a lock on a\ndirectory for the duration of its lifetime. It is used in the next\ncommit.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-14T21:31:11Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-14T21:20:05Z"
      },
      "sha": "f1478428748d47a85ca8a1b734d966af3bc07c44"
    },
    {
      "event": "committed",
      "id": null,
      "node_id": "C_kwDOABII59oAKDYyYWQxZDY5ZGMwMTYyNDQ4MTFmZDJlYmY5YzYzNTZhZGQxZDVlNDM",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "actor": null,
      "commit_id": null,
      "commit_url": null,
      "created_at": null,
      "html_url": "https://github.com/bitcoin/bitcoin/commit/62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "tree": {
        "sha": "cdd33507b19eb1b41daaa5e9a28af912fb945467",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cdd33507b19eb1b41daaa5e9a28af912fb945467"
      },
      "verification": {
        "verified": true,
        "reason": "valid",
        "payload": "tree cdd33507b19eb1b41daaa5e9a28af912fb945467\nparent f1478428748d47a85ca8a1b734d966af3bc07c44\nauthor TheCharlatan <seb.kung@gmail.com> 1739568054 +0100\ncommitter TheCharlatan <seb.kung@gmail.com> 1739568680 +0100\n\ninit: Take lock on blocks directory in BlockManager ctor\n\nThis moves the responsibility of taking the lock for the blocks\ndirectory into the BlockManager. Use the DirectoryLock wrapper to ensure\nit is the first resource to be acquired and is released again after use.\n\nThis is relevant for the kernel library where the lock should be taken\neven if the user fails to explicitly do so.\n",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE8s/Eq9C5nYN+67fQm3m0VpHbQXMFAmevtigACgkQm3m0VpHb\nQXM10g//eVfPm1OUhUsQp0CuMLftabhFffTwXrIurXddCoW6V1I86S5NYIyJMTAK\nZdM+dqt+8JIT0TcSxl48A31lAFhZlsf6tJ9sw3ftXAxLWL5dyYrinKSFKOTFVJRr\nhZVLnVeSyQrTFzzHeQpwJa8ZZ4umPVonHzr0dTSwci/CQlJ67hK7f1P333VHIv/Q\nNIJZeJBtHSbTQdTpyVpWqXpjPTfX2/To3B2nt8LNjWvT7HzXO6rtSAV4Vbtzd2pC\nFn47rAg08pLn/vmUyzn7m2NV3VECXrwU6EQNXnSEVyqw/PGYZkm0GnCjamzsUfnZ\n2DmkwEJK2nku9ftetNVb3GfQYuHmqEfz3EbMv/zbwrkUJtr3/kcBwbXf4wmqYOLW\nsw29DiU+w2dmruHEw9Z25O5iguy99AdejNAAPdVJYgzMKybdiDJVzycRpWsgEQTh\ne6Sd7TkLGp0trj8SMsEfqz+Q8Ysv3NzfpTiO0jY6S+rRnJaVWh2PDp0HTsSs2WhI\nFt3VCeYxtvmRi4z+CUNDlx3L72GbkSQfeBX2TKD0qEoXnAjK0acjhoRJdK0s560k\nGJ1RrlJ9PMhbRjaQJ7WD9+c35w3lFkhGwSHgti8nC+PGmBB19lVFfXXyYhemHQSG\nP0BzHTKLX6yVD8GEXxAPneY6/swTCJP6hi5eHOdusZbZpzUtMJA=\n=icxA\n-----END PGP SIGNATURE-----"
      },
      "parents": [
        {
          "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f1478428748d47a85ca8a1b734d966af3bc07c44",
          "sha": "f1478428748d47a85ca8a1b734d966af3bc07c44",
          "html_url": "https://github.com/bitcoin/bitcoin/commit/f1478428748d47a85ca8a1b734d966af3bc07c44"
        }
      ],
      "message": "init: Take lock on blocks directory in BlockManager ctor\n\nThis moves the responsibility of taking the lock for the blocks\ndirectory into the BlockManager. Use the DirectoryLock wrapper to ensure\nit is the first resource to be acquired and is released again after use.\n\nThis is relevant for the kernel library where the lock should be taken\neven if the user fails to explicitly do so.",
      "committer": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-14T21:31:20Z"
      },
      "author": {
        "name": "TheCharlatan",
        "email": "seb.kung@gmail.com",
        "date": "2025-02-14T21:20:54Z"
      },
      "sha": "62ad1d69dc016244811fd2ebf9c6356add1d5e43"
    },
    {
      "event": "head_ref_force_pushed",
      "id": 16317650486,
      "node_id": "HRFPE_lADOABII586p_zNxzwAAAAPMm5Y2",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16317650486",
      "actor": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "commit_url": "https://api.github.com/repos/TheCharlatan/bitcoin/commits/62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "created_at": "2025-02-14T21:31:53Z"
    },
    {
      "event": "commented",
      "id": 2660309397,
      "node_id": "IC_kwDOABII586ekRmV",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/2660309397",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-14T21:31:58Z",
      "updated_at": "2025-02-14T21:31:58Z",
      "author_association": "CONTRIBUTOR",
      "body": "<!--85328a0da195eb286784d51f73fa0af9-->\n🚧 At least one of the CI tasks failed.\n<sub>Debug: https://github.com/bitcoin/bitcoin/runs/37256718772</sub>\n\n<details><summary>Hints</summary>\n\nTry to run the tests locally, according to the documentation. However, a CI failure may still\nhappen due to a number of reasons, for example:\n\n* Possibly due to a silent merge conflict (the changes in this pull request being\nincompatible with the current code in the target branch). If so, make sure to rebase on the latest\ncommit of the target branch.\n\n* A sanitizer issue, which can only be found by compiling with the sanitizer and running the\n  affected test.\n\n* An intermittent issue.\n\nLeave a comment here, if you need help tracking down a confusing failure.\n\n</details>\n",
      "user": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#issuecomment-2660309397",
      "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/31860"
    },
    {
      "event": "labeled",
      "id": 16317651101,
      "node_id": "LE_lADOABII586p_zNxzwAAAAPMm5id",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16317651101",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-14T21:31:58Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    },
    {
      "event": "unlabeled",
      "id": 16318979435,
      "node_id": "UNLE_lADOABII586p_zNxzwAAAAPMr91r",
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/events/16318979435",
      "actor": {
        "login": "DrahtBot",
        "id": 39886733,
        "node_id": "MDQ6VXNlcjM5ODg2NzMz",
        "avatar_url": "https://avatars.githubusercontent.com/u/39886733?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/DrahtBot",
        "html_url": "https://github.com/DrahtBot",
        "followers_url": "https://api.github.com/users/DrahtBot/followers",
        "following_url": "https://api.github.com/users/DrahtBot/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/DrahtBot/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/DrahtBot/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
        "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
        "repos_url": "https://api.github.com/users/DrahtBot/repos",
        "events_url": "https://api.github.com/users/DrahtBot/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "commit_id": null,
      "commit_url": null,
      "created_at": "2025-02-15T00:21:02Z",
      "label": {
        "name": "CI failed",
        "color": "cccccc"
      }
    }
  ],
  "comments": [
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956244596",
      "pull_request_review_id": 2617967456,
      "id": 1956244596,
      "node_id": "PRRC_kwDOABII5850mex0",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 4,
      "commit_id": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "It seems like this class could easily be reused for chainstate, datadir, wallet, ... directories in future commits. Perhaps a `class DirectoryLock` would make sense?",
      "created_at": "2025-02-14T14:33:21Z",
      "updated_at": "2025-02-14T18:04:15Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956244596",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956244596"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 130,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956371573",
      "pull_request_review_id": 2617967456,
      "id": 1956371573,
      "node_id": "PRRC_kwDOABII5850m9x1",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock\n+{\n+    fs::path m_path;\n+\n+public:",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 8,
      "commit_id": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "Copy ctor and assignment operator should probably be deleted?",
      "created_at": "2025-02-14T15:55:16Z",
      "updated_at": "2025-02-14T18:03:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956371573",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956371573"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956484013",
      "pull_request_review_id": 2617967456,
      "id": 1956484013,
      "node_id": "PRRC_kwDOABII5850nZOt",
      "diff_hunk": "@@ -1109,8 +1109,9 @@ static bool LockDirectory(const fs::path& dir, bool probeOnly)\n }\n static bool LockDirectories(bool probeOnly)\n {\n-    return LockDirectory(gArgs.GetDataDirNet(), probeOnly) && \\\n-           LockDirectory(gArgs.GetBlocksDirPath(), probeOnly);\n+    // Only allow probing the blocks directory, the BlockManager takes the lock internally.\n+    return LockDirectory(gArgs.GetDataDirNet(), probeOnly) &&\n+           (probeOnly ? LockDirectory(gArgs.GetBlocksDirPath(), probeOnly) : true);",
      "path": "src/init.cpp",
      "position": null,
      "original_position": 8,
      "commit_id": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": null,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "At this point, I don't see the benefit of this function anymore. Let's just inline it?\r\n\r\n<details>\r\n<summary>git diff on 436df349f0</summary>\r\n\r\n```diff\r\ndiff --git a/src/init.cpp b/src/init.cpp\r\nindex 579669712e..3a984488af 100644\r\n--- a/src/init.cpp\r\n+++ b/src/init.cpp\r\n@@ -1107,12 +1107,6 @@ static bool LockDirectory(const fs::path& dir, bool probeOnly)\r\n     } // no default case, so the compiler can warn about missing cases\r\n     assert(false);\r\n }\r\n-static bool LockDirectories(bool probeOnly)\r\n-{\r\n-    // Only allow probing the blocks directory, the BlockManager takes the lock internally.\r\n-    return LockDirectory(gArgs.GetDataDirNet(), probeOnly) &&\r\n-           (probeOnly ? LockDirectory(gArgs.GetBlocksDirPath(), probeOnly) : true);\r\n-}\r\n \r\n bool AppInitSanityChecks(const kernel::Context& kernel)\r\n {\r\n@@ -1130,7 +1124,8 @@ bool AppInitSanityChecks(const kernel::Context& kernel)\r\n     // Probe the directory locks to give an early error message, if possible\r\n     // We cannot hold the directory locks here, as the forking for daemon() hasn't yet happened,\r\n     // and a fork will cause weird behavior to them.\r\n-    return LockDirectories(true);\r\n+    return LockDirectory(gArgs.GetDataDirNet(), /*probeOnly=*/true)\r\n+        && LockDirectory(gArgs.GetBlocksDirPath(), /*probeOnly=*/true);\r\n }\r\n \r\n bool AppInitLockDirectories()\r\n@@ -1138,11 +1133,8 @@ bool AppInitLockDirectories()\r\n     // After daemonization get the directory locks again and hold on to them until exit\r\n     // This creates a slight window for a race condition to happen, however this condition is harmless: it\r\n     // will at most make us exit without printing a message to console.\r\n-    if (!LockDirectories(false)) {\r\n-        // Detailed error printed inside LockDirectory\r\n-        return false;\r\n-    }\r\n-    return true;\r\n+    // Detailed error printed inside LockDirectory\r\n+    return LockDirectory(gArgs.GetDataDirNet(), /*probeOnly=*/false);\r\n }\r\n \r\n bool AppInitInterfaces(NodeContext& node)\r\n\r\n```\r\n</details>\r\n",
      "created_at": "2025-02-14T17:16:07Z",
      "updated_at": "2025-02-14T18:03:47Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956484013",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956484013"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": 1112,
      "start_side": "RIGHT",
      "line": null,
      "original_line": 1114,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956541082",
      "pull_request_review_id": 2618491099,
      "id": 1956541082,
      "node_id": "PRRC_kwDOABII5850nnKa",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock\n+{\n+    fs::path m_path;\n+\n+public:",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 8,
      "commit_id": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": 1956371573,
      "user": {
        "login": "stickies-v",
        "id": 69010457,
        "node_id": "MDQ6VXNlcjY5MDEwNDU3",
        "avatar_url": "https://avatars.githubusercontent.com/u/69010457?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/stickies-v",
        "html_url": "https://github.com/stickies-v",
        "followers_url": "https://api.github.com/users/stickies-v/followers",
        "following_url": "https://api.github.com/users/stickies-v/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/stickies-v/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/stickies-v/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/stickies-v/subscriptions",
        "organizations_url": "https://api.github.com/users/stickies-v/orgs",
        "repos_url": "https://api.github.com/users/stickies-v/repos",
        "events_url": "https://api.github.com/users/stickies-v/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/stickies-v/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "And have `BlockManager::m_lock` be a `std::unique_ptr<BlockDirLock>` instead?",
      "created_at": "2025-02-14T18:06:40Z",
      "updated_at": "2025-02-14T18:06:40Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956541082",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956541082"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    },
    {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956747029",
      "pull_request_review_id": 2618853313,
      "id": 1956747029,
      "node_id": "PRRC_kwDOABII5850oZcV",
      "diff_hunk": "@@ -127,6 +127,14 @@ struct BlockfileCursor {\n \n std::ostream& operator<<(std::ostream& os, const BlockfileCursor& cursor);\n \n+class BlockDirLock\n+{\n+    fs::path m_path;\n+\n+public:",
      "path": "src/node/blockstorage.h",
      "position": null,
      "original_position": 8,
      "commit_id": "62ad1d69dc016244811fd2ebf9c6356add1d5e43",
      "original_commit_id": "436df349f065658f89aecadd2d8a0d6da2fb85fd",
      "in_reply_to_id": 1956371573,
      "user": {
        "login": "TheCharlatan",
        "id": 8421793,
        "node_id": "MDQ6VXNlcjg0MjE3OTM=",
        "avatar_url": "https://avatars.githubusercontent.com/u/8421793?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/TheCharlatan",
        "html_url": "https://github.com/TheCharlatan",
        "followers_url": "https://api.github.com/users/TheCharlatan/followers",
        "following_url": "https://api.github.com/users/TheCharlatan/following%7B/other_user%7D",
        "gists_url": "https://api.github.com/users/TheCharlatan/gists%7B/gist_id%7D",
        "starred_url": "https://api.github.com/users/TheCharlatan/starred%7B/owner%7D%7B/repo%7D",
        "subscriptions_url": "https://api.github.com/users/TheCharlatan/subscriptions",
        "organizations_url": "https://api.github.com/users/TheCharlatan/orgs",
        "repos_url": "https://api.github.com/users/TheCharlatan/repos",
        "events_url": "https://api.github.com/users/TheCharlatan/events%7B/privacy%7D",
        "received_events_url": "https://api.github.com/users/TheCharlatan/received_events",
        "type": "User",
        "site_admin": false,
        "patch_url": null
      },
      "body": "I've been thinking about allocating it on the heap instead, but I kind of like that declaring it as the first field forces us to initialize it first, which a pointer type would not necessarily. Then again, moving the lock as a unique pointer from the options to the actual class would also probably be easier than defining a move constructor the directory lock class.",
      "created_at": "2025-02-14T21:36:32Z",
      "updated_at": "2025-02-14T21:36:32Z",
      "html_url": "https://github.com/bitcoin/bitcoin/pull/31860#discussion_r1956747029",
      "author_association": "CONTRIBUTOR",
      "_links": {
        "self": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/1956747029"
        },
        "pull_request": {
          "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/31860"
        }
      },
      "start_line": null,
      "original_start_line": null,
      "start_side": null,
      "line": null,
      "original_line": 134,
      "side": "RIGHT"
    }
  ]
}